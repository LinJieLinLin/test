function isIE(e,t){var n,a=window.navigator.userAgent.toLowerCase();if(-1!=a.indexOf("msie")){var i=a.match(/msie\s([0-9]*)/);n=0===arguments.length?i[1]:1===arguments.length?parseInt(i[1])===e:i[1]>=e&&i[1]<=t?i[1]:!1}return n}(function(e){function t(e,t,n){switch(arguments.length){case 2:return null!=e?e:t;case 3:return null!=e?e:null!=t?t:n;default:throw new Error("Implement me")}}function n(e,t){return Se.call(e,t)}function a(){return{empty:!1,unusedTokens:[],unusedInput:[],overflow:-2,charsLeftOver:0,nullInput:!1,invalidMonth:null,invalidFormat:!1,userInvalidated:!1,iso:!1}}function i(e){we.suppressDeprecationWarnings===!1&&"undefined"!=typeof console&&console.warn&&console.warn("Deprecation warning: "+e)}function r(e,t){var n=!0;return g(function(){return n&&(i(e),n=!1),t.apply(this,arguments)},t)}function s(e,t){mt[e]||(i(t),mt[e]=!0)}function o(e,t){return function(n){return f(e.call(this,n),t)}}function c(e,t){return function(n){return this.localeData().ordinal(e.call(this,n),t)}}function l(){}function u(e,t){t!==!1&&A(e),h(this,e),this._d=new Date(+e._d)}function d(e){var t=x(e),n=t.year||0,a=t.quarter||0,i=t.month||0,r=t.week||0,s=t.day||0,o=t.hour||0,c=t.minute||0,l=t.second||0,u=t.millisecond||0;this._milliseconds=+u+1e3*l+6e4*c+36e5*o,this._days=+s+7*r,this._months=+i+3*a+12*n,this._data={},this._locale=we.localeData(),this._bubble()}function g(e,t){for(var a in t)n(t,a)&&(e[a]=t[a]);return n(t,"toString")&&(e.toString=t.toString),n(t,"valueOf")&&(e.valueOf=t.valueOf),e}function h(e,t){var n,a,i;if("undefined"!=typeof t._isAMomentObject&&(e._isAMomentObject=t._isAMomentObject),"undefined"!=typeof t._i&&(e._i=t._i),"undefined"!=typeof t._f&&(e._f=t._f),"undefined"!=typeof t._l&&(e._l=t._l),"undefined"!=typeof t._strict&&(e._strict=t._strict),"undefined"!=typeof t._tzm&&(e._tzm=t._tzm),"undefined"!=typeof t._isUTC&&(e._isUTC=t._isUTC),"undefined"!=typeof t._offset&&(e._offset=t._offset),"undefined"!=typeof t._pf&&(e._pf=t._pf),"undefined"!=typeof t._locale&&(e._locale=t._locale),Oe.length>0)for(n in Oe)a=Oe[n],i=t[a],"undefined"!=typeof i&&(e[a]=i);return e}function p(e){return 0>e?Math.ceil(e):Math.floor(e)}function f(e,t,n){for(var a=""+Math.abs(e),i=e>=0;a.length<t;)a="0"+a;return(i?n?"+":"":"-")+a}function m(e,t){var n={milliseconds:0,months:0};return n.months=t.month()-e.month()+12*(t.year()-e.year()),e.clone().add(n.months,"M").isAfter(t)&&--n.months,n.milliseconds=+t-+e.clone().add(n.months,"M"),n}function v(e,t){var n;return t=$(t,e),e.isBefore(t)?n=m(e,t):(n=m(t,e),n.milliseconds=-n.milliseconds,n.months=-n.months),n}function y(e,t){return function(n,a){var i,r;return null===a||isNaN(+a)||(s(t,"moment()."+t+"(period, number) is deprecated. Please use moment()."+t+"(number, period)."),r=n,n=a,a=r),n="string"==typeof n?+n:n,i=we.duration(n,a),w(this,i,e),this}}function w(e,t,n,a){var i=t._milliseconds,r=t._days,s=t._months;a=null==a?!0:a,i&&e._d.setTime(+e._d+i*n),r&&he(e,"Date",ge(e,"Date")+r*n),s&&de(e,ge(e,"Month")+s*n),a&&we.updateOffset(e,r||s)}function b(e){return"[object Array]"===Object.prototype.toString.call(e)}function k(e){return"[object Date]"===Object.prototype.toString.call(e)||e instanceof Date}function T(e,t,n){var a,i=Math.min(e.length,t.length),r=Math.abs(e.length-t.length),s=0;for(a=0;i>a;a++)(n&&e[a]!==t[a]||!n&&M(e[a])!==M(t[a]))&&s++;return s+r}function _(e){if(e){var t=e.toLowerCase().replace(/(.)s$/,"$1");e=lt[e]||ut[t]||t}return e}function x(e){var t,a,i={};for(a in e)n(e,a)&&(t=_(a),t&&(i[t]=e[a]));return i}function S(t){var n,a;if(0===t.indexOf("week"))n=7,a="day";else{if(0!==t.indexOf("month"))return;n=12,a="month"}we[t]=function(i,r){var s,o,c=we._locale[t],l=[];if("number"==typeof i&&(r=i,i=e),o=function(e){var t=we().utc().set(a,e);return c.call(we._locale,t,i||"")},null!=r)return o(r);for(s=0;n>s;s++)l.push(o(s));return l}}function M(e){var t=+e,n=0;return 0!==t&&isFinite(t)&&(n=t>=0?Math.floor(t):Math.ceil(t)),n}function C(e,t){return new Date(Date.UTC(e,t+1,0)).getUTCDate()}function D(e,t,n){return oe(we([e,11,31+t-n]),t,n).week}function L(e){return U(e)?366:365}function U(e){return e%4===0&&e%100!==0||e%400===0}function A(e){var t;e._a&&-2===e._pf.overflow&&(t=e._a[Ce]<0||e._a[Ce]>11?Ce:e._a[De]<1||e._a[De]>C(e._a[Me],e._a[Ce])?De:e._a[Le]<0||e._a[Le]>24||24===e._a[Le]&&(0!==e._a[Ue]||0!==e._a[Ae]||0!==e._a[Ee])?Le:e._a[Ue]<0||e._a[Ue]>59?Ue:e._a[Ae]<0||e._a[Ae]>59?Ae:e._a[Ee]<0||e._a[Ee]>999?Ee:-1,e._pf._overflowDayOfYear&&(Me>t||t>De)&&(t=De),e._pf.overflow=t)}function E(t){return null==t._isValid&&(t._isValid=!isNaN(t._d.getTime())&&t._pf.overflow<0&&!t._pf.empty&&!t._pf.invalidMonth&&!t._pf.nullInput&&!t._pf.invalidFormat&&!t._pf.userInvalidated,t._strict&&(t._isValid=t._isValid&&0===t._pf.charsLeftOver&&0===t._pf.unusedTokens.length&&t._pf.bigHour===e)),t._isValid}function I(e){return e?e.toLowerCase().replace("_","-"):e}function O(e){for(var t,n,a,i,r=0;r<e.length;){for(i=I(e[r]).split("-"),t=i.length,n=I(e[r+1]),n=n?n.split("-"):null;t>0;){if(a=N(i.slice(0,t).join("-")))return a;if(n&&n.length>=t&&T(i,n,!0)>=t-1)break;t--}r++}return null}function N(e){var t=null;if(!Ie[e]&&Ne)try{t=we.locale(),require("./locale/"+e),we.locale(t)}catch(n){}return Ie[e]}function $(e,t){var n,a;return t._isUTC?(n=t.clone(),a=(we.isMoment(e)||k(e)?+e:+we(e))-+n,n._d.setTime(+n._d+a),we.updateOffset(n,!1),n):we(e).local()}function P(e){return e.match(/\[[\s\S]/)?e.replace(/^\[|\]$/g,""):e.replace(/\\/g,"")}function F(e){var t,n,a=e.match(Re);for(t=0,n=a.length;n>t;t++)ft[a[t]]?a[t]=ft[a[t]]:a[t]=P(a[t]);return function(i){var r="";for(t=0;n>t;t++)r+=a[t]instanceof Function?a[t].call(i,e):a[t];return r}}function R(e,t){return e.isValid()?(t=G(t,e.localeData()),dt[t]||(dt[t]=F(t)),dt[t](e)):e.localeData().invalidDate()}function G(e,t){function n(e){return t.longDateFormat(e)||e}var a=5;for(Ge.lastIndex=0;a>=0&&Ge.test(e);)e=e.replace(Ge,n),Ge.lastIndex=0,a-=1;return e}function Y(e,t){var n,a=t._strict;switch(e){case"Q":return Xe;case"DDDD":return Qe;case"YYYY":case"GGGG":case"gggg":return a?et:We;case"Y":case"G":case"g":return nt;case"YYYYYY":case"YYYYY":case"GGGGG":case"ggggg":return a?tt:je;case"S":if(a)return Xe;case"SS":if(a)return Ze;case"SSS":if(a)return Qe;case"DDD":return ze;case"MMM":case"MMMM":case"dd":case"ddd":case"dddd":return qe;case"a":case"A":return t._locale._meridiemParse;case"x":return Ke;case"X":return Je;case"Z":case"ZZ":return Be;case"T":return Ve;case"SSSS":return He;case"MM":case"DD":case"YY":case"GG":case"gg":case"HH":case"hh":case"mm":case"ss":case"ww":case"WW":return a?Ze:Ye;case"M":case"D":case"d":case"H":case"h":case"m":case"s":case"w":case"W":case"e":case"E":return Ye;case"Do":return a?t._locale._ordinalParse:t._locale._ordinalParseLenient;default:return n=new RegExp(J(K(e.replace("\\","")),"i"))}}function z(e){e=e||"";var t=e.match(Be)||[],n=t[t.length-1]||[],a=(n+"").match(ot)||["-",0,0],i=+(60*a[1])+M(a[2]);return"+"===a[0]?-i:i}function W(e,t,n){var a,i=n._a;switch(e){case"Q":null!=t&&(i[Ce]=3*(M(t)-1));break;case"M":case"MM":null!=t&&(i[Ce]=M(t)-1);break;case"MMM":case"MMMM":a=n._locale.monthsParse(t,e,n._strict),null!=a?i[Ce]=a:n._pf.invalidMonth=t;break;case"D":case"DD":null!=t&&(i[De]=M(t));break;case"Do":null!=t&&(i[De]=M(parseInt(t.match(/\d{1,2}/)[0],10)));break;case"DDD":case"DDDD":null!=t&&(n._dayOfYear=M(t));break;case"YY":i[Me]=we.parseTwoDigitYear(t);break;case"YYYY":case"YYYYY":case"YYYYYY":i[Me]=M(t);break;case"a":case"A":n._isPm=n._locale.isPM(t);break;case"h":case"hh":n._pf.bigHour=!0;case"H":case"HH":i[Le]=M(t);break;case"m":case"mm":i[Ue]=M(t);break;case"s":case"ss":i[Ae]=M(t);break;case"S":case"SS":case"SSS":case"SSSS":i[Ee]=M(1e3*("0."+t));break;case"x":n._d=new Date(M(t));break;case"X":n._d=new Date(1e3*parseFloat(t));break;case"Z":case"ZZ":n._useUTC=!0,n._tzm=z(t);break;case"dd":case"ddd":case"dddd":a=n._locale.weekdaysParse(t),null!=a?(n._w=n._w||{},n._w.d=a):n._pf.invalidWeekday=t;break;case"w":case"ww":case"W":case"WW":case"d":case"e":case"E":e=e.substr(0,1);case"gggg":case"GGGG":case"GGGGG":e=e.substr(0,2),t&&(n._w=n._w||{},n._w[e]=M(t));break;case"gg":case"GG":n._w=n._w||{},n._w[e]=we.parseTwoDigitYear(t)}}function j(e){var n,a,i,r,s,o,c;n=e._w,null!=n.GG||null!=n.W||null!=n.E?(s=1,o=4,a=t(n.GG,e._a[Me],oe(we(),1,4).year),i=t(n.W,1),r=t(n.E,1)):(s=e._locale._week.dow,o=e._locale._week.doy,a=t(n.gg,e._a[Me],oe(we(),s,o).year),i=t(n.w,1),null!=n.d?(r=n.d,s>r&&++i):r=null!=n.e?n.e+s:s),c=ce(a,i,r,o,s),e._a[Me]=c.year,e._dayOfYear=c.dayOfYear}function H(e){var n,a,i,r,s=[];if(!e._d){for(i=B(e),e._w&&null==e._a[De]&&null==e._a[Ce]&&j(e),e._dayOfYear&&(r=t(e._a[Me],i[Me]),e._dayOfYear>L(r)&&(e._pf._overflowDayOfYear=!0),a=ae(r,0,e._dayOfYear),e._a[Ce]=a.getUTCMonth(),e._a[De]=a.getUTCDate()),n=0;3>n&&null==e._a[n];++n)e._a[n]=s[n]=i[n];for(;7>n;n++)e._a[n]=s[n]=null==e._a[n]?2===n?1:0:e._a[n];24===e._a[Le]&&0===e._a[Ue]&&0===e._a[Ae]&&0===e._a[Ee]&&(e._nextDay=!0,e._a[Le]=0),e._d=(e._useUTC?ae:ne).apply(null,s),null!=e._tzm&&e._d.setUTCMinutes(e._d.getUTCMinutes()+e._tzm),e._nextDay&&(e._a[Le]=24)}}function q(e){var t;e._d||(t=x(e._i),e._a=[t.year,t.month,t.day||t.date,t.hour,t.minute,t.second,t.millisecond],H(e))}function B(e){var t=new Date;return e._useUTC?[t.getUTCFullYear(),t.getUTCMonth(),t.getUTCDate()]:[t.getFullYear(),t.getMonth(),t.getDate()]}function V(t){if(t._f===we.ISO_8601)return void Z(t);t._a=[],t._pf.empty=!0;var n,a,i,r,s,o=""+t._i,c=o.length,l=0;for(i=G(t._f,t._locale).match(Re)||[],n=0;n<i.length;n++)r=i[n],a=(o.match(Y(r,t))||[])[0],a&&(s=o.substr(0,o.indexOf(a)),s.length>0&&t._pf.unusedInput.push(s),o=o.slice(o.indexOf(a)+a.length),l+=a.length),ft[r]?(a?t._pf.empty=!1:t._pf.unusedTokens.push(r),W(r,a,t)):t._strict&&!a&&t._pf.unusedTokens.push(r);t._pf.charsLeftOver=c-l,o.length>0&&t._pf.unusedInput.push(o),t._pf.bigHour===!0&&t._a[Le]<=12&&(t._pf.bigHour=e),t._isPm&&t._a[Le]<12&&(t._a[Le]+=12),t._isPm===!1&&12===t._a[Le]&&(t._a[Le]=0),H(t),A(t)}function K(e){return e.replace(/\\(\[)|\\(\])|\[([^\]\[]*)\]|\\(.)/g,function(e,t,n,a,i){return t||n||a||i})}function J(e){return e.replace(/[-\/\\^$*+?.()|[\]{}]/g,"\\$&")}function X(e){var t,n,i,r,s;if(0===e._f.length)return e._pf.invalidFormat=!0,void(e._d=new Date(NaN));for(r=0;r<e._f.length;r++)s=0,t=h({},e),null!=e._useUTC&&(t._useUTC=e._useUTC),t._pf=a(),t._f=e._f[r],V(t),E(t)&&(s+=t._pf.charsLeftOver,s+=10*t._pf.unusedTokens.length,t._pf.score=s,(null==i||i>s)&&(i=s,n=t));g(e,n||t)}function Z(e){var t,n,a=e._i,i=at.exec(a);if(i){for(e._pf.iso=!0,t=0,n=rt.length;n>t;t++)if(rt[t][1].exec(a)){e._f=rt[t][0]+(i[6]||" ");break}for(t=0,n=st.length;n>t;t++)if(st[t][1].exec(a)){e._f+=st[t][0];break}a.match(Be)&&(e._f+="Z"),V(e)}else e._isValid=!1}function Q(e){Z(e),e._isValid===!1&&(delete e._isValid,we.createFromInputFallback(e))}function ee(e,t){var n,a=[];for(n=0;n<e.length;++n)a.push(t(e[n],n));return a}function te(t){var n,a=t._i;a===e?t._d=new Date:k(a)?t._d=new Date(+a):null!==(n=$e.exec(a))?t._d=new Date(+n[1]):"string"==typeof a?Q(t):b(a)?(t._a=ee(a.slice(0),function(e){return parseInt(e,10)}),H(t)):"object"==typeof a?q(t):"number"==typeof a?t._d=new Date(a):we.createFromInputFallback(t)}function ne(e,t,n,a,i,r,s){var o=new Date(e,t,n,a,i,r,s);return 1970>e&&o.setFullYear(e),o}function ae(e){var t=new Date(Date.UTC.apply(null,arguments));return 1970>e&&t.setUTCFullYear(e),t}function ie(e,t){if("string"==typeof e)if(isNaN(e)){if(e=t.weekdaysParse(e),"number"!=typeof e)return null}else e=parseInt(e,10);return e}function re(e,t,n,a,i){return i.relativeTime(t||1,!!n,e,a)}function se(e,t,n){var a=we.duration(e).abs(),i=xe(a.as("s")),r=xe(a.as("m")),s=xe(a.as("h")),o=xe(a.as("d")),c=xe(a.as("M")),l=xe(a.as("y")),u=i<gt.s&&["s",i]||1===r&&["m"]||r<gt.m&&["mm",r]||1===s&&["h"]||s<gt.h&&["hh",s]||1===o&&["d"]||o<gt.d&&["dd",o]||1===c&&["M"]||c<gt.M&&["MM",c]||1===l&&["y"]||["yy",l];return u[2]=t,u[3]=+e>0,u[4]=n,re.apply({},u)}function oe(e,t,n){var a,i=n-t,r=n-e.day();return r>i&&(r-=7),i-7>r&&(r+=7),a=we(e).add(r,"d"),{week:Math.ceil(a.dayOfYear()/7),year:a.year()}}function ce(e,t,n,a,i){var r,s,o=ae(e,0,1).getUTCDay();return o=0===o?7:o,n=null!=n?n:i,r=i-o+(o>a?7:0)-(i>o?7:0),s=7*(t-1)+(n-i)+r+1,{year:s>0?e:e-1,dayOfYear:s>0?s:L(e-1)+s}}function le(t){var n,a=t._i,i=t._f;return t._locale=t._locale||we.localeData(t._l),null===a||i===e&&""===a?we.invalid({nullInput:!0}):("string"==typeof a&&(t._i=a=t._locale.preparse(a)),we.isMoment(a)?new u(a,!0):(i?b(i)?X(t):V(t):te(t),n=new u(t),n._nextDay&&(n.add(1,"d"),n._nextDay=e),n))}function ue(e,t){var n,a;if(1===t.length&&b(t[0])&&(t=t[0]),!t.length)return we();for(n=t[0],a=1;a<t.length;++a)t[a][e](n)&&(n=t[a]);return n}function de(e,t){var n;return"string"==typeof t&&(t=e.localeData().monthsParse(t),"number"!=typeof t)?e:(n=Math.min(e.date(),C(e.year(),t)),e._d["set"+(e._isUTC?"UTC":"")+"Month"](t,n),e)}function ge(e,t){return e._d["get"+(e._isUTC?"UTC":"")+t]()}function he(e,t,n){return"Month"===t?de(e,n):e._d["set"+(e._isUTC?"UTC":"")+t](n)}function pe(e,t){return function(n){return null!=n?(he(this,e,n),we.updateOffset(this,t),this):ge(this,e)}}function fe(e){return 400*e/146097}function me(e){return 146097*e/400}function ve(e){we.duration.fn[e]=function(){return this._data[e]}}function ye(e){"undefined"==typeof ender&&(be=_e.moment,e?_e.moment=r("Accessing Moment through the global scope is deprecated, and will be removed in an upcoming release.",we):_e.moment=we)}for(var we,be,ke,Te="2.8.4",_e="undefined"!=typeof global?global:this,xe=Math.round,Se=Object.prototype.hasOwnProperty,Me=0,Ce=1,De=2,Le=3,Ue=4,Ae=5,Ee=6,Ie={},Oe=[],Ne="undefined"!=typeof module&&module&&module.exports,$e=/^\/?Date\((\-?\d+)/i,Pe=/(\-)?(?:(\d*)\.)?(\d+)\:(\d+)(?:\:(\d+)\.?(\d{3})?)?/,Fe=/^(-)?P(?:(?:([0-9,.]*)Y)?(?:([0-9,.]*)M)?(?:([0-9,.]*)D)?(?:T(?:([0-9,.]*)H)?(?:([0-9,.]*)M)?(?:([0-9,.]*)S)?)?|([0-9,.]*)W)$/,Re=/(\[[^\[]*\])|(\\)?(Mo|MM?M?M?|Do|DDDo|DD?D?D?|ddd?d?|do?|w[o|w]?|W[o|W]?|Q|YYYYYY|YYYYY|YYYY|YY|gg(ggg?)?|GG(GGG?)?|e|E|a|A|hh?|HH?|mm?|ss?|S{1,4}|x|X|zz?|ZZ?|.)/g,Ge=/(\[[^\[]*\])|(\\)?(LTS|LT|LL?L?L?|l{1,4})/g,Ye=/\d\d?/,ze=/\d{1,3}/,We=/\d{1,4}/,je=/[+\-]?\d{1,6}/,He=/\d+/,qe=/[0-9]*['a-z\u00A0-\u05FF\u0700-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF]+|[\u0600-\u06FF\/]+(\s*?[\u0600-\u06FF]+){1,2}/i,Be=/Z|[\+\-]\d\d:?\d\d/gi,Ve=/T/i,Ke=/[\+\-]?\d+/,Je=/[\+\-]?\d+(\.\d{1,3})?/,Xe=/\d/,Ze=/\d\d/,Qe=/\d{3}/,et=/\d{4}/,tt=/[+-]?\d{6}/,nt=/[+-]?\d+/,at=/^\s*(?:[+-]\d{6}|\d{4})-(?:(\d\d-\d\d)|(W\d\d$)|(W\d\d-\d)|(\d\d\d))((T| )(\d\d(:\d\d(:\d\d(\.\d+)?)?)?)?([\+\-]\d\d(?::?\d\d)?|\s*Z)?)?$/,it="YYYY-MM-DDTHH:mm:ssZ",rt=[["YYYYYY-MM-DD",/[+-]\d{6}-\d{2}-\d{2}/],["YYYY-MM-DD",/\d{4}-\d{2}-\d{2}/],["GGGG-[W]WW-E",/\d{4}-W\d{2}-\d/],["GGGG-[W]WW",/\d{4}-W\d{2}/],["YYYY-DDD",/\d{4}-\d{3}/]],st=[["HH:mm:ss.SSSS",/(T| )\d\d:\d\d:\d\d\.\d+/],["HH:mm:ss",/(T| )\d\d:\d\d:\d\d/],["HH:mm",/(T| )\d\d:\d\d/],["HH",/(T| )\d\d/]],ot=/([\+\-]|\d\d)/gi,ct=("Date|Hours|Minutes|Seconds|Milliseconds".split("|"),{Milliseconds:1,Seconds:1e3,Minutes:6e4,Hours:36e5,Days:864e5,Months:2592e6,Years:31536e6}),lt={ms:"millisecond",s:"second",m:"minute",h:"hour",d:"day",D:"date",w:"week",W:"isoWeek",M:"month",Q:"quarter",y:"year",DDD:"dayOfYear",e:"weekday",E:"isoWeekday",gg:"weekYear",GG:"isoWeekYear"},ut={dayofyear:"dayOfYear",isoweekday:"isoWeekday",isoweek:"isoWeek",weekyear:"weekYear",isoweekyear:"isoWeekYear"},dt={},gt={s:45,m:45,h:22,d:26,M:11},ht="DDD w W M D d".split(" "),pt="M D H h m s w W".split(" "),ft={M:function(){return this.month()+1},MMM:function(e){return this.localeData().monthsShort(this,e)},MMMM:function(e){return this.localeData().months(this,e)},D:function(){return this.date()},DDD:function(){return this.dayOfYear()},d:function(){return this.day()},dd:function(e){return this.localeData().weekdaysMin(this,e)},ddd:function(e){return this.localeData().weekdaysShort(this,e)},dddd:function(e){return this.localeData().weekdays(this,e)},w:function(){return this.week()},W:function(){return this.isoWeek()},YY:function(){return f(this.year()%100,2)},YYYY:function(){return f(this.year(),4)},YYYYY:function(){return f(this.year(),5)},YYYYYY:function(){var e=this.year(),t=e>=0?"+":"-";return t+f(Math.abs(e),6)},gg:function(){return f(this.weekYear()%100,2)},gggg:function(){return f(this.weekYear(),4)},ggggg:function(){return f(this.weekYear(),5)},GG:function(){return f(this.isoWeekYear()%100,2)},GGGG:function(){return f(this.isoWeekYear(),4)},GGGGG:function(){return f(this.isoWeekYear(),5)},e:function(){return this.weekday()},E:function(){return this.isoWeekday()},a:function(){return this.localeData().meridiem(this.hours(),this.minutes(),!0)},A:function(){return this.localeData().meridiem(this.hours(),this.minutes(),!1)},H:function(){return this.hours()},h:function(){return this.hours()%12||12},m:function(){return this.minutes()},s:function(){return this.seconds()},S:function(){return M(this.milliseconds()/100)},SS:function(){return f(M(this.milliseconds()/10),2)},SSS:function(){return f(this.milliseconds(),3)},SSSS:function(){return f(this.milliseconds(),3)},Z:function(){var e=-this.zone(),t="+";return 0>e&&(e=-e,t="-"),t+f(M(e/60),2)+":"+f(M(e)%60,2)},ZZ:function(){var e=-this.zone(),t="+";return 0>e&&(e=-e,t="-"),t+f(M(e/60),2)+f(M(e)%60,2)},z:function(){return this.zoneAbbr()},zz:function(){return this.zoneName()},x:function(){return this.valueOf()},X:function(){return this.unix()},Q:function(){return this.quarter()}},mt={},vt=["months","monthsShort","weekdays","weekdaysShort","weekdaysMin"];ht.length;)ke=ht.pop(),ft[ke+"o"]=c(ft[ke],ke);for(;pt.length;)ke=pt.pop(),ft[ke+ke]=o(ft[ke],2);ft.DDDD=o(ft.DDD,3),g(l.prototype,{set:function(e){var t,n;for(n in e)t=e[n],"function"==typeof t?this[n]=t:this["_"+n]=t;this._ordinalParseLenient=new RegExp(this._ordinalParse.source+"|"+/\d{1,2}/.source)},_months:"January_February_March_April_May_June_July_August_September_October_November_December".split("_"),months:function(e){return this._months[e.month()]},_monthsShort:"Jan_Feb_Mar_Apr_May_Jun_Jul_Aug_Sep_Oct_Nov_Dec".split("_"),monthsShort:function(e){return this._monthsShort[e.month()]},monthsParse:function(e,t,n){var a,i,r;for(this._monthsParse||(this._monthsParse=[],this._longMonthsParse=[],this._shortMonthsParse=[]),a=0;12>a;a++){if(i=we.utc([2e3,a]),n&&!this._longMonthsParse[a]&&(this._longMonthsParse[a]=new RegExp("^"+this.months(i,"").replace(".","")+"$","i"),this._shortMonthsParse[a]=new RegExp("^"+this.monthsShort(i,"").replace(".","")+"$","i")),n||this._monthsParse[a]||(r="^"+this.months(i,"")+"|^"+this.monthsShort(i,""),this._monthsParse[a]=new RegExp(r.replace(".",""),"i")),n&&"MMMM"===t&&this._longMonthsParse[a].test(e))return a;if(n&&"MMM"===t&&this._shortMonthsParse[a].test(e))return a;if(!n&&this._monthsParse[a].test(e))return a}},_weekdays:"Sunday_Monday_Tuesday_Wednesday_Thursday_Friday_Saturday".split("_"),weekdays:function(e){return this._weekdays[e.day()]},_weekdaysShort:"Sun_Mon_Tue_Wed_Thu_Fri_Sat".split("_"),weekdaysShort:function(e){return this._weekdaysShort[e.day()]},_weekdaysMin:"Su_Mo_Tu_We_Th_Fr_Sa".split("_"),weekdaysMin:function(e){return this._weekdaysMin[e.day()]},weekdaysParse:function(e){var t,n,a;for(this._weekdaysParse||(this._weekdaysParse=[]),t=0;7>t;t++)if(this._weekdaysParse[t]||(n=we([2e3,1]).day(t),a="^"+this.weekdays(n,"")+"|^"+this.weekdaysShort(n,"")+"|^"+this.weekdaysMin(n,""),this._weekdaysParse[t]=new RegExp(a.replace(".",""),"i")),this._weekdaysParse[t].test(e))return t},_longDateFormat:{LTS:"h:mm:ss A",LT:"h:mm A",L:"MM/DD/YYYY",LL:"MMMM D, YYYY",LLL:"MMMM D, YYYY LT",LLLL:"dddd, MMMM D, YYYY LT"},longDateFormat:function(e){var t=this._longDateFormat[e];return!t&&this._longDateFormat[e.toUpperCase()]&&(t=this._longDateFormat[e.toUpperCase()].replace(/MMMM|MM|DD|dddd/g,function(e){return e.slice(1)}),this._longDateFormat[e]=t),t},isPM:function(e){return"p"===(e+"").toLowerCase().charAt(0)},_meridiemParse:/[ap]\.?m?\.?/i,meridiem:function(e,t,n){return e>11?n?"pm":"PM":n?"am":"AM"},_calendar:{sameDay:"[Today at] LT",nextDay:"[Tomorrow at] LT",nextWeek:"dddd [at] LT",lastDay:"[Yesterday at] LT",lastWeek:"[Last] dddd [at] LT",sameElse:"L"},calendar:function(e,t,n){var a=this._calendar[e];return"function"==typeof a?a.apply(t,[n]):a},_relativeTime:{future:"in %s",past:"%s ago",s:"a few seconds",m:"a minute",mm:"%d minutes",h:"an hour",hh:"%d hours",d:"a day",dd:"%d days",M:"a month",MM:"%d months",y:"a year",yy:"%d years"},relativeTime:function(e,t,n,a){var i=this._relativeTime[n];return"function"==typeof i?i(e,t,n,a):i.replace(/%d/i,e)},pastFuture:function(e,t){var n=this._relativeTime[e>0?"future":"past"];return"function"==typeof n?n(t):n.replace(/%s/i,t)},ordinal:function(e){return this._ordinal.replace("%d",e)},_ordinal:"%d",_ordinalParse:/\d{1,2}/,preparse:function(e){return e},postformat:function(e){return e},week:function(e){return oe(e,this._week.dow,this._week.doy).week},_week:{dow:0,doy:6},_invalidDate:"Invalid date",invalidDate:function(){return this._invalidDate}}),we=function(t,n,i,r){var s;return"boolean"==typeof i&&(r=i,i=e),s={},s._isAMomentObject=!0,s._i=t,s._f=n,s._l=i,s._strict=r,s._isUTC=!1,s._pf=a(),le(s)},we.suppressDeprecationWarnings=!1,we.createFromInputFallback=r("moment construction falls back to js Date. This is discouraged and will be removed in upcoming major release. Please refer to https://github.com/moment/moment/issues/1407 for more info.",function(e){e._d=new Date(e._i+(e._useUTC?" UTC":""))}),we.min=function(){var e=[].slice.call(arguments,0);return ue("isBefore",e)},we.max=function(){var e=[].slice.call(arguments,0);return ue("isAfter",e)},we.utc=function(t,n,i,r){var s;return"boolean"==typeof i&&(r=i,i=e),s={},s._isAMomentObject=!0,s._useUTC=!0,s._isUTC=!0,s._l=i,s._i=t,s._f=n,s._strict=r,s._pf=a(),le(s).utc()},we.unix=function(e){return we(1e3*e)},we.duration=function(e,t){var a,i,r,s,o=e,c=null;return we.isDuration(e)?o={ms:e._milliseconds,d:e._days,M:e._months}:"number"==typeof e?(o={},t?o[t]=e:o.milliseconds=e):(c=Pe.exec(e))?(a="-"===c[1]?-1:1,o={y:0,d:M(c[De])*a,h:M(c[Le])*a,m:M(c[Ue])*a,s:M(c[Ae])*a,ms:M(c[Ee])*a}):(c=Fe.exec(e))?(a="-"===c[1]?-1:1,r=function(e){var t=e&&parseFloat(e.replace(",","."));return(isNaN(t)?0:t)*a},o={y:r(c[2]),M:r(c[3]),d:r(c[4]),h:r(c[5]),m:r(c[6]),s:r(c[7]),w:r(c[8])}):"object"==typeof o&&("from"in o||"to"in o)&&(s=v(we(o.from),we(o.to)),o={},o.ms=s.milliseconds,o.M=s.months),i=new d(o),we.isDuration(e)&&n(e,"_locale")&&(i._locale=e._locale),i},we.version=Te,we.defaultFormat=it,we.ISO_8601=function(){},we.momentProperties=Oe,we.updateOffset=function(){},we.relativeTimeThreshold=function(t,n){return gt[t]===e?!1:n===e?gt[t]:(gt[t]=n,!0)},we.lang=r("moment.lang is deprecated. Use moment.locale instead.",function(e,t){return we.locale(e,t)}),we.locale=function(e,t){var n;return e&&(n="undefined"!=typeof t?we.defineLocale(e,t):we.localeData(e),n&&(we.duration._locale=we._locale=n)),we._locale._abbr},we.defineLocale=function(e,t){return null!==t?(t.abbr=e,Ie[e]||(Ie[e]=new l),Ie[e].set(t),we.locale(e),Ie[e]):(delete Ie[e],null)},we.langData=r("moment.langData is deprecated. Use moment.localeData instead.",function(e){return we.localeData(e)}),we.localeData=function(e){var t;if(e&&e._locale&&e._locale._abbr&&(e=e._locale._abbr),!e)return we._locale;if(!b(e)){if(t=N(e))return t;e=[e]}return O(e)},we.isMoment=function(e){return e instanceof u||null!=e&&n(e,"_isAMomentObject")},we.isDuration=function(e){return e instanceof d};for(ke=vt.length-1;ke>=0;--ke)S(vt[ke]);we.normalizeUnits=function(e){return _(e)},we.invalid=function(e){var t=we.utc(NaN);return null!=e?g(t._pf,e):t._pf.userInvalidated=!0,t},we.parseZone=function(){return we.apply(null,arguments).parseZone()},we.parseTwoDigitYear=function(e){return M(e)+(M(e)>68?1900:2e3)},g(we.fn=u.prototype,{clone:function(){return we(this)},valueOf:function(){return+this._d+6e4*(this._offset||0)},unix:function(){return Math.floor(+this/1e3)},toString:function(){return this.clone().locale("en").format("ddd MMM DD YYYY HH:mm:ss [GMT]ZZ")},toDate:function(){return this._offset?new Date(+this):this._d},toISOString:function(){var e=we(this).utc();return 0<e.year()&&e.year()<=9999?"function"==typeof Date.prototype.toISOString?this.toDate().toISOString():R(e,"YYYY-MM-DD[T]HH:mm:ss.SSS[Z]"):R(e,"YYYYYY-MM-DD[T]HH:mm:ss.SSS[Z]")},toArray:function(){var e=this;return[e.year(),e.month(),e.date(),e.hours(),e.minutes(),e.seconds(),e.milliseconds()]},isValid:function(){return E(this)},isDSTShifted:function(){return this._a?this.isValid()&&T(this._a,(this._isUTC?we.utc(this._a):we(this._a)).toArray())>0:!1},parsingFlags:function(){return g({},this._pf)},invalidAt:function(){return this._pf.overflow},utc:function(e){return this.zone(0,e)},local:function(e){return this._isUTC&&(this.zone(0,e),this._isUTC=!1,e&&this.add(this._dateTzOffset(),"m")),this},format:function(e){var t=R(this,e||we.defaultFormat);return this.localeData().postformat(t)},add:y(1,"add"),subtract:y(-1,"subtract"),diff:function(e,t,n){var a,i,r,s=$(e,this),o=6e4*(this.zone()-s.zone());return t=_(t),"year"===t||"month"===t?(a=432e5*(this.daysInMonth()+s.daysInMonth()),i=12*(this.year()-s.year())+(this.month()-s.month()),r=this-we(this).startOf("month")-(s-we(s).startOf("month")),r-=6e4*(this.zone()-we(this).startOf("month").zone()-(s.zone()-we(s).startOf("month").zone())),i+=r/a,"year"===t&&(i/=12)):(a=this-s,i="second"===t?a/1e3:"minute"===t?a/6e4:"hour"===t?a/36e5:"day"===t?(a-o)/864e5:"week"===t?(a-o)/6048e5:a),n?i:p(i)},from:function(e,t){return we.duration({to:this,from:e}).locale(this.locale()).humanize(!t)},fromNow:function(e){return this.from(we(),e)},calendar:function(e){var t=e||we(),n=$(t,this).startOf("day"),a=this.diff(n,"days",!0),i=-6>a?"sameElse":-1>a?"lastWeek":0>a?"lastDay":1>a?"sameDay":2>a?"nextDay":7>a?"nextWeek":"sameElse";return this.format(this.localeData().calendar(i,this,we(t)))},isLeapYear:function(){return U(this.year())},isDST:function(){return this.zone()<this.clone().month(0).zone()||this.zone()<this.clone().month(5).zone()},day:function(e){var t=this._isUTC?this._d.getUTCDay():this._d.getDay();return null!=e?(e=ie(e,this.localeData()),this.add(e-t,"d")):t},month:pe("Month",!0),startOf:function(e){switch(e=_(e)){case"year":this.month(0);case"quarter":case"month":this.date(1);case"week":case"isoWeek":case"day":this.hours(0);case"hour":this.minutes(0);case"minute":this.seconds(0);case"second":this.milliseconds(0)}return"week"===e?this.weekday(0):"isoWeek"===e&&this.isoWeekday(1),"quarter"===e&&this.month(3*Math.floor(this.month()/3)),this},endOf:function(t){return t=_(t),t===e||"millisecond"===t?this:this.startOf(t).add(1,"isoWeek"===t?"week":t).subtract(1,"ms")},isAfter:function(e,t){var n;return t=_("undefined"!=typeof t?t:"millisecond"),"millisecond"===t?(e=we.isMoment(e)?e:we(e),+this>+e):(n=we.isMoment(e)?+e:+we(e),n<+this.clone().startOf(t))},isBefore:function(e,t){var n;return t=_("undefined"!=typeof t?t:"millisecond"),"millisecond"===t?(e=we.isMoment(e)?e:we(e),+e>+this):(n=we.isMoment(e)?+e:+we(e),+this.clone().endOf(t)<n)},isSame:function(e,t){var n;return t=_(t||"millisecond"),"millisecond"===t?(e=we.isMoment(e)?e:we(e),+this===+e):(n=+we(e),+this.clone().startOf(t)<=n&&n<=+this.clone().endOf(t))},min:r("moment().min is deprecated, use moment.min instead. https://github.com/moment/moment/issues/1548",function(e){return e=we.apply(null,arguments),this>e?this:e}),max:r("moment().max is deprecated, use moment.max instead. https://github.com/moment/moment/issues/1548",function(e){return e=we.apply(null,arguments),e>this?this:e}),zone:function(e,t){var n,a=this._offset||0;return null==e?this._isUTC?a:this._dateTzOffset():("string"==typeof e&&(e=z(e)),Math.abs(e)<16&&(e=60*e),!this._isUTC&&t&&(n=this._dateTzOffset()),this._offset=e,this._isUTC=!0,null!=n&&this.subtract(n,"m"),a!==e&&(!t||this._changeInProgress?w(this,we.duration(a-e,"m"),1,!1):this._changeInProgress||(this._changeInProgress=!0,we.updateOffset(this,!0),this._changeInProgress=null)),this)},zoneAbbr:function(){return this._isUTC?"UTC":""},zoneName:function(){return this._isUTC?"Coordinated Universal Time":""},parseZone:function(){return this._tzm?this.zone(this._tzm):"string"==typeof this._i&&this.zone(this._i),this},hasAlignedHourOffset:function(e){return e=e?we(e).zone():0,(this.zone()-e)%60===0},daysInMonth:function(){return C(this.year(),this.month())},dayOfYear:function(e){var t=xe((we(this).startOf("day")-we(this).startOf("year"))/864e5)+1;return null==e?t:this.add(e-t,"d")},quarter:function(e){return null==e?Math.ceil((this.month()+1)/3):this.month(3*(e-1)+this.month()%3)},weekYear:function(e){var t=oe(this,this.localeData()._week.dow,this.localeData()._week.doy).year;return null==e?t:this.add(e-t,"y")},isoWeekYear:function(e){var t=oe(this,1,4).year;return null==e?t:this.add(e-t,"y")},week:function(e){var t=this.localeData().week(this);return null==e?t:this.add(7*(e-t),"d")},isoWeek:function(e){var t=oe(this,1,4).week;return null==e?t:this.add(7*(e-t),"d")},weekday:function(e){var t=(this.day()+7-this.localeData()._week.dow)%7;return null==e?t:this.add(e-t,"d")},isoWeekday:function(e){return null==e?this.day()||7:this.day(this.day()%7?e:e-7)},isoWeeksInYear:function(){return D(this.year(),1,4)},weeksInYear:function(){var e=this.localeData()._week;return D(this.year(),e.dow,e.doy)},get:function(e){return e=_(e),this[e]()},set:function(e,t){return e=_(e),"function"==typeof this[e]&&this[e](t),this},locale:function(t){var n;return t===e?this._locale._abbr:(n=we.localeData(t),null!=n&&(this._locale=n),this)},lang:r("moment().lang() is deprecated. Instead, use moment().localeData() to get the language configuration. Use moment().locale() to change languages.",function(t){return t===e?this.localeData():this.locale(t)}),localeData:function(){return this._locale},_dateTzOffset:function(){return 15*Math.round(this._d.getTimezoneOffset()/15)}}),we.fn.millisecond=we.fn.milliseconds=pe("Milliseconds",!1),we.fn.second=we.fn.seconds=pe("Seconds",!1),we.fn.minute=we.fn.minutes=pe("Minutes",!1),we.fn.hour=we.fn.hours=pe("Hours",!0),we.fn.date=pe("Date",!0),we.fn.dates=r("dates accessor is deprecated. Use date instead.",pe("Date",!0)),we.fn.year=pe("FullYear",!0),we.fn.years=r("years accessor is deprecated. Use year instead.",pe("FullYear",!0)),we.fn.days=we.fn.day,we.fn.months=we.fn.month,we.fn.weeks=we.fn.week,we.fn.isoWeeks=we.fn.isoWeek,we.fn.quarters=we.fn.quarter,we.fn.toJSON=we.fn.toISOString,g(we.duration.fn=d.prototype,{_bubble:function(){var e,t,n,a=this._milliseconds,i=this._days,r=this._months,s=this._data,o=0;s.milliseconds=a%1e3,e=p(a/1e3),s.seconds=e%60,t=p(e/60),s.minutes=t%60,n=p(t/60),s.hours=n%24,i+=p(n/24),o=p(fe(i)),i-=p(me(o)),r+=p(i/30),i%=30,o+=p(r/12),r%=12,s.days=i,s.months=r,s.years=o},abs:function(){return this._milliseconds=Math.abs(this._milliseconds),this._days=Math.abs(this._days),this._months=Math.abs(this._months),this._data.milliseconds=Math.abs(this._data.milliseconds),this._data.seconds=Math.abs(this._data.seconds),this._data.minutes=Math.abs(this._data.minutes),this._data.hours=Math.abs(this._data.hours),this._data.months=Math.abs(this._data.months),this._data.years=Math.abs(this._data.years),this},weeks:function(){return p(this.days()/7)},valueOf:function(){return this._milliseconds+864e5*this._days+this._months%12*2592e6+31536e6*M(this._months/12)},humanize:function(e){var t=se(this,!e,this.localeData());return e&&(t=this.localeData().pastFuture(+this,t)),this.localeData().postformat(t)},add:function(e,t){var n=we.duration(e,t);return this._milliseconds+=n._milliseconds,this._days+=n._days,this._months+=n._months,this._bubble(),this},subtract:function(e,t){var n=we.duration(e,t);return this._milliseconds-=n._milliseconds,this._days-=n._days,this._months-=n._months,this._bubble(),this},get:function(e){return e=_(e),this[e.toLowerCase()+"s"]()},as:function(e){var t,n;if(e=_(e),"month"===e||"year"===e)return t=this._days+this._milliseconds/864e5,n=this._months+12*fe(t),"month"===e?n:n/12;switch(t=this._days+Math.round(me(this._months/12)),
e){case"week":return t/7+this._milliseconds/6048e5;case"day":return t+this._milliseconds/864e5;case"hour":return 24*t+this._milliseconds/36e5;case"minute":return 24*t*60+this._milliseconds/6e4;case"second":return 24*t*60*60+this._milliseconds/1e3;case"millisecond":return Math.floor(24*t*60*60*1e3)+this._milliseconds;default:throw new Error("Unknown unit "+e)}},lang:we.fn.lang,locale:we.fn.locale,toIsoString:r("toIsoString() is deprecated. Please use toISOString() instead (notice the capitals)",function(){return this.toISOString()}),toISOString:function(){var e=Math.abs(this.years()),t=Math.abs(this.months()),n=Math.abs(this.days()),a=Math.abs(this.hours()),i=Math.abs(this.minutes()),r=Math.abs(this.seconds()+this.milliseconds()/1e3);return this.asSeconds()?(this.asSeconds()<0?"-":"")+"P"+(e?e+"Y":"")+(t?t+"M":"")+(n?n+"D":"")+(a||i||r?"T":"")+(a?a+"H":"")+(i?i+"M":"")+(r?r+"S":""):"P0D"},localeData:function(){return this._locale}}),we.duration.fn.toString=we.duration.fn.toISOString;for(ke in ct)n(ct,ke)&&ve(ke.toLowerCase());we.duration.fn.asMilliseconds=function(){return this.as("ms")},we.duration.fn.asSeconds=function(){return this.as("s")},we.duration.fn.asMinutes=function(){return this.as("m")},we.duration.fn.asHours=function(){return this.as("h")},we.duration.fn.asDays=function(){return this.as("d")},we.duration.fn.asWeeks=function(){return this.as("weeks")},we.duration.fn.asMonths=function(){return this.as("M")},we.duration.fn.asYears=function(){return this.as("y")},we.locale("en",{ordinalParse:/\d{1,2}(th|st|nd|rd)/,ordinal:function(e){var t=e%10,n=1===M(e%100/10)?"th":1===t?"st":2===t?"nd":3===t?"rd":"th";return e+n}}),Ne?module.exports=we:"function"==typeof define&&define.amd?(define("moment",function(e,t,n){return n.config&&n.config()&&n.config().noGlobal===!0&&(_e.moment=be),we}),ye(!0)):ye()}).call(this),function(e){"use strict";var t,n=e.Base64,a="2.1.9";if("undefined"!=typeof module&&module.exports)try{t=require("buffer").Buffer}catch(i){}var r="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",s=function(e){for(var t={},n=0,a=e.length;a>n;n++)t[e.charAt(n)]=n;return t}(r),o=String.fromCharCode,c=function(e){if(e.length<2){var t=e.charCodeAt(0);return 128>t?e:2048>t?o(192|t>>>6)+o(128|63&t):o(224|t>>>12&15)+o(128|t>>>6&63)+o(128|63&t)}var t=65536+1024*(e.charCodeAt(0)-55296)+(e.charCodeAt(1)-56320);return o(240|t>>>18&7)+o(128|t>>>12&63)+o(128|t>>>6&63)+o(128|63&t)},l=/[\uD800-\uDBFF][\uDC00-\uDFFFF]|[^\x00-\x7F]/g,u=function(e){return e.replace(l,c)},d=function(e){var t=[0,2,1][e.length%3],n=e.charCodeAt(0)<<16|(e.length>1?e.charCodeAt(1):0)<<8|(e.length>2?e.charCodeAt(2):0),a=[r.charAt(n>>>18),r.charAt(n>>>12&63),t>=2?"=":r.charAt(n>>>6&63),t>=1?"=":r.charAt(63&n)];return a.join("")},g=e.btoa?function(t){return e.btoa(t)}:function(e){return e.replace(/[\s\S]{1,3}/g,d)},h=t?function(e){return(e.constructor===t.constructor?e:new t(e)).toString("base64")}:function(e){return g(u(e))},p=function(e,t){return t?h(String(e)).replace(/[+\/]/g,function(e){return"+"==e?"-":"_"}).replace(/=/g,""):h(String(e))},f=function(e){return p(e,!0)},m=new RegExp(["[À-ß][-¿]","[à-ï][-¿]{2}","[ð-÷][-¿]{3}"].join("|"),"g"),v=function(e){switch(e.length){case 4:var t=(7&e.charCodeAt(0))<<18|(63&e.charCodeAt(1))<<12|(63&e.charCodeAt(2))<<6|63&e.charCodeAt(3),n=t-65536;return o((n>>>10)+55296)+o((1023&n)+56320);case 3:return o((15&e.charCodeAt(0))<<12|(63&e.charCodeAt(1))<<6|63&e.charCodeAt(2));default:return o((31&e.charCodeAt(0))<<6|63&e.charCodeAt(1))}},y=function(e){return e.replace(m,v)},w=function(e){var t=e.length,n=t%4,a=(t>0?s[e.charAt(0)]<<18:0)|(t>1?s[e.charAt(1)]<<12:0)|(t>2?s[e.charAt(2)]<<6:0)|(t>3?s[e.charAt(3)]:0),i=[o(a>>>16),o(a>>>8&255),o(255&a)];return i.length-=[0,0,2,1][n],i.join("")},b=e.atob?function(t){return e.atob(t)}:function(e){return e.replace(/[\s\S]{1,4}/g,w)},k=t?function(e){return(e.constructor===t.constructor?e:new t(e,"base64")).toString()}:function(e){return y(b(e))},T=function(e){return k(String(e).replace(/[-_]/g,function(e){return"-"==e?"+":"/"}).replace(/[^A-Za-z0-9\+\/]/g,""))},_=function(){var t=e.Base64;return e.Base64=n,t};if(e.Base64={VERSION:a,atob:b,btoa:g,fromBase64:T,toBase64:p,utob:u,encode:p,encodeURI:f,btou:y,decode:T,noConflict:_},"function"==typeof Object.defineProperty){var x=function(e){return{value:e,enumerable:!1,writable:!0,configurable:!0}};e.Base64.extendString=function(){Object.defineProperty(String.prototype,"fromBase64",x(function(){return T(this)})),Object.defineProperty(String.prototype,"toBase64",x(function(e){return p(this,e)})),Object.defineProperty(String.prototype,"toBase64URI",x(function(){return p(this,!0)}))}}e.Meteor&&(Base64=e.Base64)}(this),window.Modernizr=window.Modernizr||function(e,t,n){function a(e){h.cssText=e}function i(e,t){return typeof e===t}var r,s,o,c="2.8.3",l={},u=t.documentElement,d="modernizr",g=t.createElement(d),h=g.style,p=({}.toString," -webkit- -moz- -o- -ms- ".split(" ")),f={svg:"http://www.w3.org/2000/svg"},m={},v=[],y=v.slice,w={}.hasOwnProperty;o=i(w,"undefined")||i(w.call,"undefined")?function(e,t){return t in e&&i(e.constructor.prototype[t],"undefined")}:function(e,t){return w.call(e,t)},Function.prototype.bind||(Function.prototype.bind=function(e){var t=this;if("function"!=typeof t)throw new TypeError;var n=y.call(arguments,1),a=function(){if(this instanceof a){var i=function(){};i.prototype=t.prototype;var r=new i,s=t.apply(r,n.concat(y.call(arguments)));return Object(s)===s?s:r}return t.apply(e,n.concat(y.call(arguments)))};return a}),m.inlinesvg=function(){var e=t.createElement("div");return e.innerHTML="<svg/>",(e.firstChild&&e.firstChild.namespaceURI)==f.svg};for(var b in m)o(m,b)&&(s=b.toLowerCase(),l[s]=m[b](),v.push((l[s]?"":"no-")+s));return l.addTest=function(e,t){if("object"==typeof e)for(var a in e)o(e,a)&&l.addTest(a,e[a]);else{if(e=e.toLowerCase(),l[e]!==n)return l;t="function"==typeof t?t():t,"undefined"!=typeof enableClasses&&enableClasses&&(u.className+=" "+(t?"":"no-")+e),l[e]=t}return l},a(""),g=r=null,l._version=c,l._prefixes=p,l}(this,this.document),Modernizr.addTest("cssfilters",function(){var e=document.createElement("div");return e.style.cssText=Modernizr._prefixes.join("filter:blur(2px); "),!!e.style.length&&(void 0===document.documentMode||document.documentMode>9)}),Modernizr.addTest("svgfilters",function(){var e=!1;try{e=void 0!==typeof SVGFEColorMatrixElement&&2==SVGFEColorMatrixElement.SVG_FECOLORMATRIX_TYPE_SATURATE}catch(t){}return e}),function(e,t,n,a){function i(t,n){var a,i;n=n||{},a=n.classes||{},i=a.fade||s.classes.fade,n.fade=n.fade||t.className.indexOf(i)>-1,this.element=t,this.settings=e.extend({},s,n),this._defaults=s,this._name=r,this.init()}var r="gray",s={fade:!1,classes:{fade:"grayscale-fade"}};e.extend(i.prototype,{init:function(){var t;!Modernizr.cssfilters&&Modernizr.inlinesvg&&Modernizr.svgfilters&&(t=e(this.element),(this.cssFilterDeprecated(t)||this.settings.fade)&&this.switchImage(t))},cssFilterDeprecated:function(e){return"none"===e.css("filter")},elementType:function(e){return"IMG"===e.prop("tagName")?"Img":"Bg"},pxToNumber:function(e){return parseInt(e.replace("px",""))},getComputedStyle:function(e){var n={},a={};n=t.getComputedStyle(e,null);for(var i=0,r=n.length;r>i;i++){var s=n[i],o=n.getPropertyValue(s);a[s]=o}return a},extractUrl:function(e){var t;return startRegex=/^url\(["']?/,endRegex=/["']?\)$/,t=e.replace(startRegex,"").replace(endRegex,"")},positionToNegativeMargin:function(e){var t,n,a;return t=e.match(/^(-?\d+\S+)/)[0],n=e.match(/\s(-?\d+\S+)$/)[0],a="margin:"+n+" 0 0 "+t},getBgSize:function(t,n){var a,i,r,s,o,c,l;if(a=new Image,a.src=t,"auto"!==n&&"cover"!==n&&"contain"!==n&&"inherit"!==n){var u=e(this.element);i=a.width/a.height,s=parseInt((n.match(/^(\d+)px/)||[0,0])[1]),c=parseInt((n.match(/\s(\d+)px$/)||[0,0])[1]),r=u.height()*i,o=u.width()/i,s=s||r,c=c||o}return l=s||c?{width:s,height:c}:{width:a.width,height:a.height}},getImgParams:function(e){var t={};t.styles=this.getComputedStyle(e[0]);var n={top:this.pxToNumber(t.styles["padding-top"]),right:this.pxToNumber(t.styles["padding-right"]),bottom:this.pxToNumber(t.styles["padding-bottom"]),left:this.pxToNumber(t.styles["padding-left"])},a={top:this.pxToNumber(t.styles["border-top-width"]),right:this.pxToNumber(t.styles["border-right-width"]),bottom:this.pxToNumber(t.styles["border-bottom-width"]),left:this.pxToNumber(t.styles["border-left-width"])};return t.image={width:this.pxToNumber(t.styles.width),height:this.pxToNumber(t.styles.height)},t.svg={url:e[0].src,padding:n,borderWidth:a,width:t.image.width+n.left+n.right+a.left+a.right,height:t.image.height+n.top+n.bottom+a.top+a.bottom,offset:""},t},getBgParams:function(t){var n,a={};return n=this.extractUrl(t.css("background-image")),bgSize=this.getBgSize(n,t.css("background-size")),offset=this.positionToNegativeMargin(t.css("background-position")),a.styles=this.getComputedStyle(t[0]),a.svg=e.extend({url:n},bgSize,{offset:offset}),a.image={width:a.svg.width,height:a.svg.height},a},setStyles:function(e,t,n,a){return t.display="inline-block",t.overflow=t["overflow-x"]=t["overflow-y"]="hidden",t["background-image"]='url("'+n.url+'")',t["background-size"]=a.width+"px "+a.height+"px","Img"===e&&(t["background-repeat"]="no-repeat",t["background-position"]=n.padding.left+"px "+n.padding.top+"px",t.width=n.width,t.height=n.height),delete t.filter,t},addSVGFilterOnce:function(){$body=e("body"),$body.data("plugin_"+r+"_has_filter")||$body.data("plugin_"+r+"_has_filter","true").append('<svg version="1.1" xmlns="http://www.w3.org/2000/svg" width="0" height="0" style="position:absolute"><defs><filter id="gray"><feColorMatrix type="saturate" values="0"/></filter></defs></svg>')},switchImage:function(t){var n,a,i,r;n=this.elementType(t),a=this["get"+n+"Params"](t),i=this.settings.fade?this.settings.classes.fade:"",r=e('<div class="grayscale grayscale-replaced '+i+'"><svg version="1.1" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 '+a.svg.width+" "+a.svg.height+'" width="'+a.svg.width+'" height="'+a.svg.height+'" style="'+a.svg.offset+'"><image filter="url(&quot;#gray&quot;)" x="0" y="0" width="'+a.image.width+'" height="'+a.image.height+'" preserveAspectRatio="none" xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="'+a.svg.url+'" /></svg></div>'),a.styles=this.setStyles(n,a.styles,a.svg,a.image),r.css(a.styles),this.addSVGFilterOnce(),t.replaceWith(r)}}),e.fn[r]=function(t){return this.each(function(){e.data(this,"plugin_"+r)||e.data(this,"plugin_"+r,new i(this,t))}),this},e(t).on("load",function(){e(".grayscale:not(.grayscale-replaced)")[r]()})}(jQuery,window,document),function(e){e.rcpAid=function(){if(e.rcpAid)return e.rcpAid;var t=function(){},n=[];n.slice;return t.fn=t.prototype,t.fn.isLogin=0,t.fn.getPage=function(e){if("string"!=typeof e)return"";var t="",n=DYCONFIG.rcp.rUrl;switch(e){case"首页":t=n;break;case"登录":t=DYCONFIG.sso.login;break;case"退出":t=DYCONFIG.sso.logout;break;case"注册":t=DYCONFIG.sso.register;break;case"搜索":t=n+"search.html";break;case"分类":t="/search.html";break;case"个人设置":t="/sso/my.html";break;case"学习中心":t="/space/student-space.html";break;case"教学中心":t="/space/teacher-space.html";break;case"助学中心":t="/guidance-space.html";break;case"老师认证":t="/sso/apply-space.html";break;case"实名认证":t="/sso/apply-space.html";break;case"家长空间":t="/parentSpace.html";break;case"班级空间":t="/classSpace.html";break;case"学校空间":t="/schoolSpace.html";break;case"机构空间":t="/organizationSpace.html";break;case"用户管理":t="/userManager.html";break;case"审核管理":t="/sso/management-center.html";break;case"课程详情":t="/course/course-detail.html";break;case"题库详情":t="/course/course-detail.html";break;case"创建课程":t="/course/course-edit.html";break;case"创建题库":t="/course/course-edit.html";break;case"人员管理":t="/sso/management-center.html";break;case"学习页":t="/course/pc-course-learning.html";break;case"圈子详情":t="/study-circle/study-circle-detail.html";break;case"全部圈子":t="/study-circle/study-circle-total.html";break;case"做题页":t="/course/exam.html";break;case"解析页":t="/course/exam-resolve-view.html";break;case"批改页":t="/course/exam-correcting.html";break;case"管理中心":t="/sso/management-center.html";break;case"我要吐槽":t="/discuss-page.html";break;case"吐槽帖子详情":t="/discuss-detail.html"}return t},t.fn.getUrl=function(t,n){var a=e.rcpAid,i=a.getPage(t),r=typeof n;switch(r){case"object":i+="?",a.each(n,function(e,t){i+=t+"="+(e||"")+"&"}),i=i.substring(0,i.length-1);break;case"string":i+=n}return i},t.fn.css3=function(){var t={check:function(){var t=e.rcpAid,n=document.createElement("div"),a="webkitTransition mozAnimation oAnimation msAnimation animation".split(" "),i=!1;return t.each(a,function(e){e in n.style&&(i=!0)}),i},callBack:function(t,n,a){function i(){"function"==typeof a&&a(),r.each(n,function(e){t.addEventListener(e,i,!1),t.removeEventListener(e,i,!1)})}var r=e.rcpAid;r.each(n,function(e){t.addEventListener(e,i,!1)})},animatedEnd:function(e,t){this.callBack(e,["webkitAnimationEnd","mozAnimationEnd","MSAnimationEnd","oanimationend","animationend"],t)},transitionEnd:function(e,t){this.callBack(e,["webkitTransitionEnd","mozTransitionEnd","MSTransitionEnd","otransitionend","transitionend"],t)},css3Animate:function(e,t,n){this.check()?($(e).addClass(t),this.animatedEnd(e,function(){$(e).removeClass(t),"function"==typeof n&&n.call(e)})):"function"==typeof n&&n.call(e)}};return t}(),t.fn.each=function(e,t){if("object"==typeof e)for(var n in e)e.hasOwnProperty(n)&&"function"==typeof t&&t(e[n],n)},t.fn.queryString=function(e){var t=window.location.search.match(new RegExp("[?&]"+e+"=([^&]+)","i"));return t?decodeURIComponent(t[1]):""},t.fn.getToken=function(){return this.getCookie("token")||this.queryString("token")},t.fn.getCookie=function(e){try{return UINFO.token}catch(t){for(var n=document.cookie.split("; "),a=0;a<n.length;a+=1){var i=n[a].split("=");if(e===i[0])return unescape(i[1]||"")}}},t.fn.loginStatus=function(){return this.getToken("token")},t.fn.checkLogin=function(){try{if(console.log(UINFO),!UINFO.uid){var e=this.queryString("token");return e?{urlToken:e}:0}return UINFO}catch(t){return UINFO={},this.queryString("token")?(console.log("urlToken"),{urlToken:this.queryString("token")}):(console.log("读取用户信息出错！"),0)}},t.fn.countTime=function(e,t,n){if("s"!==t&&(e=1e-9*e),1>e)return 0;var a={d:"天",h:"时",min:"分",s:"秒"};"en"===n&&(a={d:"d",h:"h",min:"min",s:"s"});var i={day:0,hour:0,min:0,sec:0},r=e;i.day=parseInt(r/86400),r%=86400,i.hour=parseInt(r/3600),r%=3600,i.min=parseInt(r/60),r%=60,i.sec=parseInt(r);var s=i,o="";return s.day&&(o+=s.day+a.d),s.hour&&(o+=s.hour+a.h),s.min&&(o+=s.min+a.min),s.sec&&(o+=s.sec+a.s),""===o&&(o="0"),o},t.fn.getNoTokenUrl=function(){var e=location.href,t=/[\?\&]token=([^\&]+)/gi;return e=e.replace(t,"")},t.fn.getCourseCat=function(){try{var e=JSON.parse(DYCONFIG.COURSE_CAT),t=window.location.origin;return t||(t=window.location.hostname+window.location.host),e[t.replace("http://","")]||2}catch(n){return 1}},t.fn.isIE=function(e,t){var n,a=window.navigator.userAgent.toLowerCase();if(-1!=a.indexOf("msie")){var i=a.match(/msie\s([0-9]*)/);n=0===arguments.length?i[1]:1===arguments.length?parseInt(i[1])===e:i[1]>=e&&i[1]<=t?i[1]:!1}return n},t.fn.detectOS=function(){var e={};return e.ua=navigator.userAgent,e.uaTLC=e.ua.toLowerCase(),e.platform=navigator.platform,e.isCrosswalk=navigator.userAgent.indexOf("Crosswalk")>-1,e.isLinux=String(e.platform).indexOf("Linux")>-1,e.isWin="Win32"===e.platform,e.isMac="Mac68K"===e.platform,e.isUnix="X11"===e.platform&&!e.isWin&&!e.isMac,e.isSymbian="SymbianOS"===e.platform,e.bIsCE=e.uaTLC.match(/windows ce/i),e.bIsWM=e.uaTLC.match(/windows mobile/i),e.bIsAndroid=e.uaTLC.match(/android/i),e.bIsIpad=e.uaTLC.match(/ipad/i),e.bIsIphoneOs=e.uaTLC.match(/iphone os/i),e.bIsMidp=e.uaTLC.match(/midp/i),e.bIsUc7=e.uaTLC.match(/rv:1.2.3.4/i),e.bIsUc=e.uaTLC.match(/ucweb/i),e.mobile=!!(e.bIsIpad||e.bIsIphoneOs||e.bIsMidp||e.bIsUc7||e.bIsUc||e.bIsAndroid||e.bIsCE||e.bIsWM||e.isSymbian),e.pc=!e.mobile,e.name=e.bIsIpad?"iPad":e.bIsIphoneOs?"iPhone":e.bIsMidp?"midp":e.bIsUc7?"Uc7":e.bIsUc?"Ucweb":e.isMac?"Mac":e.isLinux?e.bIsAndroid?"Android":"Linux":e.isSymbian?"SymbianOS":e.bIsCE||e.bIsWM?"wm":"other",e.isWin&&(e.isWin2K=e.ua.indexOf("Windows NT 5.0")>-1||e.ua.indexOf("Windows 2000")>-1,e.isWinXP=e.ua.indexOf("Windows NT 5.1")>-1||e.ua.indexOf("Windows XP")>-1,e.isWin2003=e.ua.indexOf("Windows NT 5.2")>-1||e.ua.indexOf("Windows 2003")>-1,e.isWinVista=e.ua.indexOf("Windows NT 6.0")>-1||e.ua.indexOf("Windows Vista")>-1,e.isWin7=e.ua.indexOf("Windows NT 6.1")>-1||e.ua.indexOf("Windows 7")>-1,e.isWin8=e.ua.indexOf("Windows NT 6.2")>-1||e.ua.indexOf("Windows 8")>-1,e.isWin10=e.ua.indexOf("Windows NT 10")>-1||e.ua.indexOf("Windows 10")>-1,e.name=e.isWin2K?"Win2000":e.isWinXP?"WinXP":e.isWin2003?"Win2003":e.isWinVista?"WinVista":e.isWin7?"Win7":e.isWin8?"Win8":e.isWin10?"win10":"other"),e},t.fn.clearFile=function(e){var t=document.getElementById(e);t&&(t.outerHTML?t.outerHTML=t.outerHTML:t.value="")},new t}()}(window),function(e,t){var n=!1;isIE()<9&&(n=!0);for(var a="",i=DYCONFIG.domain||[],r=0;r<i.length;r++)i[r].domain===location.host&&(a=i[r].domainNum);if(n){var s='<html style="background-color:#e2e2e2;"><head><meta charset="utf-8"></head><body><div id="browser-not-support" style="background: #e2e1e2;height:100%;position: absolute;top:0;left:0;right:0;z-index:999999;"><div style="width: 1000px; text-align:center;margin:auto;position:relative"><div style="background: url(/rcp-common/imgs/common/browser_03.jpg);width:756px;height:520px;margin:auto;padding: 40px 0 20px;"></div><div style="text-align:center;padding: 0 200px;margin-top: 20px;"><a href="http://rj.baidu.com/soft/detail/14744.html" style="display: block; float: left;width: 200px;color:#233344;text-decoration: none;" target="_blank"><img src="/rcp-common/imgs/icon/browser_07.png" alt=""><p>谷歌浏览器<br><span style="color: #fe3a20">（强烈推荐）</span></p></a><a href="http://rj.baidu.com/soft/detail/11843.html" style="display: block; float: left;width: 200px;color:#233344;text-decoration: none;" target="_blank"><img src="/rcp-common/imgs/icon/browser_09.png" alt=""><p>火狐浏览器</p></a><a href="http://rj.baidu.com/soft/detail/23357.html" style="display: block; float: left;width: 200px;color:#233344;text-decoration: none;" target="_blank"><img src="/rcp-common/imgs/icon/browser_11.png" alt=""><p>Internet Explorer 10+</p></a><div style="clear: both;"></div></div><p style="color:#35383b;font-size:16px;padding: 50px 0 20px;">© 2009-2015 广州市大洋信息技术股份有限公司 '+a+"</p></div></div></body></html>";window.onload=function(){document.write(s)}}var o=e.mobileUpgradeStyle;t.runErrorCallUpgrade=function(){console.log(t.loadReady),t.loadReady||e.notCheckUpgrade||(t.upgradeLock=!0,t.querySelector("html").style.display="none")},e.addEventListener("load",function(){t.loadReady=!0,t.upgradeLock&&t.write(["<html style=\"background:white url('/rcp-common/imgs/icon/upgrade-bg.png') no-repeat center 80px;"+(o?"background-size:150% auto;":"")+'">',"<head>",'<meta charset="utf-8">',"</head>",'<body style="'+(o?"padding:125% 0 80px;":"padding:560px 0 80px;")+'">','<div style="'+(o?"font:12px 'Microsoft YaHei';":"font:28px 'Microsoft YaHei';")+'color:#666;text-align:center;">啊哦，系统升级中,我们正在紧急处理，稍后再来哦！</div>',"</body>","</html>"].join(""))},!1),e.console||(e.console={log:function(){},error:function(){},info:function(){},warn:function(){}})}(window,document);var module=angular.module("RCP",["ngRoute","ngCookies","ngSanitize","LocalStorageModule","chat_directive"]);module.controller("courseDetail",["$scope","$rootScope","$sce","$q","$location","course","dialog","lazy","chatService","service",function(e,t,n,a,i,r,s,o,c,l){function u(e){var t,n;angular.forEach(S,function(n){n.id.substring(1)===e.substring(1)&&(t=n.id)}),t&&(n=angular.element(t).offset().top-50,angular.element("html, body").animate({scrollTop:n}))}function d(){switch(e.navList="",e.course.crs.type){case"10":e.navList=[{name:"课程介绍",url:"/intro"},{name:"课程内容",url:"/content"}],e.activeNav="课程介绍";break;case"20":e.navList=[{name:"题库介绍",url:"/intro"},{name:"试卷",url:"/exam"}],e.activeNav="题库介绍";break;default:console.error("$scope.course.crs.type 只能为10或20")}e.navList=e.navList.concat([{name:"评价",url:"/comment"},{name:"学习圈子",url:"/circle"}])}function g(){var t,n=i.url();angular.forEach(e.navList,function(e){e.url===n&&(t=e)}),t&&setTimeout(function(){e.scrollToTab(t)},500)}function h(){if("2"===e.status){var t=angular.element(".statusTwo");angular.element(document).on("scroll",function(){var n=t.offset().top,a=$(document).scrollTop();a>=n+10?e.floatCNav=!0:e.floatCNav=!1;try{e.$digest()}catch(i){console.log(i)}})}else{var n,a=angular.element(".course-detail");angular.element(document).on("scroll",function(){var t=a.offset().top,i=$(document).scrollTop();i>=t+20?e.floatNav=!0:e.floatNav=!1;try{e.$digest()}catch(r){console.log(r)}M||(clearTimeout(n),n=setTimeout(function(){p()},200))})}}function p(){var t,n=$(document).scrollTop();angular.forEach(S,function(a){var i=angular.element(a.id);"老师"!==a.name&&i.length&&!i.is(":hidden")&&n>=i.offset().top-50&&(t=!0,e.activeNav=a.name)}),t||(e.activeNav=S[Object.keys(S)[0]].name,console.log(e.activeNav));try{e.$digest()}catch(a){console.log(a)}}function f(){switch(e.course.crs.status){case C.NORMAL:e.currentUser&&e.currentUser.uid===e.course.user?"课程"===e.type?e.statusText="开始导学":e.statusText="批改试卷":e.isPurchase?"课程"===e.type?e.statusText=e.course.started?"开始学习":"暂未开课":e.statusText=e.course.started?"开始做题":"暂未开始":e.course.price>0?e.statusText="立即购买":"课程"===e.type?e.statusText="免费学习":e.statusText="开始做题";break;case C.OFFSELLBYOTHER:e.statusText="已下架";break;case C.USEREDITED:e.statusText="未发布";break;case C.UNCHECKED:e.statusText="待审核";break;case C.CHECKINGREJECT:e.statusText="审核不通过";break;default:console.error("$scope.course.crs.status 非期待状态")}}function m(){var t="",n="";e.course.items.service?(t=e.course.items.service.list.service.uids,n=e.course.items.service.list.users):console.log("this is no $scope.course.items.service"),e.teachers=[],e.loading.teacher=!1,t.length&&angular.forEach(n,function(n,a){console.log(n),e.teachers.push({name:n.attrs.basic.nickName,id:t[a],avatar:n.attrs.basic.avatar,desc:n.attrs.basic.desc})}),console.log("this is loadteacher "+e.loading.teachersID+"====="+e.teachers)}function v(){var t=[];if(e.course.items.summary?t=e.course.items.summary.idx.items:console.log("This is no $scope.course.items.summary"),e.readyStyle={},e.loading.intro=!1,t.length){var a="";angular.forEach(t,function(e){"T1"===e.t?(a+='<div class="intro-title">',a+=e.c.title,a+="</div>"):"image"===e.t}),e.intro=n.trustAsHtml(a||'<p class="no-data">暂无'+e.type+"介绍</p>")}else e.intro=n.trustAsHtml('<p class="no-data">暂无'+e.type+"介绍</p>")}function y(){var t=[];if(e.course.items.text?t=e.course.items.text.idx.items:console.log("this is no $scope.course.items.text"),e.loading.content=!1,t.length){e.section=t;var n=0;angular.forEach(t,function(e){"T1"===e.t&&(n+=1)}),e.course.info.sectionCount=n}else console.log("This is nothing")}function w(){console.log("This is loadCircle   ")}function b(){e.loading.comment=!1}function k(){o.request({json:{intro:{node:S.intro.id,callback:v},teacher:{node:S.teacher.id,callback:m},section:{node:S.content.id,callback:y},circle:{node:S.circle.id,callback:w},comment:{node:S.comment.id,callback:b}}})}function T(){var t;angular.forEach(e.navList,function(e){"试卷"===e.name&&(t=e)}),setTimeout(function(){e.scrollToTab(t)},100)}function _(e){return r.joinFreeCourse({cid:e})}function x(){!e.status||1!==+e.status&&2!==+e.status||(e.notPublished=!0);var t={service:{list:{}},summary:{idx:{itemc:"1",type:"T1,T2,image"}},text:{idx:{type:"T1,T2"}},paper:{list:{}},test:{list:{}}};return r.getCourseDetail({cid:e.cid,price:1,pvs:1,cmds:angular.toJson(t)})}var S,M=!1;e.cid=rcpAid.queryString("cid"),e.status=rcpAid.queryString("type"),e.oid=rcpAid.queryString("oid"),e.goCircleCheck=rcpAid.getUrl("审核管理")+"#/course-approval",e.readyStyle={height:0,overflow:"hidden"},e.loading={intro:!0,teacher:!0,content:!0,exam:!0,qna:!0,comment:!0};var C={NORMAL:100,USEREDITED:20,UNCHECKED:200,OFFSELLBYOTHER:300,CHECKINGREJECT:500};return e.circleConfig={rUrl:DYCONFIG.studyCircle.rUrl,category:"10"},e.cid?(angular.element("body").removeClass("loading"),e.$on("login",function(t,n){n&&(e.logined=!0,console.log("登录了用户信息为： "+n))}),"undefined"!=typeof isIE&&(e.isIE=isIE(9,9)),e.scrollToTab=function(t){console.log("this is scrollToTab  "+t.callback),t.callback?t.callback():(e.activeNav=t.name,M=!0,u(t.url),setTimeout(function(){M=!1},500))},e.toTop=function(){angular.element("html, body").stop().animate({scrollTop:0},"slow")},e.loadContent={section:!1,exercise:!1,qna:!1},e.enterLearning=function(t){var n={cid:e.cid,target:t.i,token:rcpAid.getToken()};e.logined?"2"===e.status?(localStorage.setItem("LEARNING_LOCATION_TARGET","true"),e.currentUser.role&&e.currentUser.role.COURSE_VERIFY_ADMIN&&(window.location.href=rcpAid.getUrl("学习页",n))):e.course.user===e.currentUser.uid?(localStorage.setItem("LEARNING_LOCATION_TARGET","true"),window.location.href=rcpAid.getUrl("学习页",n)):e.isPurchase?(localStorage.setItem("LEARNING_LOCATION_TARGET","true"),window.location.href=rcpAid.getUrl("学习页",n)):e.course.price>0?s.alert("请先购买"+e.type):_(e.cid).then(function(){localStorage.setItem("LEARNING_LOCATION_TARGET","true"),window.location.href=rcpAid.getUrl("学习页",n)},function(t){1===t.type?s.alert(t.data.data.msg):s.alert("购买"+e.type+"失败")}):l.common.toLogin()},e.buyCourse=function(){if(!e.logined)return void l.common.toLogin();if(e.isPurchase){if(!e.course.started)return void s.alert("该"+e.type+"尚未开课。");"课程"===e.type?window.location.href=rcpAid.getUrl("学习页",{cid:e.cid}):T()}else if(e.course.price>0){var t="";"题库"===e.type&&(t="&bankId="+e.course.bankId),s.alert("进入付费页面")}else _(e.cid).then(function(){s.alert("成功参与该"+e.type),e.isPurchase=!0,e.course.started?"课程"===e.type?window.location.href=rcpAid.getUrl("学习页",{cid:e.cid}):T():e.statusText="暂未开课"},function(t){1===t.type?s.alert("购买"+e.type+"失败："+t.data.data.msg):s.alert("购买"+e.type+"失败！")})},x().then(function(n){if(e.course=n.data,!e.course.crs)return void console.error("this is no data.data.crs");if("2"===e.status){if(console.log(e.currentUser),e.course.crs.status===C.USEREDITED)return;if(e.currentUser.role&&!e.currentUser.role.COURSE_VERIFY_ADMIN||!e.currentUser.role)return void(e.loadCourseError=!0)}e.course.crs.extra&&e.course.crs.extra.reason?(e.courseReason=e.course.crs.extra.reason,e.courseReasonInput=e.courseReason):(e.courseReason="",e.courseReasonInput=""),e.course.started=moment().isAfter(moment(e.course.crs.start_time)),e.isPurchase=0!==e.course.joinMode,e.course.info={},e.course.crs.type?e.type="10"===e.course.crs.type?"课程":"题库":console.error("没有$scope.course.crs.type"),t.title=e.course.crs.title+" - "+e.type+"详情",e.course.user=e.course.crs.uid,e.circleConfig.cid=e.cid,e.circleConfig.type=e.course.crs.type;try{e.course.ext=JSON.parse(e.course.ext)}catch(a){e.course.ext={}}if(S={intro:{name:e.type+"介绍",id:"#intro"},teacher:{name:"老师",id:"#teacher"},content:{id:"#content",name:"课程内容"},comment:{id:"#comment",name:"评价"},circle:{id:"#circle",name:"学习圈子"}},d(),h(),k(),f(),g(),e.course.crs.imgs)try{var i=new Image;i.onerror=function(){console.error("图片加载失败"),e.cover={"background-image":"url(/rcp-common/imgs/icon/gray-default-img.png)"}},i.onload=function(){e.cover={"background-image":"url("+(e.course.crs.imgs.toString()||"").split(",")[0]+")","background-size":"cover"}},e.course.crs.imgs.length&&e.course.crs.imgs[0]?i.src=e.course.crs.imgs[0]:e.cover={"background-image":"url(/rcp-common/imgs/icon/gray-default-img.png)"}}catch(r){console.error("crs.imgs 不是数组"),e.cover={"background-image":"url(/rcp-common/imgs/icon/gray-default-img.png)"}}else console.error("没有crs.imgs这个字段"),e.cover={"background-image":"url(/rcp-common/imgs/icon/gray-default-img.png)"}},function(t){e.loadCourseError=!0,s.alert("该课程不存在")}),e.disabledAction=function(){return"2"===e.status||e.course.crs.status!==C.NORMAL},void(e.approveCourse=function(t){return e.course.crs.status===C.UNCHECKED||1!==t&&0!==t?(10===t&&e.course.crs.status!==C.NORMAL&&s.alert("非通过课程不能下架"),void r.verifyCourse({reason:e.courseReasonInput,cid:e.cid,pass:t}).then(function(){window.location.href=rcpAid.getUrl("审核管理")+"#/course-approval"},function(e){s.alert("审核课程失败")})):void s.alert("课程不是待审核状态")})):void s.alert("课程 ID 为空。")}]),module.factory("course",["request",function(e){var t=DYCONFIG.course.rUrl;return{getCourseDetail:function(n,a){n.token=rcpAid.getToken();var i={method:"GET",url:t+"pub/api/loadCourse",params:n};return e(angular.extend(i,a||{}))},getTeacherCourses:function(n,a){n.token=rcpAid.getToken(),n.isSelf=1;var i={method:"GET",url:t+"pub/api/searchCourse",params:n};return e(angular.extend(i,a||{}))},joinFreeCourse:function(n,a){n.token=rcpAid.getToken();var i={method:"GET",url:t+"usr/api/joinCourse",params:n};return e(angular.extend(i,a||{}))},searchCourse:function(n,a){var i={method:"GET",url:t+"pub/api/searchCourse",params:n};return e(angular.extend(i,a||{}))},verifyCourse:function(n,a){n.token=rcpAid.getToken();var i={method:"GET",url:t+"usr/api/verifyCourse",params:n};return e(angular.extend(i,a||{}))},createCourse:function(n,a,i){n.token=rcpAid.getToken();var r={method:"POST",url:t+"usr/api/createCourse",params:n,data:i};return e(angular.extend(r,a||{}))},getStudentCourse:function(n,a){n.token=rcpAid.getToken(),n.isSelf=10;var i={method:"GET",url:t+"pub/api/searchCourse",params:n};return e(angular.extend(i,a||{}))},releaseCourse:function(n,a){n.token=rcpAid.getToken();var i={method:"GET",url:t+"usr/api/releaseCourse",params:n};return e(angular.extend(i,a||{}))},saveCourseData:function(n,a){var i={};i.token=rcpAid.getToken();var r={method:"POST",url:t+"usr/api/updateCourse",params:i,data:n};return e(angular.extend(r,a||{}))},cancelCourse:function(n,a){n.token=rcpAid.getToken();var i={method:"POST",url:t+"usr/api/cancelCourse",params:n};return e(angular.extend(i,a||{}))},getListGroup:function(n,a){n.token=rcpAid.getToken();var i={method:"GET",url:t+"pub/api/listGroup",params:n};return e(angular.extend(i,a||{}))},getAllTags:function(t,n){t.token=rcpAid.getToken();var a={method:"POST",url:DYCONFIG.pes.rUrl+'pub/api/page/GetPage?keys=[{"key":"p_classifi"}]',params:t};return e(angular.extend(a,n||{}))},updateArticleExt:function(n,a){n.token=rcpAid.getToken();var i={method:"GET",url:t+"usr/api/updateExt",params:n};return e(angular.extend(i,a||{}))},getArticleExt:function(n,a){n.token=rcpAid.getToken();var i={method:"GET",url:t+"pub/api/listArtExt",params:n};return e(angular.extend(i,a||{}))},loadRecord:function(n,a){n.token=rcpAid.getToken();var i={method:"GET",url:t+"pub/api/loadRecord",params:n};return e(angular.extend(i,a||{}))},listPaperCorrect:function(n,a){n.token=rcpAid.getToken();var i={method:"GET",url:t+"usr/api/listPaperCorrect",params:n};return e(angular.extend(i,a||{}))},Publish:function(n,a){n.token=rcpAid.getToken();var i={method:"GET",url:t+"usr/api/publish",params:n};return e(angular.extend(i,a||{}))}}}]),module.run(["service","course",function(e,t){e.expand("course",function(){return t})}]),angular.module("RCP").factory("chatService",["$http","$q","$rootScope","service",function(e,t,n,a){function i(e){if(e)return localStorage.getItem("anonymousLoginToken");var t=rcpAid.getToken();return t}function r(e){be=e}function s(n){return e(n).then(function(e){var n=t.defer();return 0!==e.data.code?n.reject({type:1,data:e}):n.resolve(e.data),n.promise},function(e){throw{type:-1,data:e}})}function o(){return s({method:"GET",url:"http://"+pe.SSO+"/sso/api/anonymousLogin"})}function c(){return s({url:pe.friendsAddr+"/usr/get-user-grps",params:{token:Le},method:"GET"})}function l(e,t){return s({url:pe.friendsAddr+"/get-usr-info",params:{token:Le,r:e,t:t},method:"GET",headers:{"Content-Type":void 0},option:{requestErrorMsg:!1}})}function u(e,t){return s({url:pe.friendsAddr+"/get-grp-info",params:{token:Le,r:e,cid:t},method:"GET"})}function d(){return s({
url:pe.friendsAddr+"/usr/get-usr-courgrp",params:{token:Le},method:"GET"})}function g(){return s({url:pe.rdisAddrSrv+"usr/api/listRinfo",params:{token:Le},method:"GET",option:{requestErrorMsg:!1}})}function h(e){return e.sender&&"G"===e.sender[0]&&(e.reciever=e.sender,delete e.sender),s({url:pe.rdisAddrSrv+"usr/api/listRecord",params:{token:Le,s:e.sender,r:e.reciever,btime:e.beginTime,etime:e.endTime,pageNo:e.pageNo,pageSize:e.pageSize,filter:e.filter,o:e.order,sid:e.id},method:"GET",option:{requestErrorMsg:!1}}).then(function(n){var a=t.defer();a.resolve();var i=[];return n.data.list.reduce(function(t,n){var a=C(n.time).split(" ");if(n.c=Base64.decode(n.c),11===n.t)try{var r=JSON.parse(n.c),s=["亲爱的",r.userName,"同学，欢迎加入《",r.courseName,"》课程。我们将会为你规划学习路线，提供学习指引。学习过程中的任何困惑，我们都会帮助你解决。快去课程学习页学习吧!"].join(""),o=r.userName+"加入本群";r.userName===xe.name?n.c=s:n.c=o}catch(c){}return t.then(function(){return I(n.s).then(function(t){var r={day:a[0],time:a[1],t:n.time,msg:M(n),sender:t,fileType:n.t,originalMsg:n,isMine:n.s===xe.uuid,msgId:n.i};ve[e.sender]=ve[e.sender]||{},ve[e.sender][n.i]=r,i.push(r)})})},a.promise).then(function(){return{total:n.data.total,pageNo:e.pageNo,pageSize:e.pageSize,msg:i}})})}function p(e){return s({url:pe.friendsAddr+"/usr/search-usr",params:{name:e.name,ps:e.ps,pn:e.pn,token:Le},method:"GET"})}function f(e){return s({url:pe.friendsAddr+"/usr/req-friend",params:{uuid:e.uuid,msg:e.msg,token:Le},method:"GET"})}function m(e){return s({url:pe.friendsAddr+"/usr/del-req-friend",params:{opt:e.action,oid:e.oid,token:Le},method:"GET"})}function v(e){return s({url:pe.friendsAddr+"/usr/list-notify",method:"GET",params:{token:Le,t:e}})}function y(e){return s({url:pe.friendsAddr+"/usr/add-discuss-grp",method:"GET",params:{token:Le,uids:e}})}function w(){return s({url:pe.friendsAddr+"/sel-help",method:"GET",params:{token:Le}})}function b(e){return s({url:pe.friendsAddr+"/usr/sel-answer",method:"GET",params:{token:Le,uuids:e}})}function k(e,t,n){if(ye)try{console.log.apply(console,arguments)}catch(a){console.log(e,t,n)}}function T(e,t,n){var a;"undefined"!=typeof jf&&jf.alert?(a=fe.call(arguments),jf.alert(a.join(","))):(k.apply(this,arguments),a=fe.call(arguments),alert(a.join(",")))}function _(e){localStorage&&localStorage.setItem("anonymousLoginToken",e),jf.setCookie("token2",e)}function x(e){return e=e.replace(/&/g,"&gt;"),e=e.replace(/</g,"&lt;"),e=e.replace(/>/g,"&gt;"),e=e.replace(/\'/g,"&#39;"),e=e.replace(/\'/g,"&quot;"),e=e.replace(/\n/g,"<br>")}function S(e){return e>1024?e>1048576?(e/1048576).toFixed(2)+" M":Math.floor(e/1024)+" K":e+" B"}function M(e){var t,n,a,i=e.c,r=/(http|ftp|https):\/\/[\w\-_]+(\.[\w\-_]+)+([\w\-\.,@?^=%&amp;:\/~\+#]*[\w\-\@?^=%&amp;\/~\+#])?/gi;switch(e.t){case 2:try{t=JSON.parse(i),n='<a href="javascript:;" onclick="showPic(this)"><img src="'+t.url+'?s=1" /></a>'}catch(s){i=x(i),n="<div>"+i+"</div>"}break;case 3:try{t=JSON.parse(i),a=['<div class="chat-msg-file"><div class="chat-msg-file-icon"><img src="/img/icon-92.png" /></div>','<div class ="chat-msg-file-info"><span class="chat-msg-filename" title="{{name}}">','{{name}}</span><span class="chat-msg-filesize">({{size}})</span>','<p><a href ="{{url}}?dl=1" dl="1" target="_blank" download>下载</a></p></div></div>'].join(""),a=a.replace(/{{name}}/gi,t.name),a=a.replace(/{{url}}/gi,t.url),a=a.replace(/{{size}}/gi,S(t.size)),n=a}catch(s){i=x(i),n="<div>"+i+"</div>"}break;case 20:try{t=JSON.parse(i),a=['<div class="chat-recommend-course"><p class="chat-course-recommend-head">课程推荐</p>','<div class="chat-course-cover"><img src="{{img}}" /></div><div class ="chat-course-info">','<p class="chat-course-name" title="{{name}}">课程名称：{{name}}</p><p class="chat-course-teacher">创建者：{{teacher}}</p>','<p class="chat-course-action"><a href ="{{url}}" target="_blank">立即参与</a></p></div></div>'].join(""),a=a.replace(/{{img}}/gi,t.imgs.split(",")[0]||"/img/icon-65.gif"),a=a.replace(/{{name}}/gi,t.name),a=a.replace(/{{teacher}}/gi,t.userName),a=a.replace(/{{url}}/gi,"/course-detail.html?id="+t.id),n=a}catch(s){i=x(i),n="<div>"+i+"</div>"}break;default:i=x(i);var o=r.test(i);i=i.replace(r,function(e){var t='<a target="_blank" class="chat-msg-link" href="{{href}}" title="">{{href}}</a>';return t.replace(/{{href}}/gi,e)}),n=o?'<div class="chat-msg-has-link">'+i+"</div>":'<div class="chat-msg-has-content">'+i+"</div>"}return n}function C(e,t,n){var a=new Date(e),i=a.getFullYear(),r=a.getMonth()+1,s=a.getDate(),o=a.getHours(),c=a.getMinutes(),l=a.getSeconds(),u="";return r=r>9?r:"0"+r,s=s>9?s:"0"+s,o=o>9?o:"0"+o,c=c>9?c:"0"+c,l=l>9?l:"0"+l,n?(u=n.replace(/yy/g,i),u=u.replace(/mm/g,r),u=u.replace(/dd/g,s),u=u.replace(/hh/g,o),u=u.replace(/MM/g,c),u=u.replace(/ss/g,l)):[i,r,s].join("-")+" "+(t?[o,c,l].join(":"):[o,c].join(":"))}function D(e,t,n,a){return we[e]&&we[e].length?we[e].push({fn:t,context:n||this,once:a}):we[e]=[{fn:t,context:n||this,once:a}],this}function L(e){var t=fe.call(arguments,1);we[e]&&we[e].length&&angular.forEach(we[e],function(e){e.once&&e.called||(e.fn.apply(e.context,t),e.called=!0)})}function U(e){e.sort(function(e){return e.online?-1:1})}function A(e){return me[e.uuid]||(e.msg=[{fileType:-1}],me[e.uuid]=e),e}function E(e,t){function n(){return t?u(void 0,t):e&&"G"===e[0]?u(e):l(e,"w")}return n().then(function(t){var n=e&&"G"===e[0]?"group":"user",a={type:n,name:t.data.name,img:t.data.img,id:t.data.id,uuid:t.data.ugid||t.data.uuid,online:"group"===n?!0:!!t.data.online,isGuest:!!t.data.tour};return A(a),t.data.users&&t.data.users.length&&angular.forEach(t.data.users,function(e){var t={type:"user",name:e.name,img:e.img,id:e.id,uuid:e.uuid,online:!!e.online};A(t)}),t})}function I(e){var n=t.defer();return me[e]?(n.resolve(me[e]),n.promise):(k("get user from server"),E(e).then(function(e){var t={type:e.data.ugid?"group":"user",name:e.data.name,img:e.data.img,id:e.data.id,uuid:e.data.ugid||e.data.uuid,online:!0,isGuest:!!e.data.tour};return t}))}function O(){var e=t.defer();return ce?le?e.resolve():D("wsConnected",function(){e.resolve()},this,!0):(ce=IM.NewIm(pe.imAddr,!0),ce.on("connect",function(){return le=!0,oe="pending",L("wsConnected"),N(Le).then(function(){e.resolve()})}),F()),e.promise}function N(e){var n=t.defer();return oe=oe||"pending","logined"===oe?n.resolve():e?(ce.emit("li",{token:e,ctype:"20"}),oe="logined",L("wsLogined"),n.resolve()):o().then(function(e){_(e.data.token),oe="logined",L("wsLogined"),n.resolve()},function(e){n.reject({msg:"websocket 登陆失败",err:e})}),n.promise}function P(){var e=t.defer(),a=n.$watch("anonymousUser",function(t){t&&(Le=t.token||localStorage.getItem("anonymousLoginToken"),e.resolve(),a())});return e.promise}function F(){ce.on("li",function(e){0!==e.code?(L("wsLoginError",e),k(e.err)):(L("wsLogined"),ce.emit("ur",{}))}),ce.on("m",function(e){var t,a;if("G"===e.a[0]?(t=+e.a.split("-")[1],a=e.a):(t=+e.s.split("-")[1],a=e.s),!ve[a]||!ve[a][e.i]){if(11===e.t)try{var i=JSON.parse(e.c),r=["亲爱的",i.userName,"同学，欢迎加入《",i.courseName,"》课程。我们将会为你规划学习路线，提供学习指引。学习过程中的任何困惑，我们都会帮助你解决。快去课程学习页学习吧!"].join(""),s=i.userName+"加入本群";i.userName===xe.name?e.c=r:e.c=s,(i.userName===xe.name||n.currentUser&&1===n.currentUser.auth)&&(G(),Y())}catch(o){}if(10===e.t)try{for(var c=JSON.parse(e.c),l=!1,u=0;u<De.length;u+=1)if(De[u].oid===c.req.oid){De[u].status=c.req.status,l=!0;break}if(!l){if(c.req.date=C(c.req.time||(new Date).getTime()).split(" ")[0],4===c.req.status){var d={type:"user",name:c.req.rName,img:c.req.rImg,id:+c.req.r.split("-")[1],uuid:c.req.r,online:!!c.req.online};ke.DEFAULT.users.push(A(d))}De.push(c.req)}}catch(o){}if(15===e.t)return L("realTimeUser",e),void ce.markRead(e.i,e.a);Me&&Me.uuid===a||15===e.t?(ce.markRead(e.i,e.a),e.unread=!1):(Ce[a]="undefined"==typeof Ce[a]?1:Ce[a]+1,e.unread=!0),I(e.s,e.t).then(function(t){e.c=M(e),e.time=C(e.time),I(a).then(function(){if(!ve[a]||!ve[a][e.i]){var n={isMine:!1,msg:e.c,time:e.time,type:e.a[0],sender:t,fileType:e.t,uuid:a,msgId:e.i,unread:e.unread};switch(n.fileType){case 2:n.message="[图片]";break;case 3:n.message="[附件]";break;case 10:n.message="收到新的好友通知";break;default:n.message=angular.element(n.msg).text()}me[a].msg.push(n),n.unread&&Ue.unshift(n),ie(a),L("wsMsg",e,n)}})})}}),ce.on("error",function(e){L("wsError",e)}),ce.on("close",function(e){L("wsClose",e)})}function R(e,t,n){if(!ce)return T("尚未连接服务器。"),!1;if(!n)return T("不能发送空白消息"),!1;var a={t:t||0,r:[e.uuid],c:n};n=M(a),ce.sms2(a);var i={time:C((new Date).getTime()),isMine:!0,msg:n,sender:xe,senderId:xe.uuid,fileType:t,id:e.id};me[e.uuid].msg.push(i),ie(e.uuid),L("wsSendMsg",e,i)}function G(){return d().then(function(e){Ae.splice(0,Ae.length),angular.forEach(e.data,function(e){var t={};angular.forEach(e.users,function(e){var n={name:e.name,id:e.id,img:e.img,online:!!e.online,role:e.role,type:"user",uuid:e.uuid,msg:[]};A(n),t[n.uuid]?t[n.uuid].role=[t[n.uuid].role,n.role].join(","):t[n.uuid]=n}),e.teachers=t,Ae.push(e)})})}function Y(){return E().then(function(e){xe.id=e.data.id,xe.name=e.data.name,xe.img=e.data.img,xe.uuid=e.data.uuid,xe.type="user",L("userLogin",xe),angular.forEach(ke,function(e){e.users.splice(0,e.users.length)}),angular.forEach(e.data.friendGrp,function(e){var t=[];angular.forEach(e.users,function(e){var n={type:"user",name:e.name,id:e.id,img:e.img,uuid:e.uuid,online:!!e.online};A(n),"COURSE_GRP"===e.type&&(n.type="group",n.online=!0,ke["C-GRP"].users.push(n)),"CHAT_GRP"===e.type&&(n.type="group",n.online=!0,ke["My-GRP"].users.push(n)),t.push(n)}),ke[e.gType]&&(ke[e.gType].users=t)})}).then(function(){angular.forEach(ke,function(e){U(e.users)})})}function z(){return c().then(function(e){angular.forEach(e.data,function(e){angular.forEach(ke,function(t){e.gType===t.type&&angular.forEach(e.users,function(e){var n={type:"user",name:e.name,id:e.id,img:e.img,uuid:e.uuid,online:!!e.online};t.users.push(A(n))})})})})}function W(e){Te.cid=e.data.cid,Te.oid=e.data.oid,Te.uuid=e.data.ugid,Te.gType=e.data.gType,Te.course=e.data.course,"CHAT_GRP"===Te.gType?Te.userList.member.users=e.data.users:angular.forEach(Te.userList,function(t){t.users.splice(0,t.users.length),angular.forEach(e.data.users,function(e){if(-1!==t.role.indexOf(e.role)){var n={id:e.id,img:e.img,role:[e.role],uuid:e.uuid,type:e.type,name:e.name},a=!1;angular.forEach(t.users,function(t){e.id===t.id&&(t.role.push(e.role),a=!0)}),a||t.users.push(n)}})})}function j(e){if(_e[e]){var n=t.defer();return Te=_e[e],n.resolve(),n.promise}return E(e).then(function(e){return e.data.cid?s({url:"get-course",method:"GET",params:{id:e.data.cid},option:{loading:!1}}).then(function(t){return e.data.course=t.data,W(e),e}):(W(e),e)})}function H(){return g().then(function(e){angular.forEach(e.data,function(e){var t={name:e.alias,img:e.img,uuid:e.r,type:0===e.type?"group":"user",id:+e.r.split("-")[1],online:0===e.type?!0:!!e.online,isGuest:!!e.tour};Se.push(A(t))}),U(Se)})}function q(){var e=!1;return De.splice(0,De.length),v().then(function(t){angular.forEach(t.data,function(t){t.date=C(t.time||(new Date).getTime()).split(" ")[0],1===t.status&&(e=!0),De.push(t)})}).then(function(){return v("r").then(function(e){angular.forEach(e.data,function(e){e.date=C(e.time||(new Date).getTime()).split(" ")[0],e.mine=!0,De.push(e)})})}).then(function(){e&&L("hasUnhandleRequest")})}function B(){k("get offline message")}function V(){return O()}function K(e){e.wrap("<form>").parent("form").trigger("reset"),e.unwrap()}function J(e){be=e,2===e?angular.element("#"+he).click():angular.element("#"+de).click()}function X(e,n){function a(){var e=t.defer();return"undefined"!=typeof C4js&&"function"==typeof C4js.Uer?e.resolve():$.getScript("common/directive/upload/upload-plugin.js",function(){e.resolve()}),e.promise}return n&&"image"===n?he=e:de=e,a().then(function(){var t=["png","jpg","bmp","gif","jpeg"],n=function(e){var n=!0;return 2===be&&angular.forEach(e.files,function(e){var a=e.name.split(".").pop().toLowerCase();-1===t.indexOf(a)&&(T("只支持以下格式图片上传：png,jpg,bmp,gif,jpeg。"),n=!1,K(angular.element("#chat-upload")))}),n?e.files:{}};ue=new C4js.Uer(pe.uploadSrv,{m:"C",token:Le},!0),ue.AddI(e,{pub:1,picType:2},{OnProcess:function(e,t,n){e.obj=e.obj||{},e.obj.rate=t,e.obj.speed=n,e.obj.status="uploading",k("upload progress "+e.obj.rate),L("uploadProgress",e,t,n)},OnSuccess:function(e,t){e.obj=e.obj||{};var n=t.data,a={name:e.name,path:"",Sha:"",type:e.type,url:n,size:e.size};e.obj.status="finish",R(Me,be,JSON.stringify(a)),L("uploadSuccess",e,t)},OnErr:function(e,t,n){e.obj=e.obj||{},e.obj.status="error",e.obj.error=n,L("uploadError",e,t,n)},OnAbort:function(e){e.obj=e.obj||{},e.obj.status="abort",L("uploadAbort",e)},OnStart:function(e){e.obj=e.obj||{},e.obj.status="uploading",e.obj.id=e.fid,L("uploadStart",e)},OnLoad:function(e,t){L("uploadLoad",e,t)}}),ue.OnSelect=function(e){var t=n(e);return ue.Args.token=Le,angular.forEach(t,function(e){var t={};t.status="add",t.size=S(e.size),t.name=e.name,me[Me.uuid].msg.push({time:C((new Date).getTime()),uploadingMsg:!0,file:t,isMine:!0,sender:xe,uuid:Me.uuid}),L("uploadSelect",e),k("select upload file "+e.name),e.obj=t}),t}})}function Z(e){13===e.which?(Q(ge),L("sendScreenshot")):27===e.which&&(ee(),L("cancelScreenshot"))}function Q(e){if(angular.element(document).off("keydown",Z),!e)return void T("暂无截图。");if(!Me)return void T("请选择需要发送截图的好友。");var n={status:"uploading",rate:0,speed:0,name:"截图文件",size:0},a=function(e){var a=new XMLHttpRequest,i=a.upload,r=t.defer();a.onreadystatechange=function(){if(4===a.readyState&&200===a.status)try{var e=JSON.parse(a.responseText);r.resolve(e),L("screenshotUploadFinish",e)}catch(t){r.resolve(a.responseText),L("screenshotUploadFinish",a.responseText)}},i.addEventListener("progress",function(e){if(e.lengthComputable){var t=e.loaded/e.total;n.rate=t}L("screenshotUploadProgress",n,e)}),i.addEventListener("load",function(e){L("screenshotUploadLoad",n,e)}),i.addEventListener("error",function(e){n.status="error",L("screenshotUploadError",n,e)});var s={m:"C",pub:"1",picType:1,fileName:"screenshot.png",base64:1,token:Le},o=[];angular.forEach(s,function(e,t){o.push(t+"="+e)});var c=pe.uploadSrv+"?"+o.join("&");return a.open("post",c),a.send(e),r.promise};me[Me.uuid].msg.push({time:C((new Date).getTime()),uploadingMsg:!0,file:n,isMine:!0,sender:xe,uuid:Me.uuid}),L("sendScreenshot"),a(e.split(",")[1]).then(function(e){if(301===e.code)return void T("登陆超时！请重新登陆。");if(0!==e.code)return void T("上传截图失败！请重新上传。");var t={name:e.ext.url.split("/").pop(),path:"",Sha:"",type:"image",url:e.data,size:1};n.status="finish",R(Me,2,JSON.stringify(t)),L("sendScreenshotMsg")})}function ee(){ge="",angular.element(document).off("keydown",Z),L("cancelScreenshot")}function te(e){e.on("paste",function(t){angular.forEach(t.originalEvent.clipboardData.items,function(t){if("file"===t.kind&&/image\/\w+/.test(t.type)){var n=t.getAsFile(),a=new FileReader;a.onloadend=function(){ge=this.result,L("showScreenshot",ge),angular.element(document).on("keydown",Z),e.blur()},a.readAsDataURL(n)}})})}function ne(e){ue.Abort(e)}function ae(e,t){var n=e.splice(t,1)[0];e.unshift(n)}function ie(e){for(var t,n=0,a=0,i=!1;n<Se.length;n+=1)if(t=Se[n],t.uuid===e){i=!0,ae(Se,n);break}i||(k("could not find popup user, will shift the user to the list"),Se.unshift(me[e]));for(n in ke)if(ke.hasOwnProperty(n)){var r=ke[n];for(a=0;a<r.users.length;a+=1)if(t=r.users[a],t.uuid===e){ae(r.users,a);break}}}function re(e){I(e).then(function(e){var t=angular.element(".online-chat").scope();t?t.open(e,!0):T("无法找到即时通讯组件。")})}function se(e){Le=e}var oe,ce,le,ue,de,ge,he,pe=g_conf,fe=[].slice,me={},ve={},ye="localhost"===window.location.hostname,we={},be=2,ke={"S-GRP":{name:"我的学生",users:[],type:"S-GRP",order:1},"C-GRP":{name:"学习群组",users:[],type:"C-GRP",order:3},"T-GRP":{name:"我的老师",users:[],type:"T-GRP",order:4},"My-GRP":{name:"我的讨论组",users:[],type:"My-GRP",order:5},DEFAULT:{name:"我的好友",users:[],type:"DEFAULT",order:2}},Te={userList:{teachers:{name:"老师",users:[],role:["GUIDE","ANSWER"],isTeacher:!0},students:{name:"学生",users:[],role:["MEMBER"],isTeacher:!1},member:{name:"讨论组成员",users:[],role:[""]}},cid:0,gType:"",oid:0,uuid:""},_e={},xe={},Se=[],Me={},Ce={},De=[],Le=i(),Ue=[],Ae=[];return D("enterChat",function(e){Me=e,Ce[Me.uuid]=0,me[e.uuid]||(e.msg=[],me[e.uuid]=e);for(var t=!1,n=0;n<Se.length;n+=1)if(Se[n].uuid===e.uuid){t=!0;break}t||Se.unshift(e);var a=me[Me.uuid].msg,i=[];if(angular.forEach(a,function(e){e.unread&&(i.push(e.msgId),e.unread=!1)}),i.length){var r;r="U-00"===Me.uuid?"U-0":Me.uuid,ce.markRead(i.join(","),r)}for(n=0;n<Ue.length;n+=1)Ue[n].uuid===e.uuid&&(Ue.splice(n,1),n-=1)}),D("closeChat",function(){Me=null}),D("hasUnhandleRequest",function(){for(var e=!1,t=0;t<Se.length;t+=1)if("U-0"===Se[t].uuid){e=!0;break}if(!e){var n={type:"friendNotify",name:"系统通知",img:"images/icon/friend-notify.png",id:0,uuid:"U-0",online:!0};Se.unshift(A(n))}}),{http:{anonymousLogin:o,getUserGroups:c,getUserInfo:l,getGroup:u,getRecentUser:g,searchUser:p,requestFriend:f,handleFriendRequest:m,getNotify:v,createGroup:y,getGuideTeacher:w,getServeList:d,getAnswerTeacher:b},util:{getToken:i,log:T,saveToken:_,devlog:k,parseSize:S,parseTime:C,parseMsg:M,popUpUser:ie,request:s},on:D,trigger:L,ws:{init:V,login:N},api:{getUserOrGroupInfo:E,getSender:I,clearFileInput:K,selectUploadFile:J,initUploadPlugin:X,cancelUpload:ne,sendMsg:R,getOfflineMsg:B,getMyInfoAndGroup:Y,getFriendsGroup:z,getRecentUser:H,getGroupDetail:j,getRecordList:h,initTextInput:te,sendScreenshot:Q,cancelScreenshot:ee,unread:Ce,getFriendRequest:q,getAnonymousToken:P,websocket:ce,getServeList:G,changeUploadType:r,chatWithUser:re,changeToken:se},data:{self:xe,groupInfo:Te,groups:ke,recentUser:Se,allUsers:me,friendRequests:De,unreadMsgList:Ue,serveList:Ae}}}]);var IM=function(){function e(e,t){this.url=e,this.events={},this.reconnect=t,this.times=0,this.tdata="",this.closed=!0,this.showlog=!0,this.mrs={},this.connect()}var t=[].slice;return e.WIN_SEQ="^-^",e.prototype.log=function(){if(this.showlog)switch(arguments.length){case 1:console.log(arguments[0]);break;case 2:console.log(arguments[0],arguments[1]);break;case 3:console.log(arguments[0],arguments[1],arguments[2]);break;case 4:console.log(arguments[0],arguments[1],arguments[2],arguments[3]);break;default:console.log(arguments[0])}},e.prototype.connect=function(){var e=this;this.ws=new WebSocket(this.url),this.ws.onerror=function(t){e.onError(t)},this.ws.onopen=function(t){e.onOpen(t)},this.ws.onmessage=function(t){e.onMessage(t)},this.ws.onclose=function(t){e.onClose(t)},this.log("connecting->"+this.url)},e.prototype.onError=function(e){this.log("onerror->",e),this.trigger("error",e)},e.prototype.onOpen=function(e){this.log("onopen->",this.url),this.trigger("connect",e),this.trigger("open",e),this.times=0,this.closed=!1},e.prototype.onMessage=function(e){if(this.tdata+=e.data,"\n"==this.tdata.substr(this.tdata.length-1)){var t=this.tdata,n=t.split("^-^");if(this.tdata="",n.length<2)return void this.log("receive invalid data: "+t);var a=JSON.parse(n[1]);if("m"==n[0]){if(this[a.i])return;a.c=Base64.decode(a.c),this[a.i]=!0}this.trigger(n[0],a)}},e.prototype.onClose=function(e){if(this.log("onclose->",e),this.closed=!0,this.trigger("close",e),this.log("ws is closed.."),this.reconnect){this.log("ws will reconnect after "+100*this.times+" ms");var t=this;setTimeout(function(){t.connect()},300*this.times),this.times++}},e.prototype.markRead=function(e,t){this.emit("mr",{i:e,a:t})},e.prototype.on=function(e,t){this.events[e]=t},e.prototype.trigger=function(e){var n=t.call(arguments,1);"function"==typeof this.events[e]&&this.events[e].apply(this,n)},e.prototype.emit=function(t,n){this.ws.send(t+e.WIN_SEQ+JSON.stringify(n)+"\n")},e.prototype.sms=function(e,t,n){return!e||e.length<1||void 0===t||!n?void this.log("sms args error",e,t,n):void this.emit("m",{r:e,t:t,c:Base64.encode(n)})},e.prototype.sms2=function(e){return!e.r||e.r.length<1||void 0===e.t||!e.c?void this.log("sms args error",e):void this.emit("m",{r:e.r,t:e.t,c:Base64.encode(e.c)})},e.NewIm=function(t,n){return new e(t,n)},e}();!function(){var e=angular.module("chat_directive",[]);e.filter("orderObjectBy",function(){return function(e,t){var n=[];return angular.forEach(e,function(e){n.push(e)}),n.sort(function(e,n){return e[t]>n[t]?1:-1}),n}});var t=g_conf;e.controller("chat",["$scope","$q","$rootScope","$http","$cookies","chatService","service",function(e,n,a,i,r,s,o){function c(e){var t=!1;return angular.forEach(f,function(n){e===n.id&&(t=!0)}),t}function l(e){return s.http.getAnswerTeacher(e).then(function(e){var t={name:e.data.name,img:e.data.img,uuid:e.data.uuid,type:"user",id:e.data.id,online:e.data.online};return t})}function u(){e.addMenu=!1,e.$digest(),angular.element(document).off("click",u)}function d(){return s.http.getGuideTeacher().then(function(t){var n={name:t.data.name,img:t.data.img,uuid:t.data.uuid,type:"user",id:t.data.id,online:t.data.online};return e.guideTeacher=n,e.guideTeacher})}function g(t){switch(t){case"serve":e.tabName="找老师";break;case"group":e.tabName="群组";break;case"friend":e.tabName="好友";break;default:e.tabName="消息"}}e.isIE9=!1,isIE(9,9)&&(e.isIE9=!0),angular.element(".online-chat").show();var h=s.util.devlog,p=s.util.log;e.unread=s.api.unread,e.chatTarget=null,e.self=s.data.self,e.unreadMsgList=s.data.unreadMsgList,e.myCourse=s.data.serveList,e.show="main";var f=[];angular.forEach(s.data.groups,function(e){"DEFAULT"===e.type&&(f=e.users)}),e.loginStatus="pending",e.changeUploadType=s.api.changeUploadType,s.on("wsConnected",function(){e.loginStatus="pending"}).on("wsLogined",function(){h("login to server successfully"),e.loginStatus="logined"}).on("wsLoginError",function(){h("即时通讯登陆失败，使用匿名登陆。")}).on("wsMsg",function(t,n){var a,i;"G"===t.a[0]?(a=+t.a.split("-")[1],i=t.a):(a=+t.s.split("-")[1],i=t.s),e.chatTarget&&e.chatTarget.uuid===i&&e.$emit("scrollToBottom"),h("recieve msg from id "+a,n),e.$emit("loadMsg")}).on("openChatWindow",function(t){e.readyToOpenWindow?(e.showChatWindow=!0,e.openChatWindow(t)):e.$watch("readyToOpenWindow",function(n){n&&(e.showChatWindow=!0,e.openChatWindow(t))})}).on("openAddFriendDialog",function(t){return c(t._id||t.id)?(s.util.log("该用户已经是您的好友。"),!1):t._id&&t._id===e.self.id||t.id&&t.id===e.self.id?void s.util.log("不能添加自己为好友。"):(e.showAddDialog=!0,void(e.addTarget=t))}),e.unreadAll=function(){var e=0;for(var t in s.api.unread)s.api.unread.hasOwnProperty(t)&&(e+=s.api.unread[t]);return e},e.closeAddDialog=function(){e.showAddDialog=!1,e.msg=""},e.requestAddFriend=function(){return e.addTarget?void s.http.requestFriend({uuid:e.addTarget.uuid,msg:e.msg}).then(function(){s.util.log("好友申请成功！"),e.showAddDialog=!1,e.msg=""},function(t){1===t.type?(2===t.data.data.code&&(e.showAddDialog=!1,e.msg=""),s.util.log(t.data.data.msg)):(s.util.log("请求添加好友失败！"),s.util.devlog(t))}):void s.util.log("请选择需要添加为好友的用户。")};var m=a.$watch("loginStatusInit",function(t){function i(){if(t.flag)return h("already logined, get current user info and group list"),s.api.changeToken(rcpAid.getToken()),s.api.getMyInfoAndGroup();h("not login, use anonymous login");var e=n.defer();return a.$watch("anonymousUser",function(t){t&&(s.api.changeToken(t.token),h("get anonymous user info"),s.api.getMyInfoAndGroup().then(function(){e.resolve()},function(){return s.http.anonymousLogin().then(function(t){if(0!==t.code)return console.error(t.msg,"匿名登录失败"),void localStorage.setItem("anonymousLoginUsr","error");var n=t.data;n.usr.token=n.token,localStorage.setItem("anonymousLoginToken",n.token),delete n.usr.BAttr,delete n.usr.attrs,localStorage.setItem("anonymousLoginUsr",JSON.stringify(n.usr)),a.anonymousUser=n.usr,r.stoken=n.usr.token,s.api.changeToken(n.usr.token),s.api.getMyInfoAndGroup().then(function(){e.resolve()},function(t){e.reject(t)})},function(t){localStorage.setItem("anonymousLoginUsr","error"),e.reject(t)})}))},!0),e.promise}if(t)return m(),e.hasUserLogin=t.flag,e.isTeacher=e.hasUserLogin&&1===a.currentUser.auth,e.isHelpTeacher=e.hasUserLogin&&-1!==a.currentUser.roleArr.indexOf("HELP"),jf.isIE()&&jf.isIE()<10?void(e.chatError="浏览器版本过低"):void i().then(function(){return h("get current user recent chat list"),s.api.getRecentUser()}).then(function(){return h("initialize upload plugin"),s.api.initUploadPlugin("chat-img-upload","image").then(function(){return s.api.initUploadPlugin("chat-file-upload","file")})}).then(function(){return h("initialize websocket, and login to server"),s.ws.init()}).then(function(){return e.readyToOpenWindow=!0,h("ready to open chat window"),s.api.getOfflineMsg()}).then(function(){return s.api.getFriendRequest()}).then(function(){return s.api.getServeList()}).then(function(){s.trigger("loadFriendNotify"),s.api.initTextInput(angular.element("#msg-content"))},function(t){1===t.type?s.util.log(t.data.data.msg):s.util.log("初始化即时通讯组件失败！网络错误！"),e.chatError=t,h("err",t)})},!0);e.openChatWindow=function(t){if(t){if(t.uuid===e.self.uuid)return p("不能与自己聊天。"),!1;e.show="main",e.activeTab="msg",e.chatTarget=t,e.chatType=t.type,s.trigger("enterChat",e.chatTarget),s.trigger("chatWindow",!0),s.trigger("openRecord")}},e.enterChat=function(t){e.show="main",s.trigger("switchTab","msg"),s.util.popUpUser(t.uuid),s.trigger("openChatWindow",t),e.activeTab="msg"},e.showLoginWindow=function(){o.loginModal?o.loginModal.show():"undefined"!=typeof loginWinService&&loginWinService.show()},e.findTeacher=function(t){var n=!1,a=[];for(var i in t)t.hasOwnProperty(i)&&(n=!0,a.push(t[i].uuid));return n?void l(a.join(",")).then(function(t){e.enterChat(t)},function(e){1===e.type?s.util.log(e.data.data.msg):s.util.log("请求答疑老师失败！网络错误！")}):void s.util.log("该课程没有答疑老师.")},e.open=function(t,n){if(!t&&e.showChatWindow)return void e.close();if("/course-detail.html"===location.pathname){var a=angular.element(".course-intro").scope();a.course&&s.util.request({url:"/smap",method:"POST",params:{key:e.self.id+"_CUR_COURSE",val:JSON.stringify(a.course)}}).then(function(e){console.log(e)})}return n||e.hasUserLogin?void s.trigger("openChatWindow",t||s.data.recentUser[0]):void e.switchTab("guide")},e.close=function(){e.showChatWindow=!1,e.chatTarget=void 0,s.trigger("closeChat")},e.showAddMenu=function(){e.addMenu=!0,setTimeout(function(){angular.element(document).on("click",u)},100)},e.addFriend=function(){s.trigger("resetAddGroup"),e.show="addFriend",e.tabName="添加好友",setTimeout(function(){angular.element(".chat-search-name").focus()},10)},e.addGroup=function(){e.show="addGroup",e.tabName="创建讨论组"},e.activeTab="msg",e.tabName="消息",e.switchTab=function(t){g(t),"guide"===t?d().then(function(e){s.trigger("switchTab","msg"),s.trigger("openChatWindow",e)},function(e){1===e.type?s.util.log(e.data.data.msg):s.util.log("查找在线客服失败！网络错误！")}):(s.trigger("switchTab",t),e.chatTarget=null,s.trigger("closeChat"),e.activeTab=t),"serve"===t?e.show="serve":e.show="main"},o.httpConfig&&o.httpConfig.filter("loading",[t.friendsAddr,t.rdisAddrSrv],!1)}]),e.directive("chat",function(){var e={template:'<div><div class="online-chat" ng-class="{\'online-chat-left\': position == \'left\'}" ng-controller="chat" ng-hide="isIE9"><div ng-hide="showChatWindow" class="chat-login" ng-mouseover="active=true" ng-mouseleave="active=false;"><span ng-show="unreadAll() > 0" class="chat-unread">{{unreadAll() > 99 ? \'99+\' : unreadAll()}}</span> <button type="button" class="chat-btn chat-rel" ng-hide="loginStatus==\'pending\' || loginStatus==\'logined\' && !readyToOpenWindow" ng-click="open()"><span class="chat-login-icon chat-dis-inlineblock" ng-class="{\'image-chat\': !active, \'image-chat-active\': active}"></span> <span ng-hide="unreadMsgList.length">{{hasUserLogin ? \'在线聊天\' : \'亲，需要帮助吗？\'}}</span> <span ng-show="unreadMsgList.length" class="chat-msg-tips" title="{{unreadMsgList[0].message}}"><span>{{unreadMsgList[0].sender.name}}：</span><span>{{unreadMsgList[0].message}}</span></span></button> <button type="button" class="chat-btn chat-rel" ng-show="loginStatus==\'pending\'"><span class="chat-login-icon chat-dis-inlineblock" ng-class="{\'image-chat\': !active, \'image-chat-active\': active}"></span> <span ng-show="chatError">初始化失败</span> <span ng-show="!chatError">登陆中</span></button> <button type="button" class="chat-btn chat-rel" ng-show="loginStatus==\'logined\' && !readyToOpenWindow"><span class="chat-login-icon chat-dis-inlineblock" ng-class="{\'image-chat\': !active, \'image-chat-active\': active}"></span> 连接中</button></div><div class="chat-window" ng-show="showChatWindow" drag=".chat-head" position="fixed" limit="true"><div class="chat-main-body chat-abs"><ul class="chat-menu chat-abs"><li><a href=""><span class="chat-avatar"><img ng-src="{{self.img}}" alt=""> </span><span class="chat-online"></span></a></li><li class="chat-rel" title="消息" ng-mouseenter="msgHover=true" ng-mouseleave="msgHover=false" data="{{activeTab}}"><a ng-click="switchTab(\'msg\')" href="" ng-class="{\'chat-active\': msgHover || activeTab==\'msg\'}"><span class="chat-menu-icon" ng-class="{\'image-chat-msg-active\': msgHover || activeTab==\'msg\', \'image-chat-msg\':!msgHover && activeTab!=\'msg\'}"></span>消息</a> <span ng-show="unreadAll() > 0" class="chat-unread">{{unreadAll() > 99 ? \'99+\' : unreadAll()}}</span></li><li title="找老师" ng-mouseenter="serveHover=true" ng-mouseleave="serveHover=false"><a ng-click="switchTab(\'serve\')" href="" ng-class="{\'chat-active\': serveHover || activeTab==\'serve\'}"><span class="chat-menu-icon" ng-class="{\'image-chat-serve-active\': serveHover || activeTab==\'serve\', \'image-chat-serve\':!serveHover && activeTab!=\'serve\'}"></span>找老师</a></li><li title="找客服" ng-mouseenter="guideHover=true" ng-mouseleave="guideHover=false" ng-hide="isHelpTeacher"><a ng-click="switchTab(\'guide\')" href="" ng-class="{\'chat-active\': guideHover || activeTab==\'guide\'}"><span class="chat-menu-icon" ng-class="{\'image-chat-guide-active\': guideHover || activeTab==\'guide\', \'image-chat-guide\':!guideHover && activeTab!=\'guide\'}"></span>找客服</a></li><li title="群组" ng-mouseenter="groupHover=true" ng-mouseleave="groupHover=false"><a ng-click="switchTab(\'group\')" href="" ng-class="{\'chat-active\': groupHover || activeTab==\'group\'}"><span class="chat-menu-icon" ng-class="{\'image-chat-group-active\': groupHover || activeTab==\'group\', \'image-chat-group\':!groupHover && activeTab!=\'group\'}"></span>群组</a></li><li title="好友" ng-mouseenter="friendHover=true" ng-mouseleave="friendHover=false"><a ng-click="switchTab(\'friend\')" href="" ng-class="{\'chat-active\': friendHover || activeTab==\'friend\'}"><span class="chat-menu-icon" ng-class="{\'image-chat-friend-active\': friendHover || activeTab==\'friend\', \'image-chat-friend\':!friendHover && activeTab!=\'friend\'}"></span>好友</a></li><li ng-mouseenter="menuHover=true" ng-mouseleave="menuHover=false"><a ng-click="showAddMenu()" href=""><span class="chat-menu-icon" ng-class="{\'image-chat-menu-active\': menuHover, \'image-chat-menu\':!menuHover}"></span></a><div ng-show="addMenu" class="chat-add-menu chat-abs"><a href="" ng-click="addFriend()">添加好友</a> <a href="" ng-click="addGroup()">创建讨论组</a></div></li></ul><div class="chat-right-content"><div class="chat-head chat-abs"><p>{{tabName}}</p><button class="chat-btn icon-close chat-abs" ng-click="close()"></button></div><div ng-show="show===\'main\'" class="chat-user-list chat-abs" ng-controller="chatContact"><div class="chat-user-search"><input type="text" ng-focus="focusSearchInput()" ng-change="changeSearchInput()" ng-model="searchUser" ng-keydown="enterSearchUser($event)"> <button ng-click="searchUserResult()" class="icon-magnifier chat-btn"></button></div><div ng-if="activeTab==\'friend\' || activeTab==\'group\'" class="chat-content-wrapper chat-scrollbar"><div ng-show="hasUserLogin" class="chat-groups"><div class="chat-friends" ng-repeat="group in groups|orderObjectBy:\'order\'" ng-if="(activeTab==\'friend\' && friendGroupList.indexOf(group.type)!=-1) || (activeTab==\'group\'&&groupGroupList.indexOf(group.type)!=-1)" ng-hide="group.name === \'我的学生\' && !isTeacher"><div class="chat-group-name"><a href="" ng-click="group.expand=!group.expand"><span class="fa" ng-class="{\'fa-angle-down\': group.expand, \'fa-angle-right\':!group.expand}"></span> <span>{{group.name}}</span> <span class="chat-group-count" ng-if="activeTab==\'friend\'">{{onlineCount(group.users)}}/{{group.users.length}}</span> <span class="chat-group-count" ng-if="activeTab==\'group\'">{{group.users.length}}</span></a></div><div ng-show="group.expand"><ul class="chat-group-list"><li ng-class="{\'chat-current\': user.uuid==chatTarget.uuid}" ng-repeat="user in group.users" ng-hide="hideUnrelativeItem(user.name)"><a href="" ng-click="showUserDetail(user)"><span class="chat-avatar"><img ng-src="{{user.img}}" alt="" ng-class="{\'grayscale\': !user.online}"> </span><span class="chat-user-name" title="{{user.name}}">{{user.name}}</span> </a><span ng-show="unread[user.uuid] > 0" class="chat-unread">{{unread[user.uuid] > 99 ? \'99+\' : unread[user.uuid]}}</span></li></ul></div></div></div><div ng-show="!hasUserLogin" class="chat-login-tips chat-abs chat-center"><p style="font-size:16px">( ▼-▼ )</p><p style="font-size:16px;margin-bottom:10px">什么也没有</p><p>登录后体验更多</p><p><a href="" ng-click="showLoginWindow()">马上登录</a></p></div></div><div ng-if="activeTab==\'msg\'" class="chat-content-wrapper chat-scrollbar"><ul class="chat-group-list chat-msg-list"><li ng-class="{\'chat-current\': (user.uuid==chatTarget.uuid) || (showFriendRequest && user.uuid===\'U-0\')}" ng-repeat="user in recentUser" ng-mouseenter="user.showClose=true" ng-mouseleave="user.showClose=false" ng-hide="hideUnrelativeItem(user.name)"><button ng-click="deleteRecentChat(user, $index)" ng-show="user.showClose" class="chat-delete-window"><span class="icon-close"></span></button> <a href="" ng-click="openChatWindow(user)"><span class="chat-avatar"><img ng-src="{{user.img}}" alt="" ng-class="{\'grayscale\': !user.online}"> </span><span class="chat-user-name" title="{{user.name}}">{{user.name}}</span> </a><span ng-show="unread[user.uuid] > 0" class="chat-unread">{{unread[user.uuid] > 99 ? \'99+\' : unread[user.uuid]}}</span></li><p ng-show="!recentUser.length" style="margin:50px 0;text-align:center;color:#ccc">暂无最近联系人。</p></ul></div></div><div ng-show="show===\'main\'" class="chat-content" ng-controller="chatContent"><div ng-show="showMain" class="chat-main chat-center" ng-class="{\'chat-record-open\': showMsgRecord}"><div class="chat-header chat-drag"><span class="chat-target-name" title="{{chatTarget.name}}">{{chatTarget.name}}</span> <a href="" ng-click="addFriend(chatTarget)" class="image-chat-friend-add chat-abs chat-friend-add" ng-show="showAddFriendBtn && hasUserLogin"></a> <a href="" ng-click="showGroupDetail(chatTarget)" class="image-chat-group chat-abs chat-friend-add" ng-show="chatType==\'group\'"></a></div><div class="chat-body chat-abs"><div class="chat-body-left chat-center"><div class="chat-history chat-scrollbar"><ul><div ng-hide="loadingMsg || noMoreMsg" class="chat-show-more"><a href="" ng-click="loadMoreMsg()"><span class="fa fa-clock-o"></span>查看更多消息</a></div><div ng-show="loadingMsg" class="chat-show-more"><span class="fa fa-spinner fa-spin"></span>正在载入</div><chat-msg chat-type="chatType" index="{{$index}}" ng-repeat="msg in currentChatMsg" msg="msg" id="msg-{{currentChatMsg.length - $index}}"></chat-msg></ul></div><a ng-show="unreadMsg>0" class="chat-unread-msg" ng-click="showNewMsg()">您有 <span>{{unreadMsg}}</span> 条新消息</a><div class="chat-editor"><div class="chat-editor-helper chat-rel"><a href="" ng-click="selectUploadFile(2)"><span class="icon-polaroid"></span> </a><a href="" ng-click="selectUploadFile(3)"><span class="icon-sent-files"></span> </a><a href="" ng-class="{\'chat-btn-opened\': showMsgRecord}" ng-click="openMsgRecord()" class="chat-open-record chat-abs"><span class="fa fa-clock-o"></span> 消息记录 </a><input type="file" id="chat-img-upload" style="display:none" accept="image/*"> <input type="file" id="chat-file-upload" style="display:none" accept="*"></div><div class="chat-editor-input"><textarea name="" id="msg-content" cols="30" rows="10" ng-model="msg" ng-keydown="typeMsg($event)"></textarea></div><div class="chat-send"><button class="chat-btn" ng-show="self.name === \'superone\'" ng-click="autoSendMsg(1000)">发送1000条消息</button> <button ng-click="endChat()" class="chat-btn">结束</button> <button class="chat-btn chat-btn-active" ng-click="send()">发送</button></div></div></div></div><div class="chat-msg-record chat-dis-inlineblock" ng-show="showMsgRecord" ng-controller="record"><div class="chat-record-head chat-dis-inlineblock"><span>消息记录</span> <button class="chat-btn" ng-click="$parent.openMsgRecord()">&times;</button></div><div class="chat-record-body chat-scrollbar"><ul class="chat-record-list" ng-class="{\'chat-record-list-pd\': showSearch}"><li ng-repeat="msg in record" ng-hide="loading" ng-class="{\'chat-msg-mine\': msg.sender.id == self.id}" class="pd-x10 mg-y10"><p class="chat-record-day" ng-show="showDay($index)">{{msg.day}}</p><span class="chat-record-name">{{msg.sender.name}}</span> <span class="chat-record-time mg-l10">{{msg.time}}</span><div class="chat-record-content mg-t5" ng-bind-html="msg.msg|html" ng-hide="msg.fileType===2"></div><div class="chat-record-content mg-t5" msg-img="msg" ng-if="msg.fileType===2"></div></li><div ng-show="!record.length && !loading" style="padding:50px 0;text-align:center;color:#ccc"><span class="image-chat-record-empty chat-dis-inlineblock mg-b20"></span><p ng-if="date==today&&recordDate">亲，您今天还没跟 <span>{{chatTarget.name}}</span> 交流哦~</p><p ng-if="date!=today&&recordDate">亲，<span>{{recordDate}}</span>那天您没有和 <span>{{chatTarget.name}}</span> 交流哦~</p><p ng-if="!recordDate">亲，您没有和 <span>{{chatTarget.name}}</span> 交流过哦~</p></div><div ng-show="loading" class="chat-loading chat-abs chat-center"><span class="fa fa-spinner fa-spin"></span> <span>正在载入中...</span></div></ul></div><div class="chat-record-foot chat-abs"><button ng-class="{\'chat-btn-opened\': showSearch}" ng-click="openSearch()" class="fa fa-search chat-record-search chat-btn"></button><p class="chat-record-search-option chat-abs" ng-show="showSearch">内容：<input type="text" ng-model="searchName" ng-keydown="enterSearchName($event)"> <button class="chat-btn" ng-click="searchRecord()">确定</button></p><span class="chat-record-date mg-l5 pd-l10"><div ng-click="showSelectDate($event)" class="fa fa-calendar chat-btn chat-rel"></div><datetime value="selectedDate" no-input="true" config="dateConfig" startdate="startDate" enddate="endDate"></datetime><span>{{date}}</span> </span><span class="chat-record-pa chat-abs"><button ng-class="{\'chat-disable\': currentPageNo <= 1}" ng-click="jumpToPage(1)" class="chat-btn fa fa-angle-double-left"></button> <button ng-class="{\'chat-disable\': currentPageNo <= 1}" ng-click="jumpToPage(+currentPageNo - 1)" class="chat-btn fa fa-angle-left"></button> <button ng-class="{\'chat-disable\': currentPageNo >= total}" ng-click="jumpToPage(+currentPageNo + 1)" class="chat-btn fa fa-angle-right"></button> <button ng-class="{\'chat-disable\': currentPageNo >= total}" ng-click="jumpToPage(total)" class="chat-btn fa fa-angle-double-right"></button></span></div></div></div><div ng-show="showNoTarget" class="chat-no-target chat-abs chat-center"><span class="image-chat-big chat-dis-inlineblock"></span><p>赶紧找个人聊天吧</p></div><div ng-show="showDetail" class="chat-group-detail chat-abs chat-center"><div class="chat-header chat-drag"><span class="chat-target-name" ng-show="detailUser.gType !==\'CHAT_GRP\'">{{detailUser.type === \'user\' ? \'个人\' : \'群组\'}}资料</span> <span class="chat-target-name" ng-show="detailUser.gType ===\'CHAT_GRP\'">讨论组资料</span></div><div class="chat-body chat-abs chat-scrollbar"><div ng-show="detailUser.type!==\'user\' && !loading"><div ng-show="detailUser.course" class="chat-group-course chat-group-item"><div class="chat-detail-head">当前课程</div><div class="chat-detail-content"><img class="chat-course-img chat-abs" ng-src="{{detailUser.course.imgs.split(\',\')[0] || \'img/icon-65.gif\'}}" alt=""><div class="chat-course-info chat-dis-inlineblock"><p class="chat-course-name"><a ng-href="course-detail.html?id={{detailUser.course.id}}" target="_blank">{{detailUser.course.name}}</a></p><p class="chat-course-user">创建者：<span>{{detailUser.course.userName}}</span></p></div></div></div><div ng-show="detailUser.course" class="chat-group-item chat-group-teacher"><div class="chat-detail-head">老师 <span class="chat-user-count">({{detailUser.teacherOnline || 0}}/{{detailUser.userList.teachers.users.length}})</span></div><ul class="chat-detail-content"><li ng-click="enterChat(teacher)" class="chat-course-member chat-dis-inlineblock" ng-repeat="teacher in detailUser.userList.teachers.users"><div class="chat-avatar"><img class="chat-avatar" ng-src="{{teacher.img}}" alt=""></div><span class="chat-member-role chat-teacher-guide" ng-show="teacher.role.indexOf(\'GUIDE\') !== -1">导</span> <span class="chat-member-role chat-teacher-answer" ng-show="teacher.role.indexOf(\'ANSWER\') !== -1">疑</span><p class="chat-member-name" title="{{teacher.name}}">{{teacher.name}}</p></li></ul></div><div ng-show="detailUser.course" class="chat-group-item chat-group-student"><div class="chat-detail-head"><span>学生</span> <span class="chat-user-count">({{detailUser.studentOnline || 0}}/{{detailUser.userList.students.users.length}})</span></div><ul class="chat-detail-content"><li ng-click="enterChat(student)" class="chat-course-member chat-dis-inlineblock" ng-repeat="student in detailUser.userList.students.users"><div class="chat-avatar"><img class="chat-avatar" ng-src="{{student.img}}" alt=""></div><p class="chat-member-name" title="{{student.name}}">{{student.name}}</p></li></ul></div><div ng-show="!detailUser.course" class="chat-group-item chat-group-student"><div class="chat-detail-head"><span>讨论组成员</span> <span class="chat-user-count">({{detailUser.studentOnline || 0}}/{{detailUser.userList.member.users.length}})</span></div><ul class="chat-detail-content"><li ng-click="enterChat(student)" class="chat-course-member chat-dis-inlineblock" ng-repeat="student in detailUser.userList.member.users"><div class="chat-avatar"><img class="chat-avatar" ng-src="{{student.img}}" alt=""></div><p class="chat-member-name" title="{{student.name}}">{{student.name}}</p></li></ul></div></div><div class="chat-user-detail chat-center chat-abs" ng-show="detailUser.type==\'user\' && !loading"><div class="chat-avatar"><img ng-src="{{detailUser.img}}" alt=""></div><p class="chat-detail-name">{{detailUser.name}}</p><p><span>{{detailUser.gender || \'男\'}}</span>，<span>{{detailUser.age || 15}}</span>岁</p><p>地区：<span>{{detailUser.addr || \'广东广州\'}}</span></p><p>教育经历：<span>{{detailUser.edu || \'广东工业大学 本科\'}}</span>，专业：<span>{{detailUser.master || \'电子商务\'}}</span></p></div><div ng-show="loading" class="chat-loading chat-abs chat-center"><span class="fa fa-spinner fa-spin"></span> <span>正在载入中...</span></div></div><div class="chat-foot chat-abs"><button class="chat-btn" ng-click="enterChat(detailUser.origin || detailUser)">发起聊天</button></div></div><div ng-show="showFriendRequest" class="chat-notify-window"><div class="chat-header chat-drag"><span class="chat-target-name">好友通知</span></div><div class="chat-body chat-abs chat-request-list" ng-show="!loadingFriendRequest"><ul class="chat-body-left chat-center chat-scrollbar" ng-hide="!friendRequests.length"><li ng-repeat="request in friendRequests | orderBy: \'-time\'" class="chat-request-item"><p class="chat-black-text mg-b5">{{request.date}}</p><div ng-if="request.r === self.uuid"><div class="chat-dis-inlineblock"><img ng-src="{{request.lImg || \'/img/icon-252.png\'}}" alt="" class="chat-user-avatar"></div><div class="chat-dis-inlineblock"><p class="chat-black-text">{{request.lName || \'name\'}}</p><p ng-if="request.msg">验证信息：<span>{{request.msg}}</span></p><p ng-if="!request.msg">对方请求加您为好友</p><span class="chat-request-btn"><button ng-show="request.status === 1" class="chat-btn" ng-click="handleRequest(request, 4)">同意</button> <button ng-show="request.status === 1" class="chat-btn" ng-click="handleRequest(request, 2)">拒绝</button> <span ng-show="request.status === 4"><button class="chat-btn" ng-click="sendMsg(request)">发消息</button></span> <span ng-show="request.status === 2">已拒绝</span></span></div></div><div ng-if="request.l === self.uuid"><div class="chat-dis-inlineblock"><img ng-src="{{request.rImg || \'/img/icon-252.png\'}}" alt="" class="chat-user-avatar"></div><div class="chat-dis-inlineblock"><p class="chat-black-text">{{request.rName || \'name\'}}</p><p ng-if="request.status === 4">对方已同意您的好友请求</p><p ng-if="request.status === 2">对方已拒绝您的好友请求</p><p ng-if="request.status === 1 || request.status === 3">等待对方的回复</p><span class="chat-request-btn"><span ng-show="request.status === 1">等待中</span> <span ng-show="request.status === 4"><button class="chat-btn" ng-click="sendMsg(request)">发消息</button></span> <span ng-show="request.status === 2">已拒绝</span></span></div></div></li></ul><div ng-show="!friendRequests.length" style="padding:50px 0;text-align:center;color:#ccc">暂未收到好友请求。</div></div><div ng-show="loadingFriendRequest" class="chat-loading chat-abs chat-center"><span class="fa fa-spinner fa-spin"></span> <span>正在载入中...</span></div></div><div class="chat-pos-fixed chat-pos-center chat-bg-transparent" ng-show="showScreenshot"><div class="chat-dis-table"><div class="chat-dis-tablecell"><div class="chat-screenshot-preview"><div class="chat-screenshot-preview-head">发送截图</div><div class="chat-screenshot-preview-body"><div><img src="{{base64}}" alt="" ng-style="screenshotImgStyle"></div><div><button class="chat-send-btn" ng-click="sendScreenshot()">发送截图</button> <button ng-click="cancelScreenshot()">取消</button></div><div>按Enter键快速发送截图，按ESC键取消发送。</div></div></div></div></div></div></div><div ng-show="show===\'addFriend\'" class="chat-add-friend chat-abs" ng-controller="addFriend"><div class="chat-search-detail chat-abs chat-center"><div ng-show="hasUserLogin" class="chat-search-full chat-scrollbar"><div class="chat-friend-search" ng-class="{\'chat-searching\': searchLoading}"><input type="text" class="chat-search-name" ng-model="searchName" ng-keydown="keydown($event)"> <button class="chat-btn" ng-hide="searchLoading" ng-click="search()"><span class="fa fa-search"></span></button> <button class="chat-btn" ng-show="searchLoading"><span class="fa fa-spinner fa-spin"></span></button></div><ul ng-hide="loading"><li ng-repeat="user in searchList" class="chat-friend-item chat-dis-inlineblock"><div class="chat-dis-inlineblock"><img class="chat-user-avatar" ng-src="{{user.img}}" alt=""></div><div class="chat-dis-inlineblock"><div class="chat-user-name" title="{{user.name}}">{{user.name}}</div><button class="chat-btn-addfriend" ng-click="addFriend(user)">+好友</button></div></li></ul><div ng-show="!searchList.length && !loading" class="chat-no-search"><div class="image-chat-add-icon"></div><p ng-show="!searched">赶紧添加几个好友吧</p><p ng-show="searched">搜索不到与 <span>{{searchName}}</span> 有关的用户</p></div><div ng-show="loading" class="chat-loading chat-abs chat-center"><span class="fa fa-spinner fa-spin"></span> <span>正在载入中...</span></div></div><div ng-show="!hasUserLogin" class="chat-login-tips chat-abs chat-center"><p style="font-size:16px">o(^▽^)o</p><p style="font-size:16px;margin-bottom:10px">需要先登录哦~</p><p><a href="" ng-click="showLoginWindow()">马上登录</a></p></div><div class="chat-search-pa" ng-hide="!searchList.length || !hasUserLogin"><button class="chat-btn" ng-disabled="currentPageNo<=1" ng-click="goToSearchPage(currentPageNo - 1)" ng-class="{\'chat-disable\': currentPageNo <= 1}">上一页</button> <button class="chat-btn" ng-class="{\'chat-active\': currentPageNo === p}" ng-repeat="p in pa" ng-click="goToSearchPage(p)">{{p}}</button> <button class="chat-btn" ng-disabled="currentPageNo>=totalPage" ng-click="goToSearchPage(currentPageNo + 1)" ng-class="{\'chat-disable\': currentPageNo >= totalPage}">下一页</button> <span>总共 <span>{{totalPage}} 页</span></span></div></div></div><div ng-show="show===\'addGroup\'" class="chat-add-group chat-abs" ng-controller="addGroup"><div class="chat-add-main chat-abs" ng-show="hasUserLogin"><div class="chat-left chat-abs"><div class="chat-user-search"><input type="text" ng-model="searchUser"> <button class="icon-magnifier chat-btn"></button></div><div class="chat-scrollbar chat-abs"><div class="chat-friends" ng-repeat="group in groups" ng-if="[\'DEFAULT\', \'T-GRP\', \'S-GRP\'].indexOf(group.type)!=-1"><div class="chat-group-name"><a href="" ng-click="group.collapse=!group.collapse"><span class="fa" ng-class="{\'fa-angle-down\': !group.collapse, \'fa-angle-right\':group.collapse}"></span> <span>{{group.name}}</span></a></div><div ng-hide="group.collapse"><ul class="chat-group-list"><li ng-repeat="user in group.users" ng-hide="hideUnrelativeItem(user.name)" ng-if="showUnselected(user)"><a href="" ng-click="selectUser(user)"><input type="checkbox" ng-model="user.selected"> <span class="chat-avatar"><img ng-src="{{user.img}}" alt=""> </span><span class="chat-user-name" title="{{user.name}}">{{user.name}}</span></a></li></ul></div></div></div></div><div class="chat-center chat-add-selected chat-abs"><button class="fa fa-angle-right chat-btn" ng-click="confirmSelect()"></button></div><div class="chat-right chat-abs"><div>已选联系人：<span>{{selected.length || 0}}</span> 人</div><ul class="chat-scrollbar chat-abs chat-group-list"><li ng-repeat="user in selected" ng-mouseenter="user.showDelete=true" ng-mouseleave="user.showDelete=false"><span class="chat-avatar"><img ng-src="{{user.img}}" alt=""> </span><span class="chat-user-name" title="{{user.name}}">{{user.name}}</span> <button class="chat-btn icon-close chat-abs chat-remove-select" ng-show="user.showDelete" ng-click="removeSelected(user)"></button></li></ul></div></div><div ng-show="hasUserLogin" class="chat-foot chat-abs"><button class="chat-btn" ng-click="addGroup()">确定</button> <button class="chat-btn" ng-click="close()">取消</button></div><div ng-show="!hasUserLogin" class="chat-login-tips chat-abs chat-center"><p style="font-size:16px">o(^▽^)o</p><p style="font-size:16px;margin-bottom:10px">需要先登录哦~</p><p><a href="" ng-click="showLoginWindow()">马上登录</a></p></div></div><div ng-show="show===\'serve\'" class="chat-serve chat-abs"><ul ng-show="hasUserLogin && myCourse.length" class="chat-serve-list chat-abs chat-scrollbar"><li ng-repeat="course in myCourse" class="chat-serve-course"><div class="chat-detail-content"><img class="chat-course-img chat-abs" ng-src="{{course.cImg.split(\',\')[0] || \'img/icon-65.gif\'}}" alt=""><div class="chat-course-info chat-dis-inlineblock"><p class="chat-course-name"><a target="_blank" ng-href="course-detail.html?id={{course.cid}}">{{course.cname}}</a></p><p>参与人数：<span>{{course.uCnt || 0}}</span> 人</p><div class="chat-serve-teacher"><span>答疑：</span> <a href="" ng-click="enterChat(teacher)" ng-repeat="teacher in course.teachers" title="{{teacher.name}}" class="chat-avatar"><img ng-class="{grayscale: !teacher.online}" ng-src="{{teacher.img}}" alt=""></a></div><button class="chat-btn" ng-click="findTeacher(course.teachers)"><span class="image-chat-msg-icon chat-dis-inlineblock"></span>找老师</button></div></div></li></ul><div ng-show="hasUserLogin && !myCourse.length" style="margin:40px 0;text-align:center"><img src="img/no-question.png" alt=""><p style="margin-top:20px">暂未参与任何课程。<a href="search-page.html?type=&query=" target="_blank" style="color:#02c0b9;vertical-align:bottom">立即参与课程</a></p></div><div ng-show="!hasUserLogin" class="chat-login-tips chat-abs chat-center"><p style="font-size:16px">o(^▽^)o</p><p style="font-size:16px;margin-bottom:10px">需要先登录哦~</p><p><a href="" ng-click="showLoginWindow()">马上登录</a></p></div></div><div class="chat-confirm-add" drag=".chat-confirm-drag" ng-show="showAddDialog"><div class="chat-header chat-confirm-drag"><span>添加好友</span> <button class="chat-close-window" ng-click="closeAddDialog()"><span class="icon-close"></span></button></div><div class="chat-body"><div class="chat-dis-inlineblock"><img class="chat-user-avatar" ng-src="{{addTarget.img}}" alt=""></div><div class="chat-dis-inlineblock"><p>您将添加以下好友：</p><p><span>{{addTarget.name}}</span></p></div><div class="mg-t10"><p>请输入验证信息：</p><textarea name="" id="" cols="30" rows="10" ng-model="msg" class="chat-confirm-msg"></textarea></div><div class="chat-foot"><button class="chat-btn" ng-click="requestAddFriend()">确定</button> <button class="chat-btn" ng-click="closeAddDialog()">关闭</button></div></div></div></div></div><div data-direction="left" class="chat-resize chat-resize-left"></div><div data-direction="right" class="chat-resize chat-resize-right"></div><div data-direction="top" class="chat-resize chat-resize-top"></div><div data-direction="bottom" class="chat-resize chat-resize-bottom"></div><div data-direction="top left" class="chat-resize-corner chat-resize chat-resize-corner-tl"></div><div data-direction="top right" class="chat-resize-corner chat-resize chat-resize-corner-tr"></div><div data-direction="bottom left" class="chat-resize-corner chat-resize chat-resize-corner-bl"></div><div data-direction="bottom right" class="chat-resize-corner chat-resize chat-resize-corner-br"></div></div></div></div>',
restrict:"E",scope:{position:"@",custom:"="},replace:!0};return e.link=function(e,t){function n(e,t){var n,o;h.css({top:h.position().top,bottom:"auto"}),h.css({left:h.position().left,right:"auto"}),p.width=h.width(),p.height=h.height(),f.width=angular.element(window).width(),f.height=angular.element(window).height(),n=t.clientX,o=t.clientY,g.left=n,g.top=o,r=e.split(" "),s=h.position(),l.on("mousemove",a),l.on("mouseup",i),u.addClass("no-select")}function a(e){var t,n,a,i;t=e.clientX,n=e.clientY,d.top=n-g.top,d.left=t-g.left,angular.forEach(r,function(e){switch(e){case"bottom":i=p.height+d.top,i=400>i?400:i,i=s.top+i>f.height?f.height-s.top:i,h.height(i);break;case"right":a=p.width+d.left,a=660>a?660:a,a=s.left+a>f.width?f.width-s.left:a,h.width(a);break;case"left":s.left+d.left<=0&&(d.left=-s.left),a=p.width-d.left,a=660>a?660:a,h.width(a).css({left:s.left+d.left});break;case"top":s.top+d.top<=0&&(d.top=-s.top),i=p.height-d.top,i=400>i?400:i,h.height(i).css({top:s.top+d.top})}})}function i(){l.off("mousemove",a),l.off("mouseup",i),u.removeClass("no-select"),o=null,c=null}var r,s,o,c,l=angular.element(document),u=angular.element("body"),d={top:0,left:0},g={left:0,top:0},h=t.find(".chat-window"),p={width:0,height:0},f={width:0,height:0};angular.element(".chat-resize").on("mousedown",function(e){var t=$(this).data("direction");n(t,e)})},e})}(),function(){angular.module("chat_directive").controller("chatContent",["$scope","$q","$timeout","$anchorScroll","$location","chatService","service",function(e,t,n,a,i,r,s){function o(t){var n=["showMain","showNoTarget","showDetail","showFriendRequest"];angular.forEach(n,function(t){e[t]=!1}),e[t]=!0,e.showMain||(e.$parent.chatTarget=null)}var c=r.util.devlog,l=r.data.allUsers,u=r.api.sendMsg,d=angular.element(".chat-window"),g=0,h=$(".chat-history");e.friendRequests=r.data.friendRequests,r.on("wsSendMsg",function(t,n){e.$emit("scrollToBottom",!0),c("sending msg to user "+t.uuid,n)}).on("uploadSelect",function(){e.$emit("loadMsg");try{e.$digest()}catch(t){}}).on("uploadStart",function(){e.$emit("loadMsg");try{e.$digest()}catch(t){}}).on("uploadProgress",function(){e.$emit("loadMsg");try{e.$digest()}catch(t){}}).on("uploadSuccess",function(){c("upload success");try{e.$digest()}catch(t){}}).on("uploadAbort",function(){e.$emit("loadMsg"),c("upload abort");try{e.$digest()}catch(t){}}).on("uploadError",function(){e.$emit("loadMsg"),c("upload err");try{e.$digest()}catch(t){}}).on("uploadLoad",function(){try{e.$digest()}catch(t){}}).on("openChatWindow",function(t,n,a){if(!t)return void o("showNoTarget");if("U-0"===t.uuid)o("showFriendRequest");else{var i;o("showMain"),e.currentChatMsg=[],g=0,e.noMoreMsg=!1,e.loadMoreMsg(!0),e.unreadMsg=0;var s=!0;if("group"!==t.type){for(i=0;i<r.data.groups.DEFAULT.users.length;i+=1){var c=r.data.groups.DEFAULT.users[i];if(c.id===t.id){s=!1;break}}s?(e.showAddFriendBtn=!0,e.fromGroup=a):e.showAddFriendBtn=!1}else e.showAddFriendBtn=!1}}).on("openSearchResult",function(t){e.expandSearchResult=t}).on("showScreenshot",function(t){e.base64=t,e.showScreenshot=!0;try{e.$digest()}catch(n){}}).on("sendScreenshot",function(){e.showScreenshot=!1;try{e.$digest()}catch(t){}}).on("sendScreenshotMsg",function(){e.$emit("loadMsg")}).on("cancelScreenshot",function(){e.showScreenshot=!1,e.base64="";try{e.$digest()}catch(t){}}).on("imgUploadFinish",function(){e.$emit("loadMsg")}).on("showUserDetail",function(t){o("showDetail"),"group"===t.type?(e.loading=!0,r.api.getGroupDetail(t.uuid).then(function(){e.loading=!1,e.detailUser=r.data.groupInfo,e.detailUser.origin=t},function(t){e.loading=!1,o("showNoTarget"),1===t.type?r.util.log(t.data.data.msg):r.util.log("请求群组信息失败！")})):(e.detailUser=t,e.detailUser.origin=t)}).on("switchTab",function(e){o("showNoTarget")}).on("openFriendNotify",function(e){o(e?"showFriendRequest":"showMain")}),e.groupInfo=r.data.groupInfo,e.showMsgRecord=!1,e.showScreenshot=!1,e.uploadFiles={},e.uploadType=2,e.screenshotImgStyle={"max-width":.8*angular.element(window).width(),"max-height":.8*angular.element(window).height()},e.openMsgRecord=function(){e.showMsgRecord=!e.showMsgRecord},e.send=function(){u(e.chatTarget,0,angular.element("#msg-content").val()),e.$emit("loadMsg"),e.$emit("scrollToBottom",!0),e.msg=""},e.handleRequest=function(e,t){r.http.handleFriendRequest({action:t,oid:e.oid}).then(function(){if(e.status=t,4===t){var n=!1;angular.forEach(r.data.groups.DEFAULT.users,function(t){t===e.l&&(n=!0)}),n||r.data.groups.DEFAULT.users.push({id:+e.l.split("-")[1],img:e.lImg,msg:[],name:e.lName,type:"user",uuid:e.l})}},function(e){1===e.type?r.util.log(e.data.data.msg):(r.util.log("处理好友请求失败！"),r.util.devlog(e))})},e.showGroupDetail=function(e){r.trigger("showUserDetail",e,"showMain"),o("showDetail")},e.sendScreenshot=function(){r.api.sendScreenshot(e.base64)},e.cancelScreenshot=function(){r.api.cancelScreenshot()},e.autoSendMsg=function(t){for(var n=0;t>n;n+=1)u(e.chatTarget,0,"automatically sending message No."+n),e.$emit("loadMsg"),e.$emit("scrollToBottom")},e.typeMsg=function(t){13===t.which&&(e.send(),t.preventDefault())},e.enterChat=function(t){return t.uuid===e.self.uuid?void r.util.log("不能与自己聊天。"):void r.trigger("openChatWindow",t)},e.sendMsg=function(t){r.api.getSender(t.r===e.self.uuid?t.l:t.r).then(function(t){e.enterChat(t)})},e.selectUploadFile=function(t){e.uploadType=t,r.api.selectUploadFile(t)},e.cancelUpload=function(e){r.api.cancelUpload(e.file.id),c("cancel upload")},e.loadMoreMsg=function(a){function i(){if(a&&!o.loaded||!a&&!e.noMoreMsg&&e.currentChatMsg.length===o.length){var n;return a&&!o.loaded&&o.length>1?n=o[1].msgId:a||(n=o[0].msgId),r.api.getRecordList({sender:e.chatTarget.uuid,reciever:e.self.uuid,order:"-time",pageNo:1,pageSize:a?19:20,id:n}).then(function(t){e.noMoreMsg=a&&t.total<19||!a&&t.total<=20,o.loaded=!0,angular.forEach(t.msg,function(t){var a=r.data.allUsers[e.chatTarget.uuid].msg,i=!1;if(!n)for(var s=0;s<a.length;s+=1)if(a[s].msgId===t.msgId){i=!0;break}i||r.data.allUsers[e.chatTarget.uuid].msg.unshift(t)})})}var i=t.defer();return e.noMoreMsg=e.currentChatMsg.length>o.length-20,i.resolve(),i.promise}e.loadingMsg=!0;var o=r.data.allUsers[e.chatTarget.uuid].msg;return i().then(function(){var t="msg-"+(e.currentChatMsg.length||1);a||(g+=1),e.$emit("loadMsg"),n(function(){if(a)e.$emit("scrollToBottom",!0);else{var n=angular.element("#"+t).get(0);if(!n)return;var i=n.offsetTop;h.scrollTop(i)}},10)},function(t){if(r.util.devlog(t),e.loadingMsg=!1,1===t.type)r.util.log(t.data.data.msg);else{var n,a;"undefined"!=typeof s.loginModal?(n=s.dialog,a=s.loginModal):(n=jf,a=loginWinService),n.confirm("用户已掉线，请重新登陆。",void 0,function(){a.show()},function(){window.location.reload()})}})},e.$parent.$on("loadMsg",function(){if(!e.chatTarget)return void c("聊天对象为空。");if(!l[e.chatTarget.uuid])return void c("找不到该用户");e.loadingMsg=!1;var t=l[e.chatTarget.uuid].msg;t.length>20*(g+1)?e.currentChatMsg=t.slice(t.length-20*(g+1)):e.currentChatMsg=t.slice(),e.remainingMsgCount=t.length-e.currentChatMsg.length}),e.unreadMsg=0,e.$parent.$on("scrollToBottom",function(t,n){h.find("ul").height()-(h.scrollTop()+h.height())<70||n?setTimeout(function(){h.scrollTop(h.find("ul").height())},10):e.unreadMsg+=1}),h.on("scroll",function(){h.find("ul").height()-(h.scrollTop()+h.height())<70&&(e.unreadMsg=0,e.$digest()),0!==h.scrollTop()||e.noMoreMsg||e.loadMoreMsg()}),e.showNewMsg=function(){e.unreadMsg=0,h.scrollTop(h.find("ul").height())},e.openMsgRecord=function(){e.showMsgRecord=!e.showMsgRecord,r.trigger("openRecord"),d.width(d.width()+335*(e.showMsgRecord?1:-1))},e.endChat=function(){e.$parent.open()},e.addFriend=function(e){r.trigger("openAddFriendDialog",e)}}])}(),function(){angular.module("chat_directive").controller("chatContact",["$scope","chatService",function(e,t){e.activeTab="msg",e.recentUser=t.data.recentUser,e.groups=t.data.groups,e.openSearchResult="false",e.friendGroupList=["T-GRP","S-GRP","DEFAULT"],e.groupGroupList=["C-GRP","My-GRP"],t.on("switchTab",function(t){e.activeTab=t}).on("openChatWindow",function(t){t&&("U-1"===t.uuid?e.showFriendRequest=!0:e.showFriendRequest=!1,e.activeTab="msg")}),e.deleteRecentChat=function(t,n){e.recentUser.splice(n,1),e.chatTarget&&e.chatTarget.uuid===t.uuid&&(n>e.recentUser.length-1&&(n-=1),e.openChatWindow(e.recentUser[n]))},e.hideUnrelativeItem=function(t){var n=new RegExp(e.searchUser);return!n.test(t)},e.showUserDetail=function(e){t.trigger("showUserDetail",e,"showNoTarget")},e.openChatWindow=function(e){t.trigger("openChatWindow",e,"showNoTarget")},e.onlineCount=function(e){var t=0;return angular.forEach(e,function(e){e.online&&(t+=1)}),t}}])}(),function(){angular.module("chat_directive").controller("record",["$scope","chatService","datetimeService",function(e,t,n){function a(){return e.chatTarget?(s.sender=e.chatTarget.uuid,s.reciever=e.self.uuid,e.loading=!0,t.api.getRecordList(s).then(function(t){e.record=t.msg,e.currentPageNo=s.pageNo,e.total=Math.ceil(t.total/s.pageSize),e.loading=!1,e.record.length||(e.currentPageNo=0),angular.element(".chat-record-list").scrollTop(0)},function(n){e.loading=!1,1===n.type?t.util.log(n.data.data.msg):t.util.log("请求消息记录失败！")})):void 0}var i=new Date,r=function(){var e=t.util.parseTime(i.getTime()).split(" ")[0].replace(/-/g,"/");return new Date(e).getTime()}(),s={sender:void 0,reciever:void 0,pageNo:1,pageSize:20,filter:void 0,beginTime:r,endTime:r+864e5};e.recordTab="all",e.record=[],e.currentPageNo=s.pageNo,e.total=0,e.showSearch=!1,e.date=t.util.parseTime(r).split(" ")[0],e.today=e.date,e.$watch("date",function(t){var n=t.replace(/-/g,"/"),a=new Date(n);isNaN(a.getTime())?e.recordDate=null:e.recordDate=a.getMonth()+1+"月"+a.getDate()+"日"}),e.dateConfig={style:"expired",placeholder:"只可选择过去日期",noInput:!0,targetElement:angular.element(".chat-record-date .chat-btn"),position:"top"},e.showSelectDate=function(e){n.toggle(e),console.log("showshowhso")},e.$watch("selectedDate",function(t){if(t){var n=t.replace(/-/g,"/"),i=new Date(n).getTime();if(!i)return;s.beginTime=i,s.endTime=i+864e5,a(),e.date=t}}),n.onClear=function(){s.beginTime=void 0,s.endTime=void 0,a(),e.date="所有记录"},e.showDay=function(t){return 0===t?!0:e.record[t-1]?e.record[t].day!==e.record[t-1].day:!0},e.jumpToPage=function(t){0>=t||t>e.total||(s.pageNo=t,a())},e.openSearch=function(){e.showSearch=!e.showSearch},e.searchRecord=function(){s.pageNo=1,s.filter=e.searchName,a()},e.enterPageNo=function(t){13===t.which&&(e.blurEdit(),e.editPageNo=!1)},e.showEditPa=function(){e.editPageNo=!0},e.blurEdit=function(){return e.currentPageNo=+e.currentPageNo,"NaN"===e.currentPageNo.toString()?(t.util.log("请输入正确的数值。"),void(e.currentPageNo=1)):e.currentPageNo<1||e.currentPageNo>e.total?(t.util.log("输入的页数应该在 1 到 "+e.total+"之间。"),void(e.currentPageNo=1)):(e.jumpToPage(e.currentPageNo),void(e.editPageNo=!1))},e.enterSearchName=function(t){13===t.which&&e.searchRecord()},t.on("openRecord",function(){e.$parent.showMsgRecord&&(s.pageNo=1,e.showSearch=!1,e.searchName=void 0,s.filter=void 0,a())})}])}(),function(){angular.module("chat_directive").directive("chatMsg",["$compile","chatService",function(e,t){var n={template:'<li class="chat-item" ng-class="{\'chat-mine\': msg.isMine, \'chat-others\': !msg.isMine}" ng-if="msg.fileType!==-1"><p class="chat-time"><span ng-show="showDate">{{msg.day}}</span> <span ng-show="showTime">{{msg.time}}</span></p><img class="chat-avatar" ng-src="{{msg.sender.img}}" alt=""> <span ng-show="chatType==\'group\' && !msg.isMine" class="chat-msg-sender">{{msg.sender.name}}</span><div class="chat-msg" ng-bind-html="msg.msg|html" ng-hide="msg.uploadingMsg || msg.fileType===2"></div><div class="chat-msg chat-upload-status" ng-show="msg.uploadingMsg"></div><div class="chat-msg" ng-if="msg.fileType===2" msg-img="msg"></div></li><li ng-if="msg.fileType===-1" class="chat-msg-history-tips"><span>以上是历史消息</span></li>',restrict:"E",scope:{msg:"=",index:"@",chatType:"="}},a=t.util.devlog,i=['<div class="chat-msg-upload"><p ng-show="msg.file.status==\'uploading\'">正在上传文件...</p>',"<p ng-show=\"msg.file.status=='abort'\">文件上传已取消</p>","<p ng-show=\"msg.file.status=='error'\">文件上传失败！</p>",'<p><span class="chat-msg-upload-name">{{msg.file.name}}</span><span class="chat-msg-upload-size">({{msg.file.size}})</span></p>','<p ng-show="msg.file.status==\'uploading\'"><span class="chat-msg-progress-outter">','<span class="chat-msg-progress-inner" style="width: {{msg.file.percent}}"></span></span></p>','<p style="text-align:right;"><a ng-show="msg.file.status==\'uploading\'" class="chat-msg-link" ng-click="cancelUpload()">取消上传</a>',"</p></div>"].join("");return n.link=function(n,r){var s;n.msg.uploadingMsg&&(s=e(i)(n),n.msg.msg="<div></div>",setTimeout(function(){r.find(".chat-upload-status").html(s)},10),n.$watch("msg.file",function(e){e&&"finish"===e.status&&n.uploadCallback(),n.msg.file.percent=100*n.msg.file.rate+"%"},!0));var o=r.prev().scope();n.showTime=function(){return 0===+n.index?!0:n.msg.time!==o.msg.time}(),n.showDate=function(){return 0===+n.index?!0:n.msg.day!==o.msg.day}(),n.uploadCallback=function(){var e=t.data.allUsers[n.msg.uuid].msg.indexOf(n.msg);t.data.allUsers[n.msg.uuid].msg.splice(e,1),t.trigger("imgUploadFinish")},n.cancelUpload=function(){t.api.cancelUpload(n.msg.file.id),a("cancel upload")}},n}])}(),function(){angular.module("chat_directive").controller("addFriend",["$scope","chatService",function(e,t){function n(){return e.loading=!0,t.http.searchUser(r).then(function(n){e.searchList=n.data.list,e.totalPage=Math.ceil(n.data.pa.total/r.ps),e.currentPageNo=r.pn,t.trigger("loadSearchResult",n),e.loading=!1})}function a(e,t){for(var n=e,a=[];e+t>n;n+=1)a.push(n);return a}function i(t){3>=t?e.pa=a(1,e.totalPage>=5?5:e.totalPage):t>=e.totalPage-3?e.pa=a(e.totalPage>=5?e.totalPage-4:1,5):e.pa=a(t-2,5)}var r={name:e.searchName,ps:9,pn:1};t.on("openFriendNotify",function(t){e.showFriendNofity=t}),e.search=function(){e.searchLoading||e.loading||(e.searched=!0,e.searchLoading=!0,r.pn=1,r.name=e.searchName,e.currentPageNo=r.pn,n().then(function(){i(e.currentPageNo),e.searchLoading=!1},function(n){e.searchLoading=!1,e.loading=!1,t.util.log(n.data.data.msg)}))},e.keydown=function(t){13===t.which&&e.search()},e.addFriend=function(e){t.trigger("openAddFriendDialog",e)},e.close=function(){e.$parent.show="main"},e.goToSearchPage=function(e){r.pn=e,n()},e.$watch("currentPageNo",function(e){e&&i(e)})}])}(),function(){angular.module("chat_directive").controller("addGroup",["$scope","chatService",function(e,t){var n=[];e.groups=t.data.groups,e.selected=[],t.on("switchTab",function(){e.$parent.showAddGroup&&t.trigger("resetAddGroup")}).on("resetAddGroup",function(){e.selected=[],n=[],angular.forEach(e.groups,function(e){angular.forEach(e.users,function(e){e.hide=!1,e.selected=!1,e.showDelete=!1})})}),e.showUnselected=function(e){for(var t=!0,a=0;a<n.length;a+=1)if(n[a].uuid===e.uuid){t=!1;break}return t},e.selectUser=function(t){var a=n.indexOf(t);-1===a?n.push(t):n.splice(a,1),e.confirmSelect()},e.confirmSelect=function(){e.selected=n.slice()},e.removeSelected=function(t){var a=e.selected.indexOf(t);t.showDelete=!1,e.selected.splice(a,1),angular.forEach(n,function(e,a){t.id===e.id&&n.splice(a,1)})},e.addGroup=function(){var n=[];return angular.forEach(e.selected,function(e){n.push(e.id)}),n.length?void t.http.createGroup(n.join(",")).then(function(e){t.util.log("创建讨论组成功！");var n={id:e.data.id,name:e.data.name,img:e.data.img,gType:e.data.gType,cid:e.data.cid,oid:e.data.oid,uuid:e.data.ugid,type:"group",online:!0};t.data.groups["My-GRP"].users.push(n),t.trigger("openChatWindow",n),t.trigger("resetAddGroup")},function(e){1===e.type?t.util.log("创建讨论组失败！"+e.data.data.msg):t.util.log("创建讨论组失败！网络错误！")}):void t.util.log("请选择讨论组成员。")},e.hideUnrelativeItem=function(t){var n=new RegExp(e.searchUser);return!n.test(t)},e.close=function(){e.$parent.show="main"}}])}(),function(){angular.module("chat_directive").directive("msgImg",function(){return{scope:{msg:"=msgImg"},restrict:"A",template:'<a ng-click="showPic()"><img ng-src="{{imgUrl}}"></a><div class="chat-pos-fixed chat-pos-center chat-bg-transparent" ng-show="showBigImg"><div class="chat-dis-table"><div class="chat-dis-tablecell"><div class="chat-big-img"><button ng-click="closePic()" class="chat-close-img">&times;</button><div><i ng-hide="imgLoaded" class="fa fa-spinner fa-spin"></i> <a ng-show="imgLoaded" ng-click="zoomPic()" ng-style="parentStyle"><img class="chat-img" ng-class="{\'chat-img-zoom\': largeImg && !dragMode, \'chat-img-drag\': dragMode}" ng-mousedown="mousedown($event)" ng-src="{{bigImgUrl}}" ng-style="imgStyle"></a></div></div></div></div></div>',link:function(e,t){function n(e){var t={left:e.clientX-i.left,top:e.clientY-i.top};s.parent().parent().scrollTop(r.top-t.top).scrollLeft(r.left-t.left)}function a(){o.off("mousemove",n),o.off("mouseup",a)}if(e.imgStyle={},e.parentStyle={},e.largeImg=!1,2===e.msg.fileType){var i={top:0,left:0},r={left:0,top:0},s=t.find(".chat-big-img img"),o=angular.element(document),c={width:0,height:0},l=$(window).width(),u=$(window).height(),d=!1;e.imgUrl=angular.element(e.msg.msg).find("img").attr("src"),e.showPic=function(){e.showBigImg=!0,e.bigImgUrl=e.imgUrl.split("?s=1")[0];var t=new Image;t.src=e.bigImgUrl,angular.element(t).on("load",function(){var t=this.width,n=this.height;c.width=t,c.height=n,t>.8*l?(e.largeImg=!0,e.imgStyle["max-width"]=.8*l):e.imgStyle["max-width"]=c.width,n>.8*u?(e.largeImg=!0,e.imgStyle["max-height"]=.8*u):e.imgStyle["max-height"]=c.height,e.imgLoaded=!0,e.$digest()})},e.closePic=function(){e.showBigImg=!1,e.imgStyle={},e.parentStyle={},e.largeImg=!1,e.dragMode=!1,d=!1,e.bigImgUrl=void 0,e.imgLoaded=!1,s.off("load")},e.zoomPic=function(){e.largeImg&&!d&&(e.parentStyle.width=.8*l,e.parentStyle.height=.8*u,e.imgStyle.width=c.width,e.imgStyle.height=c.height,e.dragMode=!0,d=!0,e.imgStyle["max-height"]="none",e.imgStyle["max-width"]="none")},e.mousedown=function(e){i.left=e.clientX,i.top=e.clientY,r.left=s.parent().parent().scrollLeft(),r.top=s.parent().parent().scrollTop(),o.on("mousemove",n),o.on("mouseup",a),e.preventDefault()}}}}})}();try{if("object"!=typeof module)var module=angular.module("directive",[])}catch(e){var module=angular.module("directive",[])}module.directive("placeholder",function(){return{restrict:"A",require:"?ngModel",link:function(e,t,n,a){try{var i="<style>.placeholder-style{color: gray;};</style>";0===document.getElementsByClassName("placeholder-style").length&&angular.element(document).find("head").append(i);var r=function(e,t){var n,a=window.navigator.userAgent.toLowerCase();if(-1!==a.indexOf("msie")){var i=a.match(/msie\s([0-9]*)/);n=0===arguments.length?i[1]:1===arguments.length?parseInt(i[1])===e:i[1]>=e&&i[1]<=t?i[1]:!1}return n};if(r(8,9)){a.$modelValue||a.$modelValue===!1||0===a.$modelValue||(t.val(n.placeholder),t.addClass("placeholder-style"));try{a.$setViewValue()}catch(s){}if("password"===n.type){t.removeClass("placeholder-style");var o=(new Date).getTime(),c=n.style||"",l=n["class"]||"";t.after('<input id="'+o+'" type="text" value="'+n.placeholder+'" autocomplete="off" style="'+c+'" class="'+l+' placeholder-style" />');var u=t.next();u.css("display","inline-block"),t.css("display","none"),u.on("focus",function(){t.css("display","inline-block"),u.css("display","none"),t.on("focus",function(){})})}var d=!1;t.on("focus",function(){d=!0,"password"===n.type?a.$modelValue||t.val(""):(t.removeClass("placeholder-style"),t.val()!==n.placeholder||a.$modelValue&&a.$modelValue!==n.placeholder||t.val(""))}),t.on("blur",function(){d=!1,"password"===n.type?""===t.val()&&(u.css("display","inline-block"),t.css("display","none")):t.val()||a.$modelValue||(t.val(n.placeholder),t.addClass("placeholder-style"))}),e.$watch(function(){return a.$modelValue},function(e){e?t.removeClass("placeholder-style"):d===!1&&(t.val(n.placeholder),t.addClass("placeholder-style"))})}}catch(s){}}}}),module.factory("headSearch",["request",function(e){var t=g_conf.pes.rUrl;return{SearchIntelligent:function(n,a){var i={method:"GET",url:t+"pub/api/SearchIntelligent",params:n,option:{loading:!1}};return e(angular.extend(i,a||{}))}}}]),module.run(["service","headSearch",function(e,t){e.expand("headSearch",function(){return t})}]),module.directive("headnav",function(){return{template:'<header><div ng-class="headMaximizeLock ? \'head-maximize\' : \'head-minimize\'"><div ng-class="param.style"><div class="image-head-rainbow decoration-ic"></div><section class="g-m-w header-area"><div class="minimize-logo"><a ng-href="{{param.logo.href||\'/\'}}"><img ng-src="{{param.logo.small}}" alt="{{param.logo.msg}}" title="{{param.logo.msg}}"></a></div><nav class="minimize-nav"><ul><li ng-repeat="item in navList track by $index" ng-class="item.class"><a ng-href="{{item.href || \'\'}}" target="{{item.target || \'_self\'}}">{{item.name}}</a><div ng-if="item.child.length"><ul><li ng-repeat="c in item.child"><a ng-href="{{c.href || \'\'}}" target="{{c.target || \'_self\'}}">{{c.name}}</a></li></ul></div></li></ul></nav><div class="logo"><a ng-href="{{param.logo.href||\'/\'}}"><img ng-src="{{param.logo.large}}" alt="{{param.logo.msg}}" title="{{param.logo.msg}}"></a></div><div class="top-user-menu-bar" ng-class="{clearminw: user.account}"><top-user-menu user="user" item-list="itemList"></top-user-menu></div><div class="h-sc" ng-controller="headSearchCtrl"><div class="head-search-bar"><div class="enter" ng-click="stopPropagation($event)"><input type="text" class="input" ng-model="scText" ng-keydown="onkeydown($event)" ng-change="matchChange(scSelectVal.value,scText)" placeholder="请输入关键词搜索"><div class="match-kw-v" ng-show="matchReadyLock"><div class="mc-list"><ul><li ng-if="!mcCourseList || !mcCourseList.length">暂无相关内容</li><li ng-repeat="item in mcCourseList track by $index" ng-click="intoDetail(item)" ng-if="$index < cMaxLen" ng-class="{hover: $index + lMaxLen == moveKeyIndex}" ng-mouseenter="mouseenter($index, \'资源\')"><div class="text-of pd-r10"><span class="lab" ng-if="item.t == 10">课程</span> <span class="lab" ng-if="item.t == 20">题库</span> <a class="item-name" ng-bind-html="item.name | titleMatchKw:scText"></a></div></li></ul></div></div></div><a ng-click="goToSearch(scSelectVal.value,scText)" class="submit" title="提交"><i class="fa fa-search" aria-hidden="true"></i></a></div><div class="hot-word"><a ng-href="javascript:void(0);" ng-click="goToSort(item.name)" class="mg-r20" ng-repeat="item in scHotWord">{{item.name}}</a></div></div></section><section class="nav-area"><div class="g-m-w"><div class="n-categories" ng-controller="categoriesCtrl" ng-mouseenter="service.mouseenter(hover)" ng-mouseleave="service.mouseleave(hover)"><div class="dt">全部课程</div><div class="dd" id="by-categories" ng-show="categoriesUnfoldLock || hover.mouseEnterLock"><div class="image-giraffe giraffe-icon"></div><div class="dd-inner"><div class="item" ng-repeat="item in categoriesListStyle1 track by $index" ng-mouseenter="service.mouseenter(item)" ng-mouseleave="service.mouseleave(item)" ng-show="$index<5 || hover.mouseEnterLock"><div class="layer"><h3><a ng-href="goToCategory(item.name)" target="_blank" title="{{item.name}}">{{item.name}}</a></h3><div class="hot-word"><a ng-href="goToCategory(item.name,child.name)" target="_blank" class="text-of" ng-repeat="child in item.child track by $index" ng-show="$index<3" title="{{child.name}}">{{child.name}}</a></div><i>&gt;</i></div><div class="sub" ng-show="item.mouseEnterLock"><div class="inner"><dl class="card" ng-repeat="child in item.child track by $index" ng-show="$index<3"><dt><a ng-href="goToCategory(item.name,child.name)" target="_blank" class="f-r">更多&gt;&gt;</a> <a ng-href="goToCategory(item.name,child.name)" target="_blank" title="{{child.name}}">{{child.name}}</a></dt><dd><a ng-href="goToCategory(item.name,child.name,unit.name)" target="_blank" class="text-of" ng-repeat="unit in child.child track by $index" ng-show="$index<15" title="{{unit.name}}">{{unit.name}}</a></dd></dl><div class="more-srot" ng-show="item.child.length>3"><a ng-href="goToCategory(item.name)" target="_blank" class="f-r">更多分类&gt;&gt;</a>. . .</div></div></div></div><div ng-repeat="list in categoriesListStyle2 track by $index"><div class="big-sort"><a ng-href="goToCategory(item.name)" target="_blank" title="{{list.name}}">{{list.name}}</a></div><div class="item" ng-repeat="item in list.child track by $index" ng-mouseenter="service.mouseenter(item)" ng-mouseleave="service.mouseleave(item)"><div class="layer"><h3><a ng-href="goToCategory(list.name,item.name)" target="_blank" title="{{item.name}}">{{item.name}}</a></h3><i>&gt;</i></div><div class="sub" ng-show="item.mouseEnterLock"><div class="inner"><dl class="card" ng-repeat="child in item.child track by $index" ng-show="$index<4"><dt><a ng-href="goToCategory(list.name,item.name,child.name)" target="_blank" class="f-r">更多&gt;&gt;</a> <a ng-href="goToCategory(list.name,item.name,child.name)" target="_blank" title="{{child.name}}">{{child.name}}</a></dt><dd><a ng-href="goToCategory(list.name,item.name,child.name,unit.name)" target="_blank" class="text-of" ng-repeat="unit in child.child track by $index" ng-show="$index<10" title="{{unit.name}}">{{unit.name}}</a></dd></dl><div class="more-srot" ng-show="item.child.length>4"><a ng-href="goToCategory(list.name,item.name)" target="_blank" class="f-r">更多分类&gt;&gt;</a>. . .</div></div></div></div></div></div></div></div><nav class="nav"><a ng-repeat="item in navList track by $index" ng-href="{{item.href || \'\'}}" target="{{item.target || \'_self\'}}" ng-class="item.class">{{item.name}}</a></nav><div class="extra" ng-show=""><a href="javascript:void(0);" class="icf t-icf">名师认证</a> <a href="javascript:void(0);" class="icf e-icf">真实评价</a> <a href="javascript:void(0);" class="icf r-icf">随时退</a></div></div></section></div></div></header>',restrict:"E",replace:!0,transclude:!0,scope:{itemList:"=itemList",user:"=user",nav:"="},controller:["$rootScope","$scope","$element","$attrs","service",function(e,t,n,a,i){t.service=i,t.catType=parseInt(rcpAid.getCourseCat()),e.$watch("headMaximizeLock",function(e){e&&(t.headMaximizeLock=e)}),e.$watch("categoriesUnfoldLock",function(e){e&&(t.categoriesUnfoldLock=e)}),e.$watch("catDomain",function(e){if(e)switch(e){case"aikexue.com":t.init(2)}}),t.$on("login",function(e,n){n&&t.loginInit()}),t.loginInit=function(){3===t.catType&&(t.navList=[{name:"学习中心",href:rcpAid.getUrl("学习中心"),"class":"key",target:"_blank"},{name:"教学中心",href:rcpAid.getUrl("教学中心",{uid:t.user.tid}),"class":"key",target:"_blank"},{name:"高等教育",href:rcpAid.getUrl("分类",{category:"高等教育"}),"class":"key",target:"_blank"}])},t.init=function(e){if("order"===t.nav)return t.navList=[{name:"首页",href:rcpAid.getUrl("首页"),"class":"key"},{name:"个人空间",href:rcpAid.getUrl("学习中心"),"class":"key",target:"_blank"}],void(t.param={logo:{small:"/rcp-common/imgs/order/head-icon.png",large:"/rcp-common/imgs/icon/head-icon.png",href:"/my-order.html",msg:"我的酷校"},style:""});switch(t.catType){case 3:t.isLogin?t.navList=[{name:"学习中心",href:rcpAid.getUrl("学习中心"),"class":"key",target:"_blank"},{name:"教学中心",href:rcpAid.getUrl("教学中心",{uid:t.user.tid}),"class":"key",target:"_blank"},{name:"高等教育",href:rcpAid.getUrl("分类",{category:"高等教育"}),"class":"key",target:"_blank"}]:t.navList=[{name:"高等教育",href:rcpAid.getUrl("分类",{category:"高等教育"}),"class":"key",target:"_blank"}],t.param={logo:{small:"/rcp-common/imgs/icon/gzmooc-logo.png",large:"/rcp-common/imgs/icon/gzmooc-logo.png",href:DYCONFIG.rcp.rUrl,msg:"酷校 - 首页"},style:""};break;case 2:t.navList=[{name:"首页",href:rcpAid.getUrl("首页"),"class":"key"},{name:"全部课程",href:rcpAid.getUrl("分类"),"class":"key",target:"_blank"},{name:"学习中心",href:rcpAid.getUrl("学习中心"),"class":"key",target:"_blank"}],t.param={logo:{small:"/rcp-common/imgs/icon/aikexue-logo-2.png",large:"/rcp-common/imgs/icon/aikexue-logo.png",href:DYCONFIG.rcp.rUrl,msg:"爱科学"},style:"aikexue-head"};break;default:t.navList=[{name:"首页",href:rcpAid.getUrl("首页"),"class":"key"},{name:"学习中心",href:rcpAid.getUrl("学习中心"),"class":"key",target:"_blank"},{name:"我要吐槽",href:rcpAid.getUrl("我要吐槽"),"class":"key",target:"_blank"}],t.param={logo:{small:"/rcp-common/imgs/icon/book-logo-2.png",large:"/rcp-common/imgs/icon/book-logo.png",href:DYCONFIG.rcp.rUrl,msg:"酷校LOGO·让学习更Cool"},style:""}}},t.init()}]}}),module.directive("topUserMenu",function(){return{template:'<div class="top-user-menu"><div style="font-size:14px;line-height:40px" ng-show="!currentUser.uid"><a ng-href="{{link.login}}" id="login" class="color-cyan pd-l20"><i class="image-login-user-ic"></i>马上登录 </a><span style="color:#ececec;margin:0 8px">| </span><a ng-href="{{link.register}}" class="color-cyan">注册</a></div><div class="menber-link" ng-show="currentUser.uid"><a href="" class="u-info" rel="member_link"><img ng-hide="currentUser.avatar" src="/rcp-common/imgs/face/d-face-1.png" class="face-img" width="40" height="40" rel="user_face" alt="{{currentUser.nickName}}"> <img ng-show="currentUser.avatar" ng-src="{{currentUser.avatar}}" class="face-img" width="40" height="40" rel="user_face" alt="{{currentUser.nickName}}"> <span class="name" rel="user_name" title="{{currentUser.nickName}}" ng-bind="currentUser.nickName"></span> <i class="x-arrow-dowm">&gt;</i></a><div class="u-panel"><div class="tup-box"><div class="tup-info" rel="user_info_box"><div class="user-head" rel="user_face_box"><a ng-href="{{link.setting}}"><img ng-hide="currentUser.avatar" src="/rcp-common/imgs/face/d-face-1.png" width="96" height="96" class="face-img" rel="user_face" alt="{{currentUser.nickName}}"> <img ng-show="currentUser.avatar" ng-src="{{currentUser.avatar}}" width="96" height="96" class="face-img" rel="user_face" alt="{{currentUser.nickName}}"></a></div><div class="user-identity"><p class="user-name text-of"><a href="" rel="user_name" title="{{currentUser.nickName}}" ng-bind="currentUser.nickName"></a></p><p class="attestation-un" ng-class="{\'attestation\':attestation==\'已认证\'}"><i class="image-attestation-yellow"></i> <span>{{attestation}}</span></p></div><div class="clear"></div></div><div class="tup-operate"><div class="card-sets"><a href="{{link.applySpaceUrl}}" class="key f-l"><i class="image-attestation"></i> <span class="text-4f">认证管理</span> </a><a href="{{link.setting}}" target="_blank" class="key f-l"><i class="image-settings"></i> <span class="text-4f">设置</span> </a><a href="" class="key f-r" ng-click="logout()"><i class="image-logout"></i> <span class="text-4f">退出</span></a></div><div class="card-links"><a ng-repeat="item in itemList" ng-href="{{item.href || \'\'}}" ng-class="item.name == \'...\' ? \'disabled key \'+item.icon : \'key \'+item.icon"><i></i> <span>{{item.name}}</span></a></div></div></div></div></div></div>',restrict:"E",replace:!0,transclude:!0,scope:{itemList:"=itemList",user:"=user"},controller:["$rootScope","$scope","$timeout","$location","service",function(e,t,n,a,i){t.$watch("itemList",function(e){if(e){var n=t.itemList.length,a=n%3;if(a)for(var i=3-n%3+n,r=n;i>r;r+=1)e.push({name:"..."})}},!0),t.logout=function(){var e=rcpAid.getUrl("首页");location.href=rcpAid.getUrl("退出",{url:encodeURIComponent(e)})},t.$on("login",function(e,n){n.uid&&t.loginInit()}),t.loginInit=function(){t.currentUser=e.currentUser,t.currentUser.certification&&(t.attestation="已认证")},t.init=function(){var e=rcpAid.getNoTokenUrl();t.link={login:rcpAid.getUrl("登录",{url:encodeURIComponent(e)}),register:rcpAid.getUrl("注册",{url:encodeURIComponent(e)}),applySpaceUrl:rcpAid.getUrl("实名认证"),setting:rcpAid.getUrl("个人设置",{url:window.location.href})},t.attestation="未认证"},t.init()}]}}),module.controller("categoriesCtrl",["$rootScope","$scope","service",function(e,t,n){function a(e){switch(e){case 2:t.categoriesListStyle2=i||[];break;default:t.categoriesListStyle1=i||[]}}t.service=n,t.hover={},t.catType=rcpAid.getCourseCat(),t.byCategories=function(){t.byCategoriesLoading=!0,a(t.catType)},t.listenerMember={byCategories:{node:"#by-categories",callback:t.byCategories}};var i;t.goToCategory=function(){var e=[].slice;return rcpAid.getUrl("分类",{
tags:e.call(arguments,0).join(",")})}}]),module.directive("searchDir",function(){return{template:'<div class="h-sc"><div class="head-search-bar"><div class="enter" ng-click="stopPropagation($event)"><input type="text" class="input" ng-model="scText" ng-keydown="onkeydown($event)" ng-change="matchChange(scSelectVal.value,scText)" placeholder="请输入关键词搜索"><div class="match-kw-v" ng-show="matchReadyLock"><div class="mc-list"><ul><li ng-repeat="item in mcCategoryList track by $index" ng-if="$index < lMaxLen" ng-class="{hover: $index == moveKeyIndex}" ng-mouseenter="mouseenter($index,\'类\')" ng-click="matchGoToCategory(item.tag,scText)"><div class="text-of"><a href="javascript:;">{{text}}</a> 在 <a href="javascript:;" class="item-name color-cyan">{{item.tag}}</a> 分类中搜索</div></li></ul><div style="margin:0 10px;border-top:1px solid #dfdfdf" ng-if="mcCourseList.length && mcCategoryList.length"></div><ul><li ng-if="!mcCourseList || !mcCourseList.length">暂无相关内容</li><li ng-repeat="item in mcCourseList track by $index" ng-click="intoDetail(item)" ng-if="$index < cMaxLen" ng-class="{hover: $index + lMaxLen == moveKeyIndex}" ng-mouseenter="mouseenter($index,\'资源\')"><div class="text-of"><span class="lab" ng-if="item.t == 10">课程</span> <span class="lab" ng-if="item.t == 20">题库</span> <a href="javascript:;" class="item-name" ng-bind-html="item.name|titleMatchKw:scText"></a></div></li></ul></div></div></div><a ng-click="goToSearch(scSelectVal.value,scText)" class="submit" title="提交"><i class="fa fa-search" aria-hidden="true"></i></a></div><div class="hot-word"><a href="" class="mg-r20" ng-repeat="item in scHotWord" ng-click="goToSort(item.name)">{{item.name}}</a></div></div>',restrict:"E",replace:!0,transclude:!0,scope:{hot:"="},controller:"headSearchCtrl"}}),module.controller("headSearchCtrl",["$rootScope","$scope","$document","$element","service","headSearch",function(e,t,n,a,i,r){function s(){t.scText="",d()}function o(){b=!0,t.KeyDownIndex=t.moveKeyIndex,u()}function c(){"number"!=typeof t.moveKeyIndex?t.moveKeyIndex=0:t.moveKeyIndex=(t.moveKeyIndex+1)%t.aMaxLen,o()}function l(){"number"!=typeof t.moveKeyIndex?t.moveKeyIndex=t.aMaxLen-1:t.moveKeyIndex=t.moveKeyIndex<0?t.aMaxLen-1:t.moveKeyIndex-1,o(),p(t.scText.length)}function u(){var e,n=t.KeyDownIndex,a=t.lMaxLen;return t.scTag=void 0,a>n&&(t.scText=t.text),n>=a&&(e=t.mcCourseList[n-t.lMaxLen],e&&(t.scText=e.name)),e}function d(e){t.matchReadyLock=!1,e&&(n.unbind("click"),t.$digest())}function g(){n.unbind("click").bind("click",function(){d("digest")}),t.matchReadyLock=!0}function h(){t.matchReadyLock&&(clearTimeout(k),k=setTimeout(function(){d("digest")},300))}function p(e){var t=a.find('input[ng-model="scText"]').get(0);if("selectionStart"in t&&(t.selectionStart=e,t.selectionEnd=e),"createTextRange"in t){var n=t.createTextRange();n.moveStart("character",e),n.collapse(!0),n.select()}}function f(e,n){t.inSort&&!angular.isArray(e)||angular.forEach(e,function(e){return t.inSort?!1:void(n(e)||angular.isArray(e.child)&&e.child.length&&(f(e.child,n),v("push",e.name)))})}function m(e,n){switch(t.inSort=!1,v("clear"),f(e,function(e){return t.inSort=e.name===n,t.inSort&&v("push",e.name),t.inSort}),t.inSort){case!0:v("splice",n);break;default:v("clear")}return t.categorySelect}function v(e,n){var a=t.categorySelect;switch(e){case"clear":a.splice(0,a.length);break;case"push":a.push(n);break;case"splice":a.splice(0,$.inArray(n,a))}}function y(e,t){i.dialog.alert(t),console[e](t)}function w(e){var t=[];if(e.length)for(var n=0,a=e.length;a>n;n++)t.push({id:e[n].hasOwnProperty("id")?e[n].id:"",name:e[n].hasOwnProperty("title")?e[n].title:"",t:e[n].hasOwnProperty("type")?e[n].type:""});return t}t.scHotWord=[],t.scSelect=[{name:"所有分类",value:"",fixLock:!0},{name:"课程",value:10},{name:"题库",value:20}],t.scSelectVal=t.scSelect[0],t.onkeydown=function(e){switch(e.stopPropagation(),e.keyCode){case 13:t.scText||(t.scText=$(".head-search-bar input").eq(0).val());var n=t.KeyDownIndex,a=t.lMaxLen;"number"==typeof n&&n>=0&&a>n&&t.scTag?t.matchGoToCategory(t.scTag,t.scText):n>=0&&t.matchReadyLock?location.href=rcpAid.getUrl("课程详情",{cid:t.mcCourseList[n].id}):t.goToSearch(t.scSelectVal.value,t.scText);break;case 38:l();break;case 40:c();break;default:b=!1,t.moveKeyIndex=void 0,t.KeyDownIndex=void 0,t.scTag=void 0}};var b,k;a.find('input[ng-model="scText"]').unbind("focus").bind("focus",g),a.find('input[ng-model="scText"]').unbind("blur").bind("blur",h),t.mouseenter=function(e,n){switch(n){case"类":t.moveKeyIndex=e;break;case"资源":t.moveKeyIndex=e+t.lMaxLen}},t.goToSearch=function(e,t){s(),location.href=rcpAid.getUrl("搜索",{type:e,query:t?encodeURIComponent(t):t})},t.goToSort=function(e){s(),location.href=rcpAid.getUrl("分类",{tags:e})},t.stopPropagation=function(e){e.stopPropagation()},t.matchChange=function(e,n){if(!b){if(d(),!n)return t.mcCategoryList=[],void(t.mcCourseList=[]);t.text=n,r.SearchIntelligent({key:n,courseType:e||null,limit:10}).then(function(e){t.scText&&(t.matchReadyLock=!0,t.mcCourseList=w(e.data.courses||[]),t.mcCategoryList=[],t.lMaxLen=t.mcCategoryList.length>3?3:t.mcCategoryList.length,t.cMaxLen=t.mcCourseList.length-t.lMaxLen,t.aMaxLen=t.lMaxLen+t.cMaxLen,t.mcCourseList.length||t.mcCategoryList.length||d())},function(e){y("错误代码："+e.data.data.code)})}},t.$watch("scSelectVal.value",function(){t.matchChange(t.scSelectVal.value,t.scText)}),t.matchGoToCategory=function(t,n){if(!e.allTagCategroy||!e.allTagCategroy.length)return void y("error","获取分类数据失败");var a=m(e.allTagCategroy,t).reverse().join(",");a?(s(),location.href=rcpAid.getUrl("分类",{tags:a,query:n})):y("error","找不到这个分类，请检查接口数据")},t.categorySelect=[],t.intoDetail=function(e){e.hasOwnProperty("id")&&(location.href=rcpAid.getUrl("课程详情",{cid:e.id}))}}]),module.directive("tailnav",function(){return{template:'<footer><section class="footer" id="footer"><div class="g-m-w"><div class="copyright"><p>广州市大洋信息技术股份有限公司 版权所有</p><p>Copyright © 2015 ITDAYANG. All Rights Reserved.</p><p>{{caseNumber}}</p></div><div class="footer-link"><a href="http://www.itdayang.com/about.html" target="_blank">关于我们</a> <span>- </span><a href="http://www.itdayang.com/contact.html" target="_blank">联系我们</a> <span>- </span><a href="javascript:;" ng-click="atBuilding()">法律条款</a> <span>- </span><a href="javascript:;" ng-click="atBuilding()">帮助中心</a> <span>- </span><a href="javascript:;" ng-click="atBuilding()">学校申请加入</a> <span>- </span><a href="javascript:;" ng-click="atBuilding()">机构申请加入</a> <span>- </span><a href="javascript:;" ng-click="atBuilding()">意见反馈</a></div><div class="clear"></div></div></section></footer>',restrict:"E",replace:!0,transclude:!0,scope:{data:"=data"},controller:["$scope","service",function(e,t){e.catType=rcpAid.getCourseCat();var n=DYCONFIG.domain||[];angular.forEach(n,function(t){t.domain===location.host&&(e.caseNumber=t.domainNum)}),e.atBuilding=function(){t.dialog.alert("正在建设中...")}}]}}),module.filter("titleMatchKw",["$sce",function(e){return function(t,n){var a="<b>"+n+"</b>",i=/([\[\]\(\)\{\}\*\?\+\^\$\.\|\\])/gi,r=n.replace(i,"\\$1");return t=t.replace(new RegExp(r,"ig"),a),e.trustAsHtml(t)}}]),function(){function e(){var i=document.getElementById("footer");if(i){var r=document.documentElement.scrollHeight-1||document.body.scrollHeight-1,s=document.documentElement.clientHeight||document.body.clientHeight;a=s>=r?1:2,a!==n&&(s>=r?(t(i.parentNode,{height:i.offsetHeight+"px"}),t(i,{position:"absolute",width:"100%",bottom:0,left:0})):(t(i.parentNode,{height:i.offsetHeight+"px"}),t(i,{position:"",width:"100%",bottom:0,left:0}))),n=s>=r?1:2}setTimeout(e)}if(!window.fixedFooterFlag){window.fixedFooterFlag=!0;var t=function(e,t){for(k in t)e.style[k]=t[k]},n=0,a=1;e()}}();var CryptoJS=CryptoJS||function(e,t){var n={},a=n.lib={},i=function(){},r=a.Base={extend:function(e){i.prototype=this;var t=new i;return e&&t.mixIn(e),t.hasOwnProperty("init")||(t.init=function(){t.$super.init.apply(this,arguments)}),t.init.prototype=t,t.$super=this,t},create:function(){var e=this.extend();return e.init.apply(e,arguments),e},init:function(){},mixIn:function(e){for(var t in e)e.hasOwnProperty(t)&&(this[t]=e[t]);e.hasOwnProperty("toString")&&(this.toString=e.toString)},clone:function(){return this.init.prototype.extend(this)}},s=a.WordArray=r.extend({init:function(e,n){e=this.words=e||[],this.sigBytes=n!=t?n:4*e.length},toString:function(e){return(e||c).stringify(this)},concat:function(e){var t=this.words,n=e.words,a=this.sigBytes;if(e=e.sigBytes,this.clamp(),a%4)for(var i=0;e>i;i++)t[a+i>>>2]|=(n[i>>>2]>>>24-8*(i%4)&255)<<24-8*((a+i)%4);else if(65535<n.length)for(i=0;e>i;i+=4)t[a+i>>>2]=n[i>>>2];else t.push.apply(t,n);return this.sigBytes+=e,this},clamp:function(){var t=this.words,n=this.sigBytes;t[n>>>2]&=4294967295<<32-8*(n%4),t.length=e.ceil(n/4)},clone:function(){var e=r.clone.call(this);return e.words=this.words.slice(0),e},random:function(t){for(var n=[],a=0;t>a;a+=4)n.push(4294967296*e.random()|0);return new s.init(n,t)}}),o=n.enc={},c=o.Hex={stringify:function(e){var t=e.words;e=e.sigBytes;for(var n=[],a=0;e>a;a++){var i=t[a>>>2]>>>24-8*(a%4)&255;n.push((i>>>4).toString(16)),n.push((15&i).toString(16))}return n.join("")},parse:function(e){for(var t=e.length,n=[],a=0;t>a;a+=2)n[a>>>3]|=parseInt(e.substr(a,2),16)<<24-4*(a%8);return new s.init(n,t/2)}},l=o.Latin1={stringify:function(e){var t=e.words;e=e.sigBytes;for(var n=[],a=0;e>a;a++)n.push(String.fromCharCode(t[a>>>2]>>>24-8*(a%4)&255));return n.join("")},parse:function(e){for(var t=e.length,n=[],a=0;t>a;a++)n[a>>>2]|=(255&e.charCodeAt(a))<<24-8*(a%4);return new s.init(n,t)}},u=o.Utf8={stringify:function(e){try{return decodeURIComponent(escape(l.stringify(e)))}catch(t){throw Error("Malformed UTF-8 data")}},parse:function(e){return l.parse(unescape(encodeURIComponent(e)))}},d=a.BufferedBlockAlgorithm=r.extend({reset:function(){this._data=new s.init,this._nDataBytes=0},_append:function(e){"string"==typeof e&&(e=u.parse(e)),this._data.concat(e),this._nDataBytes+=e.sigBytes},_process:function(t){var n=this._data,a=n.words,i=n.sigBytes,r=this.blockSize,o=i/(4*r),o=t?e.ceil(o):e.max((0|o)-this._minBufferSize,0);if(t=o*r,i=e.min(4*t,i),t){for(var c=0;t>c;c+=r)this._doProcessBlock(a,c);c=a.splice(0,t),n.sigBytes-=i}return new s.init(c,i)},clone:function(){var e=r.clone.call(this);return e._data=this._data.clone(),e},_minBufferSize:0});a.Hasher=d.extend({cfg:r.extend(),init:function(e){this.cfg=this.cfg.extend(e),this.reset()},reset:function(){d.reset.call(this),this._doReset()},update:function(e){return this._append(e),this._process(),this},finalize:function(e){return e&&this._append(e),this._doFinalize()},blockSize:16,_createHelper:function(e){return function(t,n){return new e.init(n).finalize(t)}},_createHmacHelper:function(e){return function(t,n){return new g.HMAC.init(e,n).finalize(t)}}});var g=n.algo={};return n}(Math);!function(){var e=CryptoJS,t=e.lib,n=t.WordArray,a=t.Hasher,i=[],t=e.algo.SHA1=a.extend({_doReset:function(){this._hash=new n.init([1732584193,4023233417,2562383102,271733878,3285377520])},_doProcessBlock:function(e,t){for(var n=this._hash.words,a=n[0],r=n[1],s=n[2],o=n[3],c=n[4],l=0;80>l;l++){if(16>l)i[l]=0|e[t+l];else{var u=i[l-3]^i[l-8]^i[l-14]^i[l-16];i[l]=u<<1|u>>>31}u=(a<<5|a>>>27)+c+i[l],u=20>l?u+((r&s|~r&o)+1518500249):40>l?u+((r^s^o)+1859775393):60>l?u+((r&s|r&o|s&o)-1894007588):u+((r^s^o)-899497514),c=o,o=s,s=r<<30|r>>>2,r=a,a=u}n[0]=n[0]+a|0,n[1]=n[1]+r|0,n[2]=n[2]+s|0,n[3]=n[3]+o|0,n[4]=n[4]+c|0},_doFinalize:function(){var e=this._data,t=e.words,n=8*this._nDataBytes,a=8*e.sigBytes;return t[a>>>5]|=128<<24-a%32,t[(a+64>>>9<<4)+14]=Math.floor(n/4294967296),t[(a+64>>>9<<4)+15]=n,e.sigBytes=4*t.length,this._process(),this._hash},clone:function(){var e=a.clone.call(this);return e._hash=this._hash.clone(),e}});e.SHA1=a._createHelper(t),e.HmacSHA1=a._createHmacHelper(t)}(),function(){if("function"==typeof ArrayBuffer){var e=CryptoJS.lib.WordArray,t=e.init;(e.init=function(e){if(e instanceof ArrayBuffer&&(e=new Uint8Array(e)),(e instanceof Int8Array||"undefined"!=typeof Uint8ClampedArray&&e instanceof Uint8ClampedArray||e instanceof Int16Array||e instanceof Uint16Array||e instanceof Int32Array||e instanceof Uint32Array||e instanceof Float32Array||e instanceof Float64Array)&&(e=new Uint8Array(e.buffer,e.byteOffset,e.byteLength)),e instanceof Uint8Array){for(var n=e.byteLength,a=[],i=0;n>i;i++)a[i>>>2]|=e[i]<<24-8*(i%4);t.call(this,a,n)}else t.apply(this,arguments)}).prototype=e}}();var C4js=function(){function e(){}return e.NewAjax=function(){return new XMLHttpRequest},e.G=function(t,n,a){var i=e.NewAjax();i.onreadystatechange=function(){if(4==i.readyState)try{200==i.status?n(JSON.parse(i.responseText),i):a(JSON.parse(i.responseText),null,i)}catch(e){a({},e,i)}},i.open("GET",t),i.send(null)},e.UrlArg=function(e){var t=window.location.search.substring(1),n=t.split("&");for(var a in n)if(kv=n[a].split("="),kv[0]==e)return kv[1];return null},e.FSize=["B","KB","MB","GB","TB"],e.fsize=function(t){bsize=t;for(var n=0;n<e.FSize.length;n++){if(!(bsize>1024))return bsize.toFixed(1)+e.FSize[n];bsize/=1024}},e.Uer=function(){function n(e,t,n){e&&(this.Url=e),t&&(this.Args=t),"undefined"!=typeof n&&(this.Auto=n),this.Hash=CryptoJS.SHA1,this.HashLimit=1024e4}return n.SOrder={E:0,A:1,S:2,P:3,W:4,L:5},n.StatusText=function(e){switch(e){case"P":return"上传中...";case"W":return"等待中...";case"E":return"上传失败";case"A":return"已取消";case"L":return"已完成";case"S":return"开始上传"}return""},n.prototype.files=[],n.prototype.loaded=0,n.prototype.idc=0,n.prototype.Auto=!0,n.prototype.Maxsize=0,n.prototype.Minsize=0,n.prototype.Uploading=!1,n.prototype.Url="",n.prototype.Fname="file",n.prototype.Args={},n.prototype.C=function(){cval={W:0,P:0,S:0,L:0,E:0,A:0,Speed:"",Loaded:this.loaded},tspeed=0;for(var t in this.files)switch(cf=this.files[t],cf.speed&&(tspeed+=cf.speed),cf.Status){case"W":cval.W++;break;case"P":cval.P++;break;case"S":cval.S++;break;case"L":cval.L++;break;case"E":cval.E++;break;case"A":cval.A++}return cval.Speed=e.fsize(tspeed),cval},n.prototype.sort=function(){this.files.sort(function(e,t){return n.SOrder[e.Status]>n.SOrder[t.Status]})},n.prototype.addf=function(e){e.Status="W",e.fid=this.idc++,e.speed=e.rate=0,this.files.push(e)},n.prototype.AddF=function(e,t,n){var a=[],i=[];this.Maxsize&&e.size>this.Maxsize?i.push(e):this.Minsize&&e.size<this.Minsize?i.push(e):(a.push(e),e.Args=t,e.Ev=n,this.addf(e),this.sort()),this.OnAdd(a,i),this.Auto&&this.uloop(),this.sort()},n.prototype.Add=function(e,t){for(var n=[],a=[],i=0;i<e.length;i++){var r=e[i];this.Maxsize&&r.size>this.Maxsize?a.push(r):this.Minsize&&r.size<this.Minsize?a.push(r):(r.node=t,r.Args=t.Args,r.Ev=t.Ev,n.push(r),this.addf(r))}this.OnAdd(n,a),this.Auto&&this.uloop(),this.sort(),t.value=""},n.prototype.AddI=function(e,n,a){t=document.getElementById(e),t&&(t.uer=this,t.Args=n,t.Ev=a,t.addEventListener("change",this.onc))},n.prototype.DelI=function(e){t=document.getElementById(e),t&&(t.uer=void 0,t.Args=void 0,t.Ev=void 0,t.removeEventListener("change",this.onc))},n.prototype.FindF=function(e){for(var t=0;t<this.files.length;t++)if(this.files[t].fid==e)return this.files[t];return null},n.prototype.ClearLoaded=function(){for(var e=[],t=0;t<this.files.length;t++)"L"!=this.files[t].Status&&e.push(this.files[t]);this.files=e},n.prototype.onc=function(e){if(e.preventDefault(),t=e.srcElement||e.target,t.uer&&t.files){var n=t.uer.OnSelect(t,e);n.length&&t.uer.Add(n,t)}return!0},n.prototype.uloop=function(){var e=null;for(var t in this.files)if(cf=this.files[t],"W"==cf.Status){e=this.files[t];break}if(e){var n=this.Hash;if(e.size>this.HashLimit?n=!1:"undefined"!=typeof e.Hash&&(n=e.Hash),!n)return delete e.Args.sha,void this.uloop_(e);var a=this,i=new FileReader;(new Date).getTime();i.onprogress=function(t){a.OnHashProc(e,t)},i.onload=function(t){var n=CryptoJS.lib.WordArray.create(this.result);e.Args||(e.Args={}),e.Args.sha=CryptoJS.SHA1(n).toString(CryptoJS.enc.Hex),a.uloop_(e)},i.readAsArrayBuffer(e)}},n.prototype.uloop_=function(t){var n=e.NewAjax(),a=n.upload,i=this;n.onreadystatechange=function(){if(4==n.readyState)if(200==n.status)try{i.OnSuccess(t,JSON.parse(n.responseText),null)}catch(e){i.OnSuccess(t,n.responseText,null)}else try{i.OnErr(t,JSON.parse(n.responseText),null)}catch(e){i.OnErr(t,n.responseText,null)}},a.addEventListener("loadstart",function(e){t.Status="S",t.speed=0,t.preloaded=0,t.pretime=(new Date).getTime()/1e3,t.node&&(t.node.uploading=!0),i.sort(),i.OnStart(t,e)},!1),a.addEventListener("progress",function(n){t.Status="P",t.rate=0,n.lengthComputable&&(t.rate=n.loaded/n.total),ntime=(new Date).getTime()/1e3,t.speed=(n.loaded-t.preloaded)/(ntime-t.pretime),speed=e.fsize(t.speed),t.preloaded=n.loaded,t.pretime=ntime,i.OnProcess(t,t.rate,speed,n)},!1),a.addEventListener("load",function(e){t.Status="L",i.loaded++,i.sort(),t.node&&(t.node.uploading=!1),i.OnLoad(t,e),i.uloop()},!1),a.addEventListener("error",function(e){t.Status="E",i.sort(),i.OnErr(t,null,e),i.uloop()},!1),a.addEventListener("abort",function(e){t.Status="A",i.sort(),i.OnAbort(t,e),i.uloop()},!1),t.Status="P",form=new FormData,uargs=[];for(var r in this.Args)uargs.push(r+"="+this.Args[r]);if(eargs=this.OnPrepare(t,n,form),eargs)for(var s in eargs)uargs.push(s+"="+eargs[s]);if(t.Args)for(var o in t.Args)uargs.push(o+"="+t.Args[o]);this.Fname.length&&form.append(this.Fname,t),rurl=this.Url,rurl.indexOf("?")<0?rurl+="?"+uargs.join("&"):rurl+="&"+uargs.join("&"),console.log(rurl),n.open("POST",rurl),n.overrideMimeType&&n.overrideMimeType("application/octet-stream"),n.send(form),t.Xhr=n},n.prototype.Abort=function(e){for(var t=0;t<this.files.length;t++)f=this.files[t],f.fid==e&&f.Xhr&&f.Xhr.abort()},n.prototype.OnAdd=function(e,t){},n.prototype.OnPrepare=function(e,t,n){return e.Ev&&e.Ev.OnPrepare&&e.Ev.OnPrepare(e,t,n),{}},n.prototype.OnStart=function(e,t){e.Ev&&e.Ev.OnStart&&e.Ev.OnStart(e,t)},n.prototype.OnProcess=function(e,t,n,a){e.Ev&&e.Ev.OnProcess&&e.Ev.OnProcess(e,t,n,a)},n.prototype.OnHashProc=function(e,t){e.Ev&&e.Ev.OnHashProc&&e.Ev.OnHashProc(e,t)},n.prototype.OnLoad=function(e,t){e.Ev&&e.Ev.OnLoad&&e.Ev.OnLoad(e,t)},n.prototype.OnSuccess=function(e,t,n){e.Ev&&e.Ev.OnSuccess&&e.Ev.OnSuccess(e,t,n)},n.prototype.OnErr=function(e,t,n){e.Ev&&e.Ev.OnErr&&e.Ev.OnErr(e,t,n)},n.prototype.OnAbort=function(e,t){e.Ev&&e.Ev.OnAbort&&e.Ev.OnAbort(e,t)},n.prototype.OnSelect=function(e,t){return e.files},n}(),window.C4js=e,e}();window.GetToken=window.GetToken?window.GetToken:function(){return rcpAid.getToken.call(rcpAid)},C4js.NewUer=function(e,t){return new C4js.Uer(DYCONFIG.uploadSrv,{m:"C",token:GetToken()},t)};var uer=C4js.NewUer({m:"C"},!0);if(angular.module("RCP").directive("drag",function(){var e={restrict:"A",link:function(e,t,n){function a(e){var n,l;"absolute"===h?(n=e.pageX,l=e.pageY,s={top:+t.css("top").split("px")[0],left:+t.css("left").split("px")[0]}):"fixed"===h&&(n=e.clientX,l=e.clientY,s=t.position()),angular.element("body").addClass("no-select"),o.off("mousedown",a),c.on("mousemove",i),c.on("mouseup",r),u.left=n,u.top=l,p&&(d.width=angular.element(window).width(),d.height=angular.element(window).height(),g.width=t.width(),g.height=t.height())}function i(e){var n,a;if("absolute"===h?(n=e.pageX,a=e.pageY):"fixed"===h&&(n=e.clientX,a=e.clientY),l.top=a-u.top,l.left=n-u.left,p){var i=s.top+l.top,r=s.left+l.left;i=0>=i?0:i,r=0>=r?0:r,i=i>=d.height-g.height?d.height-g.height:i,r=r>=d.width-g.width?d.width-g.width:r,t.css({top:i,left:r,bottom:"auto",right:"auto"})}else t.css({top:s.top+l.top,left:s.left+l.left,bottom:"auto",right:"auto"})}function r(){c.off("mousemove",i),c.off("mouseup",r),o.on("mousedown",a),angular.element("body").removeClass("no-select")}var s,o=n.drag?t.find(n.drag):t,c=angular.element(document),l={top:0,left:0},u={left:0,top:0},d={},g={},h=n.position||"absolute",p="true"===n.limit;angular.element("body").append("<style>.no-select{-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none;}</style>"),o.on("mousedown",a)}};return e}),module.directive("datetime",function(){return{template:'<span ng-style="style"><input type="text" ng-class="config.class" ng-model="value" placeholder="{{config.placeholder}}" ng-click="toggle($event)" readonly /></span>',restrict:"E",replace:!0,transclude:!0,scope:{value:"=value",startdate:"=startdate",enddate:"=enddate",config:"=config"},controller:["$scope","$element","$document","$compile","$interval","datetimeService",function(e,t,n,a,i,r){e.style={position:"relative",display:"inline-block",cursor:"default"},e.config.noInput&&(e.style.display="none"),e.toggle=function(s){return r.tpl&&(n.unbind("click"),r.tpl.remove(),r.tag===t)?(delete r.tpl,void i.cancel(r.clockTimer)):(r.tag=t,r.tpl=a('<datetime-tpl value="value" config="config"></datetime-tpl>')(e),e.config.noInput?e.config.targetElement.append(r.tpl):t.append(r.tpl),n.bind("click",e.toggle),void s.stopPropagation())},r.toggle=e.toggle}]}}),module.directive("datetimeTpl",function(){return{template:["<div ng-class=\"timeFlag ? 'datetime-w and-time-style' : 'datetime-w'\" ng-click=\"stopPropagation($event)\">",'<div style="cursor:default">','<em class="arrow-ic"></em>','<div class="show-time-box">','<div class="now-time">',"<p>当前时间</p>","<span>{{clockString}}</span>","</div>",'<div style="padding: 15px 0px;">',"<select ",'class="hour" ','ng-options="item.str for item in hourList" ','ng-model="repeatData.hour" ','ng-change="change({hour: repeatData.hour})"></select>',"</div>","<div>","<select ",'class="minute" ','ng-options="item.str for item in minuteList" ','ng-model="repeatData.minute" ','ng-change="change({minute: repeatData.minute})"></select>',"</div>","</div>",'<div class="show-date-box">','<div class="t">','<a href="javascript:;" class="p" title="上一月" ng-click="mBefore()"></a>','<a href="javascript:;" class="n" title="下一月" ng-click="mAfter()"></a>',"<select ",'class="y" ','ng-options="item.str for item in yearList" ','ng-model="repeatData.year" ','ng-change="change({year: repeatData.year})"></select>',"<select ",'class="m" ','ng-options="item.str for item in monthList" ','ng-model="repeatData.month" ','ng-change="change({month: repeatData.month})"></select>','<div class="w">',"<h4>一</h4>","<h4>二</h4>","<h4>三</h4>","<h4>四</h4>","<h4>五</h4>","<h4>六</h4>","<h4>日</h4>","</div>","</div>",'<div class="c">','<a ng-repeat="item in dayList" ng-class="item.class" ng-click="change({day: item})">{{item.val}}</a>',"</div>",'<div class="f">','<a href="javascript:;" class="clear" ng-click="clearValue()">清空</a>','<a href="javascript:;" class="today" ng-click="today()">今日</a>','<a href="javascript:;" class="cancel" ng-click="cancel()">取消</a>',"</div>","</div>","</div>","</div>"].join(""),restrict:"E",replace:!0,transclude:!0,scope:{value:"=value",config:"=config"},controller:["$scope","$element","$timeout","$interval","$document","datetimeService",function(e,t,n,a,i,r){function s(e,t){for(var n=e+"";n.length<t;)n="0"+n;return n}function o(t,n,a,i,r){for(var o=[];n>t;){var c={val:t,str:s("month"===i[0]?t+1:t,a)+(r||"")};o.push(c),c.val===i[1]&&(e.repeatData[i[0]]=c),t+=1}return o}function c(t,n,a){var i=new Date,r=i.getFullYear(),s=i.getMonth(),o=i.getDate(),c=e.newDate.getFullYear(),l=e.newDate.getMonth(),u=e.newDate.getDate(),d="d ",g=function(e){e&&(d+="d-able "),t===c&&n===l&&a===u&&(d+=e?"d-now ":"d-disabled ")};return g(e.expiredFlag?r>t||t===r&&s>n||t===r&&n===s&&o>=a:e.realFlag?t>r||t===r&&n>s||t===r&&n===s&&a>=o:!0),d}function l(e){return e%4===0&&e%100!==0||e%400===0}function u(e,t){return 1===t||3===t||5===t||7===t||8===t||10===t||12===t?31:4===t||6===t||9===t||11===t?30:2===t&&l(e)?29:28}function d(e,t){var n={"M+":e.getMonth()+1,"d+":e.getDate(),"h+":e.getHours(),"m+":e.getMinutes(),"s+":e.getSeconds(),"q+":Math.floor((e.getMonth()+3)/3),S:e.getMilliseconds()};/(y+)/.test(t)&&(t=t.replace(RegExp.$1,(e.getFullYear()+"").substr(4-RegExp.$1.length)));for(var a in n)new RegExp("("+a+")").test(t)&&(t=t.replace(RegExp.$1,1===RegExp.$1.length?n[a]:("00"+n[a]).substr((""+n[a]).length)));return t}e.oldDate=new Date,e.newDate=new Date,e.curDate=new Date,e.repeatData={},e.expiredFlag=e.config.style.match("expired"),e.realFlag=e.config.style.match("real"),e.timeFlag=e.config.style.match("time"),e.formatType=e.timeFlag?"yyyy-MM-dd hh:mm":"yyyy-MM-dd",e.setSelect=function(t,n,a,i){e.yearList=o(1901,t+100,4,["year",t],"年"),e.monthList=o(0,12,2,["month",n],"月"),e.hourList=o(0,24,2,["hour",a],"点"),e.minuteList=o(0,60,2,["minute",i],"分")},e.setDay=function(t,n,a){e.dayList=function(){for(var i=[],r=0,s=new Date(t+"-"+(n+1)+"-1"),o=s.getDay()?s.getDay():7,l=u(t,n+1);42>r;){var d=r>=o-1&&l+(o-1)>r?r-(o-2):"",g=d?c(t,n,d):"d",h={val:d,"class":g};i.push(h),h.val===a&&(e.repeatData.day=h),r+=1}return i}()},e.mBefore=function(){var t=e.curDate.getMonth()-1;0>t&&(e.curDate.setFullYear(e.curDate.getFullYear()-1),t=11),e.curDate.setMonth(t),e.reset()},e.mAfter=function(){var t=e.curDate.getMonth()+1;t>11&&(e.curDate.setFullYear(e.curDate.getFullYear()+1),t=0),e.curDate.setMonth(t),e.reset()},e.change=function(n){angular.forEach(n,function(n,i){switch(i){case"year":e.curDate.setFullYear(n.val),e.reset();break;case"month":e.curDate.setMonth(n.val),e.reset();break;case"day":n["class"].match(/d-able|d-now/)&&(e.curDate.setDate(n.val),e.setValue(e.curDate),e.timeFlag?e.reset():(t.remove(),a.cancel(r.clockTimer)));break;case"hour":e.curDate.setHours(n.val),e.initValue&&(e.setValue(e.curDate),e.reset());break;case"minute":e.curDate.setMinutes(n.val),e.initValue&&(e.setValue(e.curDate),e.reset())}})},e.clear=function(n,i,s){var o=n||new Date;e.setData(e.newDate,o),e.setData(e.curDate,o),e.value=i||"",e.reset(),s||(t.remove(),a.cancel(r.clockTimer))},e.clearValue=function(){e.clear(),"function"==typeof r.onClear&&r.onClear()},e.today=function(){var t=new Date;e.clear(t,d(t,e.formatType))},e.cancel=function(){e.initValue?(e.setValue(e.oldDate),e.reset()):e.clear(),t.remove(),a.cancel(r.clockTimer)},e.stopPropagation=function(e){e.stopPropagation()},e.setData=function(e,t){e.setFullYear(t.getFullYear()),e.setMonth(t.getMonth()),e.setDate(t.getDate()),e.setHours(t.getHours()),e.setMinutes(t.getMinutes())},e.setValue=function(t){e.setData(e.newDate,t),e.setData(e.curDate,t),e.value=d(e.newDate,e.formatType)},e.reset=function(){var t=e.curDate.getFullYear(),n=e.curDate.getMonth(),a=e.curDate.getDate(),i=e.curDate.getHours(),r=e.curDate.getMinutes();e.setSelect(t,n,i,r),e.setDay(t,n,a)},e.clock=function(){var t=new Date;e.clockString=s(t.getHours(),2)+":"+s(t.getMinutes(),2)+":"+s(t.getSeconds(),2)},e.locate=function(){var n=angular.element(window).width(),a=angular.element(window).height(),i=t.width(),r=t.height(),s=t.prev().height(),o=t.parent().offset().top-angular.element(window).scrollTop(),c=a-(o+s),l=t.parent().offset().left,u=n-(l+i),d=0,g=0,h=function(e,t,n,a){return t+n>a&&(e=a-(t+n+10),-t>e&&(e=-t)),e},p=function(a){g=h(g,l,i,n),t.addClass(a).css({left:g}),e.config.position?(t.css({bottom:30}),t.find(".arrow-ic").css({left:20})):t.find(".arrow-ic").css({left:-g+20})},f=function(e){d=h(d,o,r,a),t.addClass(e).css({top:d}),t.find(".arrow-ic").css({top:-d+s/2})},m=function(e){l+i>n&&l>i?f("dtt-w-l-sty"):i/2>l&&u>i?f("dtt-w-r-sty"):p(e)},v=function(e){f(e)};if(e.config.position)switch(g=-(28-e.config.targetElement.width()/2),e.config.position){case"top":m("dtt-w-t-sty");break;case"bottom":m("dtt-w-b-sty");break;case"left":v("dtt-w-l-sty");break;case"right":v("dtt-w-r-sty")}else c>=r?m("dtt-w-b-sty"):o>=r?m("dtt-w-t-sty"):v(l>u?"dtt-w-l-sty":"dtt-w-r-sty")},e.run=function(){e.initValue=e.value;var t=e.value?new Date(e.value.replace(/-|\./g,"/")):new Date;if(!angular.isDate(t))return void console.error("oldDate is not Date Object");e.value?(e.setData(e.oldDate,t),e.clear(t,d(t,e.formatType),"init")):e.clear(t,"","init");var i=e.oldDate.getFullYear(),s=e.oldDate.getMonth(),o=e.oldDate.getDate(),c=e.oldDate.getHours(),l=e.oldDate.getMinutes();e.setSelect(i,s,c,l),e.setDay(i,s,o),n(e.locate,80),e.timeFlag&&(e.clock(),a.cancel(r.clockTimer),r.clockTimer=a(e.clock,1e3))},e.run()}]}}),module.factory("datetimeService",function(){return{}}),module.directive("pagination",function(){return{template:'<div class="page-bar" ng-show="list.length>0"><a href="javascript:;" ng-class="current<=0?\'disabled\':\'\'" ng-click="prev()"><em class="emic">&lt;</em><em class="emf">上一页</em></a><a href="javascript:;" ng-repeat="key in keyList" ng-class="key==current ? \'cur\' : \'\'" ng-click="jump(key)">{{key+1}}</a><span ng-show="pLen>pMax && !hideEllipsis">...</span><a href="javascript:;" ng-class="current>=pLen-1?\'disabled\':\'\'" ng-click="next()"><em class="emf">下一页</em><em class="emic">&gt;</em></a><span class="jump-bar"><span>共<font class="blue-c">{{pLen}}</font>页</span><span>跳到 <input type="text" style="width:38px;height:19px;text-align:center;" ng-model="goKey"> 页</span><a href="" ng-click="go(goKey)">GO</a></span></div>',restrict:"E",replace:!0,transclude:!0,scope:{list:"=list",pagefn:"=pagefn",pageargs:"=pageargs",deepwatch:"="},controller:["$scope","$element","$attrs","service",function(e,t,n,a){e.$watch("pageargs",function(t,n){t&&(e.current=parseInt(e.pageargs.pn)-1,e.pageNode=e.current,e.pNum=parseInt(e.pageargs.ps),e.pMax=parseInt(e.pageargs.pl)||5,e.pagefn(e.pageargs,function(t){e.pLen=Math.ceil(parseInt(t.pa.total)/e.pNum),e.keyListWatch()}))},e.deepwatch),e.reKeyList=function(t,n,a){e.keyList=[];for(var i=t;n>i&&!(i>=a);i++)e.hideEllipsis=i+1==e.pLen,e.keyList.push(i)},e.keyListWatch=function(){var t=e.pLen;if(t>e.pMax){var n=Math.ceil(e.pMax/2),a=e.current;a>=n&&a<t-(e.pMax-n)?e.reKeyList(a-(e.pMax-n),a+n,t):a>=t-(e.pMax-n)?e.reKeyList(t-e.pMax,t,t):n>=a&&e.reKeyList(0,t,e.pMax)}else e.reKeyList(0,t,e.pMax)},e.jump=function(t){e.pageNode!=t&&(e.current=t,e.pageNode=t,e.pageargs.pn=t+1,e.pagefn(e.pageargs,function(t){e.pLen=Math.ceil(parseInt(t.pa.total)/e.pNum),e.keyListWatch()}))},e.next=function(){e.current++,e.current>=e.pLen&&(e.current=e.pLen-1),e.jump(e.current)},e.prev=function(){e.current--,e.current<=0&&(e.current=0),e.jump(e.current)},e.go=function(t){var n=/^-?\d+$/g;void 0==t||t.length<=0?a.dialog.alert("输入不能为空！",{}):n.test(t)?(parseInt(t)>e.pLen?(t=e.pLen,a.dialog.alert("总共只有"+e.pLen+"页，为您转到最后一页！",{})):parseInt(t)<=0&&(t=1,a.dialog.alert("不能低于第1页,为您转到最前一页！",{})),e.jump(parseInt(t)-1),e.goKey=void 0):t.match(/\s+/g)?a.dialog.alert("输入不能有空格符！",{}):a.dialog.alert("格式错误，请输入整数！",{})}}]}}),module.directive("sidebar",function(){return{restrict:"E",template:'<div class="sidebar"><ul><li ng-class="sidebar.cur" ng-repeat="sidebar in sidebarList"><i ng-class="sidebar.icon"></i> <a ng-href="{{sidebar.href}}" ng-click="SetCur(sidebar)">{{sidebar.name}}</a></li></ul></div>',replace:"true",scope:{},controller:["$scope","$element","$attrs","$location","$rootScope","$timeout",function(e,t,n,a,i,r){function s(){var t=decodeURI(window.location);angular.forEach(e.sidebarList,function(e){var n=e.href;if(n){n=n.substr(2);var a=new RegExp("#/"+n,"");t.match(a)?e.cur="cur":e.cur=""}}),"#/"==t.substr(-2)&&(e.sidebarList[0].cur="cur")}switch(n.sidebarType){case"student":e.sidebarList=[{cur:"",icon:"cat-2",name:"我的课程",href:"#/myCourses"},{cur:"",icon:"cat-3",name:"我的题库",href:"#/myQuestionPool"},{cur:"",icon:"cat-7",name:"我的圈子",href:"#/myActivity/dynamic"},{cur:"",icon:"cat-5",name:"学习风格",href:"#/myKnowledge"},{cur:"",icon:"cat-11",name:"我的学分",href:"#/myScore"},{cur:"",icon:"cat-11",name:"账号信息",href:"#/myAccont"},{cur:"",icon:"cat-11",name:"教育信息",href:"#/myEdu"}];break;case"teacher":e.sidebarList=[{cur:"cur",icon:"cat-7",name:"课程管理"},{cur:"",icon:"cat-13",name:"权限管理"},{cur:"",icon:"cat-4",name:"学生管理"},{cur:"",icon:"cat-8",name:"成绩管理"},{cur:"",icon:"cat-9",name:"试卷批改"},{cur:"",icon:"cat-6",name:"账号信息"}]}e.SetCur=function(t){angular.forEach(e.sidebarList,function(e){e.cur=""}),t.cur="cur";var n=window.location.hash;r(function(){n==window.location.hash&&e.$emit("refListSidebar",window.location.hash)})},s(),i.$on("$locationChangeSuccess",function(){s()})}]}}),angular.module("RCP").directive("rate",function(){
return{template:'<style>.rate {cursor: pointer;}.rate.big img{margin-right: 6px;}</style><span class="rate {{style}}"  ng-click="setValue($event)" ng-mousemove="hover($event)" ng-mouseleave="leave()" ng-mouseenter="enter()"><img ng-src="{{star}}" alt="" ng-repeat="star in starList track by $index"></span>',restrict:"E",scope:{value:"=",disabled:"=",style:"="},controller:["$scope","$attrs","$element",function(e,t,n){var a;a="big"===e.style?{full:"img/star_big.png",none:"img/star_big_gray.png"}:{full:"img/star_17.png",half:"img/star_23.png",none:"img/star_19.png"},e.starList=[];for(var i=0;5>i;i++)e.starList.push(a.none);e.$watch("value",function(t){if(void 0!==t){if(t=+t,"NaN"==t.toString())return!1;if(t>5||0>t)return!1;var n=t;for(i=0;5>i;i++)n>i?e.starList[i]=a.full:e.starList[i]=a.none}}),e.setValue=function(t){e.previousValue=e.value},e.hover=function(t){if(!e.disabled){var a=n.offset().left,i=t.pageX,r=17,s=Math.round(i-a),o=s/r;e.value=Math.ceil(o)}},e.leave=function(){e.value=e.previousValue},e.enter=function(){e.previousValue=e.value}}]}}),module.directive("star",function(){return{restrict:"EA",replace:!0,scope:{n:"=n"},transclude:!0,template:"<span class='star'></span>",link:function(e,t,n){e.$watch("n",function(a){if(void 0!==a){n.isrcc||(n.isrcc="/imgs/star-gray.png");var i=0,r=Math.floor(e.n),s="",o=0;for(i=0;r>i;i+=1)s+="<img src='"+n.isrca+"'>",o+=1;if(e.n>r&&(s+="<img src='"+n.isrcb+"'>",o+=1),5>o)for(i=Math.ceil(e.n);5>i;i+=1)s+="<img src='"+n.isrcc+"'>";t[0].innerHTML=s}})}}}),angular.module("RCP").directive("imageSlider",function(){return{template:'<div class="image-slider"><style type="text/css">.image-slider-wrapper{padding:10px;background:#f2f2f2}.slider-action li{display:inline-block;margin-right:5px}.slider-action a{color:#999}.slider-action img{width:13px;height:13px;margin-right:4px}.slider-main{margin:10px 0;background:#fff;padding:5px;text-align:center;overflow:hidden;-ms-user-select:none;user-select:none;-webkit-user-select:none;-moz-user-select:none}.slider-main.right{cursor:url(/img/pic_next.cur),auto}.slider-main.left{cursor:url(/img/pic_prev.cur),auto}.slider-all ul{display:block;padding:0 25px;white-space:nowrap;vertical-align:middle;overflow:hidden;width:100%;word-wrap:normal}.slider-all li{display:inline-block;position:relative;-moz-transition:all .3s;-o-transition:all .3s;transition:all .3s}.slider-all .slider-images{width:45px;height:45px;padding:2px;cursor:pointer;border:2px solid transparent}.slider-all .slider-images.active{border:2px solid #6baef8}.slider-all{position:relative;overflow:hidden}.slider-all .nav-btn{display:block;position:absolute;top:0;bottom:0;padding:15px 5px;color:#bfbfbf;border:1px solid #e5e5e5;vertical-align:middle;text-decoration:none;background:#F7F7F7;z-index:10}.slider-all .nav-btn.left{left:0}.slider-all .nav-btn.right{right:0}.slider-all .nav-btn.active{color:#fff;background:#FFAD8F}.prev-list{margin-top:-5px}.prev-list li{border:none;display:inline-block;margin-right:5px;margin-top:5px}.prev-list .s-img{width:80px;height:80px;cursor:pointer}</style><ul class="prev-list" ng-hide="show"><li ng-repeat="img in images track by $index"><ng-img c="{img:img}" class="s-img" ng-click="showBigPic($index)"></ng-img></li></ul><div ng-show="show" class="image-slider-wrapper"><div class="slider-action"><ul><li><a ng-click="show=false" href="javascript:;"><i class="fa fa-long-arrow-up"></i> 收起</a></li><li><a ng-href="{{images[currentImage]}}" target="_blank"><i class="fa fa-search-plus"></i> 查看大图</a></li><li><a ng-click="turnLeft()" href="javascript:;"><i class="fa fa-undo"></i> 向左旋转</a></li><li><a ng-click="turnRight()" href="javascript:;"><i class="fa fa-repeat"></i> 向右旋转</a></li></ul></div><div class="slider-main {{cursor}}" ng-click="nextOrPrev()" ng-mousemove="showCursor($event)"><img ng-src="{{images[currentImage]}}" alt="" ng-style="{\'max-width\': bigImgWidth, \'max-height\': 325, transform: \'rotate(\' + rotateDeg() + \'deg)\',\'-webkit-transform\': \'rotate(\' + rotateDeg() + \'deg)\', \'-ms-transform\': \'rotate(\' + rotateDeg() + \'deg)\', \'-moz-transform\': \'rotate(\' + rotateDeg() + \'deg)\', transition:\'all 0.2s\'}"></div><div class="slider-all"><a href="javascript:;" ng-class="{active: showToggle(\'left\')}" ng-click="toggleSlide(\'left\')" class="nav-btn left">&lt</a><ul style="width:{{imageListWidth}}px"><li ng-repeat="img in images track by $index" style="left:{{left}}px"><ng-img c="{img:img,divClass:{active: currentImage==$index}}" ng-click="switchImg($index)" alt="" class="slider-images"></ng-img></li></ul><a href="javascript:;" ng-class="{active: showToggle(\'right\')}" ng-click="toggleSlide(\'right\')" class="nav-btn right">&gt</a></div></div></div>',restrict:"E",scope:{images:"=",loop:"="},controller:["$scope","$element","$timeout",function(e,t,n){var a=['<style id="image-slider-style">',".image-slider-wrapper {","padding: 10px;","background: #f2f2f2;","}",".slider-action li {","display: inline-block;","margin-right: 5px;","}",".slider-action a {","color: #999999;","}",".slider-action img {","width: 13px;","height: 13px;","margin-right: 4px;","}",".slider-main {","margin: 10px 0;","background: #fff;","padding: 5px;","text-align: center;","overflow: hidden;","user-select: none;","-webkit-user-select: none;","-moz-user-select: none;","}",".slider-main.right {",'cursor: url("/rcp-common/imgs/icon/pic_next.png"), auto;',"}",".slider-main.left {",'cursor: url("/rcp-common/imgs/icon/pic_prev.png"), auto;',"}",".slider-all ul {","display: inline-block;","white-space: nowrap;","vertical-align: middle;","overflow: hidden;","}",".slider-all li {","display: inline-block;","position: relative;","transition: all 0.3s;","}",".slider-all .slider-images {","width: 45px;","height: 45px;","padding: 2px;","cursor: pointer;","border: 2px solid rgba(0,0,0,0);","}",".slider-all .slider-images.active {","border: 2px solid #6baef8;","}",".slider-all .nav-btn {","display: inline-block;","padding: 15px 5px;","color: #bfbfbf;","border: 1px solid #e5e5e5;","vertical-align: middle;","text-decoration: none;","background: #F7F7F7;","}",".slider-all .nav-btn.active {","color: #fff;","background: #FFAD8F;","}",".prev-list li {","border: none;","display: inline-block;","margin-right: 5px;","}",".prev-list .s-img {","width: 80px;","height: 80px;","cursor: pointer;","}","</style>"].join("");angular.element("#image-slider-style").length||angular.element("body").append(a),e.turnLeftCount=e.turnRightCount=0,e.imageListWidth=0,e.bigImgWidth=0,e.bigImgOffset={top:0,left:0},e.$watch("show",function(a){a&&(e.wrapperWidth=t.find(".image-slider").width(),e.bigImgWidth=e.wrapperWidth-20,e.imageListWidth=e.wrapperWidth-76,n(function(){e.bigImgOffset=t.find(".slider-main").offset()},100))}),e.showBigPic=function(t){e.show=!0,e.switchImg(t)},e.switchImg=function(t){e.currentImage=t,e.turnLeftCount=e.turnRightCount=0},e.showCursor=function(t){if(e.images){if(e.images.length<2)return void(e.cursor="");var n=t.pageX-e.bigImgOffset.left;n>e.bigImgWidth/2?e.loop||e.currentImage<e.images.length-1?e.cursor="right":e.cursor="":e.loop||e.currentImage>0?e.cursor="left":e.cursor=""}},e.nextOrPrev=function(){e.images&&("left"===e.cursor?e.loop&&0===e.currentImage?e.switchImg(e.images.length-1):e.switchImg(e.currentImage-1):"right"===e.cursor&&(e.loop&&e.currentImage===e.images.length-1?e.switchImg(0):e.switchImg(e.currentImage+1)))},e.turnLeft=function(){e.turnLeftCount=e.turnLeftCount+1},e.turnRight=function(){e.turnRightCount=e.turnRightCount+1},e.rotateDeg=function(){return 90*(e.turnRightCount-e.turnLeftCount)},e.left=0,e.showToggle=function(t){if(e.images){var n=58;return"right"===t?n*e.images.length+e.left>e.imageListWidth:"left"===t?e.left<0:void 0}},e.toggleSlide=function(t){"right"===t&&e.showToggle(t)?e.left=e.left-e.imageListWidth:"left"===t&&e.showToggle(t)&&(e.left=e.left+e.imageListWidth)}}]}}),!module)var module=angular.module("RCP",[]);module.filter("sanitize",["$sce",function(e){return function(t){return e.trustAsHtml(t)}}]),module.directive("studyCircle",function(){return{template:'<div class="study-circle"><div class=""><h3 class="content-section-head">圈子</h3><div class="content-section-body"><div class="no-data" ng-hide="hasData">暂无圈子</div><div ng-show="hasData"><ul class="circle-detail"><li class="inline" ng-repeat="c in circleList"><div class="user-info"><img ng-src="{{ usrList[c.root.ownerId].attrs.basic.avatar || \'../study-circle/imgs/d-face-1.png\'}}" alt=""><p class="text-hide" ng-bind="usrList[c.root.ownerId].attrs.basic.nickName"></p></div><div class="detail"><a ng-href="{{toDetailCircle}}" ng-click="toDetail(c)" target="_blank" style="color:#a6a6a6"><div ng-bind-html="c.root.content | sanitize"></div></a><div ng-bind="c.root.createTime| date:\'MM-dd HH:mm\'">00-00 00:00</div><image-slider images="c.root.files.IMG" class="self-image-slider"></image-slider><p class="desc"><span class="last-comment text-hide" ng-show="c.replys.length" ng-bind="usrList[c.replys[0].ownerId].usr[0]+\' 最后回复于 \'+(c.replys[0].createTime| date:\'MM-dd HH:mm\')">最后回复于 00-00 00:00</span> <span class="vote"><button ng-click="sendLike(c.root,$event)"><i class="fa fa-thumbs-o-up" ng-show="c.root.isLiked" style="color:#fe8811"></i> <i class="fa fa-thumbs-o-up" ng-hide="c.root.isLiked"></i> <span ng-bind="c.root.count.likeCount">0</span></button> <a ng-href="{{toDetailCircle}}" ng-click="toDetail(c)" target="_blank"><i class="fa fa-commenting-o"></i> <span ng-bind="c.root.count.replyCount">0</span></a></span></p></div></li></ul><div class="more-comment" ng-hide="c.showTotal"><a ng-href="{{toTotalCircle}}" target="_blank">查看全部圈子 &gt;</a></div><div ng-show="c.showTotal"><pagination class="study-circle-pagination" list="circleList" pageargs="pageargs" pagefn="pagefn"></pagination></div></div></div></div></div>',restrict:"E",replace:!0,transclude:!0,scope:{c:"="},controller:["$scope","$timeout","$http","service","$location",function(e,t,n,a,i){try{e.pageargs={pn:1,ps:8,pl:5},e.pagefn=function(t,n){e.getCircleList(n)},e.hasData=!1,e.curToken=rcpAid.getToken(),e.init=function(){e.circle={content:"",exceed:"",isSecret:1,nowSection:""},e.circleList=[],e.usrList={},e.c&&e.c.rUrl?"/"!==e.c.rUrl[e.c.rUrl.length-1]&&(e.c.rUrl+="/"):console.log("无配置文件！"),e.getCircleList(),e.toTotalCircle=rcpAid.getUrl("全部圈子",{cid:e.c.cid,type:e.c.type,token:e.curToken})},e.getCircleList=function(t){console.log(e.c.type+" uuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuu");var n={k:".",mode:1,page:e.pageargs.pn,pageCount:e.pageargs.ps,reviewReplyCount:1,reviewSort:-1,owners:[{OwnerId:e.c.cid,OwnerType:e.c.type}],sort:-1};a.studyCircle.getCircleList({},{data:angular.toJson(n)}).then(function(a){console.log(a),e.circleList=a.data.discuss,e.usrList=a.data.usr,e.circleList&&e.circleList.length&&!e.usrList&&alert("返回数据有误"),a.data.allCount?e.hasData=!0:e.hasData=!1,"function"==typeof t&&(console.log(a.data.allCount),n.pa={total:a.data.allCount,pn:e.pageargs.pn,ps:e.pageargs.ps},t(n))},function(e){console.log(e)})},e.send=function(t,n){var i={acl:{ALL:+e.circle.isSecret},atUsers:[],category:e.c.category||"10",coin:0,content:e.circle.content,desc:"",files:{FILE:[],IMG:[],VIDEO:[]},level:0,ownerType:"10",pOwnerId:"",pOwnerType:"",pid:"",scopes:[{OwnerId:e.c.cid,OwnerType:e.c.type}],tags:[],title:"",type:t};switch(t){case"10":if(!i.content)return void a.dialog.alert("请先输入内容！");e.load.sendCircle=!0,i.needData=!0;break;case"20":if(!n.replyContent)return void a.dialog.alert("请先输入内容！");n.sendReply=!0,i.needData=!0,i.content=n.replyContent,i.pOwnerId=n.ownerId,i.pOwnerType=e.c.pOwnerType||"10",i.pid=n._id;break;case"30":n.sendLike=!0,i.pOwnerId=n.ownerId,i.pOwnerType=e.c.pOwnerType||"10",i.pid=n._id}a.studyCircle.sendCircle({token:rcpAid.getToken()},{data:angular.toJson(i)}).then(function(a){switch(console.log(a),t){case"10":e.circle.content="",e.load.sendCircle=!1,e.circleList.unshift(a.data.discuss[0]),angular.extend(e.usrList,a.data.usr);break;case"20":n.sendReply=!1,e.getCircleList();break;case"30":n.sendLike=!1,n.count.likeCount=+n.count.likeCount+1,n.isLiked=!0}},function(i){switch(console.log(i),t){case"10":e.load.sendCircle=!1;break;case"20":n.sendReply=!1;break;case"30":n.sendLike=!1,1003===i.data.data.code&&a.dialog.alert("您已点过赞！")}})},e.cancle=function(e){var t={ownerType:10,type:30,parentId:e._id};a.studyCircle.removeDiscuss(t).then(function(){e.isLiked=!1,e.count.likeCount=+e.count.likeCount-1,a.dialog.alert("取消点赞成功")},function(e){a.dialog.alert("取消点赞失败"),console.error(e)})},e.setReadCount=function(e,t){var n={id:e};a.studyCircle.setReadCount(n).then(function(e){console.log(e)},function(e){console.log(e)})},e.toDetail=function(t){t.root._id&&e.setReadCount(t.root._id),e.toDetailCircle=rcpAid.getUrl("圈子详情",{id:t.root._id,token:rcpAid.getToken()})},e.sendLike=function(t,n){return e.curToken?(console.log(t),n.stopPropagation(),t.isLiked?void e.cancle(t):void(t.sendLike||e.send("30",t))):void a.common.toLogin()},e.$watch("c",e.init,!0)}catch(r){console.log(r)}}]}}),module.factory("studyCircle",["request",function(e){var t=DYCONFIG.studyCircle.rUrl||"/";return{sendCircle:function(n,a){n.token=rcpAid.getToken();var i={method:"POST",url:t+"usr/api/createDiscuss",params:n};return e(angular.extend(i,a||{}))},getCircleList:function(n,a){n.token=rcpAid.getToken();var i={method:"POST",url:t+"pub/api/searchDiscuss",params:n};return e(angular.extend(i,a||{}))},getCircleDetail:function(n,a){n.token=rcpAid.getToken();var i={method:"GET",url:t+"pub/api/getCDetail",params:n};return e(angular.extend(i,a||{}))},setReadCount:function(n,a){n.token=rcpAid.getToken();var i={method:"GET",url:t+"pub/api/statRead",params:n};return e(angular.extend(i,a||{}))},getPersonDiscuss:function(n,a){n.token=rcpAid.getToken();var i={method:"GET",url:t+"pub/api/personDiscuss",params:n};return e(angular.extend(i,a||{}))},removeDiscuss:function(n,a){n.token=rcpAid.getToken();var i={method:"GET",url:t+"usr/api/delDiscuss",params:n};return e(angular.extend(i,a||{}))},getPersonReply:function(n,a){n.token=rcpAid.getToken();var i={method:"GET",url:t+"pub/api/personReply",params:n};return e(angular.extend(i,a||{}))}}}]),module.run(["service","studyCircle",function(e,t){e.expand("studyCircle",function(){return t})}]);