!function(e){"function"==typeof define&&define.amd?define(["jquery"],e):e("object"==typeof exports?require("jquery"):jQuery)}(function(e){"use strict";function t(e){return"number"==typeof e&&!isNaN(e)}function i(e){return"undefined"==typeof e}function a(e,i){var a=[];return t(i)&&a.push(i),a.slice.apply(e,a)}function n(e,t){var i=a(arguments,2);return function(){return e.apply(t,i.concat(a(arguments)))}}function s(e){var t=e.match(/^(https?:)\/\/([^\:\/\?#]+):?(\d*)/i);return t&&(t[1]!==g.protocol||t[2]!==g.hostname||t[3]!==g.port)}function o(e){var t="timestamp="+(new Date).getTime();return e+(-1===e.indexOf("?")?"?":"&")+t}function r(e){var t,i=e.naturalWidth,a=e.naturalHeight;return i||(t=new Image,t.src=e.src,i=t.width,a=t.height),{naturalWidth:i,naturalHeight:a,aspectRatio:i/a}}function c(e){var i=[],a=e.rotate,n=e.scaleX,s=e.scaleY;return t(a)&&i.push("rotate("+a+"deg)"),t(n)&&t(s)&&i.push("scale("+n+","+s+")"),i.length?i.join(" "):"none"}function l(e,t){var i,a,n=ne(e.degree)%180,s=(n>90?180-n:n)*Math.PI/180,o=se(s),r=oe(s),c=e.width,l=e.height,d=e.aspectRatio;return t?(i=c/(r+o/d),a=i/d):(i=c*r+l*o,a=c*o+l*r),{width:i,height:a}}function d(i,a){var n,s,o,r=e("<canvas>")[0],c=r.getContext("2d"),d=0,u=0,p=a.naturalWidth,h=a.naturalHeight,g=a.rotate,m=a.scaleX,f=a.scaleY,v=t(m)&&t(f)&&(1!==m||1!==f),y=t(g)&&0!==g,w=y||v,x=p,b=h;return v&&(n=p/2,s=h/2),y&&(o=l({width:p,height:h,degree:g}),x=o.width,b=o.height,n=o.width/2,s=o.height/2),r.width=x,r.height=b,w&&(d=-p/2,u=-h/2,c.save(),c.translate(n,s)),y&&c.rotate(g*Math.PI/180),v&&c.scale(m,f),c.drawImage(i,d,u,p,h),w&&c.restore(),r}function u(t,i){this.$element=e(t),this.options=e.extend({},u.DEFAULTS,e.isPlainObject(i)&&i),this.ready=!1,this.built=!1,this.complete=!1,this.rotated=!1,this.cropped=!1,this.disabled=!1,this.replaced=!1,this.isImg=!1,this.originalUrl="",this.canvas=null,this.cropBox=null,this.init()}var p=e(window),h=e(document),g=window.location,m="cropper",f="preview."+m,v="cropper-modal",y="cropper-hide",w="cropper-hidden",x="cropper-invisible",b="cropper-move",k="cropper-crop",$="cropper-disabled",_="cropper-bg",C="mousedown touchstart pointerdown MSPointerDown",I="mousemove touchmove pointermove MSPointerMove",T="mouseup touchend touchcancel pointerup pointercancel MSPointerUp MSPointerCancel",D="wheel mousewheel DOMMouseScroll",S="dblclick",L="load."+m,M="error."+m,E="resize."+m,A="build."+m,F="built."+m,U="cropstart."+m,Y="cropmove."+m,O="cropend."+m,P="crop."+m,G="zoom."+m,j=/^(e|w|s|n|se|sw|ne|nw|all|crop|move|zoom)$/,W="e",N="w",H="s",z="n",R="se",B="sw",q="ne",K="nw",V="all",X="crop",Z="move",J="zoom",Q="none",ee=e.isFunction(e("<canvas>")[0].getContext),te=Math.sqrt,ie=Math.min,ae=Math.max,ne=Math.abs,se=Math.sin,oe=Math.cos,re=parseFloat,ce={};e.extend(ce,{init:function(){var e,t=this.$element;if(t.is("img")){if(this.isImg=!0,this.originalUrl=e=t.attr("src"),!e)return;e=t.prop("src")}else t.is("canvas")&&ee&&(e=t[0].toDataURL());this.load(e)},trigger:function(t,i){var a=e.Event(t,i);return this.$element.trigger(a),a.isDefaultPrevented()},load:function(t){var i,a,n=this.options,r=this.$element,c="";t&&(this.url=t,r.one(A,n.build),this.trigger(A)||(n.checkImageOrigin&&s(t)&&(c=' crossOrigin="anonymous"',r.prop("crossOrigin")||(i=o(t))),this.$clone=a=e("<img"+c+' src="'+(i||t)+'">'),this.isImg?r[0].complete?this.start():r.one(L,e.proxy(this.start,this)):a.one(L,e.proxy(this.start,this)).one(M,e.proxy(this.stop,this)).addClass(y).insertAfter(r)))},start:function(){this.image=r(this.isImg?this.$element[0]:this.$clone[0]),this.ready=!0,this.build()},stop:function(){this.$clone.remove(),this.$clone=null}}),e.extend(ce,{build:function(){var t,i,a,n=this.options,s=this.$element,o=this.$clone;this.ready&&(this.built&&this.unbuild(),this.$container=s.parent(),this.$cropper=t=e(u.TEMPLATE),this.$canvas=t.find(".cropper-canvas").append(o),this.$dragBox=t.find(".cropper-drag-box"),this.$cropBox=i=t.find(".cropper-crop-box"),this.$viewBox=t.find(".cropper-view-box"),this.$face=a=i.find(".cropper-face"),s.addClass(w).after(t),this.isImg||o.removeClass(y),this.initPreview(),this.bind(),n.aspectRatio=re(n.aspectRatio)||NaN,n.autoCrop?(this.cropped=!0,n.modal&&this.$dragBox.addClass(v)):i.addClass(w),n.guides||i.find(".cropper-dashed").addClass(w),n.center||i.find(".cropper-center").addClass(w),n.cropBoxMovable&&a.addClass(b).data("action",V),n.highlight||a.addClass(x),n.background&&t.addClass(_),n.cropBoxResizable||i.find(".cropper-line, .cropper-point").addClass(w),this.setDragMode(n.dragCrop?X:n.movable?Z:Q),this.render(),this.built=!0,this.setData(n.data),s.one(F,n.built),setTimeout(e.proxy(function(){this.trigger(F),this.complete=!0},this),0))},unbuild:function(){this.built&&(this.built=!1,this.initialImage=null,this.initialCanvas=null,this.initialCropBox=null,this.container=null,this.canvas=null,this.cropBox=null,this.unbind(),this.resetPreview(),this.$preview=null,this.$viewBox=null,this.$cropBox=null,this.$dragBox=null,this.$canvas=null,this.$container=null,this.$cropper.remove(),this.$cropper=null)}}),e.extend(ce,{render:function(){this.initContainer(),this.initCanvas(),this.initCropBox(),this.renderCanvas(),this.cropped&&this.renderCropBox()},initContainer:function(){var e=this.options,t=this.$element,i=this.$container,a=this.$cropper;a.addClass(w),t.removeClass(w),a.css(this.container={width:ae(i.width(),re(e.minContainerWidth)||200),height:ae(i.height(),re(e.minContainerHeight)||100)}),t.addClass(w),a.removeClass(w)},initCanvas:function(){var t=this.container,i=t.width,a=t.height,n=this.image,s=n.aspectRatio,o={aspectRatio:s,width:i,height:a};a*s>i?o.height=i/s:o.width=a*s,o.oldLeft=o.left=(i-o.width)/2,o.oldTop=o.top=(a-o.height)/2,this.canvas=o,this.limitCanvas(!0,!0),this.initialImage=e.extend({},n),this.initialCanvas=e.extend({},o)},limitCanvas:function(t,i){var a,n,s=this.options,o=s.strict,r=this.container,c=r.width,l=r.height,d=this.canvas,u=d.aspectRatio,p=this.cropBox,h=this.cropped&&p,g=this.initialCanvas||d,m=g.width,f=g.height;t&&(a=re(s.minCanvasWidth)||0,n=re(s.minCanvasHeight)||0,a?(o&&(a=ae(h?p.width:m,a)),n=a/u):n?(o&&(n=ae(h?p.height:f,n)),a=n*u):o&&(h?(a=p.width,n=p.height,n*u>a?a=n*u:n=a/u):(a=m,n=f)),e.extend(d,{minWidth:a,minHeight:n,maxWidth:1/0,maxHeight:1/0})),i&&(o?h?(d.minLeft=ie(p.left,p.left+p.width-d.width),d.minTop=ie(p.top,p.top+p.height-d.height),d.maxLeft=p.left,d.maxTop=p.top):(d.minLeft=ie(0,c-d.width),d.minTop=ie(0,l-d.height),d.maxLeft=ae(0,c-d.width),d.maxTop=ae(0,l-d.height)):(d.minLeft=-d.width,d.minTop=-d.height,d.maxLeft=c,d.maxTop=l))},renderCanvas:function(e){var t,i,a=this.options,n=this.canvas,s=this.image;this.rotated&&(this.rotated=!1,i=l({width:s.width,height:s.height,degree:s.rotate}),t=i.width/i.height,t!==n.aspectRatio&&(n.left-=(i.width-n.width)/2,n.top-=(i.height-n.height)/2,n.width=i.width,n.height=i.height,n.aspectRatio=t,this.limitCanvas(!0,!1))),(n.width>n.maxWidth||n.width<n.minWidth)&&(n.left=n.oldLeft),(n.height>n.maxHeight||n.height<n.minHeight)&&(n.top=n.oldTop),n.width=ie(ae(n.width,n.minWidth),n.maxWidth),n.height=ie(ae(n.height,n.minHeight),n.maxHeight),this.limitCanvas(!1,!0),n.oldLeft=n.left=ie(ae(n.left,n.minLeft),n.maxLeft),n.oldTop=n.top=ie(ae(n.top,n.minTop),n.maxTop),this.$canvas.css({width:n.width,height:n.height,left:n.left,top:n.top}),this.renderImage(),this.cropped&&a.strict&&this.limitCropBox(!0,!0),e&&this.output()},renderImage:function(t){var i,a=this.canvas,n=this.image;n.rotate&&(i=l({width:a.width,height:a.height,degree:n.rotate,aspectRatio:n.aspectRatio},!0)),e.extend(n,i?{width:i.width,height:i.height,left:(a.width-i.width)/2,top:(a.height-i.height)/2}:{width:a.width,height:a.height,left:0,top:0}),this.$clone.css({width:n.width,height:n.height,marginLeft:n.left,marginTop:n.top,transform:c(n)}),t&&this.output()},initCropBox:function(){var t=this.options,i=this.canvas,a=t.aspectRatio,n=re(t.autoCropArea)||.8,s={width:i.width,height:i.height};a&&(i.height*a>i.width?s.height=s.width/a:s.width=s.height*a),this.cropBox=s,this.limitCropBox(!0,!0),s.width=ie(ae(s.width,s.minWidth),s.maxWidth),s.height=ie(ae(s.height,s.minHeight),s.maxHeight),s.width=ae(s.minWidth,s.width*n),s.height=ae(s.minHeight,s.height*n),s.oldLeft=s.left=i.left+(i.width-s.width)/2,s.oldTop=s.top=i.top+(i.height-s.height)/2,this.initialCropBox=e.extend({},s)},limitCropBox:function(e,t){var i,a,n=this.options,s=n.strict,o=this.container,r=o.width,c=o.height,l=this.canvas,d=this.cropBox,u=n.aspectRatio;e&&(i=re(n.minCropBoxWidth)||0,a=re(n.minCropBoxHeight)||0,d.minWidth=ie(r,i),d.minHeight=ie(c,a),d.maxWidth=ie(r,s?l.width:r),d.maxHeight=ie(c,s?l.height:c),u&&(d.maxHeight*u>d.maxWidth?(d.minHeight=d.minWidth/u,d.maxHeight=d.maxWidth/u):(d.minWidth=d.minHeight*u,d.maxWidth=d.maxHeight*u)),d.minWidth=ie(d.maxWidth,d.minWidth),d.minHeight=ie(d.maxHeight,d.minHeight)),t&&(s?(d.minLeft=ae(0,l.left),d.minTop=ae(0,l.top),d.maxLeft=ie(r,l.left+l.width)-d.width,d.maxTop=ie(c,l.top+l.height)-d.height):(d.minLeft=0,d.minTop=0,d.maxLeft=r-d.width,d.maxTop=c-d.height))},renderCropBox:function(){var e=this.options,t=this.container,i=t.width,a=t.height,n=this.cropBox;(n.width>n.maxWidth||n.width<n.minWidth)&&(n.left=n.oldLeft),(n.height>n.maxHeight||n.height<n.minHeight)&&(n.top=n.oldTop),n.width=ie(ae(n.width,n.minWidth),n.maxWidth),n.height=ie(ae(n.height,n.minHeight),n.maxHeight),this.limitCropBox(!1,!0),n.oldLeft=n.left=ie(ae(n.left,n.minLeft),n.maxLeft),n.oldTop=n.top=ie(ae(n.top,n.minTop),n.maxTop),e.movable&&e.cropBoxMovable&&this.$face.data("action",n.width===i&&n.height===a?Z:V),this.$cropBox.css({width:n.width,height:n.height,left:n.left,top:n.top}),this.cropped&&e.strict&&this.limitCanvas(!0,!0),this.disabled||this.output()},output:function(){this.preview(),this.complete?this.trigger(P,this.getData()):this.built||this.$element.one(F,e.proxy(function(){this.trigger(P,this.getData())},this))}}),e.extend(ce,{initPreview:function(){var t=this.url;this.$preview=e(this.options.preview),this.$viewBox.html('<img src="'+t+'">'),this.$preview.each(function(){var i=e(this);i.data(f,{width:i.width(),height:i.height(),original:i.html()}),i.html('<img src="'+t+'" style="display:block;width:100%;min-width:0!important;min-height:0!important;max-width:none!important;max-height:none!important;image-orientation:0deg!important">')})},resetPreview:function(){this.$preview.each(function(){var t=e(this);t.html(t.data(f).original).removeData(f)})},preview:function(){var t=this.image,i=this.canvas,a=this.cropBox,n=t.width,s=t.height,o=a.left-i.left-t.left,r=a.top-i.top-t.top;this.cropped&&!this.disabled&&(this.$viewBox.find("img").css({width:n,height:s,marginLeft:-o,marginTop:-r,transform:c(t)}),this.$preview.each(function(){var i=e(this),l=i.data(f),d=l.width/a.width,u=l.width,p=a.height*d;p>l.height&&(d=l.height/a.height,u=a.width*d,p=l.height),i.width(u).height(p).find("img").css({width:n*d,height:s*d,marginLeft:-o*d,marginTop:-r*d,transform:c(t)})}))}}),e.extend(ce,{bind:function(){var t=this.options,i=this.$element,a=this.$cropper;e.isFunction(t.cropstart)&&i.on(U,t.cropstart),e.isFunction(t.cropmove)&&i.on(Y,t.cropmove),e.isFunction(t.cropend)&&i.on(O,t.cropend),e.isFunction(t.crop)&&i.on(P,t.crop),e.isFunction(t.zoom)&&i.on(G,t.zoom),a.on(C,e.proxy(this.cropStart,this)),t.zoomable&&t.mouseWheelZoom&&a.on(D,e.proxy(this.wheel,this)),t.doubleClickToggle&&a.on(S,e.proxy(this.dblclick,this)),h.on(I,this._cropMove=n(this.cropMove,this)).on(T,this._cropEnd=n(this.cropEnd,this)),t.responsive&&p.on(E,this._resize=n(this.resize,this))},unbind:function(){var t=this.options,i=this.$element,a=this.$cropper;e.isFunction(t.cropstart)&&i.off(U,t.cropstart),e.isFunction(t.cropmove)&&i.off(Y,t.cropmove),e.isFunction(t.cropend)&&i.off(O,t.cropend),e.isFunction(t.crop)&&i.off(P,t.crop),e.isFunction(t.zoom)&&i.off(G,t.zoom),a.off(C,this.cropStart),t.zoomable&&t.mouseWheelZoom&&a.off(D,this.wheel),t.doubleClickToggle&&a.off(S,this.dblclick),h.off(I,this._cropMove).off(T,this._cropEnd),t.responsive&&p.off(E,this._resize)}}),e.extend(ce,{resize:function(){var t,i,a,n=this.$container,s=this.container;!this.disabled&&s&&(a=n.width()/s.width,1===a&&n.height()===s.height||(t=this.getCanvasData(),i=this.getCropBoxData(),this.render(),this.setCanvasData(e.each(t,function(e,i){t[e]=i*a})),this.setCropBoxData(e.each(i,function(e,t){i[e]=t*a}))))},dblclick:function(){this.disabled||(this.$dragBox.hasClass(k)?this.setDragMode(Z):this.setDragMode(X))},wheel:function(e){var t=e.originalEvent,i=t,a=re(this.options.wheelZoomRatio)||.1,n=1;this.disabled||(e.preventDefault(),i.deltaY?n=i.deltaY>0?1:-1:i.wheelDelta?n=-i.wheelDelta/120:i.detail&&(n=i.detail>0?1:-1),this.zoom(-n*a,t))},cropStart:function(t){var i,a,n=this.options,s=t.originalEvent,o=s&&s.touches,r=t;if(!this.disabled){if(o){if(i=o.length,i>1){if(!n.zoomable||!n.touchDragZoom||2!==i)return;r=o[1],this.startX2=r.pageX,this.startY2=r.pageY,a=J}r=o[0]}if(a=a||e(r.target).data("action"),j.test(a)){if(this.trigger(U,{originalEvent:s,action:a}))return;t.preventDefault(),this.action=a,this.cropping=!1,this.startX=r.pageX||s&&s.pageX,this.startY=r.pageY||s&&s.pageY,a===X&&(this.cropping=!0,this.$dragBox.addClass(v))}}},cropMove:function(e){var t,i=this.options,a=e.originalEvent,n=a&&a.touches,s=e,o=this.action;if(!this.disabled){if(n){if(t=n.length,t>1){if(!i.zoomable||!i.touchDragZoom||2!==t)return;s=n[1],this.endX2=s.pageX,this.endY2=s.pageY}s=n[0]}if(o){if(this.trigger(Y,{originalEvent:a,action:o}))return;e.preventDefault(),this.endX=s.pageX||a&&a.pageX,this.endY=s.pageY||a&&a.pageY,this.change(s.shiftKey,o===J?a:null)}}},cropEnd:function(e){var t=e.originalEvent,i=this.action;this.disabled||i&&(e.preventDefault(),this.cropping&&(this.cropping=!1,this.$dragBox.toggleClass(v,this.cropped&&this.options.modal)),this.action="",this.trigger(O,{originalEvent:t,action:i}))}}),e.extend(ce,{change:function(e,t){var i,a,n=this.options,s=n.aspectRatio,o=this.action,r=this.container,c=this.canvas,l=this.cropBox,d=l.width,u=l.height,p=l.left,h=l.top,g=p+d,m=h+u,f=0,v=0,y=r.width,x=r.height,b=!0;switch(!s&&e&&(s=d&&u?d/u:1),n.strict&&(f=l.minLeft,v=l.minTop,y=f+ie(r.width,c.width),x=v+ie(r.height,c.height)),a={x:this.endX-this.startX,y:this.endY-this.startY},s&&(a.X=a.y*s,a.Y=a.x/s),o){case V:p+=a.x,h+=a.y;break;case W:if(a.x>=0&&(g>=y||s&&(v>=h||m>=x))){b=!1;break}d+=a.x,s&&(u=d/s,h-=a.Y/2),0>d&&(o=N,d=0);break;case z:if(a.y<=0&&(v>=h||s&&(f>=p||g>=y))){b=!1;break}u-=a.y,h+=a.y,s&&(d=u*s,p+=a.X/2),0>u&&(o=H,u=0);break;case N:if(a.x<=0&&(f>=p||s&&(v>=h||m>=x))){b=!1;break}d-=a.x,p+=a.x,s&&(u=d/s,h+=a.Y/2),0>d&&(o=W,d=0);break;case H:if(a.y>=0&&(m>=x||s&&(f>=p||g>=y))){b=!1;break}u+=a.y,s&&(d=u*s,p-=a.X/2),0>u&&(o=z,u=0);break;case q:if(s){if(a.y<=0&&(v>=h||g>=y)){b=!1;break}u-=a.y,h+=a.y,d=u*s}else a.x>=0?y>g?d+=a.x:a.y<=0&&v>=h&&(b=!1):d+=a.x,a.y<=0?h>v&&(u-=a.y,h+=a.y):(u-=a.y,h+=a.y);0>d&&0>u?(o=B,u=0,d=0):0>d?(o=K,d=0):0>u&&(o=R,u=0);break;case K:if(s){if(a.y<=0&&(v>=h||f>=p)){b=!1;break}u-=a.y,h+=a.y,d=u*s,p+=a.X}else a.x<=0?p>f?(d-=a.x,p+=a.x):a.y<=0&&v>=h&&(b=!1):(d-=a.x,p+=a.x),a.y<=0?h>v&&(u-=a.y,h+=a.y):(u-=a.y,h+=a.y);0>d&&0>u?(o=R,u=0,d=0):0>d?(o=q,d=0):0>u&&(o=B,u=0);break;case B:if(s){if(a.x<=0&&(f>=p||m>=x)){b=!1;break}d-=a.x,p+=a.x,u=d/s}else a.x<=0?p>f?(d-=a.x,p+=a.x):a.y>=0&&m>=x&&(b=!1):(d-=a.x,p+=a.x),a.y>=0?x>m&&(u+=a.y):u+=a.y;0>d&&0>u?(o=q,u=0,d=0):0>d?(o=R,d=0):0>u&&(o=K,u=0);break;case R:if(s){if(a.x>=0&&(g>=y||m>=x)){b=!1;break}d+=a.x,u=d/s}else a.x>=0?y>g?d+=a.x:a.y>=0&&m>=x&&(b=!1):d+=a.x,a.y>=0?x>m&&(u+=a.y):u+=a.y;0>d&&0>u?(o=K,u=0,d=0):0>d?(o=B,d=0):0>u&&(o=q,u=0);break;case Z:c.left+=a.x,c.top+=a.y,this.renderCanvas(!0),b=!1;break;case J:this.zoom(function(e,t,i,a){var n=te(e*e+t*t),s=te(i*i+a*a);return(s-n)/n}(ne(this.startX-this.startX2),ne(this.startY-this.startY2),ne(this.endX-this.endX2),ne(this.endY-this.endY2)),t),this.startX2=this.endX2,this.startY2=this.endY2,b=!1;break;case X:a.x&&a.y&&(i=this.$cropper.offset(),p=this.startX-i.left,h=this.startY-i.top,d=l.minWidth,u=l.minHeight,a.x>0?a.y>0?o=R:(o=q,h-=u):a.y>0?(o=B,p-=d):(o=K,p-=d,h-=u),this.cropped||(this.cropped=!0,this.$cropBox.removeClass(w)))}b&&(l.width=d,l.height=u,l.left=p,l.top=h,this.action=o,this.renderCropBox()),this.startX=this.endX,this.startY=this.endY}}),e.extend(ce,{crop:function(){this.built&&!this.disabled&&(this.cropped||(this.cropped=!0,this.limitCropBox(!0,!0),this.options.modal&&this.$dragBox.addClass(v),this.$cropBox.removeClass(w)),this.setCropBoxData(this.initialCropBox))},reset:function(){this.built&&!this.disabled&&(this.image=e.extend({},this.initialImage),this.canvas=e.extend({},this.initialCanvas),this.cropBox=e.extend({},this.initialCropBox),this.renderCanvas(),this.cropped&&this.renderCropBox())},clear:function(){this.cropped&&!this.disabled&&(e.extend(this.cropBox,{left:0,top:0,width:0,height:0}),this.cropped=!1,this.renderCropBox(),this.limitCanvas(),this.renderCanvas(),this.$dragBox.removeClass(v),this.$cropBox.addClass(w))},replace:function(e){!this.disabled&&e&&(this.isImg&&this.$element.attr("src",e),this.options.data=null,this.load(e))},enable:function(){this.built&&(this.disabled=!1,this.$cropper.removeClass($))},disable:function(){this.built&&(this.disabled=!0,this.$cropper.addClass($))},destroy:function(){var e=this.$element;this.ready?(this.isImg&&e.attr("src",this.originalUrl),this.unbuild(),e.removeClass(w)):this.isImg?e.off(L,this.start):this.$clone&&this.$clone.remove(),e.removeData(m)},move:function(e,a){var n=this.canvas;i(a)&&(a=e),e=re(e),a=re(a),this.built&&!this.disabled&&this.options.movable&&(n.left+=t(e)?e:0,n.top+=t(a)?a:0,this.renderCanvas(!0))},zoom:function(e,t){var i,a,n=this.canvas;if(e=re(e),e&&this.built&&!this.disabled&&this.options.zoomable){if(this.trigger(G,{originalEvent:t,ratio:e}))return;e=0>e?1/(1-e):1+e,i=n.width*e,a=n.height*e,n.left-=(i-n.width)/2,n.top-=(a-n.height)/2,n.width=i,n.height=a,this.renderCanvas(!0),this.setDragMode(Z)}},rotate:function(e){var t=this.image,i=t.rotate||0;e=re(e)||0,this.built&&!this.disabled&&this.options.rotatable&&(t.rotate=(i+e)%360,this.rotated=!0,this.renderCanvas(!0))},scale:function(e,a){var n=this.image;i(a)&&(a=e),e=re(e),a=re(a),this.built&&!this.disabled&&this.options.scalable&&(n.scaleX=t(e)?e:1,n.scaleY=t(a)?a:1,this.renderImage(!0))},getData:function(t){var i,a,n=this.options,s=this.image,o=this.canvas,r=this.cropBox;return this.built&&this.cropped?(a={x:r.left-o.left,y:r.top-o.top,width:r.width,height:r.height},i=s.width/s.naturalWidth,e.each(a,function(e,n){n/=i,a[e]=t?Math.round(n):n})):a={x:0,y:0,width:0,height:0},n.rotatable&&(a.rotate=s.rotate||0),n.scalable&&(a.scaleX=s.scaleX||1,a.scaleY=s.scaleY||1),a},setData:function(i){var a,n=this.image,s=this.canvas,o={};e.isFunction(i)&&(i=i.call(this.$element)),this.built&&!this.disabled&&e.isPlainObject(i)&&(t(i.rotate)&&i.rotate!==n.rotate&&this.options.rotatable&&(n.rotate=i.rotate,this.rotated=!0,this.renderCanvas(!0)),a=n.width/n.naturalWidth,t(i.x)&&(o.left=i.x*a+s.left),t(i.y)&&(o.top=i.y*a+s.top),t(i.width)&&(o.width=i.width*a),t(i.height)&&(o.height=i.height*a),this.setCropBoxData(o))},getContainerData:function(){return this.built?this.container:{}},getImageData:function(){return this.ready?this.image:{}},getCanvasData:function(){var e,t=this.canvas;return this.built&&(e={left:t.left,top:t.top,width:t.width,height:t.height}),e||{}},setCanvasData:function(i){var a=this.canvas,n=a.aspectRatio;e.isFunction(i)&&(i=i.call(this.$element)),this.built&&!this.disabled&&e.isPlainObject(i)&&(t(i.left)&&(a.left=i.left),t(i.top)&&(a.top=i.top),t(i.width)?(a.width=i.width,a.height=i.width/n):t(i.height)&&(a.height=i.height,a.width=i.height*n),this.renderCanvas(!0))},getCropBoxData:function(){var e,t=this.cropBox;return this.built&&this.cropped&&(e={left:t.left,top:t.top,width:t.width,height:t.height}),e||{}},setCropBoxData:function(i){var a,n,s=this.cropBox,o=this.options.aspectRatio;e.isFunction(i)&&(i=i.call(this.$element)),this.built&&this.cropped&&!this.disabled&&e.isPlainObject(i)&&(t(i.left)&&(s.left=i.left),t(i.top)&&(s.top=i.top),t(i.width)&&i.width!==s.width&&(a=!0,s.width=i.width),t(i.height)&&i.height!==s.height&&(n=!0,s.height=i.height),o&&(a?s.height=s.width/o:n&&(s.width=s.height*o)),this.renderCropBox())},getCroppedCanvas:function(t){var i,a,n,s,o,r,c,l,u,p,h;return this.built&&this.cropped&&ee?(e.isPlainObject(t)||(t={}),h=this.getData(),i=h.width,a=h.height,l=i/a,e.isPlainObject(t)&&(o=t.width,r=t.height,o?(r=o/l,c=o/i):r&&(o=r*l,c=r/a)),n=o||i,s=r||a,u=e("<canvas>")[0],u.width=n,u.height=s,p=u.getContext("2d"),t.fillColor&&(p.fillStyle=t.fillColor,p.fillRect(0,0,n,s)),p.drawImage.apply(p,function(){var e,t,n,s,o,r,l=d(this.$clone[0],this.image),u=l.width,p=l.height,g=[l],m=h.x,f=h.y;return-i>=m||m>u?m=e=n=o=0:0>=m?(n=-m,m=0,e=o=ie(u,i+m)):u>=m&&(n=0,e=o=ie(i,u-m)),0>=e||-a>=f||f>p?f=t=s=r=0:0>=f?(s=-f,f=0,t=r=ie(p,a+f)):p>=f&&(s=0,t=r=ie(a,p-f)),g.push(m,f,e,t),c&&(n*=c,s*=c,o*=c,r*=c),o>0&&r>0&&g.push(n,s,o,r),g}.call(this)),u):void 0},setAspectRatio:function(e){var t=this.options;this.disabled||i(e)||(t.aspectRatio=re(e)||NaN,this.built&&(this.initCropBox(),this.cropped&&this.renderCropBox()))},setDragMode:function(e){var t,i,a=this.options;this.ready&&!this.disabled&&(t=a.dragCrop&&e===X,i=a.movable&&e===Z,e=t||i?e:Q,this.$dragBox.data("action",e).toggleClass(k,t).toggleClass(b,i),a.cropBoxMovable||this.$face.data("action",e).toggleClass(k,t).toggleClass(b,i))}}),e.extend(u.prototype,ce),u.DEFAULTS={aspectRatio:NaN,data:null,preview:"",strict:!0,responsive:!0,checkImageOrigin:!0,modal:!0,guides:!0,center:!0,highlight:!0,background:!0,autoCrop:!0,autoCropArea:.8,dragCrop:!0,movable:!0,rotatable:!0,scalable:!0,zoomable:!0,mouseWheelZoom:!0,wheelZoomRatio:.1,touchDragZoom:!0,cropBoxMovable:!0,cropBoxResizable:!0,doubleClickToggle:!0,minCanvasWidth:0,minCanvasHeight:0,minCropBoxWidth:0,minCropBoxHeight:0,minContainerWidth:200,minContainerHeight:100,build:null,built:null,cropstart:null,cropmove:null,cropend:null,crop:null,zoom:null},u.setDefaults=function(t){e.extend(u.DEFAULTS,t)},u.TEMPLATE='<div class="cropper-container"><div class="cropper-canvas"></div><div class="cropper-drag-box"></div><div class="cropper-crop-box"><span class="cropper-view-box"></span><span class="cropper-dashed dashed-h"></span><span class="cropper-dashed dashed-v"></span><span class="cropper-center"></span><span class="cropper-face"></span><span class="cropper-line line-e" data-action="e"></span><span class="cropper-line line-n" data-action="n"></span><span class="cropper-line line-w" data-action="w"></span><span class="cropper-line line-s" data-action="s"></span><span class="cropper-point point-e" data-action="e"></span><span class="cropper-point point-n" data-action="n"></span><span class="cropper-point point-w" data-action="w"></span><span class="cropper-point point-s" data-action="s"></span><span class="cropper-point point-ne" data-action="ne"></span><span class="cropper-point point-nw" data-action="nw"></span><span class="cropper-point point-sw" data-action="sw"></span><span class="cropper-point point-se" data-action="se"></span></div></div>',u.other=e.fn.cropper,e.fn.cropper=function(t){var n,s=a(arguments,1);return this.each(function(){var i,a=e(this),o=a.data(m);if(!o){if(/destroy/.test(t))return;a.data(m,o=new u(this,t))}"string"==typeof t&&e.isFunction(i=o[t])&&(n=i.apply(o,s))}),i(n)?this:n},e.fn.cropper.Constructor=u,e.fn.cropper.setDefaults=u.setDefaults,e.fn.cropper.noConflict=function(){return e.fn.cropper=u.other,this}}),function(e){function t(e,t,i){switch(arguments.length){case 2:return null!=e?e:t;case 3:return null!=e?e:null!=t?t:i;default:throw new Error("Implement me")}}function i(e,t){return Ce.call(e,t)}function a(){return{empty:!1,unusedTokens:[],unusedInput:[],overflow:-2,charsLeftOver:0,nullInput:!1,invalidMonth:null,invalidFormat:!1,userInvalidated:!1,iso:!1}}function n(e){we.suppressDeprecationWarnings===!1&&"undefined"!=typeof console&&console.warn&&console.warn("Deprecation warning: "+e)}function s(e,t){var i=!0;return p(function(){return i&&(n(e),i=!1),t.apply(this,arguments)},t)}function o(e,t){ft[e]||(n(t),ft[e]=!0)}function r(e,t){return function(i){return m(e.call(this,i),t)}}function c(e,t){return function(i){return this.localeData().ordinal(e.call(this,i),t)}}function l(){}function d(e,t){t!==!1&&M(e),h(this,e),this._d=new Date(+e._d)}function u(e){var t=_(e),i=t.year||0,a=t.quarter||0,n=t.month||0,s=t.week||0,o=t.day||0,r=t.hour||0,c=t.minute||0,l=t.second||0,d=t.millisecond||0;this._milliseconds=+d+1e3*l+6e4*c+36e5*r,this._days=+o+7*s,this._months=+n+3*a+12*i,this._data={},this._locale=we.localeData(),this._bubble()}function p(e,t){for(var a in t)i(t,a)&&(e[a]=t[a]);return i(t,"toString")&&(e.toString=t.toString),i(t,"valueOf")&&(e.valueOf=t.valueOf),e}function h(e,t){var i,a,n;if("undefined"!=typeof t._isAMomentObject&&(e._isAMomentObject=t._isAMomentObject),"undefined"!=typeof t._i&&(e._i=t._i),"undefined"!=typeof t._f&&(e._f=t._f),"undefined"!=typeof t._l&&(e._l=t._l),"undefined"!=typeof t._strict&&(e._strict=t._strict),"undefined"!=typeof t._tzm&&(e._tzm=t._tzm),"undefined"!=typeof t._isUTC&&(e._isUTC=t._isUTC),"undefined"!=typeof t._offset&&(e._offset=t._offset),"undefined"!=typeof t._pf&&(e._pf=t._pf),"undefined"!=typeof t._locale&&(e._locale=t._locale),Fe.length>0)for(i in Fe)a=Fe[i],n=t[a],"undefined"!=typeof n&&(e[a]=n);return e}function g(e){return 0>e?Math.ceil(e):Math.floor(e)}function m(e,t,i){for(var a=""+Math.abs(e),n=e>=0;a.length<t;)a="0"+a;return(n?i?"+":"":"-")+a}function f(e,t){var i={milliseconds:0,months:0};return i.months=t.month()-e.month()+12*(t.year()-e.year()),e.clone().add(i.months,"M").isAfter(t)&&--i.months,i.milliseconds=+t-+e.clone().add(i.months,"M"),i}function v(e,t){var i;return t=Y(t,e),e.isBefore(t)?i=f(e,t):(i=f(t,e),i.milliseconds=-i.milliseconds,i.months=-i.months),i}function y(e,t){return function(i,a){var n,s;return null===a||isNaN(+a)||(o(t,"moment()."+t+"(period, number) is deprecated. Please use moment()."+t+"(number, period)."),s=i,i=a,a=s),i="string"==typeof i?+i:i,n=we.duration(i,a),w(this,n,e),this}}function w(e,t,i,a){var n=t._milliseconds,s=t._days,o=t._months;a=null==a?!0:a,n&&e._d.setTime(+e._d+n*i),s&&he(e,"Date",pe(e,"Date")+s*i),o&&ue(e,pe(e,"Month")+o*i),a&&we.updateOffset(e,s||o)}function x(e){return"[object Array]"===Object.prototype.toString.call(e)}function b(e){return"[object Date]"===Object.prototype.toString.call(e)||e instanceof Date}function k(e,t,i){var a,n=Math.min(e.length,t.length),s=Math.abs(e.length-t.length),o=0;for(a=0;n>a;a++)(i&&e[a]!==t[a]||!i&&I(e[a])!==I(t[a]))&&o++;return o+s}function $(e){if(e){var t=e.toLowerCase().replace(/(.)s$/,"$1");e=lt[e]||dt[t]||t}return e}function _(e){var t,a,n={};for(a in e)i(e,a)&&(t=$(a),t&&(n[t]=e[a]));return n}function C(t){var i,a;if(0===t.indexOf("week"))i=7,a="day";else{if(0!==t.indexOf("month"))return;i=12,a="month"}we[t]=function(n,s){var o,r,c=we._locale[t],l=[];if("number"==typeof n&&(s=n,n=e),r=function(e){var t=we().utc().set(a,e);return c.call(we._locale,t,n||"")},null!=s)return r(s);for(o=0;i>o;o++)l.push(r(o));return l}}function I(e){var t=+e,i=0;return 0!==t&&isFinite(t)&&(i=t>=0?Math.floor(t):Math.ceil(t)),i}function T(e,t){return new Date(Date.UTC(e,t+1,0)).getUTCDate()}function D(e,t,i){return re(we([e,11,31+t-i]),t,i).week}function S(e){return L(e)?366:365}function L(e){return e%4===0&&e%100!==0||e%400===0}function M(e){var t;e._a&&-2===e._pf.overflow&&(t=e._a[Te]<0||e._a[Te]>11?Te:e._a[De]<1||e._a[De]>T(e._a[Ie],e._a[Te])?De:e._a[Se]<0||e._a[Se]>24||24===e._a[Se]&&(0!==e._a[Le]||0!==e._a[Me]||0!==e._a[Ee])?Se:e._a[Le]<0||e._a[Le]>59?Le:e._a[Me]<0||e._a[Me]>59?Me:e._a[Ee]<0||e._a[Ee]>999?Ee:-1,e._pf._overflowDayOfYear&&(Ie>t||t>De)&&(t=De),e._pf.overflow=t)}function E(t){return null==t._isValid&&(t._isValid=!isNaN(t._d.getTime())&&t._pf.overflow<0&&!t._pf.empty&&!t._pf.invalidMonth&&!t._pf.nullInput&&!t._pf.invalidFormat&&!t._pf.userInvalidated,t._strict&&(t._isValid=t._isValid&&0===t._pf.charsLeftOver&&0===t._pf.unusedTokens.length&&t._pf.bigHour===e)),t._isValid}function A(e){return e?e.toLowerCase().replace("_","-"):e}function F(e){for(var t,i,a,n,s=0;s<e.length;){for(n=A(e[s]).split("-"),t=n.length,i=A(e[s+1]),i=i?i.split("-"):null;t>0;){if(a=U(n.slice(0,t).join("-")))return a;if(i&&i.length>=t&&k(n,i,!0)>=t-1)break;t--}s++}return null}function U(e){var t=null;if(!Ae[e]&&Ue)try{t=we.locale(),require("./locale/"+e),we.locale(t)}catch(i){}return Ae[e]}function Y(e,t){var i,a;return t._isUTC?(i=t.clone(),a=(we.isMoment(e)||b(e)?+e:+we(e))-+i,i._d.setTime(+i._d+a),we.updateOffset(i,!1),i):we(e).local()}function O(e){return e.match(/\[[\s\S]/)?e.replace(/^\[|\]$/g,""):e.replace(/\\/g,"")}function P(e){var t,i,a=e.match(Ge);for(t=0,i=a.length;i>t;t++)mt[a[t]]?a[t]=mt[a[t]]:a[t]=O(a[t]);return function(n){var s="";for(t=0;i>t;t++)s+=a[t]instanceof Function?a[t].call(n,e):a[t];return s}}function G(e,t){return e.isValid()?(t=j(t,e.localeData()),ut[t]||(ut[t]=P(t)),ut[t](e)):e.localeData().invalidDate()}function j(e,t){function i(e){return t.longDateFormat(e)||e}var a=5;for(je.lastIndex=0;a>=0&&je.test(e);)e=e.replace(je,i),je.lastIndex=0,a-=1;return e}function W(e,t){var i,a=t._strict;switch(e){case"Q":return Ze;case"DDDD":return Qe;case"YYYY":case"GGGG":case"gggg":return a?et:He;case"Y":case"G":case"g":return it;case"YYYYYY":case"YYYYY":case"GGGGG":case"ggggg":return a?tt:ze;case"S":if(a)return Ze;case"SS":if(a)return Je;case"SSS":if(a)return Qe;case"DDD":return Ne;case"MMM":case"MMMM":case"dd":case"ddd":case"dddd":return Be;case"a":case"A":return t._locale._meridiemParse;case"x":return Ve;case"X":return Xe;case"Z":case"ZZ":return qe;case"T":return Ke;case"SSSS":return Re;case"MM":case"DD":case"YY":case"GG":case"gg":case"HH":case"hh":case"mm":case"ss":case"ww":case"WW":return a?Je:We;case"M":case"D":case"d":case"H":case"h":case"m":case"s":case"w":case"W":case"e":case"E":return We;case"Do":return a?t._locale._ordinalParse:t._locale._ordinalParseLenient;default:return i=new RegExp(X(V(e.replace("\\","")),"i"))}}function N(e){e=e||"";var t=e.match(qe)||[],i=t[t.length-1]||[],a=(i+"").match(rt)||["-",0,0],n=+(60*a[1])+I(a[2]);return"+"===a[0]?-n:n}function H(e,t,i){var a,n=i._a;switch(e){case"Q":null!=t&&(n[Te]=3*(I(t)-1));break;case"M":case"MM":null!=t&&(n[Te]=I(t)-1);break;case"MMM":case"MMMM":a=i._locale.monthsParse(t,e,i._strict),null!=a?n[Te]=a:i._pf.invalidMonth=t;break;case"D":case"DD":null!=t&&(n[De]=I(t));break;case"Do":null!=t&&(n[De]=I(parseInt(t.match(/\d{1,2}/)[0],10)));break;case"DDD":case"DDDD":null!=t&&(i._dayOfYear=I(t));break;case"YY":n[Ie]=we.parseTwoDigitYear(t);break;case"YYYY":case"YYYYY":case"YYYYYY":n[Ie]=I(t);break;case"a":case"A":i._isPm=i._locale.isPM(t);break;case"h":case"hh":i._pf.bigHour=!0;case"H":case"HH":n[Se]=I(t);break;case"m":case"mm":n[Le]=I(t);break;case"s":case"ss":n[Me]=I(t);break;case"S":case"SS":case"SSS":case"SSSS":n[Ee]=I(1e3*("0."+t));break;case"x":i._d=new Date(I(t));break;case"X":i._d=new Date(1e3*parseFloat(t));break;case"Z":case"ZZ":i._useUTC=!0,i._tzm=N(t);break;case"dd":case"ddd":case"dddd":a=i._locale.weekdaysParse(t),null!=a?(i._w=i._w||{},i._w.d=a):i._pf.invalidWeekday=t;break;case"w":case"ww":case"W":case"WW":case"d":case"e":case"E":e=e.substr(0,1);case"gggg":case"GGGG":case"GGGGG":e=e.substr(0,2),t&&(i._w=i._w||{},i._w[e]=I(t));break;case"gg":case"GG":i._w=i._w||{},i._w[e]=we.parseTwoDigitYear(t)}}function z(e){var i,a,n,s,o,r,c;i=e._w,null!=i.GG||null!=i.W||null!=i.E?(o=1,r=4,a=t(i.GG,e._a[Ie],re(we(),1,4).year),n=t(i.W,1),s=t(i.E,1)):(o=e._locale._week.dow,r=e._locale._week.doy,a=t(i.gg,e._a[Ie],re(we(),o,r).year),n=t(i.w,1),null!=i.d?(s=i.d,o>s&&++n):s=null!=i.e?i.e+o:o),c=ce(a,n,s,r,o),e._a[Ie]=c.year,e._dayOfYear=c.dayOfYear}function R(e){var i,a,n,s,o=[];if(!e._d){for(n=q(e),e._w&&null==e._a[De]&&null==e._a[Te]&&z(e),e._dayOfYear&&(s=t(e._a[Ie],n[Ie]),e._dayOfYear>S(s)&&(e._pf._overflowDayOfYear=!0),a=ae(s,0,e._dayOfYear),
e._a[Te]=a.getUTCMonth(),e._a[De]=a.getUTCDate()),i=0;3>i&&null==e._a[i];++i)e._a[i]=o[i]=n[i];for(;7>i;i++)e._a[i]=o[i]=null==e._a[i]?2===i?1:0:e._a[i];24===e._a[Se]&&0===e._a[Le]&&0===e._a[Me]&&0===e._a[Ee]&&(e._nextDay=!0,e._a[Se]=0),e._d=(e._useUTC?ae:ie).apply(null,o),null!=e._tzm&&e._d.setUTCMinutes(e._d.getUTCMinutes()+e._tzm),e._nextDay&&(e._a[Se]=24)}}function B(e){var t;e._d||(t=_(e._i),e._a=[t.year,t.month,t.day||t.date,t.hour,t.minute,t.second,t.millisecond],R(e))}function q(e){var t=new Date;return e._useUTC?[t.getUTCFullYear(),t.getUTCMonth(),t.getUTCDate()]:[t.getFullYear(),t.getMonth(),t.getDate()]}function K(t){if(t._f===we.ISO_8601)return void J(t);t._a=[],t._pf.empty=!0;var i,a,n,s,o,r=""+t._i,c=r.length,l=0;for(n=j(t._f,t._locale).match(Ge)||[],i=0;i<n.length;i++)s=n[i],a=(r.match(W(s,t))||[])[0],a&&(o=r.substr(0,r.indexOf(a)),o.length>0&&t._pf.unusedInput.push(o),r=r.slice(r.indexOf(a)+a.length),l+=a.length),mt[s]?(a?t._pf.empty=!1:t._pf.unusedTokens.push(s),H(s,a,t)):t._strict&&!a&&t._pf.unusedTokens.push(s);t._pf.charsLeftOver=c-l,r.length>0&&t._pf.unusedInput.push(r),t._pf.bigHour===!0&&t._a[Se]<=12&&(t._pf.bigHour=e),t._isPm&&t._a[Se]<12&&(t._a[Se]+=12),t._isPm===!1&&12===t._a[Se]&&(t._a[Se]=0),R(t),M(t)}function V(e){return e.replace(/\\(\[)|\\(\])|\[([^\]\[]*)\]|\\(.)/g,function(e,t,i,a,n){return t||i||a||n})}function X(e){return e.replace(/[-\/\\^$*+?.()|[\]{}]/g,"\\$&")}function Z(e){var t,i,n,s,o;if(0===e._f.length)return e._pf.invalidFormat=!0,void(e._d=new Date(NaN));for(s=0;s<e._f.length;s++)o=0,t=h({},e),null!=e._useUTC&&(t._useUTC=e._useUTC),t._pf=a(),t._f=e._f[s],K(t),E(t)&&(o+=t._pf.charsLeftOver,o+=10*t._pf.unusedTokens.length,t._pf.score=o,(null==n||n>o)&&(n=o,i=t));p(e,i||t)}function J(e){var t,i,a=e._i,n=at.exec(a);if(n){for(e._pf.iso=!0,t=0,i=st.length;i>t;t++)if(st[t][1].exec(a)){e._f=st[t][0]+(n[6]||" ");break}for(t=0,i=ot.length;i>t;t++)if(ot[t][1].exec(a)){e._f+=ot[t][0];break}a.match(qe)&&(e._f+="Z"),K(e)}else e._isValid=!1}function Q(e){J(e),e._isValid===!1&&(delete e._isValid,we.createFromInputFallback(e))}function ee(e,t){var i,a=[];for(i=0;i<e.length;++i)a.push(t(e[i],i));return a}function te(t){var i,a=t._i;a===e?t._d=new Date:b(a)?t._d=new Date(+a):null!==(i=Ye.exec(a))?t._d=new Date(+i[1]):"string"==typeof a?Q(t):x(a)?(t._a=ee(a.slice(0),function(e){return parseInt(e,10)}),R(t)):"object"==typeof a?B(t):"number"==typeof a?t._d=new Date(a):we.createFromInputFallback(t)}function ie(e,t,i,a,n,s,o){var r=new Date(e,t,i,a,n,s,o);return 1970>e&&r.setFullYear(e),r}function ae(e){var t=new Date(Date.UTC.apply(null,arguments));return 1970>e&&t.setUTCFullYear(e),t}function ne(e,t){if("string"==typeof e)if(isNaN(e)){if(e=t.weekdaysParse(e),"number"!=typeof e)return null}else e=parseInt(e,10);return e}function se(e,t,i,a,n){return n.relativeTime(t||1,!!i,e,a)}function oe(e,t,i){var a=we.duration(e).abs(),n=_e(a.as("s")),s=_e(a.as("m")),o=_e(a.as("h")),r=_e(a.as("d")),c=_e(a.as("M")),l=_e(a.as("y")),d=n<pt.s&&["s",n]||1===s&&["m"]||s<pt.m&&["mm",s]||1===o&&["h"]||o<pt.h&&["hh",o]||1===r&&["d"]||r<pt.d&&["dd",r]||1===c&&["M"]||c<pt.M&&["MM",c]||1===l&&["y"]||["yy",l];return d[2]=t,d[3]=+e>0,d[4]=i,se.apply({},d)}function re(e,t,i){var a,n=i-t,s=i-e.day();return s>n&&(s-=7),n-7>s&&(s+=7),a=we(e).add(s,"d"),{week:Math.ceil(a.dayOfYear()/7),year:a.year()}}function ce(e,t,i,a,n){var s,o,r=ae(e,0,1).getUTCDay();return r=0===r?7:r,i=null!=i?i:n,s=n-r+(r>a?7:0)-(n>r?7:0),o=7*(t-1)+(i-n)+s+1,{year:o>0?e:e-1,dayOfYear:o>0?o:S(e-1)+o}}function le(t){var i,a=t._i,n=t._f;return t._locale=t._locale||we.localeData(t._l),null===a||n===e&&""===a?we.invalid({nullInput:!0}):("string"==typeof a&&(t._i=a=t._locale.preparse(a)),we.isMoment(a)?new d(a,!0):(n?x(n)?Z(t):K(t):te(t),i=new d(t),i._nextDay&&(i.add(1,"d"),i._nextDay=e),i))}function de(e,t){var i,a;if(1===t.length&&x(t[0])&&(t=t[0]),!t.length)return we();for(i=t[0],a=1;a<t.length;++a)t[a][e](i)&&(i=t[a]);return i}function ue(e,t){var i;return"string"==typeof t&&(t=e.localeData().monthsParse(t),"number"!=typeof t)?e:(i=Math.min(e.date(),T(e.year(),t)),e._d["set"+(e._isUTC?"UTC":"")+"Month"](t,i),e)}function pe(e,t){return e._d["get"+(e._isUTC?"UTC":"")+t]()}function he(e,t,i){return"Month"===t?ue(e,i):e._d["set"+(e._isUTC?"UTC":"")+t](i)}function ge(e,t){return function(i){return null!=i?(he(this,e,i),we.updateOffset(this,t),this):pe(this,e)}}function me(e){return 400*e/146097}function fe(e){return 146097*e/400}function ve(e){we.duration.fn[e]=function(){return this._data[e]}}function ye(e){"undefined"==typeof ender&&(xe=$e.moment,e?$e.moment=s("Accessing Moment through the global scope is deprecated, and will be removed in an upcoming release.",we):$e.moment=we)}for(var we,xe,be,ke="2.8.4",$e="undefined"!=typeof global?global:this,_e=Math.round,Ce=Object.prototype.hasOwnProperty,Ie=0,Te=1,De=2,Se=3,Le=4,Me=5,Ee=6,Ae={},Fe=[],Ue="undefined"!=typeof module&&module&&module.exports,Ye=/^\/?Date\((\-?\d+)/i,Oe=/(\-)?(?:(\d*)\.)?(\d+)\:(\d+)(?:\:(\d+)\.?(\d{3})?)?/,Pe=/^(-)?P(?:(?:([0-9,.]*)Y)?(?:([0-9,.]*)M)?(?:([0-9,.]*)D)?(?:T(?:([0-9,.]*)H)?(?:([0-9,.]*)M)?(?:([0-9,.]*)S)?)?|([0-9,.]*)W)$/,Ge=/(\[[^\[]*\])|(\\)?(Mo|MM?M?M?|Do|DDDo|DD?D?D?|ddd?d?|do?|w[o|w]?|W[o|W]?|Q|YYYYYY|YYYYY|YYYY|YY|gg(ggg?)?|GG(GGG?)?|e|E|a|A|hh?|HH?|mm?|ss?|S{1,4}|x|X|zz?|ZZ?|.)/g,je=/(\[[^\[]*\])|(\\)?(LTS|LT|LL?L?L?|l{1,4})/g,We=/\d\d?/,Ne=/\d{1,3}/,He=/\d{1,4}/,ze=/[+\-]?\d{1,6}/,Re=/\d+/,Be=/[0-9]*['a-z\u00A0-\u05FF\u0700-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF]+|[\u0600-\u06FF\/]+(\s*?[\u0600-\u06FF]+){1,2}/i,qe=/Z|[\+\-]\d\d:?\d\d/gi,Ke=/T/i,Ve=/[\+\-]?\d+/,Xe=/[\+\-]?\d+(\.\d{1,3})?/,Ze=/\d/,Je=/\d\d/,Qe=/\d{3}/,et=/\d{4}/,tt=/[+-]?\d{6}/,it=/[+-]?\d+/,at=/^\s*(?:[+-]\d{6}|\d{4})-(?:(\d\d-\d\d)|(W\d\d$)|(W\d\d-\d)|(\d\d\d))((T| )(\d\d(:\d\d(:\d\d(\.\d+)?)?)?)?([\+\-]\d\d(?::?\d\d)?|\s*Z)?)?$/,nt="YYYY-MM-DDTHH:mm:ssZ",st=[["YYYYYY-MM-DD",/[+-]\d{6}-\d{2}-\d{2}/],["YYYY-MM-DD",/\d{4}-\d{2}-\d{2}/],["GGGG-[W]WW-E",/\d{4}-W\d{2}-\d/],["GGGG-[W]WW",/\d{4}-W\d{2}/],["YYYY-DDD",/\d{4}-\d{3}/]],ot=[["HH:mm:ss.SSSS",/(T| )\d\d:\d\d:\d\d\.\d+/],["HH:mm:ss",/(T| )\d\d:\d\d:\d\d/],["HH:mm",/(T| )\d\d:\d\d/],["HH",/(T| )\d\d/]],rt=/([\+\-]|\d\d)/gi,ct=("Date|Hours|Minutes|Seconds|Milliseconds".split("|"),{Milliseconds:1,Seconds:1e3,Minutes:6e4,Hours:36e5,Days:864e5,Months:2592e6,Years:31536e6}),lt={ms:"millisecond",s:"second",m:"minute",h:"hour",d:"day",D:"date",w:"week",W:"isoWeek",M:"month",Q:"quarter",y:"year",DDD:"dayOfYear",e:"weekday",E:"isoWeekday",gg:"weekYear",GG:"isoWeekYear"},dt={dayofyear:"dayOfYear",isoweekday:"isoWeekday",isoweek:"isoWeek",weekyear:"weekYear",isoweekyear:"isoWeekYear"},ut={},pt={s:45,m:45,h:22,d:26,M:11},ht="DDD w W M D d".split(" "),gt="M D H h m s w W".split(" "),mt={M:function(){return this.month()+1},MMM:function(e){return this.localeData().monthsShort(this,e)},MMMM:function(e){return this.localeData().months(this,e)},D:function(){return this.date()},DDD:function(){return this.dayOfYear()},d:function(){return this.day()},dd:function(e){return this.localeData().weekdaysMin(this,e)},ddd:function(e){return this.localeData().weekdaysShort(this,e)},dddd:function(e){return this.localeData().weekdays(this,e)},w:function(){return this.week()},W:function(){return this.isoWeek()},YY:function(){return m(this.year()%100,2)},YYYY:function(){return m(this.year(),4)},YYYYY:function(){return m(this.year(),5)},YYYYYY:function(){var e=this.year(),t=e>=0?"+":"-";return t+m(Math.abs(e),6)},gg:function(){return m(this.weekYear()%100,2)},gggg:function(){return m(this.weekYear(),4)},ggggg:function(){return m(this.weekYear(),5)},GG:function(){return m(this.isoWeekYear()%100,2)},GGGG:function(){return m(this.isoWeekYear(),4)},GGGGG:function(){return m(this.isoWeekYear(),5)},e:function(){return this.weekday()},E:function(){return this.isoWeekday()},a:function(){return this.localeData().meridiem(this.hours(),this.minutes(),!0)},A:function(){return this.localeData().meridiem(this.hours(),this.minutes(),!1)},H:function(){return this.hours()},h:function(){return this.hours()%12||12},m:function(){return this.minutes()},s:function(){return this.seconds()},S:function(){return I(this.milliseconds()/100)},SS:function(){return m(I(this.milliseconds()/10),2)},SSS:function(){return m(this.milliseconds(),3)},SSSS:function(){return m(this.milliseconds(),3)},Z:function(){var e=-this.zone(),t="+";return 0>e&&(e=-e,t="-"),t+m(I(e/60),2)+":"+m(I(e)%60,2)},ZZ:function(){var e=-this.zone(),t="+";return 0>e&&(e=-e,t="-"),t+m(I(e/60),2)+m(I(e)%60,2)},z:function(){return this.zoneAbbr()},zz:function(){return this.zoneName()},x:function(){return this.valueOf()},X:function(){return this.unix()},Q:function(){return this.quarter()}},ft={},vt=["months","monthsShort","weekdays","weekdaysShort","weekdaysMin"];ht.length;)be=ht.pop(),mt[be+"o"]=c(mt[be],be);for(;gt.length;)be=gt.pop(),mt[be+be]=r(mt[be],2);mt.DDDD=r(mt.DDD,3),p(l.prototype,{set:function(e){var t,i;for(i in e)t=e[i],"function"==typeof t?this[i]=t:this["_"+i]=t;this._ordinalParseLenient=new RegExp(this._ordinalParse.source+"|"+/\d{1,2}/.source)},_months:"January_February_March_April_May_June_July_August_September_October_November_December".split("_"),months:function(e){return this._months[e.month()]},_monthsShort:"Jan_Feb_Mar_Apr_May_Jun_Jul_Aug_Sep_Oct_Nov_Dec".split("_"),monthsShort:function(e){return this._monthsShort[e.month()]},monthsParse:function(e,t,i){var a,n,s;for(this._monthsParse||(this._monthsParse=[],this._longMonthsParse=[],this._shortMonthsParse=[]),a=0;12>a;a++){if(n=we.utc([2e3,a]),i&&!this._longMonthsParse[a]&&(this._longMonthsParse[a]=new RegExp("^"+this.months(n,"").replace(".","")+"$","i"),this._shortMonthsParse[a]=new RegExp("^"+this.monthsShort(n,"").replace(".","")+"$","i")),i||this._monthsParse[a]||(s="^"+this.months(n,"")+"|^"+this.monthsShort(n,""),this._monthsParse[a]=new RegExp(s.replace(".",""),"i")),i&&"MMMM"===t&&this._longMonthsParse[a].test(e))return a;if(i&&"MMM"===t&&this._shortMonthsParse[a].test(e))return a;if(!i&&this._monthsParse[a].test(e))return a}},_weekdays:"Sunday_Monday_Tuesday_Wednesday_Thursday_Friday_Saturday".split("_"),weekdays:function(e){return this._weekdays[e.day()]},_weekdaysShort:"Sun_Mon_Tue_Wed_Thu_Fri_Sat".split("_"),weekdaysShort:function(e){return this._weekdaysShort[e.day()]},_weekdaysMin:"Su_Mo_Tu_We_Th_Fr_Sa".split("_"),weekdaysMin:function(e){return this._weekdaysMin[e.day()]},weekdaysParse:function(e){var t,i,a;for(this._weekdaysParse||(this._weekdaysParse=[]),t=0;7>t;t++)if(this._weekdaysParse[t]||(i=we([2e3,1]).day(t),a="^"+this.weekdays(i,"")+"|^"+this.weekdaysShort(i,"")+"|^"+this.weekdaysMin(i,""),this._weekdaysParse[t]=new RegExp(a.replace(".",""),"i")),this._weekdaysParse[t].test(e))return t},_longDateFormat:{LTS:"h:mm:ss A",LT:"h:mm A",L:"MM/DD/YYYY",LL:"MMMM D, YYYY",LLL:"MMMM D, YYYY LT",LLLL:"dddd, MMMM D, YYYY LT"},longDateFormat:function(e){var t=this._longDateFormat[e];return!t&&this._longDateFormat[e.toUpperCase()]&&(t=this._longDateFormat[e.toUpperCase()].replace(/MMMM|MM|DD|dddd/g,function(e){return e.slice(1)}),this._longDateFormat[e]=t),t},isPM:function(e){return"p"===(e+"").toLowerCase().charAt(0)},_meridiemParse:/[ap]\.?m?\.?/i,meridiem:function(e,t,i){return e>11?i?"pm":"PM":i?"am":"AM"},_calendar:{sameDay:"[Today at] LT",nextDay:"[Tomorrow at] LT",nextWeek:"dddd [at] LT",lastDay:"[Yesterday at] LT",lastWeek:"[Last] dddd [at] LT",sameElse:"L"},calendar:function(e,t,i){var a=this._calendar[e];return"function"==typeof a?a.apply(t,[i]):a},_relativeTime:{future:"in %s",past:"%s ago",s:"a few seconds",m:"a minute",mm:"%d minutes",h:"an hour",hh:"%d hours",d:"a day",dd:"%d days",M:"a month",MM:"%d months",y:"a year",yy:"%d years"},relativeTime:function(e,t,i,a){var n=this._relativeTime[i];return"function"==typeof n?n(e,t,i,a):n.replace(/%d/i,e)},pastFuture:function(e,t){var i=this._relativeTime[e>0?"future":"past"];return"function"==typeof i?i(t):i.replace(/%s/i,t)},ordinal:function(e){return this._ordinal.replace("%d",e)},_ordinal:"%d",_ordinalParse:/\d{1,2}/,preparse:function(e){return e},postformat:function(e){return e},week:function(e){return re(e,this._week.dow,this._week.doy).week},_week:{dow:0,doy:6},_invalidDate:"Invalid date",invalidDate:function(){return this._invalidDate}}),we=function(t,i,n,s){var o;return"boolean"==typeof n&&(s=n,n=e),o={},o._isAMomentObject=!0,o._i=t,o._f=i,o._l=n,o._strict=s,o._isUTC=!1,o._pf=a(),le(o)},we.suppressDeprecationWarnings=!1,we.createFromInputFallback=s("moment construction falls back to js Date. This is discouraged and will be removed in upcoming major release. Please refer to https://github.com/moment/moment/issues/1407 for more info.",function(e){e._d=new Date(e._i+(e._useUTC?" UTC":""))}),we.min=function(){var e=[].slice.call(arguments,0);return de("isBefore",e)},we.max=function(){var e=[].slice.call(arguments,0);return de("isAfter",e)},we.utc=function(t,i,n,s){var o;return"boolean"==typeof n&&(s=n,n=e),o={},o._isAMomentObject=!0,o._useUTC=!0,o._isUTC=!0,o._l=n,o._i=t,o._f=i,o._strict=s,o._pf=a(),le(o).utc()},we.unix=function(e){return we(1e3*e)},we.duration=function(e,t){var a,n,s,o,r=e,c=null;return we.isDuration(e)?r={ms:e._milliseconds,d:e._days,M:e._months}:"number"==typeof e?(r={},t?r[t]=e:r.milliseconds=e):(c=Oe.exec(e))?(a="-"===c[1]?-1:1,r={y:0,d:I(c[De])*a,h:I(c[Se])*a,m:I(c[Le])*a,s:I(c[Me])*a,ms:I(c[Ee])*a}):(c=Pe.exec(e))?(a="-"===c[1]?-1:1,s=function(e){var t=e&&parseFloat(e.replace(",","."));return(isNaN(t)?0:t)*a},r={y:s(c[2]),M:s(c[3]),d:s(c[4]),h:s(c[5]),m:s(c[6]),s:s(c[7]),w:s(c[8])}):"object"==typeof r&&("from"in r||"to"in r)&&(o=v(we(r.from),we(r.to)),r={},r.ms=o.milliseconds,r.M=o.months),n=new u(r),we.isDuration(e)&&i(e,"_locale")&&(n._locale=e._locale),n},we.version=ke,we.defaultFormat=nt,we.ISO_8601=function(){},we.momentProperties=Fe,we.updateOffset=function(){},we.relativeTimeThreshold=function(t,i){return pt[t]===e?!1:i===e?pt[t]:(pt[t]=i,!0)},we.lang=s("moment.lang is deprecated. Use moment.locale instead.",function(e,t){return we.locale(e,t)}),we.locale=function(e,t){var i;return e&&(i="undefined"!=typeof t?we.defineLocale(e,t):we.localeData(e),i&&(we.duration._locale=we._locale=i)),we._locale._abbr},we.defineLocale=function(e,t){return null!==t?(t.abbr=e,Ae[e]||(Ae[e]=new l),Ae[e].set(t),we.locale(e),Ae[e]):(delete Ae[e],null)},we.langData=s("moment.langData is deprecated. Use moment.localeData instead.",function(e){return we.localeData(e)}),we.localeData=function(e){var t;if(e&&e._locale&&e._locale._abbr&&(e=e._locale._abbr),!e)return we._locale;if(!x(e)){if(t=U(e))return t;e=[e]}return F(e)},we.isMoment=function(e){return e instanceof d||null!=e&&i(e,"_isAMomentObject")},we.isDuration=function(e){return e instanceof u};for(be=vt.length-1;be>=0;--be)C(vt[be]);we.normalizeUnits=function(e){return $(e)},we.invalid=function(e){var t=we.utc(NaN);return null!=e?p(t._pf,e):t._pf.userInvalidated=!0,t},we.parseZone=function(){return we.apply(null,arguments).parseZone()},we.parseTwoDigitYear=function(e){return I(e)+(I(e)>68?1900:2e3)},p(we.fn=d.prototype,{clone:function(){return we(this)},valueOf:function(){return+this._d+6e4*(this._offset||0)},unix:function(){return Math.floor(+this/1e3)},toString:function(){return this.clone().locale("en").format("ddd MMM DD YYYY HH:mm:ss [GMT]ZZ")},toDate:function(){return this._offset?new Date(+this):this._d},toISOString:function(){var e=we(this).utc();return 0<e.year()&&e.year()<=9999?"function"==typeof Date.prototype.toISOString?this.toDate().toISOString():G(e,"YYYY-MM-DD[T]HH:mm:ss.SSS[Z]"):G(e,"YYYYYY-MM-DD[T]HH:mm:ss.SSS[Z]")},toArray:function(){var e=this;return[e.year(),e.month(),e.date(),e.hours(),e.minutes(),e.seconds(),e.milliseconds()]},isValid:function(){return E(this)},isDSTShifted:function(){return this._a?this.isValid()&&k(this._a,(this._isUTC?we.utc(this._a):we(this._a)).toArray())>0:!1},parsingFlags:function(){return p({},this._pf)},invalidAt:function(){return this._pf.overflow},utc:function(e){return this.zone(0,e)},local:function(e){return this._isUTC&&(this.zone(0,e),this._isUTC=!1,e&&this.add(this._dateTzOffset(),"m")),this},format:function(e){var t=G(this,e||we.defaultFormat);return this.localeData().postformat(t)},add:y(1,"add"),subtract:y(-1,"subtract"),diff:function(e,t,i){var a,n,s,o=Y(e,this),r=6e4*(this.zone()-o.zone());return t=$(t),"year"===t||"month"===t?(a=432e5*(this.daysInMonth()+o.daysInMonth()),n=12*(this.year()-o.year())+(this.month()-o.month()),s=this-we(this).startOf("month")-(o-we(o).startOf("month")),s-=6e4*(this.zone()-we(this).startOf("month").zone()-(o.zone()-we(o).startOf("month").zone())),n+=s/a,"year"===t&&(n/=12)):(a=this-o,n="second"===t?a/1e3:"minute"===t?a/6e4:"hour"===t?a/36e5:"day"===t?(a-r)/864e5:"week"===t?(a-r)/6048e5:a),i?n:g(n)},from:function(e,t){return we.duration({to:this,from:e}).locale(this.locale()).humanize(!t)},fromNow:function(e){return this.from(we(),e)},calendar:function(e){var t=e||we(),i=Y(t,this).startOf("day"),a=this.diff(i,"days",!0),n=-6>a?"sameElse":-1>a?"lastWeek":0>a?"lastDay":1>a?"sameDay":2>a?"nextDay":7>a?"nextWeek":"sameElse";return this.format(this.localeData().calendar(n,this,we(t)))},isLeapYear:function(){return L(this.year())},isDST:function(){return this.zone()<this.clone().month(0).zone()||this.zone()<this.clone().month(5).zone()},day:function(e){var t=this._isUTC?this._d.getUTCDay():this._d.getDay();return null!=e?(e=ne(e,this.localeData()),this.add(e-t,"d")):t},month:ge("Month",!0),startOf:function(e){switch(e=$(e)){case"year":this.month(0);case"quarter":case"month":this.date(1);case"week":case"isoWeek":case"day":this.hours(0);case"hour":this.minutes(0);case"minute":this.seconds(0);case"second":this.milliseconds(0)}return"week"===e?this.weekday(0):"isoWeek"===e&&this.isoWeekday(1),"quarter"===e&&this.month(3*Math.floor(this.month()/3)),this},endOf:function(t){return t=$(t),t===e||"millisecond"===t?this:this.startOf(t).add(1,"isoWeek"===t?"week":t).subtract(1,"ms")},isAfter:function(e,t){var i;return t=$("undefined"!=typeof t?t:"millisecond"),"millisecond"===t?(e=we.isMoment(e)?e:we(e),+this>+e):(i=we.isMoment(e)?+e:+we(e),i<+this.clone().startOf(t))},isBefore:function(e,t){var i;return t=$("undefined"!=typeof t?t:"millisecond"),"millisecond"===t?(e=we.isMoment(e)?e:we(e),+e>+this):(i=we.isMoment(e)?+e:+we(e),+this.clone().endOf(t)<i)},isSame:function(e,t){var i;return t=$(t||"millisecond"),"millisecond"===t?(e=we.isMoment(e)?e:we(e),+this===+e):(i=+we(e),+this.clone().startOf(t)<=i&&i<=+this.clone().endOf(t))},min:s("moment().min is deprecated, use moment.min instead. https://github.com/moment/moment/issues/1548",function(e){return e=we.apply(null,arguments),this>e?this:e}),max:s("moment().max is deprecated, use moment.max instead. https://github.com/moment/moment/issues/1548",function(e){return e=we.apply(null,arguments),e>this?this:e}),zone:function(e,t){var i,a=this._offset||0;return null==e?this._isUTC?a:this._dateTzOffset():("string"==typeof e&&(e=N(e)),Math.abs(e)<16&&(e=60*e),!this._isUTC&&t&&(i=this._dateTzOffset()),this._offset=e,this._isUTC=!0,null!=i&&this.subtract(i,"m"),a!==e&&(!t||this._changeInProgress?w(this,we.duration(a-e,"m"),1,!1):this._changeInProgress||(this._changeInProgress=!0,we.updateOffset(this,!0),this._changeInProgress=null)),this)},zoneAbbr:function(){return this._isUTC?"UTC":""},zoneName:function(){return this._isUTC?"Coordinated Universal Time":""},parseZone:function(){return this._tzm?this.zone(this._tzm):"string"==typeof this._i&&this.zone(this._i),this},hasAlignedHourOffset:function(e){return e=e?we(e).zone():0,(this.zone()-e)%60===0},daysInMonth:function(){return T(this.year(),this.month())},dayOfYear:function(e){var t=_e((we(this).startOf("day")-we(this).startOf("year"))/864e5)+1;return null==e?t:this.add(e-t,"d")},quarter:function(e){return null==e?Math.ceil((this.month()+1)/3):this.month(3*(e-1)+this.month()%3)},weekYear:function(e){var t=re(this,this.localeData()._week.dow,this.localeData()._week.doy).year;return null==e?t:this.add(e-t,"y")},isoWeekYear:function(e){var t=re(this,1,4).year;return null==e?t:this.add(e-t,"y")},week:function(e){var t=this.localeData().week(this);return null==e?t:this.add(7*(e-t),"d")},isoWeek:function(e){var t=re(this,1,4).week;return null==e?t:this.add(7*(e-t),"d")},weekday:function(e){var t=(this.day()+7-this.localeData()._week.dow)%7;return null==e?t:this.add(e-t,"d")},isoWeekday:function(e){return null==e?this.day()||7:this.day(this.day()%7?e:e-7)},isoWeeksInYear:function(){return D(this.year(),1,4)},weeksInYear:function(){var e=this.localeData()._week;return D(this.year(),e.dow,e.doy)},get:function(e){return e=$(e),this[e]()},set:function(e,t){return e=$(e),"function"==typeof this[e]&&this[e](t),this},locale:function(t){var i;return t===e?this._locale._abbr:(i=we.localeData(t),null!=i&&(this._locale=i),this)},lang:s("moment().lang() is deprecated. Instead, use moment().localeData() to get the language configuration. Use moment().locale() to change languages.",function(t){return t===e?this.localeData():this.locale(t)}),localeData:function(){return this._locale},_dateTzOffset:function(){return 15*Math.round(this._d.getTimezoneOffset()/15)}}),we.fn.millisecond=we.fn.milliseconds=ge("Milliseconds",!1),we.fn.second=we.fn.seconds=ge("Seconds",!1),we.fn.minute=we.fn.minutes=ge("Minutes",!1),we.fn.hour=we.fn.hours=ge("Hours",!0),we.fn.date=ge("Date",!0),we.fn.dates=s("dates accessor is deprecated. Use date instead.",ge("Date",!0)),we.fn.year=ge("FullYear",!0),we.fn.years=s("years accessor is deprecated. Use year instead.",ge("FullYear",!0)),we.fn.days=we.fn.day,we.fn.months=we.fn.month,we.fn.weeks=we.fn.week,we.fn.isoWeeks=we.fn.isoWeek,we.fn.quarters=we.fn.quarter,we.fn.toJSON=we.fn.toISOString,p(we.duration.fn=u.prototype,{_bubble:function(){var e,t,i,a=this._milliseconds,n=this._days,s=this._months,o=this._data,r=0;o.milliseconds=a%1e3,e=g(a/1e3),o.seconds=e%60,t=g(e/60),o.minutes=t%60,i=g(t/60),o.hours=i%24,n+=g(i/24),r=g(me(n)),n-=g(fe(r)),s+=g(n/30),n%=30,r+=g(s/12),s%=12,o.days=n,o.months=s,o.years=r},abs:function(){return this._milliseconds=Math.abs(this._milliseconds),this._days=Math.abs(this._days),this._months=Math.abs(this._months),this._data.milliseconds=Math.abs(this._data.milliseconds),this._data.seconds=Math.abs(this._data.seconds),this._data.minutes=Math.abs(this._data.minutes),this._data.hours=Math.abs(this._data.hours),this._data.months=Math.abs(this._data.months),this._data.years=Math.abs(this._data.years),this},weeks:function(){return g(this.days()/7)},valueOf:function(){return this._milliseconds+864e5*this._days+this._months%12*2592e6+31536e6*I(this._months/12)},humanize:function(e){var t=oe(this,!e,this.localeData());return e&&(t=this.localeData().pastFuture(+this,t)),this.localeData().postformat(t)},add:function(e,t){var i=we.duration(e,t);return this._milliseconds+=i._milliseconds,this._days+=i._days,this._months+=i._months,this._bubble(),this},subtract:function(e,t){var i=we.duration(e,t);return this._milliseconds-=i._milliseconds,this._days-=i._days,this._months-=i._months,this._bubble(),this},get:function(e){return e=$(e),this[e.toLowerCase()+"s"]()},as:function(e){var t,i;if(e=$(e),"month"===e||"year"===e)return t=this._days+this._milliseconds/864e5,i=this._months+12*me(t),"month"===e?i:i/12;switch(t=this._days+Math.round(fe(this._months/12)),e){case"week":return t/7+this._milliseconds/6048e5;case"day":return t+this._milliseconds/864e5;case"hour":return 24*t+this._milliseconds/36e5;case"minute":return 24*t*60+this._milliseconds/6e4;case"second":return 24*t*60*60+this._milliseconds/1e3;case"millisecond":return Math.floor(24*t*60*60*1e3)+this._milliseconds;default:throw new Error("Unknown unit "+e)}},lang:we.fn.lang,locale:we.fn.locale,toIsoString:s("toIsoString() is deprecated. Please use toISOString() instead (notice the capitals)",function(){return this.toISOString()}),toISOString:function(){var e=Math.abs(this.years()),t=Math.abs(this.months()),i=Math.abs(this.days()),a=Math.abs(this.hours()),n=Math.abs(this.minutes()),s=Math.abs(this.seconds()+this.milliseconds()/1e3);return this.asSeconds()?(this.asSeconds()<0?"-":"")+"P"+(e?e+"Y":"")+(t?t+"M":"")+(i?i+"D":"")+(a||n||s?"T":"")+(a?a+"H":"")+(n?n+"M":"")+(s?s+"S":""):"P0D"},localeData:function(){return this._locale}}),we.duration.fn.toString=we.duration.fn.toISOString;for(be in ct)i(ct,be)&&ve(be.toLowerCase());we.duration.fn.asMilliseconds=function(){return this.as("ms")},we.duration.fn.asSeconds=function(){return this.as("s")},we.duration.fn.asMinutes=function(){return this.as("m")},we.duration.fn.asHours=function(){return this.as("h")},we.duration.fn.asDays=function(){return this.as("d")},we.duration.fn.asWeeks=function(){return this.as("weeks")},we.duration.fn.asMonths=function(){return this.as("M")},we.duration.fn.asYears=function(){return this.as("y")},we.locale("en",{ordinalParse:/\d{1,2}(th|st|nd|rd)/,ordinal:function(e){var t=e%10,i=1===I(e%100/10)?"th":1===t?"st":2===t?"nd":3===t?"rd":"th";return e+i}}),Ue?module.exports=we:"function"==typeof define&&define.amd?(define("moment",function(e,t,i){return i.config&&i.config()&&i.config().noGlobal===!0&&($e.moment=xe),we}),ye(!0)):ye()}.call(this),function(e){"use strict";"function"==typeof define&&define.amd?define(["jquery"],e):"undefined"!=typeof module&&module.exports?module.exports=e(require("jquery")):e(jQuery)}(function(e){"use strict";function t(t){return!t.nodeName||-1!==e.inArray(t.nodeName.toLowerCase(),["iframe","#document","html","body"])}function i(t){return e.isFunction(t)||e.isPlainObject(t)?t:{top:t,left:t}}var a=e.scrollTo=function(t,i,a){return e(window).scrollTo(t,i,a)};return a.defaults={axis:"xy",duration:0,limit:!0},e.fn.scrollTo=function(n,s,o){"object"==typeof s&&(o=s,s=0),"function"==typeof o&&(o={onAfter:o}),"max"===n&&(n=9e9),o=e.extend({},a.defaults,o),s=s||o.duration;var r=o.queue&&o.axis.length>1;return r&&(s/=2),o.offset=i(o.offset),o.over=i(o.over),this.each(function(){function c(t){var i=e.extend({},o,{queue:!0,duration:s,complete:t&&function(){t.call(u,h,o)}});p.animate(g,i)}if(null!==n){var l,d=t(this),u=d?this.contentWindow||window:this,p=e(u),h=n,g={};switch(typeof h){case"number":case"string":if(/^([+-]=?)?\d+(\.\d+)?(px|%)?$/.test(h)){h=i(h);break}h=d?e(h):e(h,u);case"object":if(0===h.length)return;(h.is||h.style)&&(l=(h=e(h)).offset())}var m=e.isFunction(o.offset)&&o.offset(u,h)||o.offset;e.each(o.axis.split(""),function(e,t){var i="x"===t?"Left":"Top",n=i.toLowerCase(),s="scroll"+i,f=p[s](),v=a.max(u,t);if(l)g[s]=l[n]+(d?0:f-p.offset()[n]),o.margin&&(g[s]-=parseInt(h.css("margin"+i),10)||0,g[s]-=parseInt(h.css("border"+i+"Width"),10)||0),g[s]+=m[n]||0,o.over[n]&&(g[s]+=h["x"===t?"width":"height"]()*o.over[n]);else{var y=h[n];g[s]=y.slice&&"%"===y.slice(-1)?parseFloat(y)/100*v:y}o.limit&&/^\d+$/.test(g[s])&&(g[s]=g[s]<=0?0:Math.min(g[s],v)),!e&&o.axis.length>1&&(f===g[s]?g={}:r&&(c(o.onAfterFirst),g={}))}),c(o.onAfter)}})},a.max=function(i,a){var n="x"===a?"Width":"Height",s="scroll"+n;if(!t(i))return i[s]-e(i)[n.toLowerCase()]();var o="client"+n,r=i.ownerDocument||i.document,c=r.documentElement,l=r.body;return Math.max(c[s],l[s])-Math.min(c[o],l[o])},e.Tween.propHooks.scrollLeft=e.Tween.propHooks.scrollTop={get:function(t){return e(t.elem)[t.prop]()},set:function(t){var i=this.get(t);if(t.options.interrupt&&t._last&&t._last!==i)return e(t.elem).stop();var a=Math.round(t.now);i!==a&&(e(t.elem)[t.prop](a),t._last=this.get(t))}},a}),$(function(){$(".jf-date").each(function(e,t){$(this).date()})}),$(function(){var e,t=".full-screen",i=".options-list",a=".o-item",n=".s-v",s=".edit-b",o=".stretch-b",r=".bread-crumbs",c=".my-view",l=".return-b",d=0;$(i).find(n).hide(),$(i).find(a).each(function(l,u){$(this).find(".w").click(function(){$(this).find(o).click()}),$(this).find(o).click(function(t){clearTimeout(e),$(i).find(a).each(function(e,t){e!==l&&$(this).find(o)[0].toggle&&($(this).find(n).slideToggle("fast"),$(this).find(o).toggleClass("up").find("font").html("展开"),$(this).find(o)[0].toggle=!$(this).find(o)[0].toggle)}),$(u).find(n).slideToggle("fast"),$(this).toggleClass("up").find("font").html(this.toggle?"展开":"收起").parent().find("em > i").attr("class",this.toggle?"image-c-course-o-2":"image-c-course-o-2r"),this.toggle||(e=setTimeout(function(){$("body,html").stop(!0,!0).animate({scrollTop:$(u).offset().top},"normal")},300)),this.toggle=!this.toggle,t.stopPropagation()}),$(this).find(s).click(function(e){d=document.documentElement.scrollTop||document.body.scrollTop,$("body").css({overflow:"hidden"}),$(r).find("span:eq(0)").html(" — 编辑"+$(u).find(".title span").eq(0).html()),$(t).show(),$(c).hide().eq(l).show(),jf.css3Animate($(t)[0],"scaleIn animated",function(){$(t).siblings("div").hide()}),e.stopPropagation()})}),$(t).find(l).click(function(){$(t).siblings("div").show(),document.documentElement.scrollTop=document.body.scrollTop=d,jf.css3Animate($(t)[0],"scaleOut animated",function(){$("body").css({overflow:""}),$(r).find("span:eq(0)").html(""),$(c).hide(),$(t).hide()})})}),$(function(){var e,t=".md-nav a",i=".options-list .o-item";$(t).each(function(t,a){$(this).click(function(){clearTimeout(e),$(i).eq(t).find(".s-v").is(":visible")?e=setTimeout(function(){$("body,html").stop(!0,!0).animate({scrollTop:$(i).eq(t).offset().top},"normal")},300):$(i).eq(t).find(".stretch-b").click()})})}),$(function(){function item(w,v,b,b2,attr){$(w).each(function(index,item){$(this).find(b2).addClass("open").attr("title","展开"),eval("$(this).find(v).css({"+attr+":-$(this).find(v).outerWidth(true)}).hide()"),$(this).find(b).length>0&&!$(this).find(b)[0].clickFlag&&($(this).find(b).click(function(){this.toggleFlag?($(item).find(b2).addClass("open").attr("title","展开"),eval("$(item).find(v).stop(true,true).animate({"+attr+":-$(item).find(v).outerWidth(true)},'fast',function (){ $(this).hide() })"),eval("$(item).find('.ew-word').stop(true,true).animate({"+attr+":0},'fast')")):($(item).find(b2).removeClass("open").attr("title","隐藏"),eval("$(item).find(v).show().stop(true,true).animate({"+attr+":0},'fast')"),eval("$(item).find('.ew-word').stop(true,true).animate({"+attr+":"+($(item).find(v).outerWidth(!0)+5)+"},'fast')")),this.toggleFlag=!this.toggleFlag}),$(this).find(b)[0].clickFlag=!0),$(this).find(v).find(b2).length>0&&!$(this).find(v).find(b2)[0].clickFlag&&($(this).find(v).find(b2).click(function(){$(item).find(b).click()}),$(this).find(v).find(b2)[0].clickFlag=!0)})}item(".edit-w",".ew-list",".overview-b",".close-b","left"),item(".edit-w",".ew-related",".set-knowledge-b",".close-b","right")}),$(function(){function e(){var t=$(document).height()-91,i=$(window).scrollTop()+$(window).height();i>t?$(".mft-f").removeClass("mft-fixed"):$(".mft-f").addClass("mft-fixed"),$(".return-top").css({display:$(window).scrollTop()>100?"block":"none"}),setTimeout(e)}e()});var module=angular.module("RCP",["ngRoute","ngCookies","ngSanitize","LocalStorageModule"]);module.factory("$resource",["request",function(e){return function(t){return{get:function(i,a,n){e({method:"GET",url:t,params:i}).then(a,function(e){"function"==typeof n&&n(e.data)})}}}}]),module.controller("courseEditCtrl",["$routeParams","$scope","$rootScope","$http","service","$timeout","course","$location",function(e,t,i,a,n,s,o,r){i.type=rcpAid.queryString("type"),i.cid=rcpAid.queryString("id"),i.eid=null,t.loadingMainShow=!1,i.cid||(i.cid=window.location.hash.replace("##","")),t.$root.title=i.cid?"编辑课程":"创建新课程",i.course={crs:{title:"",start_time:null,end_time:null,suitable:"",tags:[],type:i.type||"10"}},t.course=i.course,t.$on("login",function(e,t){t||n.common.toLogin()}),t.courseCat={selectCur:"",topCat:[],tags:[],tagsSelect:[],tagsSelectRecord:{},tagsExpand:!1,changeCat:function(){t.courseCat.selectCur?(t.courseCat.tagsSelect.length||(t.courseCat.tagsExpand=!0),s(function(){$("#courseCat").slideDown()})):$("#courseCat").slideUp()},selectTag:function(e){t.courseCat.tagsSelectRecord[e]||(t.courseCat.tagsSelectRecord[e]={name:e},t.courseCat.tagsSelect.push(e));
},deleteTag:function(e){t.courseCat.tagsSelectRecord[e]&&delete t.courseCat.tagsSelectRecord[e],angular.forEach(t.courseCat.tagsSelect,function(i,a){i===e&&t.courseCat.tagsSelect.splice(a,1)})},loadTags:function(e){e.length&&t.courseCat.topCat.length&&(t.courseCat.selectCur=t.courseCat.topCat[0],t.courseCat.changeCat(),t.courseCat.tagsSelect=e,angular.forEach(t.courseCat.tagsSelect,function(e,i){t.courseCat.tagsSelectRecord[e]={name:e}}),t.courseCat.tagsExpand=!1)}},t.eventTest=function(e){e.target.href===r.absUrl()&&(e.preventDefault(),s(function(){e.target.href="/",s(function(){e.target.click()})},2e3))},i.ctrlGrp={dirCtrl:angular.element('div[ng-controller="dirCtrl"]')},i.ctrlCur=null,t.dirList={items:[]},t.$on("getCourseDirNew",function(e,i){t.dirList.items=i}),i.courseStatusArr={20:{opt:"public",name:"编辑中",namePub:"发布"},100:{opt:"update",name:"已上架",namePub:"更新"},OFFSELL:{opt:"public",name:"已下架",namePub:"发布"},UNCHECKED:{opt:"public",name:"审核未通过",namePub:"发布"},CHECKED:{opt:"public",name:"审核中",namePub:"发布"},CHECK_FAIL:{opt:"public",name:"审核未通过",namePub:"发布"},FORCE_OFFSELL:{opt:"public",name:"已强制下架",namePub:"发布"},DELETED:{opt:"public",name:"已删除",namePub:"发布"}};t.coverUploadConfig={showEdit:!1,uploadNum:0,upCancel:!1,id:"courseEdit",width:550,ratio:[16,9],containerStyle:{width:"560px",height:"315px"},mode:"course",scope:null,cb:function(e){t.course.crs.cover=e}},t.uploadCover=function(){s(function(){t.coverUploadConfig.scope&&t.coverUploadConfig.scope.selectImg()})},t.deleteCover=function(e){e.stopPropagation(),t.course.crs.cover&&(t.course.crs.cover=null)},t.openFullEdit=function(e){if(!i.cid)return void t.dataSave("empty",function(){t.openFullEdit(e)});switch(e){case"dir":t.$broadcast("openDir",{id:t.course.crs.iids.text.aid}),i.ctrlCur=i.ctrlGrp.dirCtrl}};var c=function(e,i){"content"===e&&(t.contentEditStatus=i,t.$apply())};t.$on("changeStatus",function(e,t){c(t.tgt,t.status)}),t.dataSave=function(e,a){var s={};if(s.type=t.course.crs.type,s.title=t.course.crs.title,s.imgs=""===t.course.crs.cover?[]:[t.course.crs.cover],s.start_time=+moment($("#startTime").val()).format("x")||void 0,s.end_time=+moment($("#endTime").val()).format("x")||void 0,s.suitable=t.course.crs.suitable.replace("，",",").split(","),(angular.isUndefined(e)||"empty"!==e)&&!angular.isUndefined(s.start_time)&&!angular.isUndefined(s.end_time)&&s.start_time>s.end_time)return void n.dialog.alert("课程结束时间必须大于开始时间");var r=[];if(t.courseCat.selectCur&&angular.forEach(t.courseCat.tagsSelect,function(e,t){r.push(e)}),s.tags=r,i.cid){if(!s.title)return void n.dialog.alert("课程名称不能为空");s.id=i.cid,o.saveCourseData(s).then(function(i){0===i.code?e&&"release"===e?t.dataRelease("release"):e&&"update"===e?window.location.href=rcpAid.getUrl("教学中心"):n.dialog.alert("课程已保存"):n.dialog.alert(i.dmsg)})}else s.title||(s.title="课程名称"),t.loadingMainShow=!0,o.createCourse({},{option:{loading:!1}},s).then(function(s){t.loadingMainShow=!1,0===s.code?(i.cid=s.data.id,t.course.crs=t.makeCourseInfo({crs:s.data}).crs,window.location.hash="##"+i.cid,e&&"release"===e?t.dataRelease("release"):"empty"===e?a():n.dialog.alert("课程已保存")):n.dialog.alert(s.dmsg)})},t.dataRelease=function(e){if(e&&"release"===e){var a={cid:i.cid};o.releaseCourse(a).then(function(e){0===e.code?window.location.href=rcpAid.getUrl("教学中心"):n.dialog.alert(e.dmsg)})}else t.course.crs.status&&100===t.course.crs.status?t.dataSave("update"):t.dataSave("release")},t.saveItem=function(){i.ctrlCur&&i.ctrlCur.scope().saveData()},i.categoryList=[],t.makeCourseInfo=function(e){return e.crs.start_time=e.crs.start_time?moment(e.crs.start_time).format("YYYY-MM-DD HH:mm"):null,e.crs.end_time=e.crs.end_time?moment(e.crs.end_time).format("YYYY-MM-DD HH:mm"):null,e.crs.cover=e.crs.imgs.length?e.crs.imgs[0]:"",e.crs.suitable=e.crs.suitable.join(","),"10"==e.crs.type&&t.makeCourseDir(e.items),e},t.contentEditStatus=!1,t.makeCourseDir=function(e){if(e){var i=[];if(angular.forEach(e.text.idx.items,function(e,t){i.push({type:e.t,title:e.c.title})}),t.dirList.items=i,e.text.idx.art&&e.text.idx.art.idx&&e.text.idx.art.idx.itemc){var a=0;angular.forEach(e.text.idx.art.idx.itemc,function(e,t){a+=Number(e)}),a&&(t.contentEditStatus=!0)}}},t.getCourseInfo=function(e){o.getCourseDetail({cid:e,cmds:{text:{idx:{type:"T1,T2",itemc:1}}}}).then(function(e){0===e.code?(t.course=t.makeCourseInfo(e.data),t.courseCat.loadTags(t.course.crs.tags)):n.dialog.alert(e.dmsg)},function(){})},t.tags=null,t.getTags=function(){o.getAllTags({},"").then(function(e){0===e.code&&(t.tags=e.data.p_classifi.tags,t.courseCat.tags=e.data.p_classifi.tags,t.courseCat.topCat.push({name:e.data.p_classifi.name})),i.cid&&t.getCourseInfo(i.cid)})},t.init=function(){t.getTags()},t.init()}]),module.controller("dirCtrl",["$scope","$rootScope","$interval","$timeout",function(e,t,i,a){wcms.update=DYCONFIG.course.rUrl+"art/api/update",wcms.load=DYCONFIG.course.rUrl+"art/api/load",e.open="dir",e.aid="",e.$on("openDir",function(t,i){e.open="dir",e.aid||e.initContent(i.id)}),e.initContent=function(t){e.aid=t,a(function(){var t=i(function(){e.contentConfig.scope&&(e.contentConfig.scope.init(e.aid),e.initContentEdit(),i.cancel(t))},500)})},e.contentConfig={openPaper:function(i){i.data&&i.data.aid&&(e.paperConfig.aid=i.data.aid,e.paperConfig.type=i.data.type,e.paperConfig.tid=i.data.tid,e.paperConfig.id=i.id,e.paperConfig.cid=t.cid,e.paperConfig.scope.init(),e.open="exam")},changeStatus:function(t){e.$emit("changeStatus",{tgt:"content",status:!!t})},scope:null},e.paperConfig={aid:"",id:"",save:function(t){e.contentConfig.scope.savePaper(t)},back:function(){e.open="dir"},scope:null},CKEDITOR.plugins.addExternal("sharedspace","../../ckeditor_ext/plugin/sharedspace/","plugin.js"),e.saveData=function(){e.contentConfig.scope&&e.contentConfig.scope.saveContent()},e.initContentEdit=function(){e.contentConfig.scope&&e.contentConfig.scope.getContent()}}]),module.factory("course",["request",function(e){var t=DYCONFIG.course.rUrl;return{getCourseDetail:function(i,a){i.token=rcpAid.getToken();var n={method:"GET",url:t+"pub/api/loadCourse",params:i};return e(angular.extend(n,a||{}))},getTeacherCourses:function(i,a){i.token=rcpAid.getToken(),i.isSelf=1;var n={method:"GET",url:t+"pub/api/searchCourse",params:i};return e(angular.extend(n,a||{}))},joinFreeCourse:function(i,a){i.token=rcpAid.getToken();var n={method:"GET",url:t+"usr/api/joinCourse",params:i};return e(angular.extend(n,a||{}))},searchCourse:function(i,a){var n={method:"GET",url:t+"pub/api/searchCourse",params:i};return e(angular.extend(n,a||{}))},verifyCourse:function(i,a){i.token=rcpAid.getToken();var n={method:"GET",url:t+"usr/api/verifyCourse",params:i};return e(angular.extend(n,a||{}))},createCourse:function(i,a,n){i.token=rcpAid.getToken();var s={method:"POST",url:t+"usr/api/createCourse",params:i,data:n};return e(angular.extend(s,a||{}))},getStudentCourse:function(i,a){i.token=rcpAid.getToken(),i.isSelf=10;var n={method:"GET",url:t+"pub/api/searchCourse",params:i};return e(angular.extend(n,a||{}))},releaseCourse:function(i,a){i.token=rcpAid.getToken();var n={method:"GET",url:t+"usr/api/releaseCourse",params:i};return e(angular.extend(n,a||{}))},saveCourseData:function(i,a){var n={};n.token=rcpAid.getToken();var s={method:"POST",url:t+"usr/api/updateCourse",params:n,data:i};return e(angular.extend(s,a||{}))},cancelCourse:function(i,a){i.token=rcpAid.getToken();var n={method:"POST",url:t+"usr/api/cancelCourse",params:i};return e(angular.extend(n,a||{}))},getListGroup:function(i,a){i.token=rcpAid.getToken();var n={method:"GET",url:t+"pub/api/listGroup",params:i};return e(angular.extend(n,a||{}))},getAllTags:function(t,i){t.token=rcpAid.getToken();var a={method:"POST",url:DYCONFIG.pes.rUrl+'pub/api/page/GetPage?keys=[{"key":"p_classifi"}]',params:t};return e(angular.extend(a,i||{}))},updateArticleExt:function(i,a){i.token=rcpAid.getToken();var n={method:"GET",url:t+"usr/api/updateExt",params:i};return e(angular.extend(n,a||{}))},getArticleExt:function(i,a){i.token=rcpAid.getToken();var n={method:"GET",url:t+"pub/api/listArtExt",params:i};return e(angular.extend(n,a||{}))},loadRecord:function(i,a){i.token=rcpAid.getToken();var n={method:"GET",url:t+"pub/api/loadRecord",params:i};return e(angular.extend(n,a||{}))},listPaperCorrect:function(i,a){i.token=rcpAid.getToken();var n={method:"GET",url:t+"usr/api/listPaperCorrect",params:i};return e(angular.extend(n,a||{}))},Publish:function(i,a){i.token=rcpAid.getToken();var n={method:"GET",url:t+"usr/api/publish",params:i};return e(angular.extend(n,a||{}))}}}]),module.run(["service","course",function(e,t){e.expand("course",function(){return t})}]),angular.module("RCP").directive("imageSlider",function(){return{template:'<div class="image-slider"><style type="text/css">.image-slider-wrapper{padding:10px;background:#f2f2f2}.slider-action li{display:inline-block;margin-right:5px}.slider-action a{color:#999}.slider-action img{width:13px;height:13px;margin-right:4px}.slider-main{margin:10px 0;background:#fff;padding:5px;text-align:center;overflow:hidden;-ms-user-select:none;user-select:none;-webkit-user-select:none;-moz-user-select:none}.slider-main.right{cursor:url(/img/pic_next.cur),auto}.slider-main.left{cursor:url(/img/pic_prev.cur),auto}.slider-all ul{display:block;padding:0 25px;white-space:nowrap;vertical-align:middle;overflow:hidden;width:100%;word-wrap:normal}.slider-all li{display:inline-block;position:relative;-moz-transition:all .3s;-o-transition:all .3s;transition:all .3s}.slider-all .slider-images{width:45px;height:45px;padding:2px;cursor:pointer;border:2px solid transparent}.slider-all .slider-images.active{border:2px solid #6baef8}.slider-all{position:relative;overflow:hidden}.slider-all .nav-btn{display:block;position:absolute;top:0;bottom:0;padding:15px 5px;color:#bfbfbf;border:1px solid #e5e5e5;vertical-align:middle;text-decoration:none;background:#F7F7F7;z-index:10}.slider-all .nav-btn.left{left:0}.slider-all .nav-btn.right{right:0}.slider-all .nav-btn.active{color:#fff;background:#FFAD8F}.prev-list{margin-top:-5px}.prev-list li{border:none;display:inline-block;margin-right:5px;margin-top:5px}.prev-list .s-img{width:80px;height:80px;cursor:pointer}</style><ul class="prev-list" ng-hide="show"><li ng-repeat="img in images track by $index"><ng-img c="{img:img}" class="s-img" ng-click="showBigPic($index)"></ng-img></li></ul><div ng-show="show" class="image-slider-wrapper"><div class="slider-action"><ul><li><a ng-click="show=false" href="javascript:;"><i class="fa fa-long-arrow-up"></i> 收起</a></li><li><a ng-href="{{images[currentImage]}}" target="_blank"><i class="fa fa-search-plus"></i> 查看大图</a></li><li><a ng-click="turnLeft()" href="javascript:;"><i class="fa fa-undo"></i> 向左旋转</a></li><li><a ng-click="turnRight()" href="javascript:;"><i class="fa fa-repeat"></i> 向右旋转</a></li></ul></div><div class="slider-main {{cursor}}" ng-click="nextOrPrev()" ng-mousemove="showCursor($event)"><img ng-src="{{images[currentImage]}}" alt="" ng-style="{\'max-width\': bigImgWidth, \'max-height\': 325, transform: \'rotate(\' + rotateDeg() + \'deg)\',\'-webkit-transform\': \'rotate(\' + rotateDeg() + \'deg)\', \'-ms-transform\': \'rotate(\' + rotateDeg() + \'deg)\', \'-moz-transform\': \'rotate(\' + rotateDeg() + \'deg)\', transition:\'all 0.2s\'}"></div><div class="slider-all"><a href="javascript:;" ng-class="{active: showToggle(\'left\')}" ng-click="toggleSlide(\'left\')" class="nav-btn left">&lt</a><ul style="width:{{imageListWidth}}px"><li ng-repeat="img in images track by $index" style="left:{{left}}px"><ng-img c="{img:img,divClass:{active: currentImage==$index}}" ng-click="switchImg($index)" alt="" class="slider-images"></ng-img></li></ul><a href="javascript:;" ng-class="{active: showToggle(\'right\')}" ng-click="toggleSlide(\'right\')" class="nav-btn right">&gt</a></div></div></div>',restrict:"E",scope:{images:"=",loop:"="},controller:["$scope","$element","$timeout",function(e,t,i){var a=['<style id="image-slider-style">',".image-slider-wrapper {","padding: 10px;","background: #f2f2f2;","}",".slider-action li {","display: inline-block;","margin-right: 5px;","}",".slider-action a {","color: #999999;","}",".slider-action img {","width: 13px;","height: 13px;","margin-right: 4px;","}",".slider-main {","margin: 10px 0;","background: #fff;","padding: 5px;","text-align: center;","overflow: hidden;","user-select: none;","-webkit-user-select: none;","-moz-user-select: none;","}",".slider-main.right {",'cursor: url("/rcp-common/imgs/icon/pic_next.png"), auto;',"}",".slider-main.left {",'cursor: url("/rcp-common/imgs/icon/pic_prev.png"), auto;',"}",".slider-all ul {","display: inline-block;","white-space: nowrap;","vertical-align: middle;","overflow: hidden;","}",".slider-all li {","display: inline-block;","position: relative;","transition: all 0.3s;","}",".slider-all .slider-images {","width: 45px;","height: 45px;","padding: 2px;","cursor: pointer;","border: 2px solid rgba(0,0,0,0);","}",".slider-all .slider-images.active {","border: 2px solid #6baef8;","}",".slider-all .nav-btn {","display: inline-block;","padding: 15px 5px;","color: #bfbfbf;","border: 1px solid #e5e5e5;","vertical-align: middle;","text-decoration: none;","background: #F7F7F7;","}",".slider-all .nav-btn.active {","color: #fff;","background: #FFAD8F;","}",".prev-list li {","border: none;","display: inline-block;","margin-right: 5px;","}",".prev-list .s-img {","width: 80px;","height: 80px;","cursor: pointer;","}","</style>"].join("");angular.element("#image-slider-style").length||angular.element("body").append(a),e.turnLeftCount=e.turnRightCount=0,e.imageListWidth=0,e.bigImgWidth=0,e.bigImgOffset={top:0,left:0},e.$watch("show",function(a){a&&(e.wrapperWidth=t.find(".image-slider").width(),e.bigImgWidth=e.wrapperWidth-20,e.imageListWidth=e.wrapperWidth-76,i(function(){e.bigImgOffset=t.find(".slider-main").offset()},100))}),e.showBigPic=function(t){e.show=!0,e.switchImg(t)},e.switchImg=function(t){e.currentImage=t,e.turnLeftCount=e.turnRightCount=0},e.showCursor=function(t){if(e.images){if(e.images.length<2)return void(e.cursor="");var i=t.pageX-e.bigImgOffset.left;i>e.bigImgWidth/2?e.loop||e.currentImage<e.images.length-1?e.cursor="right":e.cursor="":e.loop||e.currentImage>0?e.cursor="left":e.cursor=""}},e.nextOrPrev=function(){e.images&&("left"===e.cursor?e.loop&&0===e.currentImage?e.switchImg(e.images.length-1):e.switchImg(e.currentImage-1):"right"===e.cursor&&(e.loop&&e.currentImage===e.images.length-1?e.switchImg(0):e.switchImg(e.currentImage+1)))},e.turnLeft=function(){e.turnLeftCount=e.turnLeftCount+1},e.turnRight=function(){e.turnRightCount=e.turnRightCount+1},e.rotateDeg=function(){return 90*(e.turnRightCount-e.turnLeftCount)},e.left=0,e.showToggle=function(t){if(e.images){var i=58;return"right"===t?i*e.images.length+e.left>e.imageListWidth:"left"===t?e.left<0:void 0}},e.toggleSlide=function(t){"right"===t&&e.showToggle(t)?e.left=e.left-e.imageListWidth:"left"===t&&e.showToggle(t)&&(e.left=e.left+e.imageListWidth)}}]}}),module.directive("pagination",function(){return{template:'<div class="page-bar" ng-show="list.length>0"><a href="javascript:;" ng-class="current<=0?\'disabled\':\'\'" ng-click="prev()"><em class="emic">&lt;</em><em class="emf">上一页</em></a><a href="javascript:;" ng-repeat="key in keyList" ng-class="key==current ? \'cur\' : \'\'" ng-click="jump(key)">{{key+1}}</a><span ng-show="pLen>pMax && !hideEllipsis">...</span><a href="javascript:;" ng-class="current>=pLen-1?\'disabled\':\'\'" ng-click="next()"><em class="emf">下一页</em><em class="emic">&gt;</em></a><span class="jump-bar"><span>共<font class="blue-c">{{pLen}}</font>页</span><span>跳到 <input type="text" style="width:38px;height:19px;text-align:center;" ng-model="goKey"> 页</span><a href="" ng-click="go(goKey)">GO</a></span></div>',restrict:"E",replace:!0,transclude:!0,scope:{list:"=list",pagefn:"=pagefn",pageargs:"=pageargs",deepwatch:"="},controller:["$scope","$element","$attrs","service",function(e,t,i,a){e.$watch("pageargs",function(t,i){t&&(e.current=parseInt(e.pageargs.pn)-1,e.pageNode=e.current,e.pNum=parseInt(e.pageargs.ps),e.pMax=parseInt(e.pageargs.pl)||5,e.pagefn(e.pageargs,function(t){e.pLen=Math.ceil(parseInt(t.pa.total)/e.pNum),e.keyListWatch()}))},e.deepwatch),e.reKeyList=function(t,i,a){e.keyList=[];for(var n=t;i>n&&!(n>=a);n++)e.hideEllipsis=n+1==e.pLen,e.keyList.push(n)},e.keyListWatch=function(){var t=e.pLen;if(t>e.pMax){var i=Math.ceil(e.pMax/2),a=e.current;a>=i&&a<t-(e.pMax-i)?e.reKeyList(a-(e.pMax-i),a+i,t):a>=t-(e.pMax-i)?e.reKeyList(t-e.pMax,t,t):i>=a&&e.reKeyList(0,t,e.pMax)}else e.reKeyList(0,t,e.pMax)},e.jump=function(t){e.pageNode!=t&&(e.current=t,e.pageNode=t,e.pageargs.pn=t+1,e.pagefn(e.pageargs,function(t){e.pLen=Math.ceil(parseInt(t.pa.total)/e.pNum),e.keyListWatch()}))},e.next=function(){e.current++,e.current>=e.pLen&&(e.current=e.pLen-1),e.jump(e.current)},e.prev=function(){e.current--,e.current<=0&&(e.current=0),e.jump(e.current)},e.go=function(t){var i=/^-?\d+$/g;void 0==t||t.length<=0?a.dialog.alert("输入不能为空！",{}):i.test(t)?(parseInt(t)>e.pLen?(t=e.pLen,a.dialog.alert("总共只有"+e.pLen+"页，为您转到最后一页！",{})):parseInt(t)<=0&&(t=1,a.dialog.alert("不能低于第1页,为您转到最前一页！",{})),e.jump(parseInt(t)-1),e.goKey=void 0):t.match(/\s+/g)?a.dialog.alert("输入不能有空格符！",{}):a.dialog.alert("格式错误，请输入整数！",{})}}]}}),module.factory("dynamicService",function(){var e={emotions:"表情服务"};return function(){function t(){this._hash=new Object,this.put=function(e,t){return"undefined"!=typeof e&&0==this.containsKey(e)?(this._hash[e]="undefined"==typeof t?null:t,!0):!1},this.remove=function(e){delete this._hash[e]},this.size=function(){var e=0;for(var t in this._hash)e++;return e},this.get=function(e){return this._hash[e]},this.containsKey=function(e){return"undefined"!=typeof this._hash[e]},this.clear=function(){for(var e in this._hash)delete this._hash[e]}}var i=!0,a=new Array,n=new Array,s=new t,o="1362404091";$.ajax({dataType:"jsonp",url:"https://api.weibo.com/2/emotions.json?source="+o,success:function(e){switch(e.code){case 1:for(var t=e.data,o=0;o<t.length;o++)""==t[o].category&&(t[o].category="默认"),void 0==a[t[o].category]&&(a[t[o].category]=new Array,n.push(t[o].category)),a[t[o].category].push({name:t[o].phrase,icon:t[o].icon}),s.put(t[o].phrase,t[o].icon);i=!1,l&&l.ready();break;default:jf.alert(e.data.error)}},error:function(){jf.alert("表情数据请求失败")}});var r,c,l,d,u,p,h,g="#emotions",m="#emotions .container",f="#emotions .container a",v="#emotions .categorys",y="#emotions .categorys a",w="#emotions .prev",x="#emotions .next",b="#emotions .page",k="#emotions .page a";e.emotions={emotions:a,categorys:n,uSinaEmotionsHt:s,viewLocate:function(){var e,t=$(d).offset().top+$(d).outerHeight(!0),i=$(d).offset().left+$(d).width()/2-29,a=$(window).width(),n=$(document).height(),s=$(d).outerWidth(!0),o=$(g).outerWidth(!0),r=$(d).outerHeight(!0),c=$(g).outerHeight(!0),l=$(g).outerHeight(!0)/2+$(d).outerHeight(!0)/2,u=c>n-t,p=c>t-r,h=i+o>a,m=o>i,f=function(){h&&(u=l>n-t,p=l>t-r),i-=o+10,e=!u&&p?"r r1":u&&!p?"r r3":"r r2",t-=!u&&p?30:u&&!p?c:l},v=function(){e="l",i+=s,t-=l},y=function(){e="b",t-=c+r};u&&p?m?v():f():h?f():u&&y(),$(g).find(".ag-ic").addClass(e),$(g).css({top:t,left:i})},show:function(e,t){return $(document).unbind("click").bind("click",function(){$(g).remove()}),l=this,d=e.target,p=$(e.dyeditor).get(0),h=t,$(g).length?(u==d?$(g).remove():l.viewLocate(),void(u=d)):(u=d,$("body").append('<div id="emotions"></div>'),$(g).html('<span class="ag-ic"><i></i><em></em></span><div>正在加载，请稍候...</div>'),$(g).click(function(e){e.stopPropagation()}),$(g).find(".ag-ic").click(function(){$(g).remove()}),l.ready(),void l.viewLocate())},ready:function(){!i&&$(g).length&&($(g).html('<span class="ag-ic"><i></i><em></em></span><div style="float:right"><a href="javascript:void(0);" class="prev">&laquo;</a><a href="javascript:void(0);" class="next">&raquo;</a></div><div class="categorys"></div><div class="container"></div><div class="page"></div>'),$(g).find(".ag-ic").click(function(){$(g).remove()}),$(w).click(function(){l.showCategorys(c-1)}),$(x).click(function(){l.showCategorys(c+1)}),l.showCategorys(),l.showEmotions(),l.viewLocate())},showCategorys:function(){var e=arguments[0]?arguments[0]:0;if(!(0>e||e>=n.length/5)){$(v).html(""),c=e;for(var t=5*e;5*(e+1)>t&&t<n.length;++t)$(v).append($('<a href="javascript:void(0);">'+n[t]+"</a>"));$(y).click(function(){l.showEmotions($(this).text())}),$(y).each(function(){$(this).text()==r&&$(this).addClass("current")})}},showEmotions:function(){var e=arguments[0]?arguments[0]:"默认",t=arguments[1]?arguments[1]-1:0;$(m).html(""),$(b).html(""),r=e;for(var i=72*t;72*(t+1)>i&&i<a[e].length;++i)$(m).append($('<a href="javascript:void(0);" title="'+a[e][i].name+'"><img src="'+a[e][i].icon+'" alt="'+a[e][i].name+'" width="22" height="22" /></a>'));$(f).click(function(){l.insertText($(this).attr("title")),$(g).remove()});for(var i=1;i<a[e].length/72+1;++i)$(b).append($('<a href="javascript:void(0);"'+(i==t+1?' class="current"':"")+">"+i+"</a>"));$(k).click(function(){l.showEmotions(e,$(this).text())}),$(y+".current").removeClass("current"),$(y).each(function(){$(this).text()==e&&$(this).addClass("current")}),$(g).css({minHeight:254})},insertText:function(e){l.inCursorInsertAtCaret(l.AnalyticEmotion(e),p),h&&h($(p).html())},inCursorInsertAtCaret:function(e,t){var i,a;if(window.getSelection&&window.getSelection().getRangeAt){var n=window.getSelection(),s=n.focusNode;s&&(n=n.getRangeAt(0)),$(t).focus(),i=window.getSelection(),a=i.getRangeAt(0),a.startOffset==a.endOffset?s&&n.startContainer==a.startContainer||(a.selectNodeContents(t),a.setStart(a.endContainer,a.endOffset),a.setEnd(a.endContainer,a.endOffset)):a.deleteContents();var o=document.createElement("div");o.innerHTML=e;for(var r,c,l=document.createDocumentFragment();r=o.firstChild;)c=l.appendChild(r);a.insertNode(l,c),c&&(a=a.cloneRange(),a.setStartAfter(c),a.collapse(!0),i.removeAllRanges(),i.addRange(a))}else document.selection&&document.selection.createRange&&($(t).focus(),document.selection.createRange().pasteHTML(e))},AnalyticEmotion:function(e){if("undefined"!=typeof e){var t=e.match(/\[.*?\]/g);if(t)for(var i=0;i<t.length;i++)if(s.containsKey(t[i])){var a='<img src="'+s.get(t[i])+'" height="22" width="22" />';e=e.replace(t[i],a)}}return e}}}(),e}),module.directive("addface",function(){return{restrict:"A",scope:{data:"=addface"},controller:["$scope","$element","$timeout","dynamicService",function(e,t,i,a){t.on({click:function(i){a.emotions.show({dyeditor:t.attr("bindeditor"),target:t.get(0)},function(t){e.data=t}),i.stopPropagation()}})}]}}),module.directive("dyeditor",function(){return{template:'<div class="dyeditor-w"><div class="stint-chac"><span ng-class="{\'c-gray\':exceed}" ng-hide="exceed">还可以输入<b class="text1">{{surplus}}</b>字</span> <span ng-class="{\'c-red\':exceed>0}" ng-show="exceed">已超出<b class="text1">{{exceed}}</b>字</span></div><div class="placeholder" ng-hide="model&&model!==\'<br>\'">{{config.placeholder}}</div><div class="contenteditable" contenteditable="true" id="{{config.id}}" ng-style="config.style" ng-focus="onfocus()" ng-blur="onblur()" ng-click="change()"></div></div>',restrict:"E",replace:!0,transclude:!0,scope:{model:"=model",exceed:"=exceed",config:"=config"},controller:["$scope","$element","$attrs","$timeout",function(e,t,i,a){function n(){$(s).html()!==o&&(o=$(s).html(),s.click()),setTimeout(n)}var s=t.find(".contenteditable").get(0);e.surplus=e.config.len,e.checkLen=function(t){if(e.config.len){var i=$(t).text(),a=2*parseInt(e.config.len),n=0;i&&(n=parseInt(i.length)),e.exceed=n>a?Math.ceil((n-a)/2):0,e.surplus=i&&n>a?0:i?parseInt((a-n)/2):parseInt(e.config.len)}},e.change=function(t){e.model=void 0!==t?t:$(s).html(),e.config.len&&e.checkLen(s)},e.onfocus=function(){e.config.len&&t.find(".stint-chac").show(),e.focus=!0},e.onblur=function(){t.find(".stint-chac").css({display:e.exceed?"block":"none"}),e.focus=!1},e.$watch("model",function(i,a){void 0!==typeof i&&i!==$(s).html()&&($(s).html(i),e.config.len&&e.checkLen(s),t.find(".stint-chac").css({display:e.exceed?"block":"none"}))});var o=$(s).html();n()}]}}),module.filter("filterDynamicHtml",["$sce","dynamicService",function(e,t){return function(i){return e.trustAsHtml(t.emotions.AnalyticEmotion(i))}}]),module.filter("bindHtml",["$sce",function(e){return function(t){return e.trustAsHtml(t)}}]),module.directive("editTextarea",function(){return{template:'<div class="textarea-w"><div class="stint-chac">还可以输入<b style="font-family:Georgia,Times New Roman,Times, serif;font-size:21px;">{{len}}</b>字</div><textarea class="textarea" ng-model="model" placeholder="{{myplaceholder}}" ng-style="mystyle" ng-show="!cfg.input"></textarea><input class="textarea" ng-model="model" placeholder="{{myplaceholder}}" ng-style="mystyle" ng-show="cfg.input" /></div>',restrict:"E",replace:!0,transclude:!0,scope:{len:"=len",model:"=model",mystyle:"=mystyle",myplaceholder:"=myplaceholder",config:"=config"},controller:["$rootScope","$scope","$element","$attrs","$timeout",function(e,t,i,a,n){t.cfg=t.config||{},t.initHeight=t.mystyle&&"height"in t.mystyle?t.mystyle.height:"",t.check=function(e){if(t.cfg.input||(!t.mystyle||t.mystyle&&"auto"!==t.mystyle.overflow)&&($(e).css("height",t.initHeight),e.scrollHeight>$(e).outerHeight(!0)&&$(e).css("height",e.scrollHeight-10)),t.len){var a=$(e).val(),n=2*parseInt(t.len);if(a){var s=parseInt(a._getLen());s>n&&$(e).val(a._limitLen(n,""))}i.find("b").html(a&&s>n?"0":a?parseInt((n-s)/2):parseInt(t.len))}},i.find(".textarea").on({keyup:function(){t.check(this)},focus:function(){t.len&&i.find(".stint-chac").show(),t.check(this)},blur:function(){t.blurVal=$(this).val(),i.find(".stint-chac").hide(),t.myWatch()}}),t.myWatch=function(){i.find(".textarea").val()!==t.blurVal?t.check(i.find(".textarea")):n(t.myWatch)}}]}}),module.directive("datetime",function(){return{template:'<span ng-style="style"><input type="text" ng-class="config.class" ng-model="value" placeholder="{{config.placeholder}}" ng-click="toggle($event)" readonly /></span>',restrict:"E",replace:!0,transclude:!0,scope:{value:"=value",startdate:"=startdate",enddate:"=enddate",config:"=config"},controller:["$scope","$element","$document","$compile","$interval","datetimeService",function(e,t,i,a,n,s){e.style={position:"relative",display:"inline-block",cursor:"default"},e.config.noInput&&(e.style.display="none"),e.toggle=function(o){return s.tpl&&(i.unbind("click"),s.tpl.remove(),s.tag===t)?(delete s.tpl,void n.cancel(s.clockTimer)):(s.tag=t,s.tpl=a('<datetime-tpl value="value" config="config"></datetime-tpl>')(e),e.config.noInput?e.config.targetElement.append(s.tpl):t.append(s.tpl),i.bind("click",e.toggle),void o.stopPropagation())},s.toggle=e.toggle}]}}),module.directive("datetimeTpl",function(){return{template:["<div ng-class=\"timeFlag ? 'datetime-w and-time-style' : 'datetime-w'\" ng-click=\"stopPropagation($event)\">",'<div style="cursor:default">','<em class="arrow-ic"></em>','<div class="show-time-box">','<div class="now-time">',"<p>当前时间</p>","<span>{{clockString}}</span>","</div>",'<div style="padding: 15px 0px;">',"<select ",'class="hour" ','ng-options="item.str for item in hourList" ','ng-model="repeatData.hour" ','ng-change="change({hour: repeatData.hour})"></select>',"</div>","<div>","<select ",'class="minute" ','ng-options="item.str for item in minuteList" ','ng-model="repeatData.minute" ','ng-change="change({minute: repeatData.minute})"></select>',"</div>","</div>",'<div class="show-date-box">','<div class="t">','<a href="javascript:;" class="p" title="上一月" ng-click="mBefore()"></a>','<a href="javascript:;" class="n" title="下一月" ng-click="mAfter()"></a>',"<select ",'class="y" ','ng-options="item.str for item in yearList" ','ng-model="repeatData.year" ','ng-change="change({year: repeatData.year})"></select>',"<select ",'class="m" ','ng-options="item.str for item in monthList" ','ng-model="repeatData.month" ','ng-change="change({month: repeatData.month})"></select>','<div class="w">',"<h4>一</h4>","<h4>二</h4>","<h4>三</h4>","<h4>四</h4>","<h4>五</h4>","<h4>六</h4>","<h4>日</h4>","</div>","</div>",'<div class="c">','<a ng-repeat="item in dayList" ng-class="item.class" ng-click="change({day: item})">{{item.val}}</a>',"</div>",'<div class="f">','<a href="javascript:;" class="clear" ng-click="clearValue()">清空</a>','<a href="javascript:;" class="today" ng-click="today()">今日</a>','<a href="javascript:;" class="cancel" ng-click="cancel()">取消</a>',"</div>","</div>","</div>","</div>"].join(""),restrict:"E",replace:!0,transclude:!0,scope:{value:"=value",config:"=config"},controller:["$scope","$element","$timeout","$interval","$document","datetimeService",function(e,t,i,a,n,s){function o(e,t){for(var i=e+"";i.length<t;)i="0"+i;return i}function r(t,i,a,n,s){for(var r=[];i>t;){var c={val:t,str:o("month"===n[0]?t+1:t,a)+(s||"")};r.push(c),c.val===n[1]&&(e.repeatData[n[0]]=c),t+=1}return r}function c(t,i,a){var n=new Date,s=n.getFullYear(),o=n.getMonth(),r=n.getDate(),c=e.newDate.getFullYear(),l=e.newDate.getMonth(),d=e.newDate.getDate(),u="d ",p=function(e){e&&(u+="d-able "),t===c&&i===l&&a===d&&(u+=e?"d-now ":"d-disabled ")};return p(e.expiredFlag?s>t||t===s&&o>i||t===s&&i===o&&r>=a:e.realFlag?t>s||t===s&&i>o||t===s&&i===o&&a>=r:!0),u}function l(e){return e%4===0&&e%100!==0||e%400===0}function d(e,t){return 1===t||3===t||5===t||7===t||8===t||10===t||12===t?31:4===t||6===t||9===t||11===t?30:2===t&&l(e)?29:28}function u(e,t){var i={"M+":e.getMonth()+1,"d+":e.getDate(),"h+":e.getHours(),"m+":e.getMinutes(),"s+":e.getSeconds(),"q+":Math.floor((e.getMonth()+3)/3),S:e.getMilliseconds()};/(y+)/.test(t)&&(t=t.replace(RegExp.$1,(e.getFullYear()+"").substr(4-RegExp.$1.length)));for(var a in i)new RegExp("("+a+")").test(t)&&(t=t.replace(RegExp.$1,1===RegExp.$1.length?i[a]:("00"+i[a]).substr((""+i[a]).length)));return t}e.oldDate=new Date,e.newDate=new Date,e.curDate=new Date,e.repeatData={},e.expiredFlag=e.config.style.match("expired"),e.realFlag=e.config.style.match("real"),e.timeFlag=e.config.style.match("time"),e.formatType=e.timeFlag?"yyyy-MM-dd hh:mm":"yyyy-MM-dd",e.setSelect=function(t,i,a,n){e.yearList=r(1901,t+100,4,["year",t],"年"),e.monthList=r(0,12,2,["month",i],"月"),e.hourList=r(0,24,2,["hour",a],"点"),e.minuteList=r(0,60,2,["minute",n],"分")},e.setDay=function(t,i,a){e.dayList=function(){for(var n=[],s=0,o=new Date(t+"-"+(i+1)+"-1"),r=o.getDay()?o.getDay():7,l=d(t,i+1);42>s;){var u=s>=r-1&&l+(r-1)>s?s-(r-2):"",p=u?c(t,i,u):"d",h={val:u,"class":p};n.push(h),h.val===a&&(e.repeatData.day=h),s+=1}return n}()},e.mBefore=function(){var t=e.curDate.getMonth()-1;0>t&&(e.curDate.setFullYear(e.curDate.getFullYear()-1),t=11),e.curDate.setMonth(t),e.reset()},e.mAfter=function(){var t=e.curDate.getMonth()+1;t>11&&(e.curDate.setFullYear(e.curDate.getFullYear()+1),t=0),e.curDate.setMonth(t),e.reset()},e.change=function(i){angular.forEach(i,function(i,n){switch(n){case"year":e.curDate.setFullYear(i.val),e.reset();break;case"month":e.curDate.setMonth(i.val),e.reset();break;case"day":i["class"].match(/d-able|d-now/)&&(e.curDate.setDate(i.val),e.setValue(e.curDate),e.timeFlag?e.reset():(t.remove(),a.cancel(s.clockTimer)));break;case"hour":e.curDate.setHours(i.val),e.initValue&&(e.setValue(e.curDate),e.reset());break;case"minute":e.curDate.setMinutes(i.val),e.initValue&&(e.setValue(e.curDate),e.reset())}})},e.clear=function(i,n,o){var r=i||new Date;e.setData(e.newDate,r),e.setData(e.curDate,r),e.value=n||"",e.reset(),o||(t.remove(),a.cancel(s.clockTimer))},e.clearValue=function(){e.clear(),"function"==typeof s.onClear&&s.onClear()},e.today=function(){var t=new Date;e.clear(t,u(t,e.formatType))},e.cancel=function(){e.initValue?(e.setValue(e.oldDate),e.reset()):e.clear(),t.remove(),a.cancel(s.clockTimer)},e.stopPropagation=function(e){e.stopPropagation()},e.setData=function(e,t){e.setFullYear(t.getFullYear()),e.setMonth(t.getMonth()),e.setDate(t.getDate()),e.setHours(t.getHours()),e.setMinutes(t.getMinutes())},e.setValue=function(t){e.setData(e.newDate,t),e.setData(e.curDate,t),
e.value=u(e.newDate,e.formatType)},e.reset=function(){var t=e.curDate.getFullYear(),i=e.curDate.getMonth(),a=e.curDate.getDate(),n=e.curDate.getHours(),s=e.curDate.getMinutes();e.setSelect(t,i,n,s),e.setDay(t,i,a)},e.clock=function(){var t=new Date;e.clockString=o(t.getHours(),2)+":"+o(t.getMinutes(),2)+":"+o(t.getSeconds(),2)},e.locate=function(){var i=angular.element(window).width(),a=angular.element(window).height(),n=t.width(),s=t.height(),o=t.prev().height(),r=t.parent().offset().top-angular.element(window).scrollTop(),c=a-(r+o),l=t.parent().offset().left,d=i-(l+n),u=0,p=0,h=function(e,t,i,a){return t+i>a&&(e=a-(t+i+10),-t>e&&(e=-t)),e},g=function(a){p=h(p,l,n,i),t.addClass(a).css({left:p}),e.config.position?(t.css({bottom:30}),t.find(".arrow-ic").css({left:20})):t.find(".arrow-ic").css({left:-p+20})},m=function(e){u=h(u,r,s,a),t.addClass(e).css({top:u}),t.find(".arrow-ic").css({top:-u+o/2})},f=function(e){l+n>i&&l>n?m("dtt-w-l-sty"):n/2>l&&d>n?m("dtt-w-r-sty"):g(e)},v=function(e){m(e)};if(e.config.position)switch(p=-(28-e.config.targetElement.width()/2),e.config.position){case"top":f("dtt-w-t-sty");break;case"bottom":f("dtt-w-b-sty");break;case"left":v("dtt-w-l-sty");break;case"right":v("dtt-w-r-sty")}else c>=s?f("dtt-w-b-sty"):r>=s?f("dtt-w-t-sty"):v(l>d?"dtt-w-l-sty":"dtt-w-r-sty")},e.run=function(){e.initValue=e.value;var t=e.value?new Date(e.value.replace(/-|\./g,"/")):new Date;if(!angular.isDate(t))return void console.error("oldDate is not Date Object");e.value?(e.setData(e.oldDate,t),e.clear(t,u(t,e.formatType),"init")):e.clear(t,"","init");var n=e.oldDate.getFullYear(),o=e.oldDate.getMonth(),r=e.oldDate.getDate(),c=e.oldDate.getHours(),l=e.oldDate.getMinutes();e.setSelect(n,o,c,l),e.setDay(n,o,r),i(e.locate,80),e.timeFlag&&(e.clock(),a.cancel(s.clockTimer),s.clockTimer=a(e.clock,1e3))},e.run()}]}}),module.factory("datetimeService",function(){return{}}),module.factory("headSearch",["request",function(e){var t=g_conf.pes.rUrl;return{SearchIntelligent:function(i,a){var n={method:"GET",url:t+"pub/api/SearchIntelligent",params:i,option:{loading:!1}};return e(angular.extend(n,a||{}))}}}]),module.run(["service","headSearch",function(e,t){e.expand("headSearch",function(){return t})}]),module.directive("headnav",function(){return{template:'<header><div ng-class="headMaximizeLock ? \'head-maximize\' : \'head-minimize\'"><div ng-class="param.style"><div class="image-head-rainbow decoration-ic"></div><section class="g-m-w header-area"><div class="minimize-logo"><a ng-href="{{param.logo.href||\'/\'}}"><img ng-src="{{param.logo.small}}" alt="{{param.logo.msg}}" title="{{param.logo.msg}}"></a></div><nav class="minimize-nav"><ul><li ng-repeat="item in navList track by $index" ng-class="item.class"><a ng-href="{{item.href || \'\'}}" target="{{item.target || \'_self\'}}">{{item.name}}</a><div ng-if="item.child.length"><ul><li ng-repeat="c in item.child"><a ng-href="{{c.href || \'\'}}" target="{{c.target || \'_self\'}}">{{c.name}}</a></li></ul></div></li></ul></nav><div class="logo"><a ng-href="{{param.logo.href||\'/\'}}"><img ng-src="{{param.logo.large}}" alt="{{param.logo.msg}}" title="{{param.logo.msg}}"></a></div><div class="top-user-menu-bar" ng-class="{clearminw: user.account}"><top-user-menu user="user" item-list="itemList"></top-user-menu></div><div class="h-sc" ng-controller="headSearchCtrl"><div class="head-search-bar"><div class="enter" ng-click="stopPropagation($event)"><input type="text" class="input" ng-model="scText" ng-keydown="onkeydown($event)" ng-change="matchChange(scSelectVal.value,scText)" placeholder="请输入关键词搜索"><div class="match-kw-v" ng-show="matchReadyLock"><div class="mc-list"><ul><li ng-if="!mcCourseList || !mcCourseList.length">暂无相关内容</li><li ng-repeat="item in mcCourseList track by $index" ng-click="intoDetail(item)" ng-if="$index < cMaxLen" ng-class="{hover: $index + lMaxLen == moveKeyIndex}" ng-mouseenter="mouseenter($index, \'资源\')"><div class="text-of pd-r10"><span class="lab" ng-if="item.t == 10">课程</span> <span class="lab" ng-if="item.t == 20">题库</span> <a class="item-name" ng-bind-html="item.name | titleMatchKw:scText"></a></div></li></ul></div></div></div><a ng-click="goToSearch(scSelectVal.value,scText)" class="submit" title="提交"><i class="fa fa-search" aria-hidden="true"></i></a></div><div class="hot-word"><a ng-href="javascript:void(0);" ng-click="goToSort(item.name)" class="mg-r20" ng-repeat="item in scHotWord">{{item.name}}</a></div></div></section><section class="nav-area"><div class="g-m-w"><div class="n-categories" ng-controller="categoriesCtrl" ng-mouseenter="service.mouseenter(hover)" ng-mouseleave="service.mouseleave(hover)"><div class="dt">全部课程</div><div class="dd" id="by-categories" ng-show="categoriesUnfoldLock || hover.mouseEnterLock"><div class="image-giraffe giraffe-icon"></div><div class="dd-inner"><div class="item" ng-repeat="item in categoriesListStyle1 track by $index" ng-mouseenter="service.mouseenter(item)" ng-mouseleave="service.mouseleave(item)" ng-show="$index<5 || hover.mouseEnterLock"><div class="layer"><h3><a ng-href="goToCategory(item.name)" target="_blank" title="{{item.name}}">{{item.name}}</a></h3><div class="hot-word"><a ng-href="goToCategory(item.name,child.name)" target="_blank" class="text-of" ng-repeat="child in item.child track by $index" ng-show="$index<3" title="{{child.name}}">{{child.name}}</a></div><i>&gt;</i></div><div class="sub" ng-show="item.mouseEnterLock"><div class="inner"><dl class="card" ng-repeat="child in item.child track by $index" ng-show="$index<3"><dt><a ng-href="goToCategory(item.name,child.name)" target="_blank" class="f-r">更多&gt;&gt;</a> <a ng-href="goToCategory(item.name,child.name)" target="_blank" title="{{child.name}}">{{child.name}}</a></dt><dd><a ng-href="goToCategory(item.name,child.name,unit.name)" target="_blank" class="text-of" ng-repeat="unit in child.child track by $index" ng-show="$index<15" title="{{unit.name}}">{{unit.name}}</a></dd></dl><div class="more-srot" ng-show="item.child.length>3"><a ng-href="goToCategory(item.name)" target="_blank" class="f-r">更多分类&gt;&gt;</a>. . .</div></div></div></div><div ng-repeat="list in categoriesListStyle2 track by $index"><div class="big-sort"><a ng-href="goToCategory(item.name)" target="_blank" title="{{list.name}}">{{list.name}}</a></div><div class="item" ng-repeat="item in list.child track by $index" ng-mouseenter="service.mouseenter(item)" ng-mouseleave="service.mouseleave(item)"><div class="layer"><h3><a ng-href="goToCategory(list.name,item.name)" target="_blank" title="{{item.name}}">{{item.name}}</a></h3><i>&gt;</i></div><div class="sub" ng-show="item.mouseEnterLock"><div class="inner"><dl class="card" ng-repeat="child in item.child track by $index" ng-show="$index<4"><dt><a ng-href="goToCategory(list.name,item.name,child.name)" target="_blank" class="f-r">更多&gt;&gt;</a> <a ng-href="goToCategory(list.name,item.name,child.name)" target="_blank" title="{{child.name}}">{{child.name}}</a></dt><dd><a ng-href="goToCategory(list.name,item.name,child.name,unit.name)" target="_blank" class="text-of" ng-repeat="unit in child.child track by $index" ng-show="$index<10" title="{{unit.name}}">{{unit.name}}</a></dd></dl><div class="more-srot" ng-show="item.child.length>4"><a ng-href="goToCategory(list.name,item.name)" target="_blank" class="f-r">更多分类&gt;&gt;</a>. . .</div></div></div></div></div></div></div></div><nav class="nav"><a ng-repeat="item in navList track by $index" ng-href="{{item.href || \'\'}}" target="{{item.target || \'_self\'}}" ng-class="item.class">{{item.name}}</a></nav><div class="extra" ng-show=""><a href="javascript:void(0);" class="icf t-icf">名师认证</a> <a href="javascript:void(0);" class="icf e-icf">真实评价</a> <a href="javascript:void(0);" class="icf r-icf">随时退</a></div></div></section></div></div></header>',restrict:"E",replace:!0,transclude:!0,scope:{itemList:"=itemList",user:"=user",nav:"="},controller:["$rootScope","$scope","$element","$attrs","service",function(e,t,i,a,n){t.service=n,t.catType=parseInt(rcpAid.getCourseCat()),e.$watch("headMaximizeLock",function(e){e&&(t.headMaximizeLock=e)}),e.$watch("categoriesUnfoldLock",function(e){e&&(t.categoriesUnfoldLock=e)}),e.$watch("catDomain",function(e){if(e)switch(e){case"aikexue.com":t.init(2)}}),t.$on("login",function(e,i){i&&t.loginInit()}),t.loginInit=function(){3===t.catType&&(t.navList=[{name:"学习中心",href:rcpAid.getUrl("学习中心"),"class":"key",target:"_blank"},{name:"教学中心",href:rcpAid.getUrl("教学中心",{uid:t.user.tid}),"class":"key",target:"_blank"},{name:"高等教育",href:rcpAid.getUrl("分类",{category:"高等教育"}),"class":"key",target:"_blank"}])},t.init=function(e){if("order"===t.nav)return t.navList=[{name:"首页",href:rcpAid.getUrl("首页"),"class":"key"},{name:"个人空间",href:rcpAid.getUrl("学习中心"),"class":"key",target:"_blank"}],void(t.param={logo:{small:"/rcp-common/imgs/order/head-icon.png",large:"/rcp-common/imgs/icon/head-icon.png",href:"/my-order.html",msg:"我的酷校"},style:""});switch(t.catType){case 3:t.isLogin?t.navList=[{name:"学习中心",href:rcpAid.getUrl("学习中心"),"class":"key",target:"_blank"},{name:"教学中心",href:rcpAid.getUrl("教学中心",{uid:t.user.tid}),"class":"key",target:"_blank"},{name:"高等教育",href:rcpAid.getUrl("分类",{category:"高等教育"}),"class":"key",target:"_blank"}]:t.navList=[{name:"高等教育",href:rcpAid.getUrl("分类",{category:"高等教育"}),"class":"key",target:"_blank"}],t.param={logo:{small:"/rcp-common/imgs/icon/gzmooc-logo.png",large:"/rcp-common/imgs/icon/gzmooc-logo.png",href:DYCONFIG.rcp.rUrl,msg:"酷校 - 首页"},style:""};break;case 2:t.navList=[{name:"首页",href:rcpAid.getUrl("首页"),"class":"key"},{name:"全部课程",href:rcpAid.getUrl("分类"),"class":"key",target:"_blank"},{name:"学习中心",href:rcpAid.getUrl("学习中心"),"class":"key",target:"_blank"}],t.param={logo:{small:"/rcp-common/imgs/icon/aikexue-logo-2.png",large:"/rcp-common/imgs/icon/aikexue-logo.png",href:DYCONFIG.rcp.rUrl,msg:"爱科学"},style:"aikexue-head"};break;default:t.navList=[{name:"首页",href:rcpAid.getUrl("首页"),"class":"key"},{name:"学习中心",href:rcpAid.getUrl("学习中心"),"class":"key",target:"_blank"},{name:"我要吐槽",href:rcpAid.getUrl("我要吐槽"),"class":"key",target:"_blank"}],t.param={logo:{small:"/rcp-common/imgs/icon/book-logo-2.png",large:"/rcp-common/imgs/icon/book-logo.png",href:DYCONFIG.rcp.rUrl,msg:"酷校LOGO·让学习更Cool"},style:""}}},t.init()}]}}),module.directive("topUserMenu",function(){return{template:'<div class="top-user-menu"><div style="font-size:14px;line-height:40px" ng-show="!currentUser.uid"><a ng-href="{{link.login}}" id="login" class="color-cyan pd-l20"><i class="image-login-user-ic"></i>马上登录 </a><span style="color:#ececec;margin:0 8px">| </span><a ng-href="{{link.register}}" class="color-cyan">注册</a></div><div class="menber-link" ng-show="currentUser.uid"><a href="" class="u-info" rel="member_link"><img ng-hide="currentUser.avatar" src="/rcp-common/imgs/face/d-face-1.png" class="face-img" width="40" height="40" rel="user_face" alt="{{currentUser.nickName}}"> <img ng-show="currentUser.avatar" ng-src="{{currentUser.avatar}}" class="face-img" width="40" height="40" rel="user_face" alt="{{currentUser.nickName}}"> <span class="name" rel="user_name" title="{{currentUser.nickName}}" ng-bind="currentUser.nickName"></span> <i class="x-arrow-dowm">&gt;</i></a><div class="u-panel"><div class="tup-box"><div class="tup-info" rel="user_info_box"><div class="user-head" rel="user_face_box"><a ng-href="{{link.setting}}"><img ng-hide="currentUser.avatar" src="/rcp-common/imgs/face/d-face-1.png" width="96" height="96" class="face-img" rel="user_face" alt="{{currentUser.nickName}}"> <img ng-show="currentUser.avatar" ng-src="{{currentUser.avatar}}" width="96" height="96" class="face-img" rel="user_face" alt="{{currentUser.nickName}}"></a></div><div class="user-identity"><p class="user-name text-of"><a href="" rel="user_name" title="{{currentUser.nickName}}" ng-bind="currentUser.nickName"></a></p><p class="attestation-un" ng-class="{\'attestation\':attestation==\'已认证\'}"><i class="image-attestation-yellow"></i> <span>{{attestation}}</span></p></div><div class="clear"></div></div><div class="tup-operate"><div class="card-sets"><a href="{{link.applySpaceUrl}}" class="key f-l"><i class="image-attestation"></i> <span class="text-4f">认证管理</span> </a><a href="{{link.setting}}" target="_blank" class="key f-l"><i class="image-settings"></i> <span class="text-4f">设置</span> </a><a href="" class="key f-r" ng-click="logout()"><i class="image-logout"></i> <span class="text-4f">退出</span></a></div><div class="card-links"><a ng-repeat="item in itemList" ng-href="{{item.href || \'\'}}" ng-class="item.name == \'...\' ? \'disabled key \'+item.icon : \'key \'+item.icon"><i></i> <span>{{item.name}}</span></a></div></div></div></div></div></div>',restrict:"E",replace:!0,transclude:!0,scope:{itemList:"=itemList",user:"=user"},controller:["$rootScope","$scope","$timeout","$location","service",function(e,t,i,a,n){t.$watch("itemList",function(e){if(e){var i=t.itemList.length,a=i%3;if(a)for(var n=3-i%3+i,s=i;n>s;s+=1)e.push({name:"..."})}},!0),t.logout=function(){var e=rcpAid.getUrl("首页");location.href=rcpAid.getUrl("退出",{url:encodeURIComponent(e)})},t.$on("login",function(e,i){i.uid&&t.loginInit()}),t.loginInit=function(){t.currentUser=e.currentUser,t.currentUser.certification&&(t.attestation="已认证")},t.init=function(){var e=rcpAid.getNoTokenUrl();t.link={login:rcpAid.getUrl("登录",{url:encodeURIComponent(e)}),register:rcpAid.getUrl("注册",{url:encodeURIComponent(e)}),applySpaceUrl:rcpAid.getUrl("实名认证"),setting:rcpAid.getUrl("个人设置",{url:window.location.href})},t.attestation="未认证"},t.init()}]}}),module.controller("categoriesCtrl",["$rootScope","$scope","service",function(e,t,i){function a(e){switch(e){case 2:t.categoriesListStyle2=n||[];break;default:t.categoriesListStyle1=n||[]}}t.service=i,t.hover={},t.catType=rcpAid.getCourseCat(),t.byCategories=function(){t.byCategoriesLoading=!0,a(t.catType)},t.listenerMember={byCategories:{node:"#by-categories",callback:t.byCategories}};var n;t.goToCategory=function(){var e=[].slice;return rcpAid.getUrl("分类",{tags:e.call(arguments,0).join(",")})}}]),module.directive("searchDir",function(){return{template:'<div class="h-sc"><div class="head-search-bar"><div class="enter" ng-click="stopPropagation($event)"><input type="text" class="input" ng-model="scText" ng-keydown="onkeydown($event)" ng-change="matchChange(scSelectVal.value,scText)" placeholder="请输入关键词搜索"><div class="match-kw-v" ng-show="matchReadyLock"><div class="mc-list"><ul><li ng-repeat="item in mcCategoryList track by $index" ng-if="$index < lMaxLen" ng-class="{hover: $index == moveKeyIndex}" ng-mouseenter="mouseenter($index,\'类\')" ng-click="matchGoToCategory(item.tag,scText)"><div class="text-of"><a href="javascript:;">{{text}}</a> 在 <a href="javascript:;" class="item-name color-cyan">{{item.tag}}</a> 分类中搜索</div></li></ul><div style="margin:0 10px;border-top:1px solid #dfdfdf" ng-if="mcCourseList.length && mcCategoryList.length"></div><ul><li ng-if="!mcCourseList || !mcCourseList.length">暂无相关内容</li><li ng-repeat="item in mcCourseList track by $index" ng-click="intoDetail(item)" ng-if="$index < cMaxLen" ng-class="{hover: $index + lMaxLen == moveKeyIndex}" ng-mouseenter="mouseenter($index,\'资源\')"><div class="text-of"><span class="lab" ng-if="item.t == 10">课程</span> <span class="lab" ng-if="item.t == 20">题库</span> <a href="javascript:;" class="item-name" ng-bind-html="item.name|titleMatchKw:scText"></a></div></li></ul></div></div></div><a ng-click="goToSearch(scSelectVal.value,scText)" class="submit" title="提交"><i class="fa fa-search" aria-hidden="true"></i></a></div><div class="hot-word"><a href="" class="mg-r20" ng-repeat="item in scHotWord" ng-click="goToSort(item.name)">{{item.name}}</a></div></div>',restrict:"E",replace:!0,transclude:!0,scope:{hot:"="},controller:"headSearchCtrl"}}),module.controller("headSearchCtrl",["$rootScope","$scope","$document","$element","service","headSearch",function(e,t,i,a,n,s){function o(){t.scText="",u()}function r(){x=!0,t.KeyDownIndex=t.moveKeyIndex,d()}function c(){"number"!=typeof t.moveKeyIndex?t.moveKeyIndex=0:t.moveKeyIndex=(t.moveKeyIndex+1)%t.aMaxLen,r()}function l(){"number"!=typeof t.moveKeyIndex?t.moveKeyIndex=t.aMaxLen-1:t.moveKeyIndex=t.moveKeyIndex<0?t.aMaxLen-1:t.moveKeyIndex-1,r(),g(t.scText.length)}function d(){var e,i=t.KeyDownIndex,a=t.lMaxLen;return t.scTag=void 0,a>i&&(t.scText=t.text),i>=a&&(e=t.mcCourseList[i-t.lMaxLen],e&&(t.scText=e.name)),e}function u(e){t.matchReadyLock=!1,e&&(i.unbind("click"),t.$digest())}function p(){i.unbind("click").bind("click",function(){u("digest")}),t.matchReadyLock=!0}function h(){t.matchReadyLock&&(clearTimeout(b),b=setTimeout(function(){u("digest")},300))}function g(e){var t=a.find('input[ng-model="scText"]').get(0);if("selectionStart"in t&&(t.selectionStart=e,t.selectionEnd=e),"createTextRange"in t){var i=t.createTextRange();i.moveStart("character",e),i.collapse(!0),i.select()}}function m(e,i){t.inSort&&!angular.isArray(e)||angular.forEach(e,function(e){return t.inSort?!1:void(i(e)||angular.isArray(e.child)&&e.child.length&&(m(e.child,i),v("push",e.name)))})}function f(e,i){switch(t.inSort=!1,v("clear"),m(e,function(e){return t.inSort=e.name===i,t.inSort&&v("push",e.name),t.inSort}),t.inSort){case!0:v("splice",i);break;default:v("clear")}return t.categorySelect}function v(e,i){var a=t.categorySelect;switch(e){case"clear":a.splice(0,a.length);break;case"push":a.push(i);break;case"splice":a.splice(0,$.inArray(i,a))}}function y(e,t){n.dialog.alert(t),console[e](t)}function w(e){var t=[];if(e.length)for(var i=0,a=e.length;a>i;i++)t.push({id:e[i].hasOwnProperty("id")?e[i].id:"",name:e[i].hasOwnProperty("title")?e[i].title:"",t:e[i].hasOwnProperty("type")?e[i].type:""});return t}t.scHotWord=[],t.scSelect=[{name:"所有分类",value:"",fixLock:!0},{name:"课程",value:10},{name:"题库",value:20}],t.scSelectVal=t.scSelect[0],t.onkeydown=function(e){switch(e.stopPropagation(),e.keyCode){case 13:t.scText||(t.scText=$(".head-search-bar input").eq(0).val());var i=t.KeyDownIndex,a=t.lMaxLen;"number"==typeof i&&i>=0&&a>i&&t.scTag?t.matchGoToCategory(t.scTag,t.scText):i>=0&&t.matchReadyLock?location.href=rcpAid.getUrl("课程详情",{cid:t.mcCourseList[i].id}):t.goToSearch(t.scSelectVal.value,t.scText);break;case 38:l();break;case 40:c();break;default:x=!1,t.moveKeyIndex=void 0,t.KeyDownIndex=void 0,t.scTag=void 0}};var x,b;a.find('input[ng-model="scText"]').unbind("focus").bind("focus",p),a.find('input[ng-model="scText"]').unbind("blur").bind("blur",h),t.mouseenter=function(e,i){switch(i){case"类":t.moveKeyIndex=e;break;case"资源":t.moveKeyIndex=e+t.lMaxLen}},t.goToSearch=function(e,t){o(),location.href=rcpAid.getUrl("搜索",{type:e,query:t?encodeURIComponent(t):t})},t.goToSort=function(e){o(),location.href=rcpAid.getUrl("分类",{tags:e})},t.stopPropagation=function(e){e.stopPropagation()},t.matchChange=function(e,i){if(!x){if(u(),!i)return t.mcCategoryList=[],void(t.mcCourseList=[]);t.text=i,s.SearchIntelligent({key:i,courseType:e||null,limit:10}).then(function(e){t.scText&&(t.matchReadyLock=!0,t.mcCourseList=w(e.data.courses||[]),t.mcCategoryList=[],t.lMaxLen=t.mcCategoryList.length>3?3:t.mcCategoryList.length,t.cMaxLen=t.mcCourseList.length-t.lMaxLen,t.aMaxLen=t.lMaxLen+t.cMaxLen,t.mcCourseList.length||t.mcCategoryList.length||u())},function(e){y("错误代码："+e.data.data.code)})}},t.$watch("scSelectVal.value",function(){t.matchChange(t.scSelectVal.value,t.scText)}),t.matchGoToCategory=function(t,i){if(!e.allTagCategroy||!e.allTagCategroy.length)return void y("error","获取分类数据失败");var a=f(e.allTagCategroy,t).reverse().join(",");a?(o(),location.href=rcpAid.getUrl("分类",{tags:a,query:i})):y("error","找不到这个分类，请检查接口数据")},t.categorySelect=[],t.intoDetail=function(e){e.hasOwnProperty("id")&&(location.href=rcpAid.getUrl("课程详情",{cid:e.id}))}}]),module.directive("tailnav",function(){return{template:'<footer><section class="footer" id="footer"><div class="g-m-w"><div class="copyright"><p>广州市大洋信息技术股份有限公司 版权所有</p><p>Copyright © 2015 ITDAYANG. All Rights Reserved.</p><p>{{caseNumber}}</p></div><div class="footer-link"><a href="http://www.itdayang.com/about.html" target="_blank">关于我们</a> <span>- </span><a href="http://www.itdayang.com/contact.html" target="_blank">联系我们</a> <span>- </span><a href="javascript:;" ng-click="atBuilding()">法律条款</a> <span>- </span><a href="javascript:;" ng-click="atBuilding()">帮助中心</a> <span>- </span><a href="javascript:;" ng-click="atBuilding()">学校申请加入</a> <span>- </span><a href="javascript:;" ng-click="atBuilding()">机构申请加入</a> <span>- </span><a href="javascript:;" ng-click="atBuilding()">意见反馈</a></div><div class="clear"></div></div></section></footer>',restrict:"E",replace:!0,transclude:!0,scope:{data:"=data"},controller:["$scope","service",function(e,t){e.catType=rcpAid.getCourseCat();var i=DYCONFIG.domain||[];angular.forEach(i,function(t){t.domain===location.host&&(e.caseNumber=t.domainNum)}),e.atBuilding=function(){t.dialog.alert("正在建设中...")}}]}}),module.filter("titleMatchKw",["$sce",function(e){return function(t,i){var a="<b>"+i+"</b>",n=/([\[\]\(\)\{\}\*\?\+\^\$\.\|\\])/gi,s=i.replace(n,"\\$1");return t=t.replace(new RegExp(s,"ig"),a),e.trustAsHtml(t)}}]),function(){function e(){var n=document.getElementById("footer");if(n){var s=document.documentElement.scrollHeight-1||document.body.scrollHeight-1,o=document.documentElement.clientHeight||document.body.clientHeight;a=o>=s?1:2,a!==i&&(o>=s?(t(n.parentNode,{height:n.offsetHeight+"px"}),t(n,{position:"absolute",width:"100%",bottom:0,left:0})):(t(n.parentNode,{height:n.offsetHeight+"px"}),t(n,{position:"",width:"100%",bottom:0,left:0}))),i=o>=s?1:2}setTimeout(e)}if(!window.fixedFooterFlag){window.fixedFooterFlag=!0;var t=function(e,t){for(k in t)e.style[k]=t[k]},i=0,a=1;e()}}(),module.directive("uploadImgBase",function(){return{template:'<div id="upload-img-{{uploadConfig.id}}" ng-show="uploadConfig.showEdit"><div class="cropper-tool imgCropTool" ng-show="uploadConfig.mode===\'fixed\'"><div class="cropper-tool-a"><div class="cropper-tool-b"><div class="up-header jf-drag"><div class="f-l">上传图片</div><div class="f-r"><a ng-click="cancelImg()" href="" class="close-panel">×</a></div><div class="clear"></div></div><div class="up-body"><div class="show-tool f-l"><div class="cropper-img-fixed" ng-style="containerStyle"><img ng-src="{{newImg}}" alt="Picture" src=""></div><div id="img-view-{{uploadConfig.id}}" style="display:none" class="img-view"></div></div><div class="show-line"></div><div class="show-pre f-l"><div class="pd-20"><span class="name-img">预览：</span><div class="img-preview"></div></div></div><div class="clear"></div><div id="img-show-cover" class="loading" ng-show="upLoading"><div class="cover-img" style=""><img alt="loading..." src="../../rcp-common/imgs/loading1.gif" class="mg-r10"> 上传中...</div></div></div><div class="up-footer"><div class="btn-grp"><a ng-click="confirmImg()" class="confirm mg-r10">上传</a> <a ng-click="cancelImg()" class="cancel mg-l10">取消</a></div></div></div></div></div><div class="imgCropTool img-crop-tool" ng-show="uploadConfig.mode===\'course\'"><div ng-show="upLoading" class="loading-cover"><div class="cover-img"><img src="../../rcp-common/imgs/loading1.gif" class="mg-r10">上传中...</div></div><table><tr><td class="show-tool"><div class="cropper-img-course"><img ng-src="{{newImg}}" alt="Picture" src=""></div><div id="img-view-{{uploadConfig.id}}" style="display:none"></div></td><td class="show-pre"><span class="name-img">封面预览：</span><div class="img-preview"></div><div class="btn-grp"><a ng-click="confirmImg()" class="confirm">上传</a> <a ng-click="cancelImg()" class="cancel">取消</a></div></td></tr></table></div><input type="file" id="upload-input-{{uploadConfig.id}}" style="display:none"></div>',restrict:"E",replace:!0,transclude:!0,scope:{uploadConfig:"="},controller:["$scope","$timeout","$http","service",function(e,t,i,a){e.uploadConfig.scope=e,e.uploadConfig.aspectRatio=e.uploadConfig.ratio?e.uploadConfig.ratio[0]/e.uploadConfig.ratio[1]:16/9,e.containerStyle=e.uploadConfig.containerStyle||{width:"300px",height:"300px"},e.init=function(){var n=$("#upload-img-"+e.uploadConfig.id),s=$("#upload-input-"+e.uploadConfig.id),o=$("#img-view-"+e.uploadConfig.id);e.upLoading=!1,e.newImg="",e.selectImg=function(){s.trigger("click")},e.confirmImg=function(){if(e.upLoading!==!0){var i=r.cropper("getCroppedCanvas",{width:e.uploadConfig.width||550,style:"display:none",fillColor:"#FFFFFF"});i.id="canvas",i.display=!1,o.html(i),r.on({"zoom.cropper":function(e){}}),t(function(){var t=$("#canvas")[0].toDataURL("img/png"),i=t.split(",");return 2!==i.length?void a.dialog.alert("图片转换失败，请重试"):(e.upLoading=!0,void e.uploadBasePic({baseCode:i[1]}))})}},e.cancelImg=function(){e.upLoading=!1,"block"===n.get(0).style.display&&n.get(0).off(),e.uploadConfig.upCancel=!0,e.uploadConfig.showEdit=!1},e.uploadBasePic=function(t){var s={m:t.m||"C",pub:t.pub||"1",picType:t.picType||"1",fileName:t.fileName||"1.png",name:t.fileName||"1.png",base64:1,token:rcpAid.getToken()};i({method:"POST",url:DYCONFIG.fs.upload+"?"+$.param(s),data:t.baseCode||"",headers:{"Content-Type":"multipart/form-data"}}).success(function(t){e.upLoading=!1,e.uploadConfig.showEdit=!1,0===t.code?("block"===n.get(0).style.display&&n.get(0).off(),e.uploadConfig.cb(t.data)):a.dialog.alert(t.msg)}).error(function(t){e.upLoading=!1,e.uploadConfig.showEdit=!1,console.log(t)})};var r=$(".cropper-img-"+e.uploadConfig.mode+" > img");r.cropper({aspectRatio:e.uploadConfig.aspectRatio,autoCropArea:.85,preview:".img-preview",strict:!1,guides:!0,highlight:!0,dragCrop:!1,cropBoxMovable:!0,cropBoxResizable:!1});var c={URL:window.URL||window.webkitURL,blobURL:null,inputImage:s};c.inputImage.change(function(){var t,i=this.files;r.data("cropper")&&i&&i.length&&(console.log("step1"),t=i[0],/^image\/\w+$/.test(t.type)?(e.uploadConfig.showEdit=!0,c.blobURL=c.URL.createObjectURL(t),r.one("built.cropper",function(){c.URL.revokeObjectURL(c.blobURL)}).cropper("reset").cropper("replace",c.blobURL),c.inputImage.val(""),e.$apply()):(a.dialog.alert("只支持以下格式图片上传：png,jpg,bmp,gif,jpeg。"),c.blobURL=c.URL.createObjectURL(t),c.inputImage.val("")))})},t(function(){e.init()})}]}}),module.directive("zoom",function(){return{restrict:"A",scope:{style:"=zoom",config:"=config"},controller:["$scope","$compile","$element","$document",function(e,t,i,a){function n(e){angular.forEach(e,function(e){var t=i.css(e);"position"===e&&"static"===t&&(t=""),P[e]=t})}function s(){delete e.style.left,delete e.style.right,delete e.style.bottom,delete e.style.top,P=angular.copy(e.style),e.style.width=parseInt(P.width),e.style.height=parseInt(P.height),$(M).css(P);var t="auto"===P.left?0:parseInt(P.left),a="auto"===P.top?0:parseInt(P.top);i.css({width:P.width,height:P.height,position:"relative",left:t,top:a,marginTop:-t,marginLeft:-a})}function o(){S="number"==typeof e.config.minw?e.config.minw:20,L="number"==typeof e.config.minw?e.config.minh:20,M?s():(n(["position","left","top","marginTop","marginLeft","width","height"]),r(function(){i.after(M).appendTo(M),s(),x()})),c()}function r(i){var a="shift键按比例改变大小",n='<div class="zoom-dir" ng-style="style">';n+='<div class="xr" ng-mousedown="move($event,\'xr\')"></div>',n+='<div class="yb" ng-mousedown="move($event,\'yb\')"></div>',n+='<div class="xl" ng-mousedown="move($event,\'xl\')" ng-if="!isStatic()" ></div>',n+='<div class="yt" ng-mousedown="move($event,\'yt\')" ng-if="!isStatic()" ></div>',n+='<div class="t" ng-mousedown="move($event,\'t\')" title="'+a+'" ng-if="!isStatic()"></div>',n+='<div class="r" ng-mousedown="move($event,\'r\')" title="'+a+'" ng-if="!isStatic()"></div>',n+='<div class="l" ng-mousedown="move($event,\'l\')" title="'+a+'" ng-if="!isStatic()"></div>',n+='<div class="b" ng-mousedown="move($event,\'b\')" title="'+a+'"></div>',n+="</div>",M=t(n)(e),i()}function c(){try{e.$digest()}catch(t){}}function l(){C=parseInt(i.css("width")),I=parseInt(i.css("height")),T=parseInt(i.css("top")),D=parseInt(i.css("left"))}function d(e,t){O=t,A=e.clientX,F=e.clientY,l(),a.find("body").bind("selectstart",function(){return!1}).css({WebkitUserSelect:"none",UserSelect:"none"}),a.bind("mousemove",u),a.bind("mouseup",p),a.bind("keydown",h),a.bind("keyup",g)}function u(e){U=e.clientX,Y=e.clientY;var t=U-A,i=Y-F;return _("resize",t,i),!1}function p(){a.find("body").unbind("selectstart").css({WebkitUserSelect:"",UserSelect:""}),a.unbind("mousemove",u),a.unbind("mouseup",p),a.unbind("keydown",h),a.unbind("keyup",g),O=null,E=null,m(e.config.mouseup)}function h(e){E=16===e.keyCode}function g(){E=null}function m(e){"function"==typeof e&&e()}function f(e,t,i){var a=t>=e;return a&&"function"==typeof i&&i(),a}function v(t){f(t.width,S,function(){t.width=S}),f(t.height,L,function(){t.height=L}),angular.extend(e.style,t),i.css(angular.extend(t,{marginTop:-t.top,marginLeft:-t.left})),c()}function y(e,t){angular.forEach(t,function(t,i){angular.isNumber(t)&&(e[i]=t)})}function w(){var e=20,t=$(M).get(0);navigator.userAgent.indexOf("Firefox")>0?t.addEventListener("DOMMouseScroll",function(t){var i=t.detail>0?e:-e;k(i),t.preventDefault()},!1):t.onmousewheel=function(t){t=t||window.event;var i=t.wheelDelta>0?-e:e;return k(i),!1}}function x(){var t=e.config.mousewheelLock;(!t&&"boolean"!=typeof t||t&&"boolean"==typeof t)&&w()}function b(t,i,a){function n(){L>=p&&(p=L,u=p*C/I),S>=u&&(u=S,p=u*I/C)}function s(e){!f(p,L)&&angular.isNumber(T)&&(h=T+e)}function o(e){!f(u,S)&&angular.isNumber(D)&&(g=D+e)}function r(e,t){angular.isNumber(e)&&(u=C+e),angular.isNumber(t)&&(p=I+t)}function c(e,t){-e>-t?(u=C-e,p=u*I/C):(p=I-t,u=p*C/I),n()}function l(e,t){switch(e){case"x":u=C+t,p=u*I/C;break;case"y":p=I+t,u=p*C/I}n(),s(parseInt((I-p)/2)),o(parseInt((C-u)/2))}function d(){var t=e.config.ratioScaling;switch(O){case"t":E||t?(c(i,a),s(I-p),o(C-u)):(r(-i,-a),s(a),o(i));break;case"r":E||t?(c(-i,a),s(I-p)):(r(i,-a),s(a));break;case"b":E||t?c(-i,-a):r(i,a);break;case"l":E||t?(c(i,-a),o(C-u)):(r(-i,a),o(i));break;case"xl":t?l("x",-i):(r(-i),o(i));break;case"xr":t?l("x",i):r(i);break;case"yt":t?l("y",-a):(r(null,-a),s(a));break;case"yb":t?l("y",a):r(null,a)}}var u,p,h,g,m={};switch(t){case"wheel":l("x",i);break;case"resize":d()}angular.isNumber(u)&&(m.width=u),angular.isNumber(p)&&(m.height=p),e.isStatic(function(e){e||y(m,{top:h,left:g})}),v(m)}function k(e){l(),_("wheel",e,e)}function _(e,t,i){b(e,t,i)}var C,I,T,D,S,L,M,E,A=0,F=0,U=0,Y=0,O=null,P=angular.copy(e.style);e.move=function(e,t){d(e,t)},e.isStatic=function(t){var i=e.config.position,a="static"===i;return"function"==typeof t&&t(a),a},e.$watch("config",function(t){if(!angular.isUndefined(t)){if(angular.isUndefined(P))return;e.config.init=o,"img"===i.get(0).tagName.toLowerCase()?i.on({load:o}):o()}})}]}}),module.directive("sortTreeMenu",function(){return{template:["<ul>",'<li ng-repeat="item in list track by $index" ng-class="{ hover : isHover(item) || item.hover }" ng-mouseenter="onmouseenter(item)" ng-mouseleave="onmouseleave(item)">','<div class="text-of" ng-click="option.click(item.name,$event.target)">','<i ng-show="item.child.length">&gt;</i>','<span title="{{item.name}}">{{item.name}}</span>',"</div>","</li>","</ul>"].join(""),restrict:"E",replace:!0,transclude:!0,scope:{list:"=",option:"="},controller:["$scope","$compile","$element","$timeout",function(e,t,i,a){e.isHover=function(t){return-1!==$.inArray(t.name,e.option.select)},e.onmouseenter=function(t){e.option.clear(),t.hover=!0},e.onmouseleave=function(e){e.hover=!1},e.$watch("list",function(n){n&&a(function(){angular.forEach(n,function(a,n){a.child&&a.child.length&&(e["child_"+n]=a,i.find("li").eq(n).append(t('<sort-tree-menu list="child_'+n+'.child" option="option"></sort-tree-menu>')(e)))})},200)})}]}}),module.directive("selectCategory",function(){return{template:'<div class="main-cat"><div class="search-sort" ng-click="stopPropagation($event)" onmouseenter=\'$(this).find("input:eq(0)").focus()\' ng-mouseover="searchChange(\'focus\',$event)" ng-mouseenter="showSearchLock = true" ng-mouseleave="onmouseleave($event)"><a href="javascript:;" class="new-cat" ng-show="!showSearchLock">添加分类</a> <span class="input-w" ng-show="showSearchLock"><input type="text" id="kw-sc-input" class="input" ng-model="sortKeyWork" ng-focus="searchChange(\'focus\',$event)" ng-change="searchChange(\'change\',$event)" ng-keydown="onkeydown($event)" ng-blur="onblur($event)" placeholder="请输入关键词"> <i class="fa fa-plus-circle add-key-wrok" title="创建关键词" ng-show="!inSort && sortKeyWork" ng-click="addKeyWork(sortKeyWork)"></i><div class="select-sort" ng-show="showSelect"><sort-tree-menu id="tag-sle-v" list="allSortTag" option="selectOption" ng-show="inSort || showSort"></sort-tree-menu></div></span></div><div><a href="javascript:;" class="f-r" ng-click="showMoreKwLock = !showMoreKwLock" ng-show="checkShowMoveLock()"><span ng-show="!showMoreKwLock">展开</span> <span ng-show="showMoreKwLock">收起</span></a><div class="kw-laber" ng-class="{smove: showMoreKwLock}" ng-show="labelList.length || categoryList.length"><div class="kw-laver-wrap"><p ng-repeat="item in labelList track by $index" class="block-w" ng-class="{last: $index == labelList.length-1 && !keyWordList.length}"><span ng-repeat="name in item track by $index" class="grid"><a href="javascript:;" class="key text-of" title="{{name}}"><i class="fa fa-times-circle" title="删除" ng-click="deleteEvent(name,item)"></i> {{name}}</a></span></p><p ng-hide="!categoryList.length"><a href="javascript:;" class="key text-of" ng-repeat="name in categoryList track by $index" title="{{name}}"><i class="fa fa-times-circle" title="删除" ng-click="deleteEvent(name)"></i> {{name}}</a></p></div></div><p class="more" ng-show="checkShowMoveLock() && !showMoreKwLock">...</p></div></div>',
restrict:"E",replace:!0,transclude:!0,scope:{tags:"="},controller:["$rootScope","$scope","$element","$document","$timeout","$http","service",function(e,t,i,a,n,s,o){function r(){t.kwThumbnail.splice(0,t.kwThumbnail.length),angular.forEach(e.labelList,function(e){angular.forEach(e,function(i){t.kwThumbnail.push({name:i,item:e})})}),angular.forEach(e.categoryList,function(e){t.kwThumbnail.push({name:e})})}function c(e){angular.forEach(e,function(e){k("push",{selectArr:e})}),d()}function l(e){var t=e.split(""),i="";return angular.forEach(t,function(e){i=i+"_"+e.charCodeAt()}),i.substring(1,i.length)}function d(){E.splice(0,E.length),u(M,E),p(h(E,[]))}function u(e,t){var i=t;angular.forEach(e,function(e){var t={name:e.name,child:[]};i.push(t),e.child&&y(e.child)&&u(e.child,t.child)})}function p(t){var i=e.labelList;i.splice(0,i.length),angular.forEach(t,function(e){i.push(e.split(","))})}function h(e,t){return g(e,void 0,t),t}function g(e,t,i){angular.forEach(e,function(e){var a=void 0===t?e.name:t+","+e.name;e.child&&e.child.length&&g(e.child,a,i),m(i,a)})}function m(e,t){var i;$(e).each(function(e,a){return i=a.match(new RegExp("^"+t,"i")),i?!1:void 0}),i||e.push(t)}function f(e){var t=M;angular.forEach(e,function(i,a){var n=l(i);a===e.length-1?delete v(t)[n]:t=v(t)[n]}),d()}function v(e){return e.child&&y(e.child)&&(e=e.child),e}function y(e){var t;for(var i in e)if(e.hasOwnProperty(i)){t=!0;break}return t}function w(){var e=[],t=function(i){i.length&&(e.push(i.eq(0).find("> div > span:eq(0)").html()),t(i.eq(0).find("> ul > li.hover")))};return t($("#tag-sle-v > li.hover")),e}function x(t,i,a){var n=0;return angular.forEach(t,function(t,i){-1===$.inArray(t,e.categoryList)?e.categoryList.push(t):n++}),n===t.length?void("function"==typeof a&&a()):void("function"==typeof a&&i())}function b(e,t){var i=angular.copy(t),a=i.splice(0,$.inArray(e,i)+1);f(a)}function k(e,t){switch(e){case"push":x(t.selectArr,t.ishaveCallback,t.nohaveCallback);break;case"delete":b(t.name,t.item)}}function _(e,i){t.inSort&&!angular.isArray(e)||angular.forEach(e,function(e){return t.inSort?!1:void(i(e)||angular.isArray(e.child)&&e.child.length&&(_(e.child,i),I("push",e.name)))})}function C(e,i){switch(t.inSort=!1,t.showSelect=!0,I("clear"),_(e,function(e){return t.inSort=e.name===i,t.inSort&&I("push",e.name),t.inSort}),t.inSort){case!0:I("splice",i);break;default:I("clear")}}function I(e,i){var a=t.selectOption.select;switch(e){case"clear":a.splice(0,a.length);break;case"push":a.push(i);break;case"splice":a.splice(0,$.inArray(i,a))}}function T(){a.unbind("click").bind("click",function(){t.blurFn("digest")})}function D(e,t,i){var a={};a[t]=i||"orange",$(e).css(a),setTimeout(function(){a[t]="",$(e).css(a)},200)}function S(i,a){i&&("labelList"===a&&(!t.initTreeLock&&i.length&&(t.initTreeLock=!t.initTreeLock,c(i)),angular.forEach(i,function(e,t){e.length||i.splice(t,1)})),r(),t.categoryList=e.categoryList,t.labelList=e.labelList)}function L(e){return e?(angular.forEach(e,function(e,t){e.tags.length&&(e.child=L(e.tags))}),e):void 0}var M={},E=[];t.sortKeyWork="",t.inSort=!1,t.kwThumbnail=[],e.categoryList=e.categoryList||[],e.labelList=e.labelList||[],t.searchChange=function(e,i){switch(e){case"focus":T(),t.focusLock=!0,t.selectSortEvent(i);break;default:t.showSort&&(t.showSort=!1)}t.sortKeyWork?C(t.allSortTag,t.sortKeyWork):"focus"!==e&&t.selectSortEvent()},t.blurFn=function(e,i){t.inSort=!1,t.showSort=!1,t.showSelect=!1,I("clear"),a.unbind("click"),i&&(t.sortKeyWork=""),e&&t.$digest()},t.showMoreWin=function(){$("#kw-laber-win").window({mask:!1})},t.stopPropagation=function(e){e.stopPropagation()},t.addKeyWork=function(i){var a=e.categoryList;return i?void(-1===$.inArray(i,a)?(a.push(i),t.blurFn(!1,"clearInput")):(o.dialog.alert("关键词已添加过"),D($("#kw-sc-input"),"borderColor"))):void o.dialog.alert("关键词不能为空")},t.checkShowMoveLock=function(){var e=i.find(".kw-laver-wrap").height()<90;return e&&(t.showMoreKwLock=!1),!e},t.deleteKeyWork=function(t){var i=e.categoryList,a=$.inArray(t,i),n=-1!==a;return n&&i.splice(a,1),n},t.deleteEvent=function(e,i){return t.deleteKeyWork(e)?void t.checkShowMoveLock():(k("delete",{name:e,item:i}),void checkShowMoveLock())},t.addEvent=function(e,i){k("push",{selectArr:w(),nohaveCallback:function(){o.dialog.alert("所选分类都已添加过"),D($(i).parent(),"backgroundColor"),t.focusLock=!0,n(function(){t.focusLock=!1},220)},ishaveCallback:function(){d(),t.blurFn(!1,"clearInput")}})},t.onmouseleave=function(){n(function(){t.focusLock||(t.showSearchLock=!1)},220)},t.onblur=function(){t.focusLock=!1,n(function(){t.showSearchLock&&!t.focusLock&&(t.showSearchLock=!1)},200)},t.onkeydown=function(e){13===e.keyCode&&t.sortKeyWork&&(t.inSort?t.addEvent(t.sortKeyWork):(t.addKeyWork(t.sortKeyWork),t.selectSortEvent(e)))},t.selectSortEvent=function(e){t.showSort=!t.sortKeyWork,t.showSelect=!t.sortKeyWork,e&&e.stopPropagation()},t.selectOption={select:[],click:t.addEvent,clear:function(){I("clear")}},e.$watch("labelList",function(e){S(e,"labelList")},!0),e.$watch("categoryList",function(e){S(e)},!0),t.$watch("tags",function(e){t.allSortTag=L(t.tags)},!0)}]}}),angular.module("RCP").directive("yLoading",function(){return{restrict:"E",template:'<style>.y-loading{text-align:center;margin:0 auto;font-size:18px;color:#d5d5d5;letter-spacing:2px;text-shadow:0 2px 0 #fff;position:relative;cursor:default}.y-loading .cover{position:absolute;width:218px;height:204px;left:50%;top:0;margin-left:-109px}.y-loading p{position:relative}.y-loading .font{margin-right:18px}.y-loading img{width:218px;margin-bottom:5px}.y-loading.s2{font-size:14px}.y-loading.s2 img{width:138px}.y-loading.s2 .y-ld-ellipsis{margin-left:16px}.y-loading.s3{font-size:14px}.y-loading.s3 img{width:88px}.y-ld-ellipsis{position:absolute;left:50%;top:0;margin-left:22px;-webkit-animation:y-loading 1.5s linear infinite normal;animation:y-loading 1.5s linear infinite normal}@keyframes y-loading{0%{clip:rect(auto 0 auto auto)}35%{clip:rect(auto 6px auto auto)}70%{clip:rect(auto 12px auto auto)}100%{clip:rect(auto 18px auto auto)}}@-webkit-keyframes y-loading{0%{clip:rect(auto 0 auto auto)}35%{clip:rect(auto 6px auto auto)}70%{clip:rect(auto 12px auto auto)}100%{clip:rect(auto 18px auto auto)}}</style><div class="y-loading" ng-show="show"><div class="cover"></div><img src="/rcp-common/imgs/old/loading/y-loading.gif"><p><span class="font">加载中</span><span class="y-ld-ellipsis">...</span></p></div>',scope:{show:"=show"}}});var wcms=function(){function e(){}function t(e,t){if("string"!=typeof e||e.trim().length<1)throw"the name must be string and not empty";if(this.name=e,t){if("number"!=typeof t||1>t)throw"the limit must be integer and >0";this.limit=t}else this.limit=5242880}function i(){}function a(t,i,a){if(!t||t.length<1)throw"article id is null or empty";this.aid=t,this.type=i,a&&a>0?this.count=a:this.count=10,this.args={},this.store=e.NewStore(t,4194304),this.init()}return e.langs={},e.langs.en={},e.langs.ch={},e.vals=e.langs.en,t.prototype.get=function(e){return window.localStorage[this.name+"_"+e]},t.prototype.getj=function(e){try{var t=this.get(e);return t&&t.length?JSON.parse(t):null}catch(i){return console.error("get json by key("+e+") error:"+i),null}},t.prototype.set=function(e,t){t+="";var i=this.get(e),a=0;if(a=i?this.size()+t.length-i.length:this.size()+t.length,a>this.limit)return!1;var n=this.idx();return n[e]=t.length,window.localStorage[this.name+"_"+e]=t,window.localStorage[this.name+"_size"]=a,window.localStorage[this.name+"_idx"]=JSON.stringify(n),!0},t.prototype.setj=function(e,t){return this.set(e,JSON.stringify(t))},t.prototype.del=function(e){var t=this.get(e);if(!t)return!1;var i=this.idx();return delete i[e],window.localStorage.removeItem(this.name+"_"+e),window.localStorage[this.name+"_size"]=this.size()-t.length,window.localStorage[this.name+"_idx"]=JSON.stringify(i),!0},t.prototype.idx=function(){var e=window.localStorage[this.name+"_idx"];return e&&e.length?JSON.parse(e):{}},t.prototype.size=function(){var e=window.localStorage[this.name+"_size"];return e?parseInt(e):0},t.prototype.clear=function(){var e=this.idx();for(var t in e)window.localStorage.removeItem(this.name+"_"+t);return window.localStorage.removeItem(this.name+"_size"),window.localStorage.removeItem(this.name+"_idx"),!0},e.LocStore=t,e.NewStore=function(e,i,a,n,s,o,r,c){return new t(e,i)},e.DelStroe=function(e,i,a,n,s,o,r,c){return new t(e,i).clear()},i.prototype.done=function(e){return this.done_=e,this},i.prototype.ondone=function(e,t,i){this.done_&&this.done_(e,t,i)},i.prototype.fail=function(e){return this.fail_=e,this},i.prototype.onfail=function(e,t,i){this.fail_&&this.fail_(e,t,i)},e.Res=i,e.create="/art/api/create",e.update="/art/api/update",e.load="/art/api/load",e.ART_TABLE="T",a.prototype.init=function(){this.inited=!1,this.saving=!1;var e=this.store.getj("art");e?(console.log("the local article data found, using cache"),this.art=e,this.cached=!0):this.art={ver:-1};var t=this.store.getj("einfo");t?(console.log("the local einfo data found, using cache"),this.einfo=t):this.einfo={};var i=this.store.getj("updated");i?(console.log("the local updated data found, using cache"),this.updated=i):this.updated={gids:{},iids:{},gidx:!1,iidx:!1};var a=this.store.getj("updated_");a?(console.log("the local updated_ data found, using cache"),this.updated_=a):this.updated_={gids:{},iids:{},gidx:!1,iidx:!1};var n=this.store.get("sequence");n?this.sequence=parseInt(n):this.sequence=0},a.prototype.ls_sync=function(){this.store.setj("art",this.art),this.store.setj("sequence",this.sequence),this.store.setj("einfo",this.einfo),this.store.setj("updated",this.updated),this.store.setj("updated_",this.updated_)},a.prototype.ls_clear=function(){this.store.clear(),this.init()},a.prototype.nid=function(){var e="l"+this.sequence++;return this.ls_sync(),e},a.prototype.nfid=function(){var e="l"+(new Date).getTime()+this.sequence++;return this.ls_sync(),e},a.prototype.chk_updated=function(e){for(var t in e.gids)return!0;for(var i in e.iids)return!0;return e.gidx||e.iidx},a.prototype.isUpdated=function(){return this.chk_updated(this.updated)},a.prototype.isUpdated_=function(){return this.chk_updated(this.updated_)},a.prototype.resetUpdated=function(){this.updated.gids={},this.updated.iids={},this.updated.gidx=!1,this.updated.iidx=!1},a.prototype.resetUpdated_=function(){this.updated_.gids={},this.updated_.iids={},this.updated_.gidx=!1,this.updated_.iidx=!1},a.prototype.art_merge_u=function(e,t){e.gidx=e.gidx||t.gidx,e.iidx=e.iidx||t.iidx;for(var i in t.gids)e.gids[i]=t.gids[i];for(var a in t.iids)e.iids[a]=t.iids[a]},a.prototype.art_merge_i=function(e,t){if(t.items){if(!e.items)return void(e.items=t.items);for(var i in t.items)this.updated.iids[i]||(e.items[i]=t.items[i])}},a.prototype.art_merge_g=function(e,t){if(t.groups){if(!e.groups)return void(e.groups=t.groups);for(var i in t.groups)this.updated.gids[i]||(e.groups[i]=t.groups[i])}},a.prototype.art_merge=function(e,t){"undefined"!=typeof t.ver&&(e.ver=t.ver),t.idx&&(e.idx=t.idx),this.art_merge_i(e,t),this.art_merge_g(e,t)},a.prototype.einfo_merge=function(e,t){if(t)for(var i in t)e[i]=t[i]},a.prototype.chk_init=function(){if(!this.inited)throw"Article is not inited"},a.prototype.load_=function(t,a,n,s,o,r,c,l){var d={};d.aid=this.aid,t&&t.length&&(d.items=t),a&&a.length&&(d.groups=a),n&&n.length&&(d.type=n),s&&(d.count=s),o&&(d.itemc=o),r&&(d.idx=r),c&&(d.access=c),l&&(d.last=l);for(var u in this.args)d[u]=this.args[u];console.log("load article by "+JSON.stringify(d));var p=new i;return $.getJSON(e.load,d,function(e){p.ondone(e)}).fail(function(e){p.onfail("load fail by state:"+e.readyState+", error:"+e.statusText+", text:\n"+e.responseText,e)}),p},a.prototype.load=function(e,t,a,n,s,o,r,c){var l=new i,d=this;return this.load_(e,t,a,n,s,o,r,c).done(function(e){if(0!==e.code){var t="load article fail by code:"+e.code+", msg:"+e.msg+", dmsg:"+e.dmsg;return console.error(t),d.onLoadFail(t,e),void l.onfail(t,e)}return d.art.ver<0?(console.log("load and merge article success on first load, the base version: "+e.data.art.ver),d.art=e.data.art,d.einfo=e.data.einfo,d.onLoadDone(d,e.data),l.ondone(d,e.data),void d.ls_sync()):void(d.art.ver==e.data.art.ver?(console.log("load and merge article success on the same version: "+d.art.ver),d.art_merge(d.art,e.data.art),d.einfo_merge(d.einfo,e.data.einfo),d.onLoadDone(d,e.data),l.ondone(d,e.data),d.ls_sync()):(console.error("load article fail by having new version->",e.data.art.ver),d.onNewVer(d,e.data),l.onfail("NEW_VER",e.data)))}).fail(function(e,t){d.onLoadFail(e,t),l.onfail(e,t)}),l},a.prototype.run=function(){var t=this,a=new i,n=!1,s=function(){var i=1,o=e.ART_TABLE,r=t.count;t.art.idx&&t.art.idx.iids&&(i=0,o="",r=0),t.load(null,null,o,r,i,i,i,i).done(function(e,t){e.inited=!0,a.ondone(e,t)}).fail(function(e,i){return n||"NEW_VER"!==e?void a.onfail(e,i):(t.ls_clear(),t.init(),n=!0,void s())})};return s(),a},a.prototype.next=function(e){for(var t=[],a=0;a<e.length;a++)this.art.items[e[a]]||this.einfo[e[a]]||t.push(e[a]);var n=this;if(t.length<1){var s=new i;return s.done=function(e){return e(n),this},s}return this.load(t.join(","))},a.prototype.listGroup=function(e){for(var t=[],a=0;a<e.length;a++)this.art.groups[e[a]]||"_"!=e[a]&&"E"!=e[a]&&t.push(e[a]);var n=this;if(t.length<1){var s=new i;return s.done=function(e){return e(n),this},s}return this.load(null,t.join(","))},a.prototype.findIids=function(e){if(this.chk_init(),!this.art.idx||!this.art.idx.iids)return[];if(!e)return this.art.idx.iids;for(var t=[],i=0;i<this.art.idx.iids.length;i++){var a=this.art.idx.iids[i];e[this.art.idx.i2t[a]]&&t.push(a)}return t},a.prototype.findGids=function(){return this.chk_init(),this.art.idx&&this.art.idx.gids?this.art.idx.gids:[]},a.prototype.findItem=function(e,t,i){this.chk_init();var a=null;if(this.art.items&&this.art.items[e])a=this.art.items[e],a.visiable=!0;else{if(!this.einfo||!this.einfo[e])return null;a={g:this.einfo[e],visiable:!1}}return t&&(this.art.groups&&this.art.groups[a.g]?a.group=this.art.groups[a.g]:a.group=null),i&&(this.art.idx&&this.art.idx.gic&&this.art.idx.gic[a.g]?a.gic=this.art.idx.gic[a.g]:a.gic=null),a},a.prototype.findGroup=function(e){return this.chk_init(),this.art.groups&&this.art.groups[e]?this.art.groups[e]:null},a.prototype.moveItem=function(e,t){if(this.chk_init(),0>e||0>t||e>this.art.idx.iids.length-1||t>this.art.idx.iids.length-1)throw"index out of bound "+JSON.stringify({idxa:e,idxb:t,ilen:this.art.idx.iids.length});this.art.idx.iids.splice(t,0,this.art.idx.iids.splice(e,1)[0]),this.updated.iidx=!0,this.ls_sync()},a.prototype.moveItem2=function(e,t){t?this.moveItem(e,e-1):this.moveItem(e,e+1)},a.prototype.moveItem3=function(e,t){this.chk_init();for(var i=-1,a=0;a<this.art.idx.iids.length;a++)if(this.art.idx.iids[a]==e){i=parseInt(a);break}if(0>i)throw"the item id("+e+") is not found on article";this.moveItem2(i,t)},a.prototype.moveItemGrp=function(e,t,i,a){this.chk_init();var n=this.art.idx.iids,s=n.splice(e,i),o=[];o=a?n.splice(0,t):n.splice(0,t-i),this.art.idx.iids=o.concat(s,n),this.updated.iidx=!0,this.ls_sync()},a.prototype.updateItem=function(e,t){if(this.chk_init(),!this.art.items[e])throw"the item id("+e+") is not found on article";if(this.art.items[e].t!=t.t)throw"the item("+e+") type can not be updated";this.art.items[e]=t,this.updated.iids[e]=1,this.ls_sync()},a.prototype.updateGroup=function(e,t){if(this.chk_init(),!this.art.groups[e])throw"the group id("+e+") is not found on article";this.art.groups[e]=t,this.updated.gids[e]=1,this.ls_sync()},a.prototype.addItem=function(e,t){this.chk_init(),"undefined"==typeof t&&(t=this.art.idx.iids.length);var i=this.nid();return this.art.items||(this.art.items={}),this.art.items[i]=e,this.art.idx.iids.splice(t,0,i),this.art.idx.i2t[i]=e.t,this.updated.iidx=!0,this.updated.iids[i]=1,this.ls_sync(),console.log("add item success by id("+i+") on index"+t+"->",JSON.stringify(e)),i},a.prototype.addGroup=function(e,t){this.chk_init(),"undefined"==typeof t&&(t=this.art.idx.gids.length);var i=this.nid();return this.art.groups||(this.art.groups={}),this.art.groups[i]=e,this.art.idx.gids.splice(t,0,i),this.updated.gidx=!0,this.updated.gids[i]=1,this.ls_sync(),console.log("add group success by id("+i+") on index"+t+"->",JSON.stringify(e)),i},a.prototype.removeItem=function(e){this.chk_init();for(var t=-1,i=0;i<this.art.idx.iids.length;i++)if(this.art.idx.iids[i]==e){t=parseInt(i);break}if(0>t)throw"the item id("+e+") is not found on article";delete this.art.items[e],this.art.idx.iids.splice(t,1),delete this.art.idx.i2t[e],this.updated.iidx=!0,this.ls_sync()},a.prototype.save_=function(){var t=new i;if(this.saving){var a="there is already having task to save article";return console.log(a),t.fail=function(e){return e(a),this},t}this.saving=!0,this.art_merge_u(this.updated_,this.updated),this.resetUpdated(),this.ls_sync(),console.log("saving article....");var n=this,s={};s.ver=n.art.ver,s.id=n.art.id,s.title=n.art.title,s.desc=n.art.desc,s.idx={},this.updated_.iidx&&(s.idx.iids=n.art.idx.iids),this.updated_.gidx&&(s.idx.gids=n.art.idx.gids),s.items={};for(var o in this.updated_.iids)s.items[o]=n.art.items[o];s.groups={};for(var r in this.updated_.gids)s.groups[r]=n.art.groups[r];var c=JSON.stringify(s);return console.log("saving the article by args:",s),$.ajax({url:e.update+"?"+$.param(n.args),type:"POST",data:c,dataType:"json",contentType:"application/json",success:function(e,i,a){n.saving=!1,t.ondone(n,e,i,a)},error:function(e,i,a){n.saving=!1,t.onfail("save fail by state:"+e.readyState+", error:"+e.statusText+", text:\n"+e.responseText,e,i,a)}}),t},a.prototype.save=function(){var e=new i,t=this;return this.isUpdated()?(this.save_().done(function(i,a){if(0===a.code){t.art_merge(t.art,a.data.art);var n=0,s=0;for(var o in a.data.gidm)delete t.art.groups[o],n++;for(var r in a.data.iidm)delete t.art.items[r],s++;console.log("update article success to ver("+a.data.art.ver+") with gidmc("+n+"),iidmc("+s+")"),t.resetUpdated_(),t.ls_sync(),t.onSaveDone(t,a.data,n,s),e.ondone(t,a.data,n,s)}else if(409===a.code)console.error("update article faild base ver("+t.art.ver+")->"+JSON.stringify(a.data.art.last)),t.art_merge_u(t.updated,t.updated_),t.resetUpdated_(),t.ls_sync(),t.onSaveConfict(t,a.data),e.onfail("confict",a.data);else{var c="update article fail by code:"+a.code+", msg:"+a.msg+", dmsg:"+a.dmsg;console.error(c),t.art_merge_u(t.updated,t.updated_),t.resetUpdated_(),t.ls_sync(),t.onSaveFail(c,a),e.onfail(c,a)}this.saving=!1}).fail(function(i,a){t.art_merge_u(t.updated,t.updated_),t.resetUpdated_(),t.ls_sync(),t.onSaveFail(i,a),e.onfail(i,a)}),e):(e.done=function(e){return e(t),this},e)},a.prototype.onSaveDone=function(e,t,i,a){},a.prototype.onSaveConfict=function(e,t){},a.prototype.onSaveFail=function(e,t){},a.prototype.onNewVer=function(e,t){},a.prototype.onLoadDone=function(e,t){},a.prototype.onLoadFail=function(e,t){},e.Article=a,window.wcms=e,e}();module.factory("contentService",["$resource","$http","$q",function(e,t,i){var a=DYCONFIG.fs.rUrl;return{request:function(e){return t(e).then(function(e){var t=i.defer();return angular.isUndefined(e.data.code)?t.reject({type:-1,data:e}):0!==e.data.code?t.reject({type:1,data:e}):t.resolve(e.data),t.promise},function(e){throw{type:-1,data:e}})},GetFileDetail:e(a+"/srv/api/fileDetail"),GetFileToken:e(a+"usr/api/fileDetail"),GetFileFid:e(a+"pub/api/listInfo"),DownloadFile:e(a+"/srv/usr/api/dload"),itemType:{picArr:["png","jpg","bmp","gif","jpeg","PNG","JPG","BMP","GIF","JPEG"],videoArr:["mp4","flv","avi"],docArr:["doc","docx","pdf","ppt","xls","xlsx","pptx"],specialArr:["swf"]},GetValue:function(e,t){for(var i=0;i<e.length;i++)if(e[i].F_key==t)return e[i].F_value},bindHtml:function(e,t,i){return"flash"===e?'<embed src="'+this.transFlashUrl(t)+'" id="embed-flash-'+i.id+'"wmode="Opaque"allowfullscreen="true"quality="high"width="800"height="450"align="middel"allowscriptaccess="always"type="application/x-shockwave-flash"per="100%">':"video"===e?'<video id="video-main-'+i.id+'" src="'+this.transFlashUrl(t)+'"class="ckVideo" style="background-color: #000000" width="640"height="360" per="100%" preload="none"controls="controls"></video>':void 0},transDownloadUrl:function(e){var t=rcpAid.getToken()||"";return a+"usr/api/dload?fid="+e+"&dl=1&token="+t},transImgUrl:function(e){var t=rcpAid.getToken()||"";return a+"usr/api/dload?fid="+e+"&dl=0&token="+t},transFlashUrl:function(e){var t=rcpAid.getToken()||"";return a+"usr/api/dload?fid="+e+"&dl=0&token="+t},transPreviewUrl:function(e){return a+"viewPaperDemo.html?fileId="+e},getMediaInfo:function(e){var t=(e.File,e.Exts),i={status:"UNKNOWN",data:{},msg:"未知视频信息"};switch(i.status=this.GetValue(t,"MEDIA_STATUS"),i.status){case"N":i.msg=this.GetValue(t,"MEDIA_MSG"),i.data.url=this.GetValue(t,"MEDIA_URL"),i.data.guid=this.GetValue(t,"MEDIA_GUID"),i.data.videoUrl="http://"+i.data.url+"/"+i.data.guid+".mp4",i.data.imgUrl=[this.GetValue(t,"MEDIA_PIC_URL")+i.data.guid+".jpg",this.GetValue(t,"MEDIA_PIC_URL")+i.data.guid+"_1.jpg",this.GetValue(t,"MEDIA_PIC_URL")+i.data.guid+"_2.jpg"];break;case"CONVERT":i.msg="视频转码中，请耐心等候";break;case"FAIL":i.msg="视频转码失败，请删除后重新上传。"}return i},getFileInfo:function(e){var t=e.File,i=e.Exts,a={status:"UNKNOWN",data:{},msg:"未知文件信息"};switch(a.status=this.GetValue(i,"STATUS"),a.status){case"SUCCESS":a.data.downUrl=this.transPreviewUrl(t.Tid);break;case"CONVERT":a.msg="文件转码中，请耐心等候";break;case"FAIL":a.msg="文件转码失败，请删除后重新上传。"}return a},getFileOperate:function(e){return-1!=$.inArray(e,this.itemType.picArr)?"show":-1!=$.inArray(e,this.itemType.videoArr)?"meida":-1!=$.inArray(e,this.itemType.docArr)?"review":-1!=$.inArray(e,this.itemType.specialArr)?"flash":"download"},getFileExtOpt:function(e){return $.inArray(e,this.itemType.docArr)},getFileFid:function(e,t){var i={method:"GET",url:a+"pub/api/listInfo",params:{mark:t.join(","),mode:"mark",token:GetToken()}};return this.request(angular.extend(i,{}))},getFileDetail:function(e,t){var i={method:"GET",url:a+"/srv/api/fileDetail",params:{fid:1,fileIds:e,ftoken:t,token:GetToken()}};return this.request(angular.extend(i,{}))},getFileToken:function(e){var t={method:"GET",url:a+"usr/api/fileDetail",params:{fid:1,fileIds:e,token:GetToken()}};return this.request(angular.extend(t,{}))}}}]),module.factory("courseContent",["request",function(e){var t=DYCONFIG.fs;return{transDownloadUrl:function(e){return t.down+"?mark="+e+"&dl=1&token="+rcpAid.getToken()},transImgUrl:function(e){return t.down+"?mark="+e+"&token="+rcpAid.getToken()},transVideoUrl:function(e){return t.down+"?mark="+e+"&type=V_pc&token="+rcpAid.getToken()},transFlashUrl:function(e){return t.down+"?mark="+e+"&token="+rcpAid.getToken()},transPreviewUrl:function(e,t,i){try{return"/course/document-preview.html?mark="+e+"&type="+this.convertExt.transExecType[t]+"&count="+i[this.convertExt.transExecType[t]].count}catch(a){console.log(a)}},convertExt:{video:["wmv","rm","rmvb","mpg","mpeg","mpe","3gp","mov","mp4","m4v","avi","mkv","flv","vob"],attach:["doc","docx","pdf","ppt","pptx"],transExecType:{doc:"D_docx",docx:"D_docx",ppt:"D_pptx",pptx:"D_pptx",pdf:"D_pdfx"}},bindHtml:function(e,t,i){return"flash"===e?'<embed src="'+this.transFlashUrl(t)+'" id="embed-flash-'+i.id+'"wmode="Opaque"allowfullscreen="true"quality="high"width="800"height="450"align="middel"allowscriptaccess="always"type="application/x-shockwave-flash"per="100%">':"video"===e?'<video id="video-main-'+i.id+'" src="'+this.transVideoUrl(t)+'"class="ckVideo" style="background-color: #000000" width="640"height="360" per="100%" preload="none"controls="controls"></video>':void 0},getFileInfo:function(i,a){var n={};return n="string"==typeof i?{method:"GET",url:t.info,params:{mark:i,mode:"mark"}}:{method:"GET",url:t.listInfo,params:{mark:i.join(","),mode:"mark"}},e(angular.extend(n,a||{}))}}}]),module.run(["service","courseContent",function(e,t){e.expand("courseContent",function(){return t})}]),module.factory("examReq",["request",function(e){var t=DYCONFIG.course.rUrl;return{getListGroup:function(i,a){i.token=rcpAid.getToken();var n={method:"GET",url:t+"pub/api/listGroup",params:i};return e(angular.extend(n,a||{}))},getListItemL:function(i,a){i.token=rcpAid.getToken();var n={method:"GET",url:t+"pub/api/listItemL",params:i};return e(angular.extend(n,a||{}))},answerPaper:function(i,a){i.token=rcpAid.getToken();var n={method:"GET",url:t+"usr/api/answer",params:i,option:{loading:!1}};return e(angular.extend(n,a||{}))},startAnswer:function(i,a){i.token=rcpAid.getToken();var n={method:"GET",url:t+"usr/api/startAnswer",params:i};return e(angular.extend(n,a||{}))},doneAnswer:function(i,a){i.token=rcpAid.getToken();var n={method:"GET",url:t+"usr/api/doneAnswer",params:i};return e(angular.extend(n,a||{}))},listExam:function(i,a){i.token=rcpAid.getToken();var n={method:"GET",url:t+"usr/api/listExam",params:i};return e(angular.extend(n,a||{}))},publishAns:function(i,a){i.token=rcpAid.getToken();var n={method:"GET",url:t+"usr/api/publish",params:i};return e(angular.extend(n,a||{}))},correctPaper:function(i,a){i.token=rcpAid.getToken();var n={method:"GET",url:t+"usr/api/correct",params:i};return e(angular.extend(n,a||{}))},listCourseRef:function(i,a){i.token=rcpAid.getToken();var n={method:"GET",url:t+"pub/api/listRef",params:i};return e(angular.extend(n,a||{}))},createPaper:function(i,a){i.token=rcpAid.getToken();var n={method:"GET",url:t+"art/api/create",params:i};return e(angular.extend(n,a||{}))},insertTest:function(i,a){i.params.token=rcpAid.getToken();var n={method:"POST",url:t+"usr/api/upsertTest",params:i.params,data:i.data};return e(angular.extend(n,a||{}))}}}]),module.run(["service","examReq",function(e,t){e.expand("examReq",function(){return t})}]),module.directive("contentEdit",function(){return{restrict:"E",template:'<div class="edit-w content-n" id="courseNewEdit"><div class="ew-h con"><div class="list-ac"><div class="block-grp"><div class="bw"><a href="javascript:;" class="return-b back"><p class="ic"><i class="image-con-head-back"></i></p><p>返回</p></a></div></div><div class="block-grp"><div class="bw"><a href="javascript:;" class="overview-b"><p class="ic"><i class="image-con-head-dir"></i></p><p>目录</p></a></div></div><div class="block-grp"><div class="bw"><a href="javascript:;" ng-click="newItem({type:\'T1\',index:curItemIndex.index + 1})"><p class="ic"><i class="image-con-head-t1"></i></p><p>添加章</p></a></div></div><div class="block-grp" ng-click="newItem({type:\'T2\',index:curItemIndex.index + 1})"><div class="bw"><a href="javascript:;"><p class="ic"><i class="image-con-head-t2"></i></p><p>添加节</p></a></div></div><div class="block-grp" ng-show="editWidthMode === \'wide\'"><div class="bw"><a href="javascript:;" ng-click="newItem({type:\'image\',index:curItemIndex.index + 1})"><p class="ic"><i class="image-con-head-pic"></i></p><p>图片</p></a></div></div><div class="block-grp" ng-show="editWidthMode === \'wide\'"><div class="bw"><a href="javascript:;" ng-click="newItem({type:\'text\',index:curItemIndex.index + 1})"><p class="ic"><i class="image-con-head-content"></i></p><p>添加内容</p></a></div></div><div class="block-grp"><div class="bw"><a href="javascript:;" class="up-panel down-list-h"><p class="ic"><i class="image-con-head-more"></i></p><p>更多</p><div class="down-list"><ul><li ng-click="newItem({type:\'image\',index:curItemIndex.index + 1})" ng-show="editWidthMode === \'petty\'"><div class="img-p"><i class="image-con-s-pic"></i></div>图片</li><li ng-click="newItem({type:\'text\',index:curItemIndex.index + 1})" ng-show="editWidthMode === \'petty\'"><div class="img-p"><i class="image-con-s-content"></i></div>添加内容</li><li ng-click="newItem({type:\'attach\',index:curItemIndex.index + 1})"><div class="img-p"><i class="image-con-s-file"></i></div>添加附件</li><li ng-click="newItem({type:\'link\',index:curItemIndex.index + 1})"><div class="img-p"><i class="image-con-s-link"></i></div>添加链接</li><li ng-click="newItem({type:\'embed\',index:curItemIndex.index + 1})"><div class="img-p"><i class="image-con-s-movie-ext"></i></div>网上视频</li><li ng-click="newItem({type:\'video\',index:curItemIndex.index + 1})"><div class="img-p"><i class="image-con-s-movie-loc"></i></div>本地视频</li><li ng-click="newItem({type:\'flash\',index:curItemIndex.index + 1})"><div class="img-p"><i class="image-con-s-flash"></i></div>添加Flash</li><li ng-click="addExam(\'test\')"><div class="img-p"><i class="image-con-s-p1"></i></div>试卷</li></ul></div></a></div></div><div class="seq"></div><div class="block-grp"><div class="bw"><a href="javascript:;" class="" target="_blank" ng-href="{{previewUrl()}}"><p class="ic"><i class="image-con-head-preview"></i></p><p>预览</p></a></div></div><div class="block-grp"><div class="bw"><a href="javascript:;" class="save-b" ng-click="saveContent()"><p class="ic"><i class="image-con-head-save"></i></p><p>保存</p></a></div></div><div class="seq"></div><div class="block_new ck-tool-bar" ng-class="ckToolPosMode"><div id="topEditor-" class="top-editor"></div></div></div><div class="ew-m con"><div class="ew-list" id="courseDirOpen"><a href="javascript:;" class="close-b" title="隐藏"><i class="image-con-dir-close"></i></a><div class="h"><span>课程目录</span></div><div class="l dir"><div class="l-c"><div class="tree-line"></div><ul><li class="option" ng-repeat="item in cat.items track by $index" ng-show="item.type == \'T1\' || item.type == \'T2\'"><div class="icon"><i class="image-con-dir-t1" ng-show="item.type == \'T1\'"></i> <i class="image-con-dir-t2" ng-show="item.type == \'T2\'"></i></div><a ng-show="item.type == \'T1\'" ng-click="gotoGrpItem(item.id)" title="{{item.title}}" class="section-context first">{{item.title}}</a> <a ng-show="item.type == \'T2\'" ng-click="gotoGrpItem(item.id)" title="{{item.title}}" class="section-context second">{{item.title}}</a></li></ul></div></div></div><div class="ew-word" id="contentEditEw"><div class="m w-ck dir"><div class="un-support" ng-show="unSupport"><div>{{unSupport}}</div></div><div ng-repeat="group in content.groups track by $index"><content-group group="group" ctrl="containerCtrl" index="$index" focus="curItemIndex"></content-group></div></div></div></div><div class="upload-area"><input type="file" id="{{uploadInputId}}"></div></div></div>',replace:"true",scope:{config:"="},controller:["$compile","$interval","$timeout","$log","$scope","$rootScope","$resource","$location","contentService","courseContent","service",function($compile,$interval,$timeout,$log,$scope,$rootScope,$resource,$location,contentService,courseContent,service){function setGroupLazy(e,t,i){$timeout(function(){lazy({node:"#c-list-"+t,container:"#"+e,callback:function(e){e&&i(t)}})})}function lazy(e){function t(){var t=$(e.node);if(t.length&&!a){var n=$(window),s=n.scrollTop(),o=s+n.height(),r=t.offset().top,c=r+t.height(),l=r>=s&&o>=r,d=s>=r&&c>=s;(l||d)&&(a=!a,"function"==typeof e.callback&&(e.callback(l||d),n.unbind("scroll",i),n.unbind("resize",i)))}}function i(){$timeout.cancel(n),n=$timeout(t,200)}var a,n,s=$(e.container);i(),s.bind("scroll",i),s.bind("resize",i)}var uploadUrl=DYCONFIG.fs.upload;if($scope.config){$scope.config.scope=$scope;var itemPage={per:10};$scope.aid="",$scope.uploadInputId="courseEditUploadFile",$scope.uploadUrl={upload:uploadUrl,fileDetail:uploadUrl+"fileDetail"},$scope.statusList={EDIT:null,VIEW:null,PREVIEW:null},$scope.curStatus="EDIT",$scope.curFocusItem=0,$scope.curItemIndex={group:0,index:$scope.curFocusItem},$scope.itemStatusList={NORMAL:{name:"正常"},"NON-UPDATE":{name:"未保存"},"NON-UPLOAD":{name:"未上传"}},$scope.content={groups:[],items:[]},$scope.numOnce=10,$scope.testContent="",$scope.egItems={"文档内容":{t:"text",c:{c:"<p>示例内容</p>"}},"练习试卷":{t:"practise",c:{d:{bankId:54748,name:"课程评测新增试卷",tag:"",desc:"",score:0,id:9263,p2bId:10650,start:0,isOwn:!0,uid:200097}}},"网络视频":{t:"embed",c:{title:"名称",url:"<iframe>示例视频</iframe>",style:{width:"640",height:"360"}}},"本地图片":{t:"image",c:{title:"名称",fid:41897,url:"http://14.23.162.172:19503/C66FD84781CDFAAD1119B86583D3D760.jpg",style:{width:"640",height:"360"}}},"本地视频":{
t:"video",c:{title:"名称",fid:41897,url:"http://14.23.162.172:19503/C66FD84781CDFAAD1119B86583D3D760.mp4",style:{width:"640",height:"360"}}},"下载附件":{t:"attach",c:{title:"名称",size:null,type:null,fid:41897,url:"http://14.23.162.172:19503/C66FD84781CDFAAD1119B86583D3D760.mp4"}},"链接":{t:"link",c:{title:"名称",url:"http://14.23.162.172:19503/C66FD84781CDFAAD1119B86583D3D760.mp4"}}},$scope.plugins={text:{status:!0,type:"content",data:{id:312,name:"测试内容",content:$scope.testContent},scope:null},practice:{type:"practice",data:{id:"3322211",name:"测试试卷"},scope:null},payArea:{status:!0,type:"payArea",data:{id:"3322211",name:"新增付费区域",items:[]},scope:null},video:{status:!0,type:"video",data:{id:"",status:"BLANK",name:"请输入网络视频地址"},scope:null},embed:{status:!0,type:"embed",data:{id:"",status:"BLANK",name:""},scope:null},T1:{status:!0,type:"T1",data:{id:"3322211",name:"新建章"},content:[],childItems:[]},T2:{status:!0,type:"T2",data:{id:"3322211",name:"新建节"},content:[],childItems:[]}},$scope.getPlugin=function(e,t){var i=$scope.plugins[e];if(i)return i.id=Date.parse(new Date),t&&(i.data.content=t),angular.copy(i)},$scope.changeCurFocus=function(e,t){$scope.curItemIndex.group=e,$scope.curItemIndex.index=t},$scope.getDeepIndex=function(e,t){for(var i=0,a=0;e>a;a++)i+=$scope.content.groups[a].ids.length;return i+t};var iInsertT={T1:!0,T2:!0,link:!0,text:!0,e_es:!0,embed:!0,practice:!1,video:!1,image:!1,attach:!1};$scope.insertItem=function(e,t,i){$scope.content.groups.length||$scope.addGroup();var a=$scope.getDeepIndex(t,i),n=art.addItem(e,a),s=$scope.makePlugin(n,e,"insert");return $scope.content.groups[t].items.splice(i,0,s),$scope.content.groups[t].ids.splice(i,0,n),$scope.content.groups[t].dis||($scope.content.groups[t].dis=!0),$scope.curItemIndex.index=i,$scope.gotoLoc("main-content-"+n),$scope.refCat(),$scope.refItems(),$timeout(function(){"e_es"===s.type&&$scope.containerCtrl("openPaper",s)}),n},$scope.newItem=function(e,t){var i=e.type+"-"+$scope.aid+"-"+(new Date).getTime();if("T1"==e.type)var a={t:e.type,c:{title:"请输入章名称"},g:"_"};else if("T2"==e.type)var a={t:e.type,c:{title:"请输入节名称"},g:"_"};else if("text"==e.type)var a={t:e.type,c:{c:$scope.testContent},g:"_"};else if("e_es"==e.type)var a={t:e.type,c:{aid:t.aid,tid:null,type:"e_paper",desc:"",title:"未命名试卷",d:{oid:$rootScope.cid,time:0}},g:"_"};else if("link"==e.type)var a={t:e.type,c:{title:"",url:"",status:"EDIT"},g:"_"};else if("embed"==e.type)var a={t:e.type,c:{title:"",url:"",status:"EDIT",style:{width:"640",height:"360"}},g:"_"};else if("image"==e.type){var a={t:e.type,c:{mark:i,status:"UPLOAD",title:"本地图片",fid:null,url:"",style:{}},g:"_"};$scope.upload(a,$scope.curItemIndex.group,e.index)}else if("video"==e.type){var a={t:e.type,c:{mark:i,status:"UPLOAD",title:"本地视频",fid:null,url:"",style:{width:"640",height:"360"}},g:"_"};$scope.upload(a,$scope.curItemIndex.group,e.index)}else if("attach"==e.type){var a={t:e.type,c:{mark:i,status:"UPLOAD",title:"附件",fid:null,url:""},g:"_"};$scope.upload(a,$scope.curItemIndex.group,e.index)}else{if("flash"!=e.type)return;var a={t:e.type,c:{mark:i,status:"UPLOAD",title:"Flash",fid:null,url:""},g:"_"};$scope.upload(a,$scope.curItemIndex.group,e.index)}iInsertT[e.type]&&$scope.insertItem(a,$scope.curItemIndex.group,e.index)},$scope.moveItem=function(e,t,i){if(!("up"===i&&0==t||"down"===i&&t==$scope.content.items.length-1)){var a=$scope.content.items[t];angular.isUndefined(a.disContent)||(a.disContent=!1),"up"==i&&(art.moveItem3(e.id,!0),$scope.content.items.splice(t,1),$scope.content.items.splice(t-1,0,a),$scope.refCat()),"down"==i&&(art.moveItem3(e.id,!1),$scope.content.items.splice(t,1),$scope.content.items.splice(t+1,0,a),$scope.refCat()),"del"==i&&(art.removeItem(e.id),$scope.content.items.splice(t,1),$scope.refCat())}},$scope.getNonEmptyGrp=function(e,t){var i=0,a=t;if("up"===e){for(var n=a;n>=i;n--)if($scope.content.groups[n].ids.length>0)return $scope.content.groups[n]}else{i=t,a=$scope.content.groups.length-1;for(var n=i;a>=n;n++)if($scope.content.groups[n].ids.length>0)return $scope.content.groups[n]}return!1},$scope.moveGroupItem=function(e,t,i,a){var n=$scope.content.groups[i],s=n.items[a];if(angular.isUndefined(s.disContent)||(s.disContent=!1),!("up"===e&&0==a&&0==i||"down"===e&&a==n.items.length-1&&i==$scope.content.groups.length-1)){if("up"===e&&0==a){var o=$scope.getNonEmptyGrp(e,i-1);return void(o&&(art.moveItem3(t.id,!0),n.items.splice(a,1),n.ids.splice(a,1),o.items.splice(o.items.length-1,0,s),o.ids.splice(o.ids.length-1,0,s.id),$scope.refCat()))}if("down"===e&&a==n.ids.length-1){var o=$scope.getNonEmptyGrp(e,i+1);return void(o&&(art.moveItem3(t.id,!1),n.items.splice(a,1),n.ids.splice(a,1),o.items.splice(1,0,s),o.ids.splice(1,0,s.id),$scope.refCat()))}"up"==e&&(art.moveItem3(t.id,!0),n.items.splice(a,1),n.ids.splice(a,1),n.items.splice(a-1,0,s),n.ids.splice(a-1,0,s.id),$scope.refCat()),"down"==e&&(art.moveItem3(t.id,!1),n.items.splice(a,1),n.ids.splice(a,1),n.items.splice(a+1,0,s),n.ids.splice(a+1,0,s.id),$scope.refCat()),"del"==e&&(art.removeItem(t.id),n.items.splice(a,1),n.ids.splice(a,1),$scope.refCat())}},$scope.refCat=function(){$scope.idsCat=art.findIids({T:1,T1:1,T2:1});var e=[];console.log($scope.idsCat);for(var t=0;t<$scope.idsCat.length;t++){var i=art.findItem($scope.idsCat[t],1,1);i&&i.visiable&&e.push({id:$scope.idsCat[t],title:i.c.title,type:i.t})}$scope.cat.items=e,$scope.$emit("getCourseDirNew",e)},$scope.refItems=function(){$scope.idsContent=art.findIids()},$scope.getItemById=function(e){for(var t=0;t<$scope.content.groups.length;t++)for(var i=0;i<$scope.content.groups[t].items.length;i++)if($scope.content.groups[t].items[i].id==e)return $scope.content.groups[t].items[i]},$scope.getItemInfoById=function(e){for(var t={id:null,group:0,index:0},i=0;i<$scope.content.groups.length;i++)for(var a=0;a<$scope.content.groups[i].ids.length;a++)if($scope.content.groups[i].ids[a]==e){t.id=$scope.content.groups[i][a],t.group=i,t.index=a;break}return t},$scope.getItemByPid=function(e){for(var t=0;t<$scope.content.groups.length;t++)for(var i=0;i<$scope.content.groups[t].items.length;i++){var a=$scope.content.groups[t].items[i];if("practise"==a.type&&a.data.p2bId==e)return a}},$scope.getItemByMark=function(e){for(var t=0;t<$scope.content.groups.length;t++)for(var i=0;i<$scope.content.groups[t].items.length;i++){var a=$scope.content.groups[t].items[i];if(a.data.mark&&a.data.mark===e)return a}},$scope.addGroup=function(){$scope.content.groups.push({ids:[],items:[]})},$scope.cat={items:[]},$scope.makeCat=function(e,t){art.next(e).done(function(i,a){for(var n=0;n<e.length;n++){var s=art.findItem(e[n],1,1);s&&s.visiable&&t.push({id:e[n],title:s.c.title,type:s.t}),i.art.items[e[n]]||!i.einfo[e[n]]}$scope.$emit("getCourseDirNew",t)}).fail(function(e,t){})},$scope.makePlugin=function(e,t,i){var a={id:e,type:t.t,scope:$scope.itemScope,fileDis:"insert"===i};return"T"==t.t||"T1"==t.t?a.data={title:t.c.title}:"T2"==t.t?a.data={title:t.c.title}:"text"==t.t?a.data={content:t.c.c}:"e_es"==t.t?a.data={aid:t.c.aid,tid:t.c.tid,type:t.c.type,desc:t.c.desc,title:t.c.title,data:t.c.d}:"link"==t.t?a.data={mark:t.c.mark,title:t.c.title,url:t.c.url,status:t.c.status}:"embed"==t.t?a.data={mark:t.c.mark,title:t.c.title,url:t.c.url,status:t.c.status,style:t.c.style}:"image"==t.t?a.data={mark:t.c.mark,url:t.c.url,title:t.c.title,size:t.c.size,ext:t.c.ext,status:t.c.status,style:t.c.style}:"video"==t.t?a.data={mark:t.c.mark,url:t.c.url,title:t.c.title,size:t.c.size,ext:t.c.ext,exec:t.c.exec||"none",execInfo:t.c.execInfo||void 0,status:t.c.status,style:t.c.style}:"attach"==t.t?a.data={mark:t.c.mark,url:t.c.url,title:t.c.title,size:t.c.size,ext:t.c.ext,exec:t.c.exec||"none",execInfo:t.c.execInfo||void 0,type:t.c.type,status:t.c.status}:"flash"==t.t&&(a.data={mark:t.c.mark,url:t.c.url,title:t.c.title,size:t.c.size,ext:t.c.ext,type:t.c.type,status:t.c.status}),a},$scope.makeContent=function(e){$scope.content.groups=[];for(var t=0;t<e.length;t++)0!=t&&(t+1)%itemPage.per!==0||$scope.addGroup(),$scope.content.groups[$scope.content.groups.length-1].ids.push(e[t])},$scope.refCatLoc=function(e){for(var t=0;t<$scope.cat.items.length;t++)$scope.cat.items[t].id!==e.id||angular.isUndefined(e.data.title)||($scope.cat.items[t].title=e.data.title)},$scope.formatItemData=function(e){var t=e.data;return"text"==e.type&&(t={c:e.data.content}),"practise"==e.type&&(t={d:e.data}),t},$scope.formatItem=function(e){return{t:e.type,c:$scope.formatItemData(e),g:e.g}},$scope.updateItem=function(e,t){if(e){var i=art.findItem(e.id);i.c=$scope.formatItem(e).c,art.updateItem(e.id,i),!art.isUpdated()||art.isUpdated_()?(t({err:!0}),window.resm="testupdate1 check updated error 2..."):t({err:!1})}},$scope.savePaper=function(e){var t=$scope.getItemById(e.id);console.log(e,t),t.data.title=e.title,t.data.type=e.type,t.data.tid=e.tid,t.data.desc=e.desc,$scope.updateItem(t,function(){})},$scope.itemScope={emit:function(e,t,i){switch(e){case"T1":$scope.refCatLoc(t),$scope.updateItem(t,i);break;case"T2":$scope.refCatLoc(t),$scope.updateItem(t,i);break;case"text":$scope.updateItem(t,i);break;case"link":$scope.updateItem(t,i);break;case"embed":$scope.updateItem(t,i);break;case"image":$scope.updateItem(t,i);break;default:return}}};var doneItems={};$scope.containerCtrl=function(e,t){if("emit"===e)switch(t.type){case"T1":$scope.refCatLoc(t.data),$scope.updateItem(t.data,t.cb);break;case"T2":$scope.refCatLoc(t.data),$scope.updateItem(t.data,t.cb);break;case"text":$scope.updateItem(t.data,t.cb);break;case"link":$scope.updateItem(t.data,t.cb);break;case"embed":$scope.updateItem(t.data,t.cb);break;case"image":$scope.updateItem(t.data,t.cb)}"move"===e&&$scope.moveGroupItem(t.type,t.item,t.group,t.index),"openPaper"===e&&$scope.config.openPaper(t)},$scope.getItems=function(e,t){if(!$scope.content.groups[e].dis&&!angular.isUndefined($scope.content.groups[e])){var i=$scope.content.groups[e].ids;art.next(i).done(function(a,n){for(var s={},o={},r=[],c=0;c<i.length;c++){var l=art.findItem(i[c],1,1);if(l.t&&l.visiable){var d=$scope.makePlugin(i[c],l);s[i[c]]=d,!angular.isUndefined(d.data)&&d.data.mark&&(o[d.data.mark]={id:i[c],item:d,mark:d.data.mark},r.push(d.data.mark))}}r.length&&uploadFile.transMarkUrl(o,o),angular.forEach(i,function(t){s[t]&&$scope.content.groups[e].items.push(s[t])}),$scope.content.groups[e].dis=!0,t&&$scope.gotoLoc(t)}).fail(function(e,t){window.resm=e})}};var art=null;$scope.idsCat=[],$scope.idsContent=[];var uer=new jswf.Uer($scope.uploadUrl.upload,{m:"C",token:rcpAid.getToken()},!0),uploadFile={picArr:["png","jpg","bmp","gif","jpeg","PNG","JPG","BMP","GIF","JPEG"],videoArr:["wmv","rm","rmvb","mpg","mpeg","mpe","3gp","mov","mp4","m4v","avi","mkv","flv","vob"],docArr:["doc","docx","pdf","ppt","pptx"],specialArr:["swf"],fileList:{},judgeFileConvert:function(e){},transMarkUrl:function(e,t){var i=[];angular.forEach(e,function(e,a){if("SUCCESS"!==e.item.data.status&&(e.item.s="NON-UPDATE"),"UPLOAD"===e.item.data.status&&(e.item.data.status="LOADFAIL"),t[a]){var n=(t[a],e.item);"image"===n.type&&(n.data.url=courseContent.transImgUrl(a)),"video"===n.type&&("none"===n.data.exec||"done"===n.data.exec?(n.data.url=courseContent.transVideoUrl(a),n.data.bindHtml=courseContent.bindHtml("video",a,n)):"error"===n.data.exec?(n.data.url=courseContent.transVideoUrl(a),n.data.bindHtml=courseContent.bindHtml("video",a,n)):i.push({item:n,mark:a})),"flash"===n.type&&(n.data.url=courseContent.transFlashUrl(a),n.data.bindHtml=courseContent.bindHtml("flash",a,n)),"attach"===n.type&&(n.data.url=courseContent.transDownloadUrl(a),$.inArray(n.data.ext,uploadFile.specialArr)&&"none"!==n.data.exec&&"done"!==n.data.exec&&"error"!==n.data.exec&&i.push({item:n,mark:a}))}else e.item.data.status="LOADFAIL";uploadFile.fileCovertListRef(i)})},fileCovertCheckTime:1e4,fileCovertList:[],fileCovertListRef:function(e,t,i){uploadFile.fileCovertList.length?e?angular.forEach(e,function(e,t){uploadFile.fileCovertList.push(e)}):uploadFile.fileCovertList.push({item:t,mark:i}):(e?angular.forEach(e,function(e,t){uploadFile.fileCovertList.push(e)}):uploadFile.fileCovertList.push({item:t,mark:i}),uploadFile.fileConvertPool(uploadFile.fileConvertSuccessHandle))},fileCovertInsert:function(e,t,i){if(e.ext&&e.ext.id){var a=$scope.getItemByMark(t);uploadFile.fileCovertListRef(0,a,t)}},fileConvertPool:function(e){if(uploadFile.fileCovertList.length){var t=[];angular.forEach(uploadFile.fileCovertList,function(e,i){t.push(e.mark)}),courseContent.getFileInfo(t,{option:{loading:!1}}).then(function(t){0===t.code&&angular.forEach(uploadFile.fileCovertList,function(i,a){!t.data[i.mark]||"done"!==t.data[i.mark].base.exec&&"error"!==t.data[i.mark].base.exec||(e(i,t.data[i.mark]),uploadFile.fileCovertList.splice(a,1))}),uploadFile.fileCovertList.length&&$timeout(function(){uploadFile.fileConvertPool(e)},uploadFile.fileCovertCheckTime)})}},fileConvertSuccessHandle:function(e,t){var i=e.item,a=t.base;"video"===i.type&&(i.data.status="SUCCESS",i.data.exec=a.exec,i.data.execInfo=a.info,i.data.url=courseContent.transVideoUrl(i.data.mark),i.data.bindHtml=courseContent.bindHtml("video",i.data.mark,i),$scope.updateItem(i,function(){})),"attach"===i.type&&(i.data.status="SUCCESS",i.data.exec=a.exec,i.data.execInfo=a.info,$scope.updateItem(i,function(){}))},insertPic:function(e){var t=e.ext;if(t){var i=$scope.getItemByMark(e.args.mark);i.data.status="SUCCESS",i.data.url=courseContent.transImgUrl(e.args.mark),$scope.updateItem(i,function(){}),$timeout(function(){var e=new Image;e.src=$("#img-show-"+i.id).attr("src"),angular.isUndefined(i.data.style)&&(i.data.style={}),e.onload=function(){e.width>800?(i.data.style.width=800,i.data.style.height=800*e.height/e.width):(i.data.style.width=e.width,i.data.style.height=e.height)}})}$scope.$apply()},insertVideo:function(e,t,i){var a=e.ext;if(a){var n=$scope.getItemByMark(e.args.mark);n.data.status="SUCCESS",n.data.exec=i.exec,n.data.execInfo=i.info,"none"!==i.exec&&"done"!==i.exec||(n.data.url=courseContent.transVideoUrl(e.args.mark),n.data.bindHtml=courseContent.bindHtml("video",e.args.mark,n)),$scope.updateItem(n,function(){}),t&&$scope.$apply()}},insertFlash:function(e,t){var i=e.ext;if(i){var a=$scope.getItemByMark(e.args.mark);a.data.status="SUCCESS",a.data.url=courseContent.transFlashUrl(e.args.mark),a.data.bindHtml=courseContent.bindHtml("flash",e.args.mark,a),$scope.updateItem(a,function(){}),t&&$scope.$apply()}},insertFile:function(e,t,i){var a=e.ext;if(a){var n=$scope.getItemByMark(e.args.mark);n.data.status="SUCCESS",n.data.exec=i.exec,n.data.execInfo=i.info,n.data.url=courseContent.transDownloadUrl(e.args.mark),$scope.updateItem(n,function(){}),t&&$scope.$apply()}},uploadRate:function(e,t,i){var a=e.ext;if(a){var n=$scope.getItemByMark(e.args.mark),s="100";if(1!=t&&(s=""+100*t.toFixed(2).substr(0,4),s.length>6))return;n.data.per=s}$scope.$apply()},renderSize:function(e){if(null==e||""==e)return"0 Bytes";var t=["Bytes","KB","MB","GB","TB","PB","EB","ZB","YB"],i=0,a=parseFloat(e),n=Math.round(a/Math.pow(1024,i=Math.floor(Math.log(a)/Math.log(1024))));return n+t[i]},filterFile:function(e,t,i,a){for(var n=t.t,s=(new Date).getTime(),o=0;o<e.files.length;o++){s++;var r=e.files[o],c=null,l=r.name.split(".").pop().toLowerCase();if(t.c.ext=l,t.c.per=0,"image"==n&&-1===$.inArray(l,uploadFile.picArr))return service.dialog.alert("只支持png、jpg、bmp、gif、jpeg、PNG、JPG、BMP、GIF、JPEG格式的图片"),[];if("video"==n&&-1===$.inArray(l,uploadFile.videoArr))return service.dialog.alert("只支持wmv、rm、rmvb、mpg、mpeg、mpe、3gp、mov、mp4、m4v、avi、mkv、flv、vob格式的视频"),[];if("flash"==n&&-1===$.inArray(l,uploadFile.specialArr))return service.dialog.alert("只支持swf格式的flash"),[];r.ext={opt:n,eid:t.t+s,title:r.name,size:uploadFile.renderSize(r.size),ext:l},r.args={},t.c.title=r.name,t.c.size=uploadFile.renderSize(r.size),t.c.ext=l,c=-1!=$.inArray(l,uploadFile.picArr)&&"image"==n?$scope.insertItem(t,i,a):-1!=$.inArray(l,uploadFile.videoArr)&&"video"==n?$scope.insertItem(t,i,a):-1!=$.inArray(l,uploadFile.specialArr)&&"flash"==n?$scope.insertItem(t,i,a):$scope.insertItem(t,i,a),r.ext.id=c,r.ext.eid=t.c.mark,r.ext.type=n,r.args.mark=t.c.mark,r.args.owner=$scope.aid}return e.files}},clearFile=function(e){var t=document.getElementById(e);t&&(t.outerHTML?t.outerHTML=t.outerHTML:t.value="")};$scope.upload=function(e,t,i){$scope.uploadInputId;return"undefined"==typeof uer?void service.dialog.alert("上传组件加载中，请稍后..."):(uer.OnProcess=function(e,t,i,a){uploadFile.uploadRate(e,t,a)},uer.OnSuccess=function(e,t,i){if("string"==typeof t&&(t=JSON.parse(t)),301==t.code)return void service.dialog.alert("请重新登录。");if(0!=t.code)return void service.dialog.alert("上传失败。");var a=e.name.split(".").pop().toLowerCase();if(-1!=$.inArray(a,uploadFile.picArr)&&"image"==e.ext.opt)uploadFile.insertPic(e);else if(-1!=$.inArray(a,uploadFile.videoArr)&&"video"==e.ext.opt){if(uploadFile.insertVideo(e,1,t.base),$.inArray(e.ext.ext,uploadFile.videoArr)&&"none"!=t.base.exec&&"done"!=t.base.exec){var n=$scope.getItemByMark(e.args.mark);n.data.exec=t.base.exec,uploadFile.fileCovertInsert(e,e.args.mark,t.base.id)}}else if(-1!=$.inArray(a,uploadFile.specialArr)&&"flash"==e.ext.opt)uploadFile.insertFlash(e,1);else if(uploadFile.insertFile(e,1,t.base),$.inArray(e.ext.ext,uploadFile.specialArr)&&"none"!=t.base.exec&&"done"!=t.base.exec){var n=$scope.getItemByMark(e.args.mark);n.data.exec=t.base.exec,uploadFile.fileCovertInsert(e,e.args.mark,t.base.id)}uer.ClearLoaded(),clearFile($scope.uploadInputId)},uer.OnErr=function(e,t,i){$(".jf-tips").length||jf.confirm("上传失败，请删除后重试。",{mask:!0,confirmTitle:"文件上传"},function(){}),uer.ClearLoaded(),clearFile($scope.uploadInputId)},uer.OnPrepare=function(e,t,i){return e.args},uer.AddI($scope.uploadInputId,{},{}),uer.OnSelect=function(a,n){return uploadFile.filterFile(a,e,t,i)},void $("#"+$scope.uploadInputId).click())},$scope.addExam=function(e){service.examReq.createPaper({owner:"course",type:"paper",oid:$rootScope.cid}).then(function(e){0===e.code&&$scope.newItem({type:"e_es",index:$scope.curItemIndex.index+1},{aid:e.data.id})})};var initSwitch=!1,contentSwitch=!1;$scope.init=function(e){e&&"0"!==e||($scope.unSupport="对不起，当前课程不支持体验版编辑课程内容 :("),$scope.aid=e,art=new wcms.Article(e,"T",3),art.args.uid=1,art.args.token=rcpAid.getToken(),art.run().done(function(e,t){initSwitch=!0,$scope.idsCat=e.findIids({T1:1,T2:1}),$scope.idsContent=e.findIids(),console.log(e,t,$scope.idsCat,$scope.idsContent),$scope.makeCat($scope.idsCat,$scope.cat.items),$scope.makeContent($scope.idsContent),console.log($scope.content)}).fail(function(e,t){window.resm=e,"new version"==e&&(art.ls_clear(),$scope.init())})},$scope.getContent=function(){if(!contentSwitch)var e=$interval(function(){console.log("initSwitch",initSwitch),initSwitch&&(contentSwitch=!0,angular.forEach($scope.content.groups,function(e,t){setGroupLazy("contentEditEw",t,$scope.getItems)}),$interval.cancel(e))},500)};var saveFlag=!1;$scope.saveContent=function(){if(!saveFlag){saveFlag=!0;for(var e=[],t=0;t<$scope.content.groups.length;t++)for(var i=$scope.content.groups[t],a=0;a<i.items.length;a++)i.items[a].s&&"NORMAL"!==i.items[a].s&&"NON-UPDATE"===i.items[a].s&&$scope.updateItem(i.items[a],function(){});return e.length?(service.dialog.alert("您还有"+e.length+"处未编辑的内容"),saveFlag=!1,void $scope.gotoLoc(e[0])):void $timeout(function(){art.save().done(function(e,t){if(service.dialog.alert("课程内容保存成功"),!angular.isUndefined(t)){if(t.iidm){var i=t.iidm;angular.forEach(i,function(e,t){var i=$scope.getItemInfoById(t);$scope.content.groups[i.group].ids[i.index]=e;var a=$scope.content.groups[i.group].items[i.index];angular.isUndefined(a)||(a.id=e)}),$scope.refCat()}console.log(i,$scope.content.groups)}$scope.content.groups.length&&$scope.content.groups[0].items&&$scope.config.changeStatus($scope.content.groups[0].items.length),saveFlag=!1}).fail(function(){saveFlag=!1,service.dialog.alert("课程内容保存失败")})})}},$scope.gotoGrpItem=function(e){var t=$scope.getItemInfoById(e);$scope.content.groups[t.group].dis?$scope.gotoLoc("main-content-"+e):$scope.getItems(t.group,"main-content-"+e)},$scope.gotoLoc=function(e){$timeout(function(){$("#contentEditEw").scrollTo("#"+e,200)})},$scope.cid=QueryStringByName("cid"),$scope.previewUrl=function(){return rcpAid.getUrl("学习页","?cid="+$rootScope.cid)};var widthThreshold=1200,width=$(window).width();$scope.editWidthMode=widthThreshold>width?"petty":"wide",$scope.ckToolPosMode=widthThreshold>width?"petty":"wide",$(window).resize(function(){var e=$(this).width();$scope.editWidthMode=widthThreshold>e?"petty":"wide",$scope.ckToolPosMode=widthThreshold>e?"petty":"wide",$scope.$apply()}),$(function(){function item(w,v,b,b2,attr){$(w).each(function(index,item){$(this).find(b2).addClass("open").attr("title","展开"),eval("$(this).find(v).css({"+attr+":-$(this).find(v).outerWidth(true)}).hide()"),$(this).find(b).length>0&&!$(this).find(b)[0].clickFlag&&($(this).find(b).click(function(){this.toggleFlag?($(item).find(b2).addClass("open").attr("title","展开"),eval("$(item).find(v).stop(true,true).animate({"+attr+":-$(item).find(v).outerWidth(true)},'fast',function (){ $(this).hide() })"),eval("$(item).find('.ew-word').stop(true,true).animate({"+attr+":0},'fast')")):($(item).find(b2).removeClass("open").attr("title","隐藏"),eval("$(item).find(v).show().stop(true,true).animate({"+attr+":0},'fast')"),eval("$(item).find('.ew-word').stop(true,true).animate({"+attr+":"+($(item).find(v).outerWidth(!0)+5)+"},'fast')")),this.toggleFlag=!this.toggleFlag}),$(this).find(b)[0].clickFlag=!0),$(this).find(v).find(b2).length>0&&!$(this).find(v).find(b2)[0].clickFlag&&($(this).find(v).find(b2).click(function(){$(item).find(b).click()}),$(this).find(v).find(b2)[0].clickFlag=!0)})}item(".edit-w",".ew-list",".overview-b",".close-b","left"),item(".edit-w",".ew-related",".set-knowledge-b",".close-b","right")})}}]}}),module.directive("contentGroup",function(){return{restrict:"E",template:'<div id="c-list-{{index}}"><div ng-hide="group.dis" class="group-loading"><div class="loading-body"><div class="loading-img"></div><span>加载中</span></div></div><div ng-show="group.dis"><div ng-repeat="item in group.items track by $index"><div class="main-content" ng-click="changeCurFocus(index,$index)" id="main-content-{{item.id}}" ng-class="{\'gray-back\':curInfo.group == index && curInfo.index == $index,\'edit\':true}"><div class="tools" ng-hide="index == 0 && group.items.length == 1"><a ng-click="moveItem(item,$index,\'up\')"><div class="ic"><i class="image-new-pos-up"></i></div></a><a ng-click="moveItem(item,$index,\'down\')"><div class="ic"><i class="image-new-pos-down"></i></div></a><a ng-click="moveItem(item,$index,\'del\')"><div class="ic"><i class="image-new-pos-del"></i></div></a></div><div class="content-container" id="container-{{item.id}}"><div class="container-show"><div class="plugin-title-first plugin" id="titleFirst={{item.id}}" ng-show="item.type == \'T1\'"><div class="title-c"><p class="first-title"><input ng-model="item.data.title" type="text" onclick="this.select()" maxlength="50" ng-blur="dataEmit($index)" ng-change="changeStatus($index,\'NON-UPDATE\')"></p></div></div><div class="plugin-title-second plugin" id="titleSecond={{item.id}}" ng-show="item.type == \'T2\'"><div class="title-c"><p class="second-title"><input ng-model="item.data.title" type="text" onclick="this.select()" maxlength="50" ng-blur="dataEmit($index)" ng-change="changeStatus($index,\'NON-UPDATE\')"></p></div></div><div class="quote-list plugin" ng-show="item.type != \'T1\' && item.type != \'T2\'"><div ng-show="item.type == \'E\'">付费内容</div><div ng-show="item.type == \'empty\' || item.type == \'loading\'">内容正在努力加载中</div><div class="practice-plugin" id="practise-{{item.id}}" ng-show="item.type == \'practise\'"><div><div class="content"><span>{{item.data.name}}</span> <a class="edit" ng-show="item.data.isOwn" ng-click="openPaper($index,\'edit\')">编辑</a> <a class="edit" ng-show="!item.data.isOwn" ng-click="openPaper($index,\'preview\')">预览</a></div></div></div><div class="plugin-video" id="video-{{item.id}}" ng-show="item.type == \'video\'"><div class="wait-init" ng-show="item.data.status == \'LOADING\'"><span>视频信息读取中</span></div><div class="wait-init" ng-show="item.data.status == \'LOADFAIL\'"><span>视频信息读取失败，请删除后重新上传。</span></div><div class="wait-init upload" ng-show="item.data.status == \'UPLOAD\'"><span>视频文件上传中：{{item.data.per || 0}}%</span><div class="plugin-progress"><div class="upload-progress"><div class="upload-progress-bar success" ng-style="{\'width\':item.data.per * 4 + \'px\'}"></div></div></div></div><div class="wait-init" ng-show="item.data.status == \'TRANS\'"><span>视频转码中</span></div><div class="wait-init" ng-show="item.data.status == \'FAIL\'"><span>视频转码失败，请删除后重新上传。</span></div><div ng-show="item.data.status == \'SUCCESS\'"><div class="file-collapse" ng-hide="item.fileDis"><div class="head"><div class="icon"><i class="image-plugin-i-video"></i></div><div class="title"><a ng-bind="\'本地视频  \' + item.data.title" title="{{item.data.title}}" ng-click="item.fileDis = true"></a></div></div><div class="btn-grp"><span class="exec" ng-show="item.data.exec === \'running\'"><img src="/course/imgs/loading-convert.gif" alt="">转码中</span> <span class="exec" ng-show="item.data.exec === \'error\'">转码失败</span> <a href="" ng-show="item.data.exec === \'done\'" ng-click="item.fileDis = true">播放</a> <a href="" ng-click="moveItem(item,$index,\'del\')">删除</a></div></div><div class="file-expand" ng-show="item.fileDis"><p><a href="javascript:;" class="up" ng-click="item.fileDis = false"><span>收起</span> <i class="fa fa-arrow-circle-up"></i></a></p><p class="title" ng-bind="\'视频名称：\' + item.data.title" ng-show="item.data.title"></p><div class="video-convert" ng-show="item.data.exec === \'running\'"><img src="/course/imgs/loading-yellow.gif" alt=""><p>视频转码中。。</p></div><div class="video-convert" ng-show="item.data.exec == \'error\'"><img src="/course/imgs/convert-error.png" alt=""> <span>视频转码失败，请删除后重新上传。</span></div><div ng-bind-html="deliberatelyTrustDangerousSnippet($index,item.data.bindHtml)" ng-show="item.data.exec === \'done\'"></div></div></div></div><div class="plugin-content" id="content-{{item.id}}" ng-if="item.type == \'text\'"><div class="content-editor-plh" ng-show="item.data.content == \'\'"><p>请在这里输入课程内容</p></div><div id="editor-course-{{item.id}}" class="content-editor" args="item" scope="dataEmit" index="$index" tag="\'course\'" ng-model="item.data.content" content-editor editor-scope="item.editorScope" ng-bind-html="item.ckContent" contenteditable="true" ng-click="activeEditor($index)"></div></div><div class="plugin-embed" id="embed-{{item.id}}" ng-show="item.type == \'embed\'"><div class="wait-init" ng-show="item.data.status == \'EDIT\'"><div><span>视频名称：</span> <input type="text" ng-model="item.data.title" placeholder="请输入视频名称"></div><div><span>视频代码：</span> <input type="text" ng-model="item.embedUrl" placeholder="请输入网络视频地址"> <span class="tips">提示：目前只支持video、iframe、embed格式的视频代码，embed视频无法在手机端播放</span></div><div><a class="confirm" ng-click="confirmEmbed($index)">确定</a></div></div><div class="embed-success" ng-show="item.data.status == \'SUCCESS\'"><div class="file-collapse" ng-hide="item.fileDis"><div class="head"><div class="icon"><i class="image-plugin-i-video"></i></div><div class="title"><a ng-bind="\'网络视频  \' + item.data.title" title="{{item.data.title}}" ng-click="item.fileDis = true">网络视频</a></div></div><div class="btn-grp"><a href="" ng-click="editEmbed($index)">修改</a> <a href="" ng-click="item.fileDis = true">播放</a> <a href="" ng-click="moveItem(item,$index,\'del\')">删除</a></div></div><div class="file-expand" ng-show="item.fileDis"><p><a href="javascript:;" class="up" ng-click="item.fileDis = false"><span>收起</span> <i class="fa fa-arrow-circle-up"></i> </a><a href="javascript:;" class="edit" ng-click="editEmbed($index)"><span>修改</span> <i class="fa fa-pencil-square-o"></i></a></p><p class="title" ng-bind="\'视频名称：\' + item.data.title" ng-show="item.data.title"></p><div ng-bind-html="deliberatelyTrustDangerousSnippet($index,item.data.url)"></div></div></div></div><div class="plugin-link" id="link-{{item.id}}" ng-show="item.type == \'link\'"><div class="wait-init" ng-show="item.data.status == \'EDIT\'"><div><span>链接名称：</span> <input type="text" ng-model="item.data.title" placeholder="请输入链接名称"></div><div><span>链接地址：</span> <input type="text" ng-model="item.url" placeholder="链接地址"></div><div><a class="confirm" ng-click="confirmLink($index)">确定</a></div></div><div class="link-success" ng-show="item.data.status == \'SUCCESS\'"><div class="file-collapse"><div class="head"><div class="icon"><i class="image-plugin-i-link"></i></div><div class="title"><a target="_blank" href="" title="{{item.data.url}}" ng-href="{{item.data.url}}">{{item.data.title == \'\' ? item.data.url : item.data.title}}</a></div></div><div class="btn-grp"><a href="" ng-click="editLink($index)">编辑</a> <a href="" ng-click="moveItem(item,$index,\'del\')">删除</a></div></div></div></div><div class="plugin-image" id="image-{{item.id}}" ng-show="item.type == \'image\'"><div class="wait-init" ng-show="item.data.status == \'LOADING\'"><span>图片信息读取中</span></div><div class="wait-init" ng-show="item.data.status == \'LOADFAIL\'"><span>图片信息读取失败，请删除后重新上传。</span></div><div class="wait-init upload" ng-show="item.data.status == \'UPLOAD\'"><span>图片上传中：{{item.data.per || 0}}%</span><div class="plugin-progress"><div class="upload-progress"><div class="upload-progress-bar success" ng-style="{\'width\':item.data.per * 4 + \'px\'}"></div></div></div></div><div class="image-success" ng-if="item.data.status == \'SUCCESS\'" ng-mouseover="item.editBtn = true" ng-mouseleave="item.editBtn = false"><div class="edit-btn" ng-show=""><a ng-click="item.editMode = true" ng-show="!item.editMode && item.editBtn === true">编辑</a></div><div class="edit-style" ng-show="item.editMode"><div class="title">图片样式：</div><span>宽度：<input type="text" ng-model="item.data.style.width" ng-change="changeStatus($index,\'NON-UPDATE\')" placeholder="默认宽度"></span><span>高度：<input type="text" ng-model="item.data.style.height" ng-change="changeStatus($index,\'NON-UPDATE\')" placeholder="默认高度"></span><a ng-click="item.editMode = false" class="close-btn">收起</a></div><span class="success-main"><img id="img-show-{{item.id}}" ng-src="{{item.data.url}}" zoom="item.data.style" config="item.config" ng-style="item.data.style"></span></div></div><div class="plugin-attach" id="attach-{{item.id}}" ng-show="item.type == \'attach\'"><div class="wait-init" ng-show="item.data.status == \'LOADING\'"><span>文件信息读取中</span></div><div class="wait-init" ng-show="item.data.status == \'LOADFAIL\'"><span>文件息读取失败，请删除后重新上传。</span></div><div class="wait-init upload" ng-show="item.data.status == \'UPLOAD\'"><span>文件上传中：{{item.data.per || 0}}%</span><div class="plugin-progress"><div class="upload-progress"><div class="upload-progress-bar success" ng-style="{\'width\':item.data.per * 4 + \'px\'}"></div></div></div></div><div ng-show="item.data.status == \'SUCCESS\'"><div class="file-collapse"><div class="head"><div class="icon"><i class="image-plugin-i-file"></i></div><div class="title"><a ng-bind="item.data.title + \'(\' + item.data.size + \')\'" title="{{item.data.title}}" ng-href="{{item.data.url}}"></a></div></div><div class="btn-grp"><span ng-show="transExecType[item.data.ext]"><a href="" ng-href="{{\'/course/document-preview.html?mark=\'+item.data.mark+\'&type=\'+transExecType[item.data.ext]+\'&count=\'+item.data.execInfo[transExecType[item.data.ext]].count}}" target="_blank" ng-show="item.data.exec === \'done\'">预览</a> <span class="exec" ng-show="item.data.exec === \'running\'"><img src="/course/imgs/loading-convert.gif" alt="">转码中</span> <span class="exec" ng-show="item.data.exec === \'error\'">转码失败</span> </span><a href="" ng-href="{{item.data.url}}" target="_blank">下载</a> <a href="" ng-click="moveItem(item,$index,\'del\')">删除</a></div></div></div></div><div class="plugin-flash" id="flash-{{item.id}}" ng-show="item.type == \'flash\'"><div ng-show="item.data.status == \'LOADING\'"><span>文件信息读取中</span></div><div ng-show="item.data.status == \'LOADFAIL\'"><span>文件信息读取失败，请删除后重新上传。</span></div><div class="wait-init upload" ng-show="item.data.status == \'UPLOAD\'"><span>文件上传中：{{item.data.per || 0}}%</span><div class="plugin-progress"><div class="upload-progress"><div class="upload-progress-bar success" ng-style="{\'width\':item.data.per * 4 + \'px\'}"></div></div></div></div><div ng-show="item.data.status == \'FAIL\'"><span>获取文件信息失败，请删除后重新上传。</span></div><div ng-show="item.data.status == \'SUCCESS\'"><div class="file-collapse" ng-hide="item.fileDis"><div class="head"><div class="icon"><i class="image-plugin-i-flash"></i></div><div class="title"><a ng-bind="item.data.title" title="{{item.data.title}}" ng-click="item.fileDis = true"></a></div></div><div class="btn-grp"><a href="" ng-click="item.fileDis = true">播放</a> <a href="" ng-click="moveItem(item,$index,\'del\')">删除</a></div></div><div class="file-expand" ng-show="item.fileDis"><p><a href="javascript:;" class="up" ng-click="item.fileDis = false"><span>收起</span> <i class="fa fa-arrow-circle-up"></i></a></p><p class="title" ng-bind="item.data.title" ng-show="item.data.title"></p><div ng-bind-html="deliberatelyTrustDangerousSnippet($index,item.data.bindHtml)"></div></div></div></div><div class="plugin-exam" id="exam-{{item.id}}" ng-show="item.type == \'e_es\'"><div><div class="file-collapse"><div class="head"><div class="icon"><i class="image-plugin-i-exam"></i></div><div class="title"><a ng-bind="(item.data.type === \'e_paper\' ? \'试卷：\' : \'考试：\') + (item.data.title || \'未命名试卷\')" title="{{item.data.title}}" ng-click="item.fileDis = true"></a></div></div><div class="btn-grp"><a href="" ng-click="openPaper($index)">编辑</a> <a href="" ng-click="moveItem(item,$index,\'del\')">删除</a></div></div></div></div></div></div></div></div></div></div></div>',
replace:"true",scope:{group:"=group",ctrl:"=ctrl",index:"=index",curInfo:"=focus"},controller:["$timeout","$scope","$rootScope","$element","$sce","service","courseContent",function(e,t,i,a,n,s,o){t.items=t.group.items;var r={url:/(http|ftp|https):\/\/[\w\-_]+(\.[\w\-_]+)+([\w\-\.,@?^=%&amp;:\/~\+#]*[\w\-\@?^=%&amp;\/~\+#])?/,tagVideo:/<video(.*)>[^<]*<\/video>/gi,tagEmbed:/<embed(.*)>/gi,tagFrame:/<iframe(.*)>[^<]*<\/iframe>/gi};t.transExecType=o.convertExt.transExecType,t.getPreviewUrl=o.transPreviewUrl,t.initItems=function(){angular.forEach(t.items,function(e){e.ckContent=n.trustAsHtml(e.data?e.data.content:""),e.disContent=!1,e.url="",e.embedUrl="",e.config={mousewheelLock:!1,position:"static",ratioScaling:!0,minw:100,minh:100,mouseup:function(){e.s="NON-UPDATE"}}})},t.initItems(),t.$watchCollection("items",function(e){t.initItems()}),t.dataEmit=function(e){t.ctrl("emit",{type:t.items[e].type,data:t.items[e],cb:function(i){i.err||(t.items[e].s="NORMAL")}})},t.moveItem=function(e,i,a){t.ctrl("move",{type:a,item:e,group:t.index,index:i})},t.changeStatus=function(e,i){t.items[e].s=i},t.changeStatusData=function(e,i){t.items[e].data.status=i},t.deliberatelyTrustDangerousSnippet=function(e,i){return t.items[e].disContent?void 0:n.trustAsHtml(i)},t.changeCurFocus=function(e,i){t.curInfo.group=e,t.curInfo.index=i},t.openPaper=function(e){var i=t.items[e];t.ctrl("openPaper",i)},t.activeEditor=function(e){},t.confirmEmbed=function(e){if(""==t.items[e].embedUrl)return void s.dialog.alert("请输入网络视频代码");if(!t.items[e].embedUrl.match(r.tagFrame)&&!t.items[e].embedUrl.match(r.tagEmbed)&&!t.items[e].embedUrl.match(r.tagVideo))return void s.dialog.alert("只支持video、iframe、embed格式的视频代码");var i=$(t.items[e].embedUrl);i.attr("style","width: 640px;height :360px;"),t.items[e].data.url=i[0].outerHTML,t.dataEmit(e),t.items[e].fileDis=!0,t.items[e].data.status="SUCCESS"},t.editEmbed=function(e){t.items[e].embedUrl=t.items[e].data.url,t.changeStatusData(e,"EDIT")},t.confirmLink=function(e){if(""==t.items[e].url)return void s.dialog.alert("请输入链接地址");var i="";t.items[e].url.indexOf("http://")<0&&t.items[e].url.indexOf("https://")<0&&t.items[e].url.indexOf("ftp://")<0&&(i="http://"),t.items[e].data.url=i+t.items[e].url,t.items[e].data.title||(t.items[e].data.title=t.items[e].data.url),t.dataEmit(e),t.items[e].data.status="SUCCESS"},t.editLink=function(e){t.items[e].url=t.items[e].data.url,t.items[e].title===t.items[e].url&&(t.items[e].title=""),t.changeStatusData(e,"EDIT")}}]}}),module.directive("contentEditor",function(){return{require:"?ngModel",scope:{args:"=args",scope:"=scope",index:"=index",tag:"=tag",editorScope:"=editorScope",group:"="},link:function(e,t,i,a){var n=null,s="topEditor-"+(e.group||""),o=$("#"+s);e.$watch("editorScope",function(t){n||(e.editorScope=e,e.init())}),e.init=function(){if(null==n){var r={width:i.width,height:i.height,font_names:"宋体/宋体;黑体/黑体;仿宋/仿宋_GB2312;楷体/楷体_GB2312;隶书/隶书;幼圆/幼圆;微软雅黑/微软雅黑;"+CKEDITOR.config.font_names,extraPlugins:"language,sharedspace",removePlugins:"resize",sharedSpaces:{top:s},skin:"../../../ckeditor_ext/skin/minimalist",toolbarCanCollapse:!0,toolbar:"Full",toolbarGroups:[{name:"document",groups:["doctools","mode","document"]},{name:"clipboard",groups:["clipboard","undo"]},{name:"editing",groups:["find","selection","spellchecker","editing"]},{name:"forms",groups:["forms"]},{name:"insert",groups:["insert"]},{name:"paragraph",groups:["indent","blocks","align","bidi","paragraph"]},"/",{name:"links",groups:["links"]},{name:"basicstyles",groups:["basicstyles","cleanup"]},{name:"styles",groups:["styles"]},{name:"colors",groups:["colors"]},{name:"tools",groups:["tools"]}],removeButtons:"Save,NewPage,Print,Preview,Templates,Source,Flash,Iframe,Form,Checkbox,Radio,TextField,Textarea,Select,Button,ImageButton,HiddenField,Scayt,Anchor,Language,Styles,About,ShowBlocks,NumberedList,BulletedList,CreateDiv,Flash,Smiley,PageBreak,Image,SelectAll,Blockquote"};"editor-"+e.tag+"-"+e.args.id;t[0].id="editor-"+(new Date).getTime()+"-"+Math.floor(1e8*Math.random()),console.log("oiiiiiiiiiiiiiiiiiiiiiiiii",t[0].id),n=CKEDITOR.inline(t[0].id,r),n.on("instanceReady",function(e){n.setData(a.$viewValue)}),n.on("pasteState",function(e){a.$setViewValue(n.getData())}),n.on("refData",function(e){a.$setViewValue(n.getData())}),n.on("focus",function(t){o.show(),e.args.s="NON-UPDATE"}),n.on("change",function(t){a.$setViewValue(n.getData()),e.args.s="NON-UPDATE"}),n.on("key",function(e){}),n.on("blur",function(t){o.hide(),e.scope(e.index)}),n.on("contentDom",function(e){}),a.$render=function(e){n&&n.setData(a.$viewValue)}}}}}}),module.directive("paperEdit",function(){return{restrict:"E",template:'<div class="edit-w content-n" id="paper-edit-{{config.aid}}"><div ng-show="!loading"><y-loading show="true"></y-loading></div><div class="ew-h con" ng-show="loading"><div class="list-ac"><div class="block-grp"><div class="bw"><a href="javascript:;" class="back" ng-click="closeEdit()"><p class="ic"><i class="image-con-head-back"></i></p><p>返回</p></a></div></div><div class="block-grp"><div class="bw"><a href="javascript:;" class="overview-b"><p class="ic"><i class="image-con-head-dir"></i></p><p>目录</p></a></div></div><div class="block-grp"><div class="bw"><a href="javascript:;" ng-click="addItem(\'T1\',null,curItemIndex.index,curItemIndex.group)"><p class="ic"><i class="image-con-head-q-6"></i></p><p>添加题组</p></a></div></div><div class="block-grp"><div class="bw"><a href="javascript:;" ng-click="addItem(\'e_sel\',\'single\',curItemIndex.index,curItemIndex.group)"><p class="ic"><i class="image-con-head-q-1"></i></p><p>单选题</p></a></div></div><div class="block-grp"><div class="bw"><a href="javascript:;" ng-click="addItem(\'e_sel\',\'multi\',curItemIndex.index,curItemIndex.group)"><p class="ic"><i class="image-con-head-q-2"></i></p><p>多选题</p></a></div></div><div class="block-grp"><div class="bw"><a href="javascript:;" ng-click="addItem(\'e_sel\',\'judge\',curItemIndex.index,curItemIndex.group)"><p class="ic"><i class="image-con-head-q-5"></i></p><p>判断题</p></a></div></div><div class="block-grp"><div class="bw"><a href="javascript:;" ng-click="addItem(\'e_fill\',null,curItemIndex.index,curItemIndex.group)"><p class="ic"><i class="image-con-head-q-3"></i></p><p>填空题</p></a></div></div><div class="block-grp"><div class="bw"><a href="javascript:;" ng-click="addItem(\'e_text\',null,curItemIndex.index,curItemIndex.group)"><p class="ic"><i class="image-con-head-q-4"></i></p><p>简答题</p></a></div></div><div class="seq"></div><div class="block-grp"><div class="bw"><a href="javascript:;" ng-href="{{\'/course/exam.html?aid=\'+config.aid+\'&preview=1\'}}" target="_blank"><p class="ic"><i class="image-con-head-preview"></i></p><p>预览</p></a></div></div><div class="block-grp"><div class="bw"><a href="javascript:;" class="save-b" ng-click="savePaper()"><p class="ic"><i class="image-con-head-save"></i></p><p>保存</p></a></div></div><div class="seq"></div><div class="block_new ck-tool-bar" ng-class="ckToolPosMode"><div id="topEditor-exam" class="top-editor"></div></div></div><div class="ew-m con"><div class="ew-list"><a href="javascript:;" class="close-b" title="隐藏"><i class="image-con-dir-close"></i></a><div class="h"><span>试卷目录</span></div><div class="l dir"><div class="l-c"><div class="tree-line"></div><ul ng-repeat="group in paper.groups track by $index"><li class="option"><div class="icon"><i class="image-con-dir-t1"></i></div><a ng-click="gotoGrpItem(group.id)" class="section-context first" title="{{group.title.data.title}}">{{group.title.data.title}}</a></li><li class="option" ng-repeat="item in group.items track by $index"><div class="icon"><i class="image-con-dir-t2"></i></div><a ng-click="gotoGrpItem(item.id)" class="section-context second" ng-bind="transTitle(item.data.text)" title="{{item.data.text}}"></a></li></ul></div></div></div><div class="ew-word" id="ew-paper-{{config.aid}}"><div class="m w-ck dir"><div><div class="test-main"><div class="head-info"><div><span class="info"><em class="icon"><i class="image-test-h-1"></i></em> <input class="n name" placeholder="请输入试卷名称" ng-model="paper.title" maxlength="20"> </span><span class="info"><em class="icon"><i class="image-test-h-2"></i></em> <input class="n limit" placeholder="建议时长（分）" type="text" maxlength="3" ng-model="paper.advise_cost"> </span><span class="info" ng-show="paper.type === \'e_test\'"><span class="time">考试时间</span> <input type="text" class="jf-date n time" plug-style="all time" readonly="readonly" id="startTime-{{config.aid}}" ng-model="paper.tInfo.start_time" placeholder="点击选择开始时间"> <span class="time">--</span> <input type="text" class="jf-date n time" plug-style="all time" readonly="readonly" id="endTime-{{config.aid}}" ng-model="paper.tInfo.end_time" placeholder="点击选择结束时间"></span><div class="r"><span class="mode-btn-grp"><a href="" ng-click="paper.type = \'e_paper\'" ng-class="{\'cur\': paper.type === \'e_paper\'}" title="普通试卷，无做题时间限制">普通试卷</a> <a href="" ng-click="paper.type = \'e_test\'" ng-class="{\'cur\': paper.type === \'e_test\'}" title="有做题时间限制">考试模式</a></span></div></div><p class="h-20"></p><div><span class="info desc"><em class="icon"><i class="image-test-h-3"></i></em> <input class="n explain" placeholder="请输入试卷说明" ng-model="paper.desc" maxlength="50"></span><div class="r"><span class="score-total">共 <span>{{paper.total}}</span> 题 ,总分 <span>{{paper.score}}</span> 分</span></div></div></div><div class="q-area"><div class="item" ng-repeat="group in paper.groups track by $index"><div class="item-t1" ng-click="changeCurFocus($index,-1)" id="{{\'q-t-\'+config.aid+\'-\'+group.title.id}}" ng-class="{\'gray-back\':curItemIndex.group == $index && curItemIndex.index == -1}"><div class="tools" ng-show="paper.groups.length > 1"><a ng-click="moveGroup($index,\'up\')" ng-show="!$first"><div class="ic"><i class="image-new-pos-up"></i></div></a><a ng-click="moveGroup($index,\'down\')" ng-show="!$last"><div class="ic"><i class="image-new-pos-down"></i></div></a><a ng-click="deleteGroup($index)"><div class="ic"><i class="image-new-pos-del"></i></div></a></div><div class="main-t1"><input type="text" placeholder="请输入题组名称" ng-model="group.title.data.title"></div><div class="r"><span class="score-alert" ng-show="group.scoreAlert">{{group.scoreAlert}}</span> <span>每题 <input type="text" class="score" title="分值" ng-model="group.aveScore" ng-change="averageScore(group)" maxlength="3"> 分&nbsp;&nbsp;&nbsp; 共{{group.title.score}}分/{{group.items.length}}题</span></div></div><div ng-repeat="item in group.items track by $index" ng-click="changeCurFocus($parent.$index,$index)" id="{{\'q-\'+config.aid+\'-\'+item.id}}" ng-class="{\'gray-back\':curItemIndex.group == $parent.$index && curItemIndex.index == $index}" class="item-n"><div class="item-q"><div class="normal" ng-show="item.mode === \'normal\'"><div class="main-l"><div class="q-index">{{$index + 1}}.</div><div ng-show="item.type === \'e_sel\'"><div class="q-content" ng-bind-html="item.data.text"></div><div class="q-item" ng-repeat="option in item.data.optionList track by $index"><div ng-hide="item.data.type === \'judge\'">{{oCode[$index]}}.&nbsp;</div><div ng-bind-html="option.text"></div></div></div><div ng-show="item.type === \'e_fill\'"><div class="q-content" ng-bind-html="item.data.text"></div></div><div ng-show="item.type === \'e_text\'"><div class="q-content text" ng-bind-html="item.data.text"></div></div><div class="q-score">分值 <input type="text" title="分值" ng-model="item.data.score" ng-change="calcScore()"> 分 <span class="score-alert" ng-show="item.scoreAlert">{{item.scoreAlert}}</span></div></div><div class="main-r"><a href="" ng-click="editQuestion(item)"><i class="image-test-q-1"></i></a> <a href="" ng-click="($parent.$first && $first) ? null : moveQuestion(item, $parent.$index, $index, \'up\')"><i class="image-test-q-2" ng-class="$parent.$first && $first ? \'image-test-q-2r\' : \'image-test-q-2\'"></i></a> <a href="" ng-click="($parent.$last && $last) ? null : moveQuestion(item, $parent.$index, $index, \'down\')"><i class="image-test-q-3" ng-class="$parent.$last && $last ? \'image-test-q-3r\' : \'image-test-q-3\'"></i></a> <a href="" ng-click="deleteQuestion(item,$index,$parent.$index)"><i class="image-test-q-4"></i></a></div></div><div class="edit" ng-if="item.mode === \'edit\'"><table class="mode-edit"><tr><td><span>题目：</span></td><td><div class="qe-content"><div id="editor-paper-{{item.id}}" class="content-editor" args="item" scope="dataEmit" index="$index" tag="\'paper\'" ng-model="item.dataT.text" content-editor editor-scope="item.editorScope" group="\'exam\'" ng-bind-html="item.dataT.content.text" contenteditable="true"></div></div><div ng-show="item.type === \'e_sel\'"><div class="qe-item"><div class="p" ng-repeat="option in item.dataT.optionList track by $index"><span ng-show="item.data.type === \'single\'"><input type="radio" title="" name="radio-single-{{item.id}}" class="head" ng-model="item.dataT.radioAnswer" ng-value="$index"> <span class="index">{{oCode[$index]}}</span> <input type="text" title="" class="content" ng-model="option.text" placeholder="请输入选项内容"> <a class="btn"><i class="image-test-q-4" ng-click="optionDel(item, $index)"></i></a> </span><span ng-show="item.data.type === \'multi\'"><input type="checkbox" title="" class="head" ng-model="option.answer"> <span class="index">{{oCode[$index]}}</span> <input type="text" title="" class="content" ng-model="option.text" placeholder="请输入选项内容"> <a class="btn"><i class="image-test-q-4" ng-click="optionDel(item, $index)"></i></a> </span><span ng-show="item.data.type === \'judge\'"><input type="radio" title="" name="radio-judge-{{item.id}}" class="head" ng-model="item.dataT.radioAnswer" ng-value="$index"> <span>{{option.text}}</span></span></div></div><div class="qe-btn-grp" ng-show="item.data.type === \'single\' || item.data.type === \'multi\'"><a href="" class="btn-p-n" ng-click="optionAdd(item)">添加选项</a></div></div><div ng-show="item.type === \'e_fill\'"></div><div ng-show="item.type === \'e_text\'"></div></td></tr><tr ng-show="item.type === \'e_text\'"><td><span>答案：</span></td><td><div class="qe-content"><div id="editor-ans-{{item.id}}" class="content-editor" args="item" scope="dataEmit" index="$index" tag="\'ans\'" ng-model="item.dataT.answer" content-editor editor-scope="item.editorScope" group="\'exam\'" ng-bind-html="item.dataT.content.answer" contenteditable="true"></div></div></td></tr><tr><td><span>答案解析：</span></td><td><div class="qe-content"><div id="editor-ana-{{item.id}}" class="content-editor" args="item" scope="dataEmit" index="$index" tag="\'ana\'" ng-model="item.dataT.analyze" content-editor editor-scope="item.editorScope" group="\'exam\'" ng-bind-html="item.dataT.content.analyze" contenteditable="true"></div></div></td></tr><tr><td><span>分值：</span></td><td><div class="qe-score"><input type="text" title="分值" ng-model="item.dataT.score" maxlength="3"> 分</div></td></tr><tr><td></td><td><div class="qe-btn-grp"><a href="" class="btn-p-n g green" ng-click="questionEditConfirm(item)">保存</a> <a href="" class="btn-p-n g" ng-click="questionEditCancel(item)">取消</a></div></td></tr></table></div></div></div></div><div class="item-tool" ng-show=""><a href="" class="btn-p-n" ng-click="addItem(\'e_sel\',\'single\')" ng-show="paper.groups.length">单选</a> <a href="" class="btn-p-n" ng-click="addItem(\'e_sel\',\'multi\')" ng-show="paper.groups.length">多选</a> <a href="" class="btn-p-n" ng-click="addItem(\'e_sel\',\'judge\')" ng-show="paper.groups.length">判断</a> <a href="" class="btn-p-n" ng-click="addItem(\'T1\')">添加题组</a> <a href="" class="btn-p-n r build" ng-click="savePaper(\'close\')">生成试卷</a> <a href="" class="btn-p-n r build" ng-click="savePaper()">保存试卷</a></div></div></div></div></div></div></div></div></div>',replace:"true",scope:{config:"="},controller:["$timeout","$scope","$rootScope","$element","$sce","service",function(e,t,i,a,n,s){function o(){t.paper={groups:[],score:0,total:0,advise_cost:null,loaded:!1,type:"e_paper",art:null,tInfo:{}}}function r(e,t,i){var a=0,n=!1,s=e.attr("class")+" ",o="",i=i||2;n||(n=setInterval(function(){a++,o=a%2?s+t:s,e.attr("class",o),a==2*i&&(clearInterval(n),e.removeClass(t))},200))}function c(e,t){s.course.updateArticleExt({aid:e,ext:t}).then(function(e){})}function l(e){s.course.getArticleExt({aids:e}).then(function(i){0===i.code&&i.data[e]&&(t.paper.advise_cost=i.data[e].advise_cost||"")})}var d=/^[0-9]\d*$/;if(t.config){t.config.scope=t,t.loading=!1,t.qInfo={type:{single:{name:"单选题"},multi:{name:"多选题"},judge:{name:"判断题"}}},t.oCode=["A","B","C","D","E","F","G","H","I","J","K","L","M","N","O","P","Q","R","S","T","U","V","W","X","Y","Z"],t.curItemIndex={group:0,index:-1};var u=null;t.addGroup=function(e,i){angular.isUndefined(e)?t.paper.groups.push({title:null,items:[]}):t.paper.groups.splice(e,0,{title:null,items:i})},t.addItem=function(e,i,a,n){var s={t:e,g:"_"};if("T1"==e)s.c={title:"请输入题组名称"};else if("e_sel"===e)s.c={type:i,text:"<p>请输入题目内容</p>",options:["<p>示例内容A</p>","<p>示例内容B</p>","<p>示例内容C</p>","<p>示例内容D</p>"],answer:[0],score:0,analyze:"<p>请输入答案解析</p>"},"single"===i&&(s.c.text="<p>【单选题】请输入题目内容</p>"),"multi"===i&&(s.c.text="<p>【多选题】请输入题目内容</p>"),"judge"===i&&(s.c.text="<p>【判断题】请输入题目内容</p>",s.c.options=["<p>正确</p>","<p>错误</p>"]);else if("e_fill"===e)s.c={text:"<p>【填空题】请输入题目内容<span style='text-decoration: overline'>①</span></p>",answer:[0],score:0,analyze:"<p>请输入答案解析</p>"};else{if("e_text"!==e)return;s.c={text:"<p>【简答题】请输入题目内容</p>",answer:"<p>请输入参考答案</p>",score:0,analyze:"<p>请输入答案解析</p>"}}angular.isUndefined(a)&&angular.isUndefined(n)&&(n=t.paper.groups.length-1,a=t.paper.groups[t.paper.groups.length-1].items.length);var o=t.getDeepIndex(n,a),r=u.addItem(s,o);if("T1"===e){var c=n+1,l=[];a>-2&&(l=t.paper.groups[n].items.splice(a+1,t.paper.groups[n].items.length)),t.addGroup(c,l),t.paper.groups[c].title=t.makePlugin(r,s),t.gotoLoc("q-t-"+t.config.aid+"-"+t.paper.groups[c].title.id),t.curItemIndex.group=c,t.curItemIndex.index=-1}else{var d=t.makePlugin(r,s);t.paper.groups[n].items.splice(a+1,0,d),t.editQuestion(d),t.gotoLoc("q-"+t.config.aid+"-"+d.id),t.curItemIndex.group=n,t.curItemIndex.index=a+1}},t.dataEmit=function(e){},t.getDeepIndex=function(e,i){for(var a=0,n=0;e>n;n++)a+=t.paper.groups[n].items.length,t.paper.groups[n].title&&(a+=1);return a+i+2},t.makePlugin=function(e,t){var i={id:e,type:t.t,mode:"normal",data:null};if("T1"===t.t)i.data={title:t.c.title};else if("e_sel"===t.t){i.data=t.c;var a={},n=0;angular.forEach(i.data.answer,function(e,t){a[e]=!0,n=e});var s=[];angular.forEach(i.data.options,function(e,t){s.push({text:e,answer:!angular.isUndefined(a[t])})}),i.data.optionList=s,i.data.radioAnswer=n}else"e_fill"===t.t?i.data=t.c:"e_text"===t.t&&(i.data=t.c);return i},t.editQuestion=function(e){console.log(e),e.dataT=angular.copy(e.data),e.dataT.content={text:n.trustAsHtml(e.dataT.text),analyze:n.trustAsHtml(e.dataT.analyze)},"e_sel"===e.type?angular.forEach(e.dataT.optionList,function(e,i){e.text=t.transTitle(e.text)}):"e_fill"===e.type||"e_text"===e.type&&(e.dataT.content.answer=n.trustAsHtml(e.dataT.answer)),e.mode="edit"},t.questionDeepIndex=function(e,i){for(var a=0,n=0;e>n;n++)a=a+t.paper.groups[n].items.length+1;return a+i+1},t.moveQuestion=function(e,i,a,n){console.log(e,i,a,n);var s=t.questionDeepIndex(i,a),o=t.paper.groups[i].items[a],r=t.paper.groups[i].items.length-1;"up"===n?(u.moveItem2(s,!0),t.paper.groups[i].items.splice(a,1),0==a?t.paper.groups[i-1].items.push(o):t.paper.groups[i].items.splice(a-1,0,o),t.gotoLoc("q-"+t.config.aid+"-"+o.id)):"down"===n&&(u.moveItem2(s,!1),t.paper.groups[i].items.splice(a,1),a==r?t.paper.groups[i+1].items.splice(0,0,o):t.paper.groups[i].items.splice(a+1,0,o),t.gotoLoc("q-"+t.config.aid+"-"+o.id)),t.calcScore()},t.moveGroup=function(e,i){if("up"===i){var a=t.getDeepIndex(e,-2),n=t.getDeepIndex(e-1,-2);u.moveItemGrp(a,n,t.paper.groups[e].items.length+1,!0);var s=t.paper.groups.splice(e,1)[0];t.paper.groups.splice(e-1,0,s),t.gotoLoc("q-t-"+t.config.aid+"-"+s.title.id)}else{var a=t.getDeepIndex(e,-2),n=t.getDeepIndex(e+2,-2);u.moveItemGrp(a,n,t.paper.groups[e].items.length+1,!1);var s=t.paper.groups.splice(e,1)[0];t.paper.groups.splice(e+1,0,s),t.gotoLoc("q-t-"+t.config.aid+"-"+s.title.id)}t.calcScore()},t.deleteGroup=function(e){var i=t.paper.groups[e];u.removeItem(i.title.id),angular.forEach(i.items,function(e,t){u.removeItem(e.id)}),t.paper.groups.splice(i,1),t.calcScore()},t.questionEditCancel=function(e){e.dataT=null,e.mode="normal"},t.questionEditConfirm=function(e){if("e_sel"===e.type){if(!e.dataT.optionList.length)return s.dialog.alert("选择题至少需要一个选项"),void r($("#q-"+t.config.aid+"-"+e.id).find(".item-q"),"red-alert",3);if(!e.dataT.text)return s.dialog.alert("请输入题目内容"),void r($("#q-"+t.config.aid+"-"+e.id).find(".item-q"),"red-alert",3);var i=0;if(angular.forEach(e.dataT.optionList,function(e,t){e.text||(i=1)}),i)return s.dialog.alert("选项内容不能为空"),void r($("#q-"+t.config.aid+"-"+e.id).find(".item-q"),"red-alert",3);e.dataT.options=t.selOptionHandle(e),e.dataT.answer=t.selAnswerHandle(e)}e.data=angular.copy(e.dataT),e.mode="normal",e.data.score=Number(e.data.score),console.log(e.data),t.calcScore(),t.gotoLoc("q-"+t.config.aid+"-"+e.id)},t.deleteQuestion=function(e,i,a){u.removeItem(e.id),t.paper.groups[a].items.splice(i,1),t.calcScore()},t.selOptionHandle=function(e){var i=[];return angular.forEach(e.optionList,function(e,a){e.text=t.transTitleR(e.text),i.push(e.text)}),i},t.selAnswerHandle=function(e){var t=null;return"e_sel"===e.type?(t=[],"single"===e.dataT.type||"judge"===e.dataT.type?t.push(Number(e.dataT.radioAnswer)):"multi"===e.dataT.type&&angular.forEach(e.dataT.optionList,function(e,i){e.answer&&t.push(Number(i))})):"e_fill"===e.type||"e_text"===e.type,t},t.optionAdd=function(e){return e.dataT.optionList.length>25?void s.dialog.alert("最多支持26个选项"):void e.dataT.optionList.push({text:"请输入选项内容",answer:!1})},t.optionDel=function(e,t){e.dataT.optionList.splice(t,1)},t.formatItemData=function(e){var t=e.data;return"T1"==e.type&&(t={title:e.data.title}),"e_sel"==e.type&&(t={type:e.data.type,text:e.data.text,options:e.data.options,answer:e.data.answer,score:e.data.score,analyze:e.data.analyze}),"e_fill"==e.type&&(t={type:e.data.type,text:e.data.text,answer:e.data.answer,score:e.data.score,analyze:e.data.analyze}),"e_text"==e.type&&(t={type:e.data.type,text:e.data.text,answer:e.data.answer,score:e.data.score,analyze:e.data.analyze}),t},t.formatItem=function(e){return{t:e.type,c:t.formatItemData(e),g:e.g}},t.transTitle=function(e){return e?(e=e.replace(/<\/?[^>]*>/g,""),e=e.replace(/&nbsp;/gi,""),e=e.replace(/&ldquo;/gi,""),e=e.replace(/&rdquo;/gi,""),e=e.replace(/&bull;/gi,""),e=e.replace(/&gt;/gi,">"),e=e.replace(/&lt;/gi,"<")):""},t.transTitleR=function(e){return"<p>"+e+"</p>"},t.updateItem=function(e,i){if(e){var a=u.findItem(e.id);a.c=t.formatItem(e).c,console.log(a),u.updateItem(e.id,a),!u.isUpdated()||u.isUpdated_()?(i({err:!0}),window.resm="testupdate1 check updated error 2..."):i({err:!1})}},t.changeCurFocus=function(e,i){t.curItemIndex.group=e,t.curItemIndex.index=i},t.editMode="paper",t.changeEditMode=function(e){},t.makeContent=function(e){u.next(e).done(function(i,a){var n=!1;angular.forEach(e,function(e,i){var a=u.findItem(e,1,1);if(a&&a.t&&a.visiable){var s=t.makePlugin(e,a,"normal");"T1"===s.type?(t.addGroup(),n=!0,t.paper.groups[t.paper.groups.length-1].title=s):t.paper.groups.length&&(n?"e_sel"===s.type?t.paper.groups[t.paper.groups.length-1].items.push(s):"e_fill"===s.type?t.paper.groups[t.paper.groups.length-1].items.push(s):"e_text"===s.type?t.paper.groups[t.paper.groups.length-1].items.push(s):u.removeItem(s.id):u.removeItem(s.id))}}),e.length||t.addItem("T1",null,-2,-1),t.calcScore(),t.$apply(),console.log(t.paper)}).fail(function(e,t){window.resm=e})};var p=!1;t.savePaper=function(i){if(!p){p=!0;var a={type:null,msg:""};if(angular.forEach(t.paper.groups,function(e,t){return e.title.data.title?void angular.forEach(e.items,function(e,t){"edit"==e.mode&&(a.type="item",a.msg="请先保存题目",a.id=e.id)}):(a.type="title",a.msg="题组名称不能为空",void(a.id=e.title.id))}),"title"===a.type)return s.dialog.alert(a.msg),t.gotoLoc("q-t-"+t.config.aid+"-"+a.id),r($("#q-t-"+t.config.aid+"-"+a.id).find(".main-t1"),"red-alert",3),void(p=!1);if("item"===a.type)return s.dialog.alert(a.msg),t.gotoLoc("q-"+t.config.aid+"-"+a.id),r($("#q-"+t.config.aid+"-"+a.id).find(".item-q"),"red-alert",3),void(p=!1);angular.forEach(t.paper.groups,function(e,i){t.updateItem(e.title,function(){}),angular.forEach(e.items,function(e,i){t.updateItem(e,function(){})})}),u.art.title=t.paper.title,u.art.desc=t.transTitleR(t.paper.desc),e(function(){u.save().done(function(e,i){if(s.dialog.alert("试卷已保存"),!angular.isUndefined(i)&&i.iidm){var a=i.iidm;angular.forEach(t.paper.groups,function(e,t){a[e.title.id]?e.title.id=a[e.title.id]:angular.forEach(e.items,function(e,t){a[e.id]&&(e.id=a[e.id])})}),console.log(a,u,t.paper)}if(c(t.config.aid,{advise_cost:Number(t.paper.advise_cost)}),"e_test"===t.paper.type){var n={params:{cid:t.config.cid},data:{title:t.paper.title,desc:t.paper.desc,multi:300,start_time:+moment($("#startTime-"+t.config.aid).val()).format("x")||void 0,end_time:+moment($("#endTime-"+t.config.aid).val()).format("x")||void 0,aids:[t.config.aid]}};t.config.tid&&(n.data.id=t.config.tid),s.examReq.insertTest(n).then(function(e){if(0===e.code){t.config.tid=e.data.id,t.paper.tid=e.data.id;var i={id:t.config.id,title:t.paper.title,tid:t.paper.tid,desc:t.paper.desc,type:t.paper.type};t.config.save(i)}}),p=!1}else{var o={id:t.config.id,title:t.paper.title,tid:null,desc:t.paper.desc,type:t.paper.type};t.config.save(o),p=!1}}).fail(function(){p=!1,s.dialog.alert("试卷保存失败")})})}},t.closeEdit=function(){o(),t.config.back()},t.calcScore=function(){var e=0,i=0;angular.forEach(t.paper.groups,function(t,a){var n=0;t.title&&(e+=t.items.length,angular.forEach(t.items,function(e,t){d.test(""+e.data.score)||""===e.data.score?(e.data.score=Number(e.data.score),n+=e.data.score,e.scoreAlert=""):e.scoreAlert="题目分数必须为正整数"})),t.title.score=n,i+=n}),t.paper.total=e,t.paper.score=i},t.averageScore=function(e){if(d.test(e.aveScore)||""===e.aveScore){var i=Number(e.aveScore);angular.forEach(e.items,function(e,t){e.data.score=i}),t.calcScore(),e.scoreAlert=""}else e.scoreAlert="分数必须为正整数"},t.init=function(){return t.config.aid?(u=new wcms.Article(t.config.aid,"T",3),u.args.uid=1,u.args.token=rcpAid.getToken(),o(),l(t.config.aid),t.paper.title=u.art.title,t.paper.desc=t.transTitle(u.art.desc),t.paper.type=t.config.type,(!t.paper.type||"e_paper"!==t.paper.type&&"e_test"!==t.paper.type&&"e_exercise"!==t.paper.type)&&(t.paper.type="e_paper"),void u.run().done(function(e,i){t.loading=!0,t.idsContent=e.findIids(),console.log(e,i,t.idsContent),t.makeContent(t.idsContent)}).fail(function(e,i){t.loading=!0,"new version"==e?(u.ls_clear(),t.init()):t.closeEdit()})):void t.closeEdit()},t.gotoLoc=function(i){e(function(){$("#ew-paper-"+t.config.aid).scrollTo("#"+i,200)})},t.preview=function(){}}}]}});