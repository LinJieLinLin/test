var module=angular.module("RCP",["ngCookies","ngRoute","ngSanitize","LocalStorageModule"]);module.controller("learningRecordCtrl",["$rootScope","$scope","$timeout","service",function(e,t,a,n){t.temSection=[{a:1},{a:2},{a:1},{a:1},{a:2}];var i=function(){t.urlData={},t.urlData.contentId=rcpAid.queryString("aid"),t.urlData.studentId=rcpAid.queryString("uid"),t.urlData.contentId="574e8116bc9a34572f6c2f5c",t.urlData.studentId="u3",t.urlData.contentId&&t.urlData.studentId||(n.dialog.alert("参数有误！正在为您跳到首页..."),a(function(){location.href="/"},3e3)),t.data={},t.currentUser=e.currentUser,t.$on("login",function(a,i){return i?void(t.currentUser=e.currentUser):void n.common.toLogin()}),t.loadMore=!1,t.chartTime(),t.chartNum();new Date;t.selectDate=moment().format("YYYY年MM月");var i={ret_listUsedTotal:1,ret_artUsedTotal:1,ret_chatTotal:1,ret_discussTotal:1,ret_artUsed:1,ret_listUsed:1,ret_chat:1,ret_discuss:1,ret_artUsedDetail:1,et_artAvgDetail:1,beg:new Date(moment(t.selectDate,"YYYY年MM月")).getTime(),end:new Date(moment(t.selectDate,"YYYY年MM月").add(1,"M")).getTime(),span:1};t.req.loadRecord(i),t.checkLoadMore(".a-content")};t.chartTime=function(e){function t(e){$("#chart-time").highcharts({chart:{type:"spline"},title:{text:"小时",align:"left",style:{fontSize:"14px"},x:0,y:20},xAxis:{max:31,tickInterval:2,categories:e,tickPosition:"inside",allowDecimals:!1},yAxis:{max:24,min:1,tickInterval:2,allowDecimals:!1,title:{text:""}},exporting:{enabled:!1},tooltip:{headerFormat:"<span>日期：{point.x}<span><br>",pointFormat:"<span>时长:{point.y}</span>"},legend:{align:"right",verticalAlign:"top"},series:[{color:"#ee7760",name:"在线时长",data:[1,3,5,7,2,4,6,8]},{color:"#59a9eb",name:"课程学习时长",data:[0]}],credits:{enabled:!1}})}var a=function(){for(var e=[],t=1;31>t;t+=1)e.push(t);return e}();t(a)},t.chartNum=function(e){function t(e){$("#chart-num").highcharts({chart:{type:"spline"},title:{text:"次",align:"left",style:{fontSize:"14px"},x:0,y:20},xAxis:{max:30,tickInterval:2,categories:e,tickPosition:"inside",allowDecimals:!1},yAxis:{title:{text:""},allowDecimals:!1,min:1,minorGridLineWidth:0,girdLineWidth:0,alternateGridColor:null},exporting:{enabled:!1},tooltip:{headerFormat:"<span>时间：{point.x}<span><br>",pointFormat:"<span>访问次数:{point.y}</span>"},legend:{align:"right",verticalAlign:"top"},series:[{color:"#ee7760",name:"沟通数",data:[1,4,9,2,7,6,3,5,7,2,4,6,8,1,4,9,2,7,6,3,5,7,2,4,6,8,1,4,9,2,7]},{color:"#59a9eb",name:"发帖数",data:[1,3,5,7,2,4,6,8]}],credits:{enabled:!1}})}var a=function(){for(var e=[],t=1;31>t;t+=1)e.push(t);return e}();t(a)},t.timePrev=function(){t.selectDate=moment(t.selectDate,"YYYY年MM月").subtract(1,"M").format("YYYY年MM月")},t.timeNext=function(){t.selectDate!==moment().format("YYYY年MM月")&&(t.selectDate=moment(t.selectDate,"YYYY年MM月").add(1,"M").format("YYYY年MM月"))},t.checkLoadMore=function(e){a(function(){var a=$(e),n=a.height()||0,i=+(a.css("max-height")||0).replace("px","");i>n&&(t.loadMore=!0)},0)},t.expand=function(e,a,n){e.open=a,a&&n>=0&&(e.lineStyle=t.getStyle("#section-"+n))},t.getStyle=function(e){console.log($(e));var t="";try{var a=$(e)[0].offsetHeight,n=25,i=21;a=a+n-i,t={height:a+"px"}}catch(r){}return t},t.getChartData=function(e){console.log("格式化数据：",e);var a={},n=[0],i=new Date(moment(t.selectDate,"YYYY年MM月")).getTime(),r=new Date(moment(t.selectDate,"YYYY年MM月").add(1,"M")).getTime();if(!e)return n;for(var o=0;r>i&&10>o;)o++,a[i]=e[i]||0,i=new Date(moment(t.selectDate,"YYYY年MM月").add(1,"D")).getTime(),console.log(i,a);return n},t.req={loadRecord:function(e){var a={host:location.host,uids:t.urlData.studentId,aids:t.urlData.contentId};n.course.loadRecord(angular.extend(a,e)).then(function(e){angular.extend(t.data,e.data),console.log(t.data);try{t.data.listUsed&&(t.data.chartOnline=t.getChartData(t.data.listUsed[t.urlData.studentId])),t.data.artUsed&&(t.data.chartLearn=t.getChartData(t.data.artUsed[t.urlData.studentId])),t.data.chat&&(t.data.chartChat=t.getChartData(t.data.chat[t.urlData.studentId]))}catch(a){n.dialog.alert("返回数据有误！"),console.log(a)}},function(e){console.log(e)})}},i()}]),module.factory("course",["request",function(e){var t=DYCONFIG.course.rUrl;return{getCourseDetail:function(a,n){a.token=rcpAid.getToken();var i={method:"GET",url:t+"pub/api/loadCourse",params:a};return e(angular.extend(i,n||{}))},getTeacherCourses:function(a,n){a.token=rcpAid.getToken(),a.isSelf=1;var i={method:"GET",url:t+"pub/api/searchCourse",params:a};return e(angular.extend(i,n||{}))},joinFreeCourse:function(a,n){a.token=rcpAid.getToken();var i={method:"GET",url:t+"usr/api/joinCourse",params:a};return e(angular.extend(i,n||{}))},searchCourse:function(a,n){var i={method:"GET",url:t+"pub/api/searchCourse",params:a};return e(angular.extend(i,n||{}))},verifyCourse:function(a,n){a.token=rcpAid.getToken();var i={method:"GET",url:t+"usr/api/verifyCourse",params:a};return e(angular.extend(i,n||{}))},createCourse:function(a,n,i){a.token=rcpAid.getToken();var r={method:"POST",url:t+"usr/api/createCourse",params:a,data:i};return e(angular.extend(r,n||{}))},getStudentCourse:function(a,n){a.token=rcpAid.getToken(),a.isSelf=10;var i={method:"GET",url:t+"pub/api/searchCourse",params:a};return e(angular.extend(i,n||{}))},releaseCourse:function(a,n){a.token=rcpAid.getToken();var i={method:"GET",url:t+"usr/api/releaseCourse",params:a};return e(angular.extend(i,n||{}))},saveCourseData:function(a,n){var i={};i.token=rcpAid.getToken();var r={method:"POST",url:t+"usr/api/updateCourse",params:i,data:a};return e(angular.extend(r,n||{}))},cancelCourse:function(a,n){a.token=rcpAid.getToken();var i={method:"POST",url:t+"usr/api/cancelCourse",params:a};return e(angular.extend(i,n||{}))},getListGroup:function(a,n){a.token=rcpAid.getToken();var i={method:"GET",url:t+"pub/api/listGroup",params:a};return e(angular.extend(i,n||{}))},getAllTags:function(t,a){t.token=rcpAid.getToken();var n={method:"POST",url:DYCONFIG.pes.rUrl+'pub/api/page/GetPage?keys=[{"key":"p_classifi"}]',params:t};return e(angular.extend(n,a||{}))},updateArticleExt:function(a,n){a.token=rcpAid.getToken();var i={method:"GET",url:t+"usr/api/updateExt",params:a};return e(angular.extend(i,n||{}))},getArticleExt:function(a,n){a.token=rcpAid.getToken();var i={method:"GET",url:t+"pub/api/listArtExt",params:a};return e(angular.extend(i,n||{}))},loadRecord:function(a,n){a.token=rcpAid.getToken();var i={method:"GET",url:t+"pub/api/loadRecord",params:a};return e(angular.extend(i,n||{}))},listPaperCorrect:function(a,n){a.token=rcpAid.getToken();var i={method:"GET",url:t+"usr/api/listPaperCorrect",params:a};return e(angular.extend(i,n||{}))},Publish:function(a,n){a.token=rcpAid.getToken();var i={method:"GET",url:t+"usr/api/publish",params:a};return e(angular.extend(i,n||{}))}}}]),module.run(["service","course",function(e,t){e.expand("course",function(){return t})}]),module.factory("headSearch",["request",function(e){var t=g_conf.pes.rUrl;return{SearchIntelligent:function(a,n){var i={method:"GET",url:t+"pub/api/SearchIntelligent",params:a,option:{loading:!1}};return e(angular.extend(i,n||{}))}}}]),module.run(["service","headSearch",function(e,t){e.expand("headSearch",function(){return t})}]),module.directive("headnav",function(){return{template:'<header><div ng-class="headMaximizeLock ? \'head-maximize\' : \'head-minimize\'"><div ng-class="param.style"><div class="image-head-rainbow decoration-ic"></div><section class="g-m-w header-area"><div class="minimize-logo"><a ng-href="{{param.logo.href||\'/\'}}"><img ng-src="{{param.logo.small}}" alt="{{param.logo.msg}}" title="{{param.logo.msg}}"></a></div><nav class="minimize-nav"><ul><li ng-repeat="item in navList track by $index" ng-class="item.class"><a ng-href="{{item.href || \'\'}}" target="{{item.target || \'_self\'}}">{{item.name}}</a><div ng-if="item.child.length"><ul><li ng-repeat="c in item.child"><a ng-href="{{c.href || \'\'}}" target="{{c.target || \'_self\'}}">{{c.name}}</a></li></ul></div></li></ul></nav><div class="logo"><a ng-href="{{param.logo.href||\'/\'}}"><img ng-src="{{param.logo.large}}" alt="{{param.logo.msg}}" title="{{param.logo.msg}}"></a></div><div class="top-user-menu-bar" ng-class="{clearminw: user.account}"><top-user-menu user="user" item-list="itemList"></top-user-menu></div><div class="h-sc" ng-controller="headSearchCtrl"><div class="head-search-bar"><div class="enter" ng-click="stopPropagation($event)"><input type="text" class="input" ng-model="scText" ng-keydown="onkeydown($event)" ng-change="matchChange(scSelectVal.value,scText)" placeholder="请输入关键词搜索"><div class="match-kw-v" ng-show="matchReadyLock"><div class="mc-list"><ul><li ng-if="!mcCourseList || !mcCourseList.length">暂无相关内容</li><li ng-repeat="item in mcCourseList track by $index" ng-click="intoDetail(item)" ng-if="$index < cMaxLen" ng-class="{hover: $index + lMaxLen == moveKeyIndex}" ng-mouseenter="mouseenter($index, \'资源\')"><div class="text-of pd-r10"><span class="lab" ng-if="item.t == 10">课程</span> <span class="lab" ng-if="item.t == 20">题库</span> <a class="item-name" ng-bind-html="item.name | titleMatchKw:scText"></a></div></li></ul></div></div></div><a ng-click="goToSearch(scSelectVal.value,scText)" class="submit" title="提交"><i class="fa fa-search" aria-hidden="true"></i></a></div><div class="hot-word"><a ng-href="javascript:void(0);" ng-click="goToSort(item.name)" class="mg-r20" ng-repeat="item in scHotWord">{{item.name}}</a></div></div></section><section class="nav-area"><div class="g-m-w"><div class="n-categories" ng-controller="categoriesCtrl" ng-mouseenter="service.mouseenter(hover)" ng-mouseleave="service.mouseleave(hover)"><div class="dt">全部课程</div><div class="dd" id="by-categories" ng-show="categoriesUnfoldLock || hover.mouseEnterLock"><div class="image-giraffe giraffe-icon"></div><div class="dd-inner"><div class="item" ng-repeat="item in categoriesListStyle1 track by $index" ng-mouseenter="service.mouseenter(item)" ng-mouseleave="service.mouseleave(item)" ng-show="$index<5 || hover.mouseEnterLock"><div class="layer"><h3><a ng-href="goToCategory(item.name)" target="_blank" title="{{item.name}}">{{item.name}}</a></h3><div class="hot-word"><a ng-href="goToCategory(item.name,child.name)" target="_blank" class="text-of" ng-repeat="child in item.child track by $index" ng-show="$index<3" title="{{child.name}}">{{child.name}}</a></div><i>&gt;</i></div><div class="sub" ng-show="item.mouseEnterLock"><div class="inner"><dl class="card" ng-repeat="child in item.child track by $index" ng-show="$index<3"><dt><a ng-href="goToCategory(item.name,child.name)" target="_blank" class="f-r">更多&gt;&gt;</a> <a ng-href="goToCategory(item.name,child.name)" target="_blank" title="{{child.name}}">{{child.name}}</a></dt><dd><a ng-href="goToCategory(item.name,child.name,unit.name)" target="_blank" class="text-of" ng-repeat="unit in child.child track by $index" ng-show="$index<15" title="{{unit.name}}">{{unit.name}}</a></dd></dl><div class="more-srot" ng-show="item.child.length>3"><a ng-href="goToCategory(item.name)" target="_blank" class="f-r">更多分类&gt;&gt;</a>. . .</div></div></div></div><div ng-repeat="list in categoriesListStyle2 track by $index"><div class="big-sort"><a ng-href="goToCategory(item.name)" target="_blank" title="{{list.name}}">{{list.name}}</a></div><div class="item" ng-repeat="item in list.child track by $index" ng-mouseenter="service.mouseenter(item)" ng-mouseleave="service.mouseleave(item)"><div class="layer"><h3><a ng-href="goToCategory(list.name,item.name)" target="_blank" title="{{item.name}}">{{item.name}}</a></h3><i>&gt;</i></div><div class="sub" ng-show="item.mouseEnterLock"><div class="inner"><dl class="card" ng-repeat="child in item.child track by $index" ng-show="$index<4"><dt><a ng-href="goToCategory(list.name,item.name,child.name)" target="_blank" class="f-r">更多&gt;&gt;</a> <a ng-href="goToCategory(list.name,item.name,child.name)" target="_blank" title="{{child.name}}">{{child.name}}</a></dt><dd><a ng-href="goToCategory(list.name,item.name,child.name,unit.name)" target="_blank" class="text-of" ng-repeat="unit in child.child track by $index" ng-show="$index<10" title="{{unit.name}}">{{unit.name}}</a></dd></dl><div class="more-srot" ng-show="item.child.length>4"><a ng-href="goToCategory(list.name,item.name)" target="_blank" class="f-r">更多分类&gt;&gt;</a>. . .</div></div></div></div></div></div></div></div><nav class="nav"><a ng-repeat="item in navList track by $index" ng-href="{{item.href || \'\'}}" target="{{item.target || \'_self\'}}" ng-class="item.class">{{item.name}}</a></nav><div class="extra" ng-show=""><a href="javascript:void(0);" class="icf t-icf">名师认证</a> <a href="javascript:void(0);" class="icf e-icf">真实评价</a> <a href="javascript:void(0);" class="icf r-icf">随时退</a></div></div></section></div></div></header>',restrict:"E",replace:!0,transclude:!0,scope:{itemList:"=itemList",user:"=user",nav:"="},controller:["$rootScope","$scope","$element","$attrs","service",function(e,t,a,n,i){t.service=i,t.catType=parseInt(rcpAid.getCourseCat()),e.$watch("headMaximizeLock",function(e){e&&(t.headMaximizeLock=e)}),e.$watch("categoriesUnfoldLock",function(e){e&&(t.categoriesUnfoldLock=e)}),e.$watch("catDomain",function(e){if(e)switch(e){case"aikexue.com":t.init(2)}}),t.$on("login",function(e,a){a&&t.loginInit()}),t.loginInit=function(){3===t.catType&&(t.navList=[{name:"学习中心",href:rcpAid.getUrl("学习中心"),"class":"key",target:"_blank"},{name:"教学中心",href:rcpAid.getUrl("教学中心",{uid:t.user.tid}),"class":"key",target:"_blank"},{name:"高等教育",href:rcpAid.getUrl("分类",{category:"高等教育"}),"class":"key",target:"_blank"}])},t.init=function(e){if("order"===t.nav)return t.navList=[{name:"首页",href:rcpAid.getUrl("首页"),"class":"key"},{name:"个人空间",href:rcpAid.getUrl("学习中心"),"class":"key",target:"_blank"}],void(t.param={logo:{small:"/rcp-common/imgs/order/head-icon.png",large:"/rcp-common/imgs/icon/head-icon.png",href:"/my-order.html",msg:"我的酷校"},style:""});switch(t.catType){case 3:t.isLogin?t.navList=[{name:"学习中心",href:rcpAid.getUrl("学习中心"),"class":"key",target:"_blank"},{name:"教学中心",href:rcpAid.getUrl("教学中心",{uid:t.user.tid}),"class":"key",target:"_blank"},{name:"高等教育",href:rcpAid.getUrl("分类",{category:"高等教育"}),"class":"key",target:"_blank"}]:t.navList=[{name:"高等教育",href:rcpAid.getUrl("分类",{category:"高等教育"}),"class":"key",target:"_blank"}],t.param={logo:{small:"/rcp-common/imgs/icon/gzmooc-logo.png",large:"/rcp-common/imgs/icon/gzmooc-logo.png",href:DYCONFIG.rcp.rUrl,msg:"酷校 - 首页"},style:""};break;case 2:t.navList=[{name:"首页",href:rcpAid.getUrl("首页"),"class":"key"},{name:"全部课程",href:rcpAid.getUrl("分类"),"class":"key",target:"_blank"},{name:"学习中心",href:rcpAid.getUrl("学习中心"),"class":"key",target:"_blank"}],t.param={logo:{small:"/rcp-common/imgs/icon/aikexue-logo-2.png",large:"/rcp-common/imgs/icon/aikexue-logo.png",href:DYCONFIG.rcp.rUrl,msg:"爱科学"},style:"aikexue-head"};break;default:t.navList=[{name:"首页",href:rcpAid.getUrl("首页"),"class":"key"},{name:"学习中心",href:rcpAid.getUrl("学习中心"),"class":"key",target:"_blank"},{name:"我要吐槽",href:rcpAid.getUrl("我要吐槽"),"class":"key",target:"_blank"}],t.param={logo:{small:"/rcp-common/imgs/icon/book-logo-2.png",large:"/rcp-common/imgs/icon/book-logo.png",href:DYCONFIG.rcp.rUrl,msg:"酷校LOGO·让学习更Cool"},style:""}}},t.init()}]}}),module.directive("topUserMenu",function(){return{template:'<div class="top-user-menu"><div style="font-size:14px;line-height:40px" ng-show="!currentUser.uid"><a ng-href="{{link.login}}" id="login" class="color-cyan pd-l20"><i class="image-login-user-ic"></i>马上登录 </a><span style="color:#ececec;margin:0 8px">| </span><a ng-href="{{link.register}}" class="color-cyan">注册</a></div><div class="menber-link" ng-show="currentUser.uid"><a href="" class="u-info" rel="member_link"><img ng-hide="currentUser.avatar" src="/rcp-common/imgs/face/d-face-1.png" class="face-img" width="40" height="40" rel="user_face" alt="{{currentUser.nickName}}"> <img ng-show="currentUser.avatar" ng-src="{{currentUser.avatar}}" class="face-img" width="40" height="40" rel="user_face" alt="{{currentUser.nickName}}"> <span class="name" rel="user_name" title="{{currentUser.nickName}}" ng-bind="currentUser.nickName"></span> <i class="x-arrow-dowm">&gt;</i></a><div class="u-panel"><div class="tup-box"><div class="tup-info" rel="user_info_box"><div class="user-head" rel="user_face_box"><a ng-href="{{link.setting}}"><img ng-hide="currentUser.avatar" src="/rcp-common/imgs/face/d-face-1.png" width="96" height="96" class="face-img" rel="user_face" alt="{{currentUser.nickName}}"> <img ng-show="currentUser.avatar" ng-src="{{currentUser.avatar}}" width="96" height="96" class="face-img" rel="user_face" alt="{{currentUser.nickName}}"></a></div><div class="user-identity"><p class="user-name text-of"><a href="" rel="user_name" title="{{currentUser.nickName}}" ng-bind="currentUser.nickName"></a></p><p class="attestation-un" ng-class="{\'attestation\':attestation==\'已认证\'}"><i class="image-attestation-yellow"></i> <span>{{attestation}}</span></p></div><div class="clear"></div></div><div class="tup-operate"><div class="card-sets"><a href="{{link.applySpaceUrl}}" class="key f-l"><i class="image-attestation"></i> <span class="text-4f">认证管理</span> </a><a href="{{link.setting}}" target="_blank" class="key f-l"><i class="image-settings"></i> <span class="text-4f">设置</span> </a><a href="" class="key f-r" ng-click="logout()"><i class="image-logout"></i> <span class="text-4f">退出</span></a></div><div class="card-links"><a ng-repeat="item in itemList" ng-href="{{item.href || \'\'}}" ng-class="item.name == \'...\' ? \'disabled key \'+item.icon : \'key \'+item.icon"><i></i> <span>{{item.name}}</span></a></div></div></div></div></div></div>',restrict:"E",replace:!0,transclude:!0,scope:{itemList:"=itemList",user:"=user"},controller:["$rootScope","$scope","$timeout","$location","service",function(e,t,a,n,i){t.$watch("itemList",function(e){if(e){var a=t.itemList.length,n=a%3;if(n)for(var i=3-a%3+a,r=a;i>r;r+=1)e.push({name:"..."})}},!0),t.logout=function(){var e=rcpAid.getUrl("首页");location.href=rcpAid.getUrl("退出",{url:encodeURIComponent(e)})},t.$on("login",function(e,a){a.uid&&t.loginInit()}),t.loginInit=function(){t.currentUser=e.currentUser,t.currentUser.certification&&(t.attestation="已认证")},t.init=function(){var e=rcpAid.getNoTokenUrl();t.link={login:rcpAid.getUrl("登录",{url:encodeURIComponent(e)}),register:rcpAid.getUrl("注册",{url:encodeURIComponent(e)}),applySpaceUrl:rcpAid.getUrl("实名认证"),setting:rcpAid.getUrl("个人设置",{url:window.location.href})},t.attestation="未认证"},t.init()}]}}),module.controller("categoriesCtrl",["$rootScope","$scope","service",function(e,t,a){function n(e){switch(e){case 2:t.categoriesListStyle2=i||[];break;default:t.categoriesListStyle1=i||[]}}t.service=a,t.hover={},t.catType=rcpAid.getCourseCat(),t.byCategories=function(){t.byCategoriesLoading=!0,n(t.catType)},t.listenerMember={byCategories:{node:"#by-categories",callback:t.byCategories}};var i;t.goToCategory=function(){var e=[].slice;return rcpAid.getUrl("分类",{tags:e.call(arguments,0).join(",")})}}]),module.directive("searchDir",function(){return{template:'<div class="h-sc"><div class="head-search-bar"><div class="enter" ng-click="stopPropagation($event)"><input type="text" class="input" ng-model="scText" ng-keydown="onkeydown($event)" ng-change="matchChange(scSelectVal.value,scText)" placeholder="请输入关键词搜索"><div class="match-kw-v" ng-show="matchReadyLock"><div class="mc-list"><ul><li ng-repeat="item in mcCategoryList track by $index" ng-if="$index < lMaxLen" ng-class="{hover: $index == moveKeyIndex}" ng-mouseenter="mouseenter($index,\'类\')" ng-click="matchGoToCategory(item.tag,scText)"><div class="text-of"><a href="javascript:;">{{text}}</a> 在 <a href="javascript:;" class="item-name color-cyan">{{item.tag}}</a> 分类中搜索</div></li></ul><div style="margin:0 10px;border-top:1px solid #dfdfdf" ng-if="mcCourseList.length && mcCategoryList.length"></div><ul><li ng-if="!mcCourseList || !mcCourseList.length">暂无相关内容</li><li ng-repeat="item in mcCourseList track by $index" ng-click="intoDetail(item)" ng-if="$index < cMaxLen" ng-class="{hover: $index + lMaxLen == moveKeyIndex}" ng-mouseenter="mouseenter($index,\'资源\')"><div class="text-of"><span class="lab" ng-if="item.t == 10">课程</span> <span class="lab" ng-if="item.t == 20">题库</span> <a href="javascript:;" class="item-name" ng-bind-html="item.name|titleMatchKw:scText"></a></div></li></ul></div></div></div><a ng-click="goToSearch(scSelectVal.value,scText)" class="submit" title="提交"><i class="fa fa-search" aria-hidden="true"></i></a></div><div class="hot-word"><a href="" class="mg-r20" ng-repeat="item in scHotWord" ng-click="goToSort(item.name)">{{item.name}}</a></div></div>',restrict:"E",replace:!0,transclude:!0,scope:{hot:"="},controller:"headSearchCtrl"}}),module.controller("headSearchCtrl",["$rootScope","$scope","$document","$element","service","headSearch",function(e,t,a,n,i,r){function o(){t.scText="",g()}function c(){x=!0,t.KeyDownIndex=t.moveKeyIndex,d()}function s(){"number"!=typeof t.moveKeyIndex?t.moveKeyIndex=0:t.moveKeyIndex=(t.moveKeyIndex+1)%t.aMaxLen,c()}function l(){"number"!=typeof t.moveKeyIndex?t.moveKeyIndex=t.aMaxLen-1:t.moveKeyIndex=t.moveKeyIndex<0?t.aMaxLen-1:t.moveKeyIndex-1,c(),h(t.scText.length)}function d(){var e,a=t.KeyDownIndex,n=t.lMaxLen;return t.scTag=void 0,n>a&&(t.scText=t.text),a>=n&&(e=t.mcCourseList[a-t.lMaxLen],e&&(t.scText=e.name)),e}function g(e){t.matchReadyLock=!1,e&&(a.unbind("click"),t.$digest())}function m(){a.unbind("click").bind("click",function(){g("digest")}),t.matchReadyLock=!0}function u(){t.matchReadyLock&&(clearTimeout(b),b=setTimeout(function(){g("digest")},300))}function h(e){var t=n.find('input[ng-model="scText"]').get(0);if("selectionStart"in t&&(t.selectionStart=e,t.selectionEnd=e),"createTextRange"in t){var a=t.createTextRange();a.moveStart("character",e),a.collapse(!0),a.select()}}function p(e,a){t.inSort&&!angular.isArray(e)||angular.forEach(e,function(e){return t.inSort?!1:void(a(e)||angular.isArray(e.child)&&e.child.length&&(p(e.child,a),v("push",e.name)))})}function f(e,a){switch(t.inSort=!1,v("clear"),p(e,function(e){return t.inSort=e.name===a,t.inSort&&v("push",e.name),t.inSort}),t.inSort){case!0:v("splice",a);break;default:v("clear")}return t.categorySelect}function v(e,a){var n=t.categorySelect;switch(e){case"clear":n.splice(0,n.length);break;case"push":n.push(a);break;case"splice":n.splice(0,$.inArray(a,n))}}function k(e,t){i.dialog.alert(t),console[e](t)}function y(e){var t=[];if(e.length)for(var a=0,n=e.length;n>a;a++)t.push({id:e[a].hasOwnProperty("id")?e[a].id:"",name:e[a].hasOwnProperty("title")?e[a].title:"",t:e[a].hasOwnProperty("type")?e[a].type:""});return t}t.scHotWord=[],t.scSelect=[{name:"所有分类",value:"",fixLock:!0},{name:"课程",value:10},{name:"题库",value:20}],t.scSelectVal=t.scSelect[0],t.onkeydown=function(e){switch(e.stopPropagation(),e.keyCode){case 13:t.scText||(t.scText=$(".head-search-bar input").eq(0).val());var a=t.KeyDownIndex,n=t.lMaxLen;"number"==typeof a&&a>=0&&n>a&&t.scTag?t.matchGoToCategory(t.scTag,t.scText):a>=0&&t.matchReadyLock?location.href=rcpAid.getUrl("课程详情",{cid:t.mcCourseList[a].id}):t.goToSearch(t.scSelectVal.value,t.scText);break;case 38:l();break;case 40:s();break;default:x=!1,t.moveKeyIndex=void 0,t.KeyDownIndex=void 0,t.scTag=void 0}};var x,b;n.find('input[ng-model="scText"]').unbind("focus").bind("focus",m),n.find('input[ng-model="scText"]').unbind("blur").bind("blur",u),t.mouseenter=function(e,a){switch(a){case"类":t.moveKeyIndex=e;break;case"资源":t.moveKeyIndex=e+t.lMaxLen}},t.goToSearch=function(e,t){o(),location.href=rcpAid.getUrl("搜索",{type:e,query:t?encodeURIComponent(t):t})},t.goToSort=function(e){o(),location.href=rcpAid.getUrl("分类",{tags:e})},t.stopPropagation=function(e){e.stopPropagation()},t.matchChange=function(e,a){if(!x){if(g(),!a)return t.mcCategoryList=[],void(t.mcCourseList=[]);t.text=a,r.SearchIntelligent({key:a,courseType:e||null,limit:10}).then(function(e){t.scText&&(t.matchReadyLock=!0,t.mcCourseList=y(e.data.courses||[]),t.mcCategoryList=[],t.lMaxLen=t.mcCategoryList.length>3?3:t.mcCategoryList.length,t.cMaxLen=t.mcCourseList.length-t.lMaxLen,t.aMaxLen=t.lMaxLen+t.cMaxLen,t.mcCourseList.length||t.mcCategoryList.length||g())},function(e){k("错误代码："+e.data.data.code)})}},t.$watch("scSelectVal.value",function(){t.matchChange(t.scSelectVal.value,t.scText)}),t.matchGoToCategory=function(t,a){if(!e.allTagCategroy||!e.allTagCategroy.length)return void k("error","获取分类数据失败");var n=f(e.allTagCategroy,t).reverse().join(",");n?(o(),location.href=rcpAid.getUrl("分类",{tags:n,query:a})):k("error","找不到这个分类，请检查接口数据")},t.categorySelect=[],t.intoDetail=function(e){e.hasOwnProperty("id")&&(location.href=rcpAid.getUrl("课程详情",{cid:e.id}))}}]),module.directive("tailnav",function(){return{template:'<footer><section class="footer" id="footer"><div class="g-m-w"><div class="copyright"><p>广州市大洋信息技术股份有限公司 版权所有</p><p>Copyright © 2015 ITDAYANG. All Rights Reserved.</p><p>{{caseNumber}}</p></div><div class="footer-link"><a href="http://www.itdayang.com/about.html" target="_blank">关于我们</a> <span>- </span><a href="http://www.itdayang.com/contact.html" target="_blank">联系我们</a> <span>- </span><a href="javascript:;" ng-click="atBuilding()">法律条款</a> <span>- </span><a href="javascript:;" ng-click="atBuilding()">帮助中心</a> <span>- </span><a href="javascript:;" ng-click="atBuilding()">学校申请加入</a> <span>- </span><a href="javascript:;" ng-click="atBuilding()">机构申请加入</a> <span>- </span><a href="javascript:;" ng-click="atBuilding()">意见反馈</a></div><div class="clear"></div></div></section></footer>',restrict:"E",replace:!0,transclude:!0,scope:{data:"=data"},controller:["$scope","service",function(e,t){e.catType=rcpAid.getCourseCat();var a=DYCONFIG.domain||[];angular.forEach(a,function(t){t.domain===location.host&&(e.caseNumber=t.domainNum)}),e.atBuilding=function(){t.dialog.alert("正在建设中...")}}]}}),module.filter("titleMatchKw",["$sce",function(e){return function(t,a){var n="<b>"+a+"</b>",i=/([\[\]\(\)\{\}\*\?\+\^\$\.\|\\])/gi,r=a.replace(i,"\\$1");return t=t.replace(new RegExp(r,"ig"),n),e.trustAsHtml(t)}}]),function(){function e(){var i=document.getElementById("footer");if(i){var r=document.documentElement.scrollHeight-1||document.body.scrollHeight-1,o=document.documentElement.clientHeight||document.body.clientHeight;n=o>=r?1:2,n!==a&&(o>=r?(t(i.parentNode,{height:i.offsetHeight+"px"}),t(i,{position:"absolute",width:"100%",bottom:0,left:0})):(t(i.parentNode,{height:i.offsetHeight+"px"}),t(i,{position:"",width:"100%",bottom:0,left:0}))),a=o>=r?1:2}setTimeout(e)}if(!window.fixedFooterFlag){window.fixedFooterFlag=!0;var t=function(e,t){for(k in t)e.style[k]=t[k]},a=0,n=1;e()}}();