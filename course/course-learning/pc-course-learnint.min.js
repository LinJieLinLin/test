var module=angular.module("RCP",["ngCookies","ngRoute","ngSanitize","LocalStorageModule"]);module.factory("$resource",["request",function(e){return function(t){return{get:function(i,n,a){e({method:"GET",url:t,params:i}).then(n,function(e){"function"==typeof a&&a(e.data)})}}}}]),module.controller("contentCtrl",["$resource","$rootScope","$scope","$timeout","service","cvfa",function(e,t,i,n,a,r){function o(){t.sectionLoadingReady=!1,t.contentLoadingReady=void 0}function c(e){o(),"/"==wcms.load[0]&&(wcms.load=wcms.load.slice(1)),wcms.load=DYCONFIG.course.rUrl+wcms.load,r.self=i.self,r.config({uid:1,contentId:e,t:"T",n:3,target:r.queryString("target")}).init(),i.$on("cvfaInitReady",function(){i.endingLoading("newLock")}),i.$on("cvfaInitError",function(e,t,n){i.endingLoading("newLock")}),i.$on("makeContentReady",function(){t.contentLoadingReady=!0}),i.$on("makeCatReady",function(){s(r.cat.items)}),i.$on("actionAatId",function(e,t){angular.forEach(r.cat.items,function(e,n){e.id==t&&(i.curSectionIndex=n+1,i.curSectionName=e.title,i.nowSection=e)}),console.log(i.curSectionIndex,i.curSectionName)}),i.$on("makeContentError",function(e,i,n){t.contentLoadingReady=!0}),i.$on("locateContentTarget",function(){t.contentLoadingReady=!1})}function s(e){e&&(i.sectionLength=e.length)}function l(e){for(var t,i=["requestFullscreen","webkitRequestFullscreen","mozRequestFullScreen","msRequestFullscreen"],n=0;n<i.length;n++)if(e[i[n]]){e[i[n]](),t=!t;break}if(!t&&"undefined"!=typeof window.ActiveXObject){var a=new ActiveXObject("WScript.Shell");null!==a&&a.SendKeys("{F11}")}}function d(e){for(var t,i=["exitFullscreen","webkitExitFullscreen","mozCancelFullScreen","msExitFullscreen"],n=0;n<i.length;n++)if(e[i[n]]){e[i[n]](),t=!t;break}if(!t&&"undefined"!=typeof window.ActiveXObject){var a=new ActiveXObject("WScript.Shell");null!==a&&a.SendKeys("{F11}")}}function u(){var e=document.fullscreenElement||document.webkitFullscreenElement||document.mozFullScreenElement||document.msFullscreenElement;i.fullScreenLock=!!e;try{i.$digest()}catch(t){}}i.isIe9=rcpAid.isIE(5,9),i.newCtvMark=rcpAid.queryString("new"),i.courseStatus=rcpAid.queryString("type"),i.targetId=rcpAid.queryString("target"),i.courseId=rcpAid.queryString("cid"),i.isNullContent=!1,i.learningLocationData={},t.learningDialog={},i.nowSection={},i.currentUser={},i.$on("login",function(e,n){return n?(i.currentUser=t.currentUser,void i.courseDetail()):void a.common.toLogin()}),i.init=function(){i.link={courseDetail:"",teacherSpace:""},i.courseId||a.dialog.alert("课程信息有误！")},i.courseDetail=function(){var e={text:{idx:{type:"items"}}},t={cid:i.courseId,cmds:angular.toJson(e)};a.course.getCourseDetail(t).then(function(e){i.courseDetailHub(e)},function(e){i.endingLoading(),a.dialog.alert("课程信息有误！")})},i.courseDetailHub=function(e){return 0!==e.code?(a.dialog.alert(301===e.code?"请先登录":e.msg?e.msg:"获取课程信息失败"),void i.endingLoading()):(t.courseData=e.data,i.link.courseDetail=rcpAid.getUrl("课程详情",{cid:t.courseData.crs.id}),i.link.teacherSpace=rcpAid.getUrl("教学中心",{cid:t.currentUser.uid}),document.title=t.courseData.crs.title+" · 学习页",t.readPermissions=t.courseData.joinMode,100!==t.courseData.crs.status&&10!==t.readPermissions||(i.readSlideBar=!0),t.currentUser.role&&(t.currentUser.role.UCS_ADMIN||t.currentUser.role.COURSE_VERIFY_ADMIN)&&(t.readPermissions=!0),t.readPermissions?void i.showNewContentView():(i.endingLoading(),a.dialog.alert("您未参与课程，正在跳转到详情页",{mask:!0}),i.endingLoading(),void n(function(){location.href=i.link.courseDetail},2500)))},i.showNewContentView=function(){try{if(!t.courseData.crs.iids.text.aid)return dialogAlert("课程内容id不能为空"),void console.error("courseData.linkId == undefined");c(t.courseData.crs.iids.text.aid)}catch(e){}},document.addEventListener("fullscreenchange",u,!1),document.addEventListener("mozfullscreenchange",u,!1),document.addEventListener("webkitfullscreenchange",u,!1),document.addEventListener("msfullscreenchange",u,!1),document.onmsfullscreenchange=u,i.fullScreen=function(){if(rcpAid.isIE())return void a.dialog.alert("请手动按F11键");if(i.fullScreenLock)return void i.cancelScreen();var e=document.documentElement;l(e),i.toggleSection(!1)},i.cancelScreen=function(){var e=document.documentElement;d(e),d(document),d(window),i.toggleSection(!0)},i.continueLearning=function(e){i.$broadcast("continueLearning",$(e.target).html())},i.endingLoading=function(){t.sectionLoadingReady=!0,t.contentLoadingReady=!0,t.serviceLoadingReady=!0},i.toggleSection=function(e,t){i.showSectionLock="boolean"==typeof e?e:!i.showSectionLock;var n=.16*$(window).width();250>n&&(n=250);var a=i.showSectionLock?n:0;$("#section-v").stop().animate({width:a},t||"fast"),$("#container-v").stop().animate({left:a+20},t||"fast"),$("#toggle-section-new").stop().animate({left:a||0},t||"fast")},i.init(),i.gotoDetail=function(e){window.open(i.link.courseDetail),t.$broadcast("pauseLearning")},i.gotoSpace=function(e){window.open("./teacher-space.html?uid="+e)},i.pauseLearning=function(){t.$broadcast("pauseLearning")},i.filterSectionList=[{name:"全部",type:"all",active:!0},{name:"文件",type:"file"},{name:"图片",type:"img"},{name:"视频",type:"video"},{name:"练习",type:"exercise"}],i.curFilterType=i.filterSectionList[0],i.filterSection=function(e){if(i.curFilterType=e,angular.forEach(i.filterSectionList,function(t){t.active=t.type===e.type}),!i.loginStatus())return void a.dialog.alert("请先登录");if(!i.isNullCourseList()){var t=!0;switch(e.type){case"all":angular.forEach(i.courseDirectory.items,function(e){t=!1,e.filterHide=!1,e.filterFlag=!1,angular.forEach(e.childItems,function(e){e.filterHide=!1,e.filterFlag=!1})});break;default:angular.forEach(i.courseDirectory.items,function(i){i.filterFlag=!1,i.filterHide=!0,angular.forEach(i.contentType,function(n){i.filterFlag||(i.filterHide=n!==e.type,i.filterFlag=n===e.type,t=!1)}),angular.forEach(i.childItems,function(n){n.filterFlag=!1,n.filterHide=!0,angular.forEach(n.contentType,function(a){n.filterFlag||(n.filterHide=a!==e.type,n.filterFlag=a===e.type),n.filterHide||(i.filterHide=!1,t=!1)})})})}i.curFilterType.showNull=t}},i.loginStatus=function(){var e=rcpAid.loginStatus();return e&&(i.curLoginStatus&&i.curLoginStatus!==e&&window.location.reload(),i.curLoginStatus=e),e}}]),module.controller("serviceCtrl",["$rootScope","$scope","$document","$timeout","$q","service",function(e,t,i,n,a,r){function o(){t.currentUser=e.currentUser,t.$on("login",function(i,n){return n?void(t.currentUser=e.currentUser):void r.common.toLogin()}),t.studyCircleConfig={courseId:t.courseId},n(function(){console.log(t.nowSection,12312123123)},3e3),t.$parent.toggleSection(!0),t.stopPropagation=c,t.$parent.stopPropagation=c}function c(e){e.stopPropagation()}t.isIe9=rcpAid.isIE(5,9),t.$parent.tabsNavList=[{"class":"image-c-chat",name:"群聊",msg:"强化巩固知识试试评测便知！"},{"class":"image-user-blue",name:"找老师",isIe9:t.isIe9,msg:"学习问题老师统统帮你搞定！"},{"class":"image-circle",name:"写圈子",msg:"课程圈子探讨学习分享知识！"}],t.curTabName=t.tabsNavList[0].name,t.showTabLock=!1;var s=Math.round(.282258258*$(window).width());350>s&&(s=350);var l=0,d=l;t.closeServiceTab=function(e){t.showTabLock="boolean"==typeof e?e:!t.showTabLock;try{t.$digest(t.showTabLock)}catch(i){}t.resizeView(t.showTabLock?s:l,"animate")},t.switchServiceTab=function(e){var i=!1;if(t.curTabName!==e&&(i=!0),t.curTabName=e,t.uploadImgIe={status:"wait",rate:0,speed:0,file:[],img:[]},!t.showTabLock||i){t.showTabLock=!0;var n=Math.round(.282258258*$(window).width());350>n&&(n=350),t.resizeView(d>n?d:n,"animate"),angular.forEach(t.tabsNavList,function(t){t.active=t.name===e})}else t.closeServiceTab()},t.resizeView=function(e,n,a){var r=i.width()/2,o=l>e?l:e>r?r:e;if(o>350&&(o=450),console.log("窗口改变",e,n,a,l,o),d=o,o){$(".study-circle-w").show();var c=$(".content-ctrl")[0].clientHeight;$(".study-circle .study-circle-r").height(c)}else $(".study-circle-w").hide();switch(n){case"animate":$("#service-v .widthmark").stop().animate({width:o},"fast"),$(".top-active-bar").stop().animate({marginRight:o},"fast"),$(".study-circle-w").stop().animate({width:o?o-60:0},"fast"),t.showTabLock?i.unbind("click").bind("click",function(){a||t.closeServiceTab(!1),a=!1}):i.unbind("click");break;default:$("#service-v .widthmark").css({width:o}),$(".top-active-bar").stop().css({marginRight:o}),$(".study-circle-w").css({width:o?o-60:0})}},$(window).on({resize:function(){var e=Math.round(.282258258*$(window).width());350>=e&&450===d?(console.log("变小"),t.resizeView(350)):e>d&&350===d&&(console.log("变大"),t.resizeView(450))}}),o()}]),module.filter("sanitize",["$sce",function(e){return function(t){return e.trustAsHtml(t)}}]),module.factory("course",["request",function(e){var t=DYCONFIG.course.rUrl;return{getCourseDetail:function(i,n){i.token=rcpAid.getToken();var a={method:"GET",url:t+"pub/api/loadCourse",params:i};return e(angular.extend(a,n||{}))},getTeacherCourses:function(i,n){i.token=rcpAid.getToken(),i.isSelf=1;var a={method:"GET",url:t+"pub/api/searchCourse",params:i};return e(angular.extend(a,n||{}))},joinFreeCourse:function(i,n){i.token=rcpAid.getToken();var a={method:"GET",url:t+"usr/api/joinCourse",params:i};return e(angular.extend(a,n||{}))},searchCourse:function(i,n){var a={method:"GET",url:t+"pub/api/searchCourse",params:i};return e(angular.extend(a,n||{}))},verifyCourse:function(i,n){i.token=rcpAid.getToken();var a={method:"GET",url:t+"usr/api/verifyCourse",params:i};return e(angular.extend(a,n||{}))},createCourse:function(i,n,a){i.token=rcpAid.getToken();var r={method:"POST",url:t+"usr/api/createCourse",params:i,data:a};return e(angular.extend(r,n||{}))},getStudentCourse:function(i,n){i.token=rcpAid.getToken(),i.isSelf=10;var a={method:"GET",url:t+"pub/api/searchCourse",params:i};return e(angular.extend(a,n||{}))},releaseCourse:function(i,n){i.token=rcpAid.getToken();var a={method:"GET",url:t+"usr/api/releaseCourse",params:i};return e(angular.extend(a,n||{}))},saveCourseData:function(i,n){var a={};a.token=rcpAid.getToken();var r={method:"POST",url:t+"usr/api/updateCourse",params:a,data:i};return e(angular.extend(r,n||{}))},cancelCourse:function(i,n){i.token=rcpAid.getToken();var a={method:"POST",url:t+"usr/api/cancelCourse",params:i};return e(angular.extend(a,n||{}))},getListGroup:function(i,n){i.token=rcpAid.getToken();var a={method:"GET",url:t+"pub/api/listGroup",params:i};return e(angular.extend(a,n||{}))},getAllTags:function(t,i){t.token=rcpAid.getToken();var n={method:"POST",url:DYCONFIG.pes.rUrl+'pub/api/page/GetPage?keys=[{"key":"p_classifi"}]',params:t};return e(angular.extend(n,i||{}))}}}]),module.run(["service","course",function(e,t){e.expand("course",function(){return t})}]);var swfobject=function(){function e(){if(!V){try{var e=R.getElementsByTagName("body")[0].appendChild(m("span"));e.parentNode.removeChild(e)}catch(t){return}V=!0;for(var i=U.length,n=0;i>n;n++)U[n]()}}function t(e){V?e():U[U.length]=e}function i(e){if(typeof F.addEventListener!=I)F.addEventListener("load",e,!1);else if(typeof R.addEventListener!=I)R.addEventListener("load",e,!1);else if(typeof F.attachEvent!=I)v(F,"onload",e);else if("function"==typeof F.onload){var t=F.onload;F.onload=function(){t(),e()}}else F.onload=e}function n(){M?a():r()}function a(){var e=R.getElementsByTagName("body")[0],t=m(D);t.setAttribute("type",A);var i=e.appendChild(t);if(i){var n=0;!function(){if(typeof i.GetVariable!=I){var a=i.GetVariable("$version");a&&(a=a.split(" ")[1].split(","),W.pv=[parseInt(a[0],10),parseInt(a[1],10),parseInt(a[2],10)])}else if(10>n)return n++,void setTimeout(arguments.callee,10);e.removeChild(t),i=null,r()}()}else r()}function r(){var e=H.length;if(e>0)for(var t=0;e>t;t++){var i=H[t].id,n=H[t].callbackFn,a={success:!1,id:i};if(W.pv[0]>0){var r=h(i);if(r)if(!y(H[t].swfVersion)||W.wk&&W.wk<312)if(H[t].expressInstall&&c()){var d={};d.data=H[t].expressInstall,d.width=r.getAttribute("width")||"0",d.height=r.getAttribute("height")||"0",r.getAttribute("class")&&(d.styleclass=r.getAttribute("class")),r.getAttribute("align")&&(d.align=r.getAttribute("align"));for(var u={},p=r.getElementsByTagName("param"),f=p.length,g=0;f>g;g++)"movie"!=p[g].getAttribute("name").toLowerCase()&&(u[p[g].getAttribute("name")]=p[g].getAttribute("value"));s(d,u,i,n)}else l(r),n&&n(a);else b(i,!0),n&&(a.success=!0,a.ref=o(i),n(a))}else if(b(i,!0),n){var m=o(i);m&&typeof m.SetVariable!=I&&(a.success=!0,a.ref=m),n(a)}}}function o(e){var t=null,i=h(e);if(i&&"OBJECT"==i.nodeName)if(typeof i.SetVariable!=I)t=i;else{var n=i.getElementsByTagName(D)[0];n&&(t=n)}return t}function c(){return!G&&y("6.0.65")&&(W.win||W.mac)&&!(W.wk&&W.wk<312)}function s(e,t,i,n){G=!0,C=n||null,T={success:!1,id:i};var a=h(i);if(a){"OBJECT"==a.nodeName?(k=d(a),$=null):(k=a,$=i),e.id=N,(typeof e.width==I||!/%$/.test(e.width)&&parseInt(e.width,10)<310)&&(e.width="310"),(typeof e.height==I||!/%$/.test(e.height)&&parseInt(e.height,10)<137)&&(e.height="137"),R.title=R.title.slice(0,47)+" - Flash Player Installation";var r=W.ie&&W.win?"ActiveX":"PlugIn",o="MMredirectURL="+encodeURI(window.location).toString().replace(/&/g,"%26")+"&MMplayerType="+r+"&MMdoctitle="+R.title;if(typeof t.flashvars!=I?t.flashvars+="&"+o:t.flashvars=o,W.ie&&W.win&&4!=a.readyState){var c=m("div");i+="SWFObjectNew",c.setAttribute("id",i),a.parentNode.insertBefore(c,a),a.style.display="none",function(){4==a.readyState?a.parentNode.removeChild(a):setTimeout(arguments.callee,10)}()}u(e,t,i)}}function l(e){if(W.ie&&W.win&&4!=e.readyState){var t=m("div");e.parentNode.insertBefore(t,e),t.parentNode.replaceChild(d(e),t),e.style.display="none",function(){4==e.readyState?e.parentNode.removeChild(e):setTimeout(arguments.callee,10)}()}else e.parentNode.replaceChild(d(e),e)}function d(e){var t=m("div");if(W.win&&W.ie)t.innerHTML=e.innerHTML;else{var i=e.getElementsByTagName(D)[0];if(i){var n=i.childNodes;if(n)for(var a=n.length,r=0;a>r;r++)1==n[r].nodeType&&"PARAM"==n[r].nodeName||8==n[r].nodeType||t.appendChild(n[r].cloneNode(!0))}}return t}function u(e,t,i){var n,a=h(i);if(W.wk&&W.wk<312)return n;if(a)if(typeof e.id==I&&(e.id=i),W.ie&&W.win){var r="";for(var o in e)e[o]!=Object.prototype[o]&&("data"==o.toLowerCase()?t.movie=e[o]:"styleclass"==o.toLowerCase()?r+=' class="'+e[o]+'"':"classid"!=o.toLowerCase()&&(r+=" "+o+'="'+e[o]+'"'));var c="";for(var s in t)t[s]!=Object.prototype[s]&&(c+='<param name="'+s+'" value="'+t[s]+'" />');a.outerHTML='<object classid="clsid:D27CDB6E-AE6D-11cf-96B8-444553540000"'+r+">"+c+"</object>",P[P.length]=e.id,n=h(e.id)}else{var l=m(D);l.setAttribute("type",A);for(var d in e)e[d]!=Object.prototype[d]&&("styleclass"==d.toLowerCase()?l.setAttribute("class",e[d]):"classid"!=d.toLowerCase()&&l.setAttribute(d,e[d]));for(var u in t)t[u]!=Object.prototype[u]&&"movie"!=u.toLowerCase()&&p(l,u,t[u]);a.parentNode.replaceChild(l,a),n=l}return n}function p(e,t,i){var n=m("param");n.setAttribute("name",t),n.setAttribute("value",i),e.appendChild(n)}function f(e){var t=h(e);t&&"OBJECT"==t.nodeName&&(W.ie&&W.win?(t.style.display="none",function(){4==t.readyState?g(e):setTimeout(arguments.callee,10)}()):t.parentNode.removeChild(t))}function g(e){var t=h(e);if(t){for(var i in t)"function"==typeof t[i]&&(t[i]=null);t.parentNode.removeChild(t)}}function h(e){var t=null;try{t=R.getElementById(e)}catch(i){}return t}function m(e){return R.createElement(e)}function v(e,t,i){e.attachEvent(t,i),z[z.length]=[e,t,i]}function y(e){var t=W.pv,i=e.split(".");return i[0]=parseInt(i[0],10),i[1]=parseInt(i[1],10)||0,i[2]=parseInt(i[2],10)||0,t[0]>i[0]||t[0]==i[0]&&t[1]>i[1]||t[0]==i[0]&&t[1]==i[1]&&t[2]>=i[2]}function w(e,t,i,n){if(!W.ie||!W.mac){var a=R.getElementsByTagName("head")[0];if(a){var r=i&&"string"==typeof i?i:"screen";if(n&&(S=null,L=null),!S||L!=r){var o=m("style");o.setAttribute("type","text/css"),o.setAttribute("media",r),S=a.appendChild(o),W.ie&&W.win&&typeof R.styleSheets!=I&&R.styleSheets.length>0&&(S=R.styleSheets[R.styleSheets.length-1]),L=r}W.ie&&W.win?S&&typeof S.addRule==D&&S.addRule(e,t):S&&typeof R.createTextNode!=I&&S.appendChild(R.createTextNode(e+" {"+t+"}"))}}}function b(e,t){if(q){var i=t?"visible":"hidden";V&&h(e)?h(e).style.visibility=i:w("#"+e,"visibility:"+i)}}function x(e){var t=/[\\\"<>\.;]/,i=null!=t.exec(e);return i&&typeof encodeURIComponent!=I?encodeURIComponent(e):e}var k,$,C,T,S,L,I="undefined",D="object",E="Shockwave Flash",_="ShockwaveFlash.ShockwaveFlash",A="application/x-shockwave-flash",N="SWFObjectExprInst",j="onreadystatechange",F=window,R=document,O=navigator,M=!1,U=[n],H=[],P=[],z=[],V=!1,G=!1,q=!0,W=function(){var e=typeof R.getElementById!=I&&typeof R.getElementsByTagName!=I&&typeof R.createElement!=I,t=O.userAgent.toLowerCase(),i=O.platform.toLowerCase(),n=i?/win/.test(i):/win/.test(t),a=i?/mac/.test(i):/mac/.test(t),r=/webkit/.test(t)?parseFloat(t.replace(/^.*webkit\/(\d+(\.\d+)?).*$/,"$1")):!1,o=!1,c=[0,0,0],s=null;if(typeof O.plugins!=I&&typeof O.plugins[E]==D)s=O.plugins[E].description,!s||typeof O.mimeTypes!=I&&O.mimeTypes[A]&&!O.mimeTypes[A].enabledPlugin||(M=!0,o=!1,s=s.replace(/^.*\s+(\S+\s+\S+$)/,"$1"),c[0]=parseInt(s.replace(/^(.*)\..*$/,"$1"),10),c[1]=parseInt(s.replace(/^.*\.(.*)\s.*$/,"$1"),10),c[2]=/[a-zA-Z]/.test(s)?parseInt(s.replace(/^.*[a-zA-Z]+(.*)$/,"$1"),10):0);else if(typeof F.ActiveXObject!=I)try{var l=new ActiveXObject(_);l&&(s=l.GetVariable("$version"),s&&(o=!0,s=s.split(" ")[1].split(","),c=[parseInt(s[0],10),parseInt(s[1],10),parseInt(s[2],10)]))}catch(d){}return{w3:e,pv:c,wk:r,ie:o,win:n,mac:a}}();(function(){W.w3&&((typeof R.readyState!=I&&"complete"==R.readyState||typeof R.readyState==I&&(R.getElementsByTagName("body")[0]||R.body))&&e(),V||(typeof R.addEventListener!=I&&R.addEventListener("DOMContentLoaded",e,!1),W.ie&&W.win&&(R.attachEvent(j,function(){"complete"==R.readyState&&(R.detachEvent(j,arguments.callee),e())}),F==top&&!function(){if(!V){try{R.documentElement.doScroll("left")}catch(t){return void setTimeout(arguments.callee,0)}e()}}()),W.wk&&!function(){return V?void 0:/loaded|complete/.test(R.readyState)?void e():void setTimeout(arguments.callee,0)}(),i(e)))})(),function(){W.ie&&W.win&&window.attachEvent("onunload",function(){for(var e=z.length,t=0;e>t;t++)z[t][0].detachEvent(z[t][1],z[t][2]);for(var i=P.length,n=0;i>n;n++)f(P[n]);for(var a in W)W[a]=null;W=null;for(var r in swfobject)swfobject[r]=null;swfobject=null})}();return{registerObject:function(e,t,i,n){if(W.w3&&e&&t){var a={};a.id=e,a.swfVersion=t,a.expressInstall=i,a.callbackFn=n,H[H.length]=a,b(e,!1)}else n&&n({success:!1,id:e})},getObjectById:function(e){return W.w3?o(e):void 0},embedSWF:function(e,i,n,a,r,o,l,d,p,f){var g={success:!1,id:i};W.w3&&!(W.wk&&W.wk<312)&&e&&i&&n&&a&&r?(b(i,!1),t(function(){n+="",a+="";var t={};if(p&&typeof p===D)for(var h in p)t[h]=p[h];t.data=e,t.width=n,t.height=a;var m={};if(d&&typeof d===D)for(var v in d)m[v]=d[v];if(l&&typeof l===D)for(var w in l)typeof m.flashvars!=I?m.flashvars+="&"+w+"="+l[w]:m.flashvars=w+"="+l[w];if(y(r)){var x=u(t,m,i);t.id==i&&b(i,!0),g.success=!0,g.ref=x}else{if(o&&c())return t.data=o,void s(t,m,i,f);b(i,!0)}f&&f(g)})):f&&f(g)},switchOffAutoHideShow:function(){q=!1},ua:W,getFlashPlayerVersion:function(){return{major:W.pv[0],minor:W.pv[1],release:W.pv[2]}},hasFlashPlayerVersion:y,createSWF:function(e,t,i){return W.w3?u(e,t,i):void 0},showExpressInstall:function(e,t,i,n){W.w3&&c()&&s(e,t,i,n)},removeSWF:function(e){W.w3&&f(e)},createCSS:function(e,t,i,n){W.w3&&w(e,t,i,n)},addDomLoadEvent:t,addLoadEvent:i,getQueryParamValue:function(e){var t=R.location.search||R.location.hash;if(t){if(/\?/.test(t)&&(t=t.split("?")[1]),null==e)return x(t);for(var i=t.split("&"),n=0;n<i.length;n++)if(i[n].substring(0,i[n].indexOf("="))==e)return x(i[n].substring(i[n].indexOf("=")+1))}return""},expressInstallCallback:function(){if(G){var e=h(N);e&&k&&(e.parentNode.replaceChild(k,e),$&&(b($,!0),W.ie&&W.win&&(k.style.display="block")),C&&C(T)),G=!1}}}}();if(window.isUploadFinish=function(){for(var e=0;e<uer.files.length;e++)if("L"!==uer.files[e].Status&&"E"!==uer.files[e].Status&&"A"!==uer.files[e].Status)return!1;return!0},angular.module("RCP").directive("uploadImg",function(){return{restrict:"AE",scope:{selectFile:"=",upload:"=",onProcess:"=",onSuccess:"=",onErr:"="},template:'<input ng-show="isIe9==false" style="display:none;" type="file" multiple id="uploader-{{id}}" /><style type="text/css">.swf-up{position: absolute;top: 0;opacity: 0;filter:alpha(opacity=0);}.swf-up-71 {position: absolute;left: -71px;opacity: 0;filter:alpha(opacity=0);}.swf-up-35 {position: absolute;left: 35px;top: 0;opacity: 0;filter:alpha(opacity=0);} </style><div ng-show="isIe9==true" id="swfUploader-{{id}}"><a href="http://www.adobe.com/go/getflashplayer" ng-show="showMsg" style="background-color: #fff;opacity: 1;filter:alpha(opacity=1);">请先安装FLASH播放器！</a>',controller:["$scope","$timeout","service",function(e,t,i){var n=new jswf.Uer(DYCONFIG.fs.upload,{m:"C",pub:1,token:rcpAid.getToken()},!0);angular.isObject(e.upload)||(e.upload={}),e.upload.status="wait",e.upload.rate=0,e.upload.speed=0,e.upload.file=[],e.upload.img=[],e.upload.max=e.upload.max||6,e.isIe9=!1,isIE(9,9)&&(e.isIe9=!0,t(function(){e.showMsg=!0,SwfUpload("swfUploader-"+e.id,e,"swfUpCb")},1e3)),e.id=(new Date).getTime(),e.swfUpCb=function(t,n){if(0===n.code)try{var a=e.upload.max;if(a<e.upload.img.length+1)return i.dialog.alert("最多只能添加"+a+"张图片！"),!1;e.upload.img.push(n.data),e.$apply()}catch(r){}},e.selectFile=function(){setTimeout(function(){return e.isIe9?void $("#swfUploader-"+e.id).trigger("click"):void $("#uploader-"+e.id).trigger("click")},100),n.AddI("uploader-"+e.id,{},{}),n.OnProcess=function(t,i,n){e.upload.status="uploading",e.upload.rate=i,e.upload.speed=n,e.upload.file=t,e.onProcess&&"function"==typeof e.onProcess&&e.onProcess(t);try{e.$apply()}catch(a){}},n.OnSuccess=function(i,n){e.upload.status="success",e.upload.rate=0,e.upload.speed=0,e.upload.file=i,e.upload.img.push(n.data),t(function(){e.upload.status="wait"},2e3),rcpAid.clearFile("uploader-"+e.id),e.onSuccess&&"function"==typeof e.onSuccess&&e.onSuccess(i);try{e.$apply()}catch(a){}},n.OnErr=function(){e.upload.status="error",e.upload.rate=0,e.upload.speed=0,e.onErr&&"function"==typeof e.onErr&&e.onErr();try{e.$apply()}catch(t){}}},n.OnSelect=function(e){var t=r(e);return t};var a=["png","jpg","bmp","gif","jpeg"],r=function(t){var n=!0,r=0;return angular.forEach(t.files,function(t){var o=t.name.split(".").pop().toLowerCase();-1===$.inArray(o,a)&&(i.dialog.alert("只支持以下格式图片上传：png,jpg,bmp,gif,jpeg。"),n=!1,rcpAid.clearFile("uploader-"+e.id)),r++}),e.upload.max<r+e.upload.img.length&&(n=!1,i.dialog.alert("最多只能上传"+e.upload.max+"张图片！")),n?t.files:[]}}]}}),angular.module("RCP").directive("imageSlider",function(){return{template:'<div class="image-slider"><style type="text/css">.image-slider-wrapper{padding:10px;background:#f2f2f2}.slider-action li{display:inline-block;margin-right:5px}.slider-action a{color:#999}.slider-action img{width:13px;height:13px;margin-right:4px}.slider-main{margin:10px 0;background:#fff;padding:5px;text-align:center;overflow:hidden;-ms-user-select:none;user-select:none;-webkit-user-select:none;-moz-user-select:none}.slider-main.right{cursor:url(/img/pic_next.cur),auto}.slider-main.left{cursor:url(/img/pic_prev.cur),auto}.slider-all ul{display:block;padding:0 25px;white-space:nowrap;vertical-align:middle;overflow:hidden;width:100%;word-wrap:normal}.slider-all li{display:inline-block;position:relative;-moz-transition:all .3s;-o-transition:all .3s;transition:all .3s}.slider-all .slider-images{width:45px;height:45px;padding:2px;cursor:pointer;border:2px solid transparent}.slider-all .slider-images.active{border:2px solid #6baef8}.slider-all{position:relative;overflow:hidden}.slider-all .nav-btn{display:block;position:absolute;top:0;bottom:0;padding:15px 5px;color:#bfbfbf;border:1px solid #e5e5e5;vertical-align:middle;text-decoration:none;background:#F7F7F7;z-index:10}.slider-all .nav-btn.left{left:0}.slider-all .nav-btn.right{right:0}.slider-all .nav-btn.active{color:#fff;background:#FFAD8F}.prev-list{margin-top:-5px}.prev-list li{border:none;display:inline-block;margin-right:5px;margin-top:5px}.prev-list .s-img{width:80px;height:80px;cursor:pointer}</style><ul class="prev-list" ng-hide="show"><li ng-repeat="img in images track by $index"><ng-img c="{img:img}" class="s-img" ng-click="showBigPic($index)"></ng-img></li></ul><div ng-show="show" class="image-slider-wrapper"><div class="slider-action"><ul><li><a ng-click="show=false" href="javascript:;"><i class="fa fa-long-arrow-up"></i> 收起</a></li><li><a ng-href="{{images[currentImage]}}" target="_blank"><i class="fa fa-search-plus"></i> 查看大图</a></li><li><a ng-click="turnLeft()" href="javascript:;"><i class="fa fa-undo"></i> 向左旋转</a></li><li><a ng-click="turnRight()" href="javascript:;"><i class="fa fa-repeat"></i> 向右旋转</a></li></ul></div><div class="slider-main {{cursor}}" ng-click="nextOrPrev()" ng-mousemove="showCursor($event)"><img ng-src="{{images[currentImage]}}" alt="" ng-style="{\'max-width\': bigImgWidth, \'max-height\': 325, transform: \'rotate(\' + rotateDeg() + \'deg)\',\'-webkit-transform\': \'rotate(\' + rotateDeg() + \'deg)\', \'-ms-transform\': \'rotate(\' + rotateDeg() + \'deg)\', \'-moz-transform\': \'rotate(\' + rotateDeg() + \'deg)\', transition:\'all 0.2s\'}"></div><div class="slider-all"><a href="javascript:;" ng-class="{active: showToggle(\'left\')}" ng-click="toggleSlide(\'left\')" class="nav-btn left">&lt</a><ul style="width:{{imageListWidth}}px"><li ng-repeat="img in images track by $index" style="left:{{left}}px"><ng-img c="{img:img,divClass:{active: currentImage==$index}}" ng-click="switchImg($index)" alt="" class="slider-images"></ng-img></li></ul><a href="javascript:;" ng-class="{active: showToggle(\'right\')}" ng-click="toggleSlide(\'right\')" class="nav-btn right">&gt</a></div></div></div>',restrict:"E",scope:{images:"=",loop:"="},controller:["$scope","$element","$timeout",function(e,t,i){var n=['<style id="image-slider-style">',".image-slider-wrapper {","padding: 10px;","background: #f2f2f2;","}",".slider-action li {","display: inline-block;","margin-right: 5px;","}",".slider-action a {","color: #999999;","}",".slider-action img {","width: 13px;","height: 13px;","margin-right: 4px;","}",".slider-main {","margin: 10px 0;","background: #fff;","padding: 5px;","text-align: center;","overflow: hidden;","user-select: none;","-webkit-user-select: none;","-moz-user-select: none;","}",".slider-main.right {",'cursor: url("/rcp-common/imgs/icon/pic_next.png"), auto;',"}",".slider-main.left {",'cursor: url("/rcp-common/imgs/icon/pic_prev.png"), auto;',"}",".slider-all ul {","display: inline-block;","white-space: nowrap;","vertical-align: middle;","overflow: hidden;","}",".slider-all li {","display: inline-block;","position: relative;","transition: all 0.3s;","}",".slider-all .slider-images {","width: 45px;","height: 45px;","padding: 2px;","cursor: pointer;","border: 2px solid rgba(0,0,0,0);","}",".slider-all .slider-images.active {","border: 2px solid #6baef8;","}",".slider-all .nav-btn {","display: inline-block;","padding: 15px 5px;","color: #bfbfbf;","border: 1px solid #e5e5e5;","vertical-align: middle;","text-decoration: none;","background: #F7F7F7;","}",".slider-all .nav-btn.active {","color: #fff;","background: #FFAD8F;","}",".prev-list li {","border: none;","display: inline-block;","margin-right: 5px;","}",".prev-list .s-img {","width: 80px;","height: 80px;","cursor: pointer;","}","</style>"].join("");angular.element("#image-slider-style").length||angular.element("body").append(n),e.turnLeftCount=e.turnRightCount=0,e.imageListWidth=0,e.bigImgWidth=0,e.bigImgOffset={top:0,left:0},e.$watch("show",function(n){n&&(e.wrapperWidth=t.find(".image-slider").width(),e.bigImgWidth=e.wrapperWidth-20,e.imageListWidth=e.wrapperWidth-76,i(function(){e.bigImgOffset=t.find(".slider-main").offset()},100))}),e.showBigPic=function(t){e.show=!0,e.switchImg(t)},e.switchImg=function(t){e.currentImage=t,e.turnLeftCount=e.turnRightCount=0},e.showCursor=function(t){if(e.images){if(e.images.length<2)return void(e.cursor="");var i=t.pageX-e.bigImgOffset.left;i>e.bigImgWidth/2?e.loop||e.currentImage<e.images.length-1?e.cursor="right":e.cursor="":e.loop||e.currentImage>0?e.cursor="left":e.cursor=""}},e.nextOrPrev=function(){e.images&&("left"===e.cursor?e.loop&&0===e.currentImage?e.switchImg(e.images.length-1):e.switchImg(e.currentImage-1):"right"===e.cursor&&(e.loop&&e.currentImage===e.images.length-1?e.switchImg(0):e.switchImg(e.currentImage+1)))},e.turnLeft=function(){e.turnLeftCount=e.turnLeftCount+1},e.turnRight=function(){e.turnRightCount=e.turnRightCount+1},e.rotateDeg=function(){return 90*(e.turnRightCount-e.turnLeftCount)},e.left=0,e.showToggle=function(t){if(e.images){var i=58;return"right"===t?i*e.images.length+e.left>e.imageListWidth:"left"===t?e.left<0:void 0}},e.toggleSlide=function(t){"right"===t&&e.showToggle(t)?e.left=e.left-e.imageListWidth:"left"===t&&e.showToggle(t)&&(e.left=e.left+e.imageListWidth)}}]}}),module.directive("pagination",function(){return{template:'<div class="page-bar" ng-show="list.length>0"><a href="javascript:;" ng-class="current<=0?\'disabled\':\'\'" ng-click="prev()"><em class="emic">&lt;</em><em class="emf">上一页</em></a><a href="javascript:;" ng-repeat="key in keyList" ng-class="key==current ? \'cur\' : \'\'" ng-click="jump(key)">{{key+1}}</a><span ng-show="pLen>pMax && !hideEllipsis">...</span><a href="javascript:;" ng-class="current>=pLen-1?\'disabled\':\'\'" ng-click="next()"><em class="emf">下一页</em><em class="emic">&gt;</em></a><span class="jump-bar"><span>共<font class="blue-c">{{pLen}}</font>页</span><span>跳到 <input type="text" style="width:38px;height:19px;text-align:center;" ng-model="goKey"> 页</span><a href="" ng-click="go(goKey)">GO</a></span></div>',restrict:"E",replace:!0,transclude:!0,scope:{list:"=list",pagefn:"=pagefn",pageargs:"=pageargs",deepwatch:"="},controller:["$scope","$element","$attrs","service",function(e,t,i,n){e.$watch("pageargs",function(t,i){t&&(e.current=parseInt(e.pageargs.pn)-1,e.pageNode=e.current,e.pNum=parseInt(e.pageargs.ps),e.pMax=parseInt(e.pageargs.pl)||5,e.pagefn(e.pageargs,function(t){e.pLen=Math.ceil(parseInt(t.pa.total)/e.pNum),e.keyListWatch()}))},e.deepwatch),e.reKeyList=function(t,i,n){e.keyList=[];for(var a=t;i>a&&!(a>=n);a++)e.hideEllipsis=a+1==e.pLen,e.keyList.push(a)},e.keyListWatch=function(){var t=e.pLen;if(t>e.pMax){var i=Math.ceil(e.pMax/2),n=e.current;n>=i&&n<t-(e.pMax-i)?e.reKeyList(n-(e.pMax-i),n+i,t):n>=t-(e.pMax-i)?e.reKeyList(t-e.pMax,t,t):i>=n&&e.reKeyList(0,t,e.pMax)}else e.reKeyList(0,t,e.pMax)},e.jump=function(t){e.pageNode!=t&&(e.current=t,e.pageNode=t,e.pageargs.pn=t+1,e.pagefn(e.pageargs,function(t){e.pLen=Math.ceil(parseInt(t.pa.total)/e.pNum),e.keyListWatch()}))},e.next=function(){e.current++,e.current>=e.pLen&&(e.current=e.pLen-1),e.jump(e.current)},e.prev=function(){e.current--,e.current<=0&&(e.current=0),e.jump(e.current)},e.go=function(t){var i=/^-?\d+$/g;void 0==t||t.length<=0?n.dialog.alert("输入不能为空！",{}):i.test(t)?(parseInt(t)>e.pLen?(t=e.pLen,n.dialog.alert("总共只有"+e.pLen+"页，为您转到最后一页！",{})):parseInt(t)<=0&&(t=1,n.dialog.alert("不能低于第1页,为您转到最前一页！",{})),e.jump(parseInt(t)-1),e.goKey=void 0):t.match(/\s+/g)?n.dialog.alert("输入不能有空格符！",{}):n.dialog.alert("格式错误，请输入整数！",{})}}]}}),angular.module("RCP").factory("dynamicService",function(){var e={emotions:"表情服务"};return function(){function t(){this._hash=new Object,this.put=function(e,t){return"undefined"!=typeof e&&0==this.containsKey(e)?(this._hash[e]="undefined"==typeof t?null:t,!0):!1},this.remove=function(e){delete this._hash[e]},this.size=function(){var e=0;for(var t in this._hash)e++;return e},this.get=function(e){return this._hash[e]},this.containsKey=function(e){return"undefined"!=typeof this._hash[e]},this.clear=function(){for(var e in this._hash)delete this._hash[e]}}var i=!0,n=new Array,a=new Array,r=new t,o="1362404091";$.ajax({dataType:"jsonp",url:"https://api.weibo.com/2/emotions.json?source="+o,success:function(e){switch(e.code){case 1:for(var t=e.data,o=0;o<t.length;o++)""==t[o].category&&(t[o].category="默认"),
void 0==n[t[o].category]&&(n[t[o].category]=new Array,a.push(t[o].category)),n[t[o].category].push({name:t[o].phrase,icon:t[o].icon}),r.put(t[o].phrase,t[o].icon);i=!1,l&&l.ready();break;default:jf.alert(e.data.error)}},error:function(){jf.alert("表情数据请求失败")}});var c,s,l,d,u,p,f,g="#emotions",h="#emotions .container",m="#emotions .container a",v="#emotions .categorys",y="#emotions .categorys a",w="#emotions .prev",b="#emotions .next",x="#emotions .page",k="#emotions .page a";e.emotions={emotions:n,categorys:a,uSinaEmotionsHt:r,viewLocate:function(){var e,t=$(d).offset().top+$(d).outerHeight(!0),i=$(d).offset().left+$(d).width()/2-29,n=$(window).width(),a=$(document).height(),r=$(d).outerWidth(!0),o=$(g).outerWidth(!0),c=$(d).outerHeight(!0),s=$(g).outerHeight(!0),l=$(g).outerHeight(!0)/2+$(d).outerHeight(!0)/2,u=s>a-t,p=s>t-c,f=i+o>n,h=o>i,m=function(){f&&(u=l>a-t,p=l>t-c),i-=o+10,e=!u&&p?"r r1":u&&!p?"r r3":"r r2",t-=!u&&p?30:u&&!p?s:l},v=function(){e="l",i+=r,t-=l},y=function(){e="b",t-=s+c};u&&p?h?v():m():f?m():u&&y(),$(g).find(".ag-ic").addClass(e),$(g).css({top:t,left:i})},show:function(e,t){return $(document).unbind("click").bind("click",function(){$(g).remove()}),l=this,d=e.target,p=$(e.dyeditor).get(0),f=t,$(g).length?(u==d?$(g).remove():l.viewLocate(),void(u=d)):(u=d,$("body").append('<div id="emotions"></div>'),$(g).html('<span class="ag-ic"><i></i><em></em></span><div>正在加载，请稍候...</div>'),$(g).click(function(e){e.stopPropagation()}),$(g).find(".ag-ic").click(function(){$(g).remove()}),l.ready(),void l.viewLocate())},ready:function(){!i&&$(g).length&&($(g).html('<span class="ag-ic"><i></i><em></em></span><div style="float:right"><a href="javascript:void(0);" class="prev">&laquo;</a><a href="javascript:void(0);" class="next">&raquo;</a></div><div class="categorys"></div><div class="container"></div><div class="page"></div>'),$(g).find(".ag-ic").click(function(){$(g).remove()}),$(w).click(function(){l.showCategorys(s-1)}),$(b).click(function(){l.showCategorys(s+1)}),l.showCategorys(),l.showEmotions(),l.viewLocate())},showCategorys:function(){var e=arguments[0]?arguments[0]:0;if(!(0>e||e>=a.length/5)){$(v).html(""),s=e;for(var t=5*e;5*(e+1)>t&&t<a.length;++t)$(v).append($('<a href="javascript:void(0);">'+a[t]+"</a>"));$(y).click(function(){l.showEmotions($(this).text())}),$(y).each(function(){$(this).text()==c&&$(this).addClass("current")})}},showEmotions:function(){var e=arguments[0]?arguments[0]:"默认",t=arguments[1]?arguments[1]-1:0;$(h).html(""),$(x).html(""),c=e;for(var i=72*t;72*(t+1)>i&&i<n[e].length;++i)$(h).append($('<a href="javascript:void(0);" title="'+n[e][i].name+'"><img src="'+n[e][i].icon+'" alt="'+n[e][i].name+'" width="22" height="22" /></a>'));$(m).click(function(){l.insertText($(this).attr("title")),$(g).remove()});for(var i=1;i<n[e].length/72+1;++i)$(x).append($('<a href="javascript:void(0);"'+(i==t+1?' class="current"':"")+">"+i+"</a>"));$(k).click(function(){l.showEmotions(e,$(this).text())}),$(y+".current").removeClass("current"),$(y).each(function(){$(this).text()==e&&$(this).addClass("current")}),$(g).css({minHeight:254})},insertText:function(e){l.inCursorInsertAtCaret(l.AnalyticEmotion(e),p),f&&f($(p).html())},inCursorInsertAtCaret:function(e,t){var i,n;if(window.getSelection&&window.getSelection().getRangeAt){var a=window.getSelection(),r=a.focusNode;r&&(a=a.getRangeAt(0)),$(t).focus(),i=window.getSelection(),n=i.getRangeAt(0),n.startOffset==n.endOffset?r&&a.startContainer==n.startContainer||(n.selectNodeContents(t),n.setStart(n.endContainer,n.endOffset),n.setEnd(n.endContainer,n.endOffset)):n.deleteContents();var o=document.createElement("div");o.innerHTML=e;for(var c,s,l=document.createDocumentFragment();c=o.firstChild;)s=l.appendChild(c);n.insertNode(l,s),s&&(n=n.cloneRange(),n.setStartAfter(s),n.collapse(!0),i.removeAllRanges(),i.addRange(n))}else document.selection&&document.selection.createRange&&($(t).focus(),document.selection.createRange().pasteHTML(e))},AnalyticEmotion:function(e){if("undefined"!=typeof e){var t=e.match(/\[.*?\]/g);if(t)for(var i=0;i<t.length;i++)if(r.containsKey(t[i])){var n='<img src="'+r.get(t[i])+'" height="22" width="22" />';e=e.replace(t[i],n)}}return e}}}(),e}).directive("addface",function(){return{restrict:"A",scope:{data:"=addface"},controller:["$scope","$element","$timeout","dynamicService",function(e,t,i,n){t.on({click:function(i){n.emotions.show({dyeditor:t.attr("bindeditor"),target:t.get(0)},function(t){e.data=t}),i.stopPropagation()}})}]}}).directive("dyeditor",function(){return{template:'<div class="dyeditor-w"><div class="stint-chac"><span style="color:#9c9c9c;" ng-hide="exceed">还可以输入<b style="font-family:Georgia,Times New Roman,Times, serif;font-size:21px;">{{surplus}}</b>字</span><span style="color:#ff0000;" ng-show="exceed">已超出<b style="font-family:Georgia,Times New Roman,Times, serif;font-size:21px;">{{exceed}}</b>字</span></div><div class="placeholder" ng-hide="model">{{config.placeholder}}</div><div class="contenteditable" contenteditable="true" id="{{config.id}}" ng-style="config.style" ng-focus="onfocus()" ng-blur="onblur()" ng-click="change()"></div></div>',restrict:"E",replace:!0,transclude:!0,scope:{model:"=model",exceed:"=exceed",config:"=config"},controller:["$scope","$element","$attrs","$timeout",function(e,t,i,n){function a(){$(r).html()!==o&&(o=$(r).html(),r.click()),setTimeout(a)}var r=t.find(".contenteditable").get(0);e.surplus=e.config.len,e.checkLen=function(t){if(e.config.len){var i=$(t).text(),n=2*parseInt(e.config.len),a=0;i&&(a=parseInt(i.length)),e.exceed=a>n?Math.ceil((a-n)/2):0,e.surplus=i&&a>n?0:i?parseInt((n-a)/2):parseInt(e.config.len)}},e.change=function(t){e.model=void 0!==t?t:$(r).html(),e.config.len&&e.checkLen(r)},e.onfocus=function(){e.config.len&&t.find(".stint-chac").show(),e.focus=!0},e.onblur=function(){t.find(".stint-chac").css({display:e.exceed?"block":"none"}),e.focus=!1},e.$watch("model",function(i,n){void 0!==typeof i&&i!==$(r).html()&&($(r).html(i),e.config.len&&e.checkLen(r),t.find(".stint-chac").css({display:e.exceed?"block":"none"}))});var o=$(r).html();a()}]}}).filter("filterDynamicHtml",["$sce","dynamicService",function(e,t){return function(i){return e.trustAsHtml(t.emotions.AnalyticEmotion(i))}}]).filter("bindHtml",["$sce",function(e){return function(t){return e.trustAsHtml(t)}}]),module.directive("editTextarea",function(){return{template:'<div class="textarea-w"><div class="stint-chac">还可以输入<b style="font-family:Georgia,Times New Roman,Times, serif;font-size:21px;">{{len}}</b>字</div><textarea class="textarea" ng-model="model" placeholder="{{myplaceholder}}" ng-style="mystyle" ng-show="!cfg.input"></textarea><input class="textarea" ng-model="model" placeholder="{{myplaceholder}}" ng-style="mystyle" ng-show="cfg.input" /></div>',restrict:"E",replace:!0,transclude:!0,scope:{len:"=len",model:"=model",mystyle:"=mystyle",myplaceholder:"=myplaceholder",config:"=config"},controller:["$rootScope","$scope","$element","$attrs","$timeout",function(e,t,i,n,a){t.cfg=t.config||{},t.initHeight=t.mystyle&&"height"in t.mystyle?t.mystyle.height:"",t.check=function(e){if(t.cfg.input||(!t.mystyle||t.mystyle&&"auto"!==t.mystyle.overflow)&&($(e).css("height",t.initHeight),e.scrollHeight>$(e).outerHeight(!0)&&$(e).css("height",e.scrollHeight-10)),t.len){var n=$(e).val(),a=2*parseInt(t.len);if(n){var r=parseInt(n._getLen());r>a&&$(e).val(n._limitLen(a,""))}i.find("b").html(n&&r>a?"0":n?parseInt((a-r)/2):parseInt(t.len))}},i.find(".textarea").on({keyup:function(){t.check(this)},focus:function(){t.len&&i.find(".stint-chac").show(),t.check(this)},blur:function(){t.blurVal=$(this).val(),i.find(".stint-chac").hide(),t.myWatch()}}),t.myWatch=function(){i.find(".textarea").val()!==t.blurVal?t.check(i.find(".textarea")):a(t.myWatch)}}]}}),module.directive("datetime",function(){return{template:'<span ng-style="style"><input type="text" ng-class="config.class" ng-model="value" placeholder="{{config.placeholder}}" ng-click="toggle($event)" readonly /></span>',restrict:"E",replace:!0,transclude:!0,scope:{value:"=value",startdate:"=startdate",enddate:"=enddate",config:"=config"},controller:["$scope","$element","$document","$compile","$interval","datetimeService",function(e,t,i,n,a,r){e.style={position:"relative",display:"inline-block",cursor:"default"},e.config.noInput&&(e.style.display="none"),e.toggle=function(o){return r.tpl&&(i.unbind("click"),r.tpl.remove(),r.tag===t)?(delete r.tpl,void a.cancel(r.clockTimer)):(r.tag=t,r.tpl=n('<datetime-tpl value="value" config="config"></datetime-tpl>')(e),e.config.noInput?e.config.targetElement.append(r.tpl):t.append(r.tpl),i.bind("click",e.toggle),void o.stopPropagation())},r.toggle=e.toggle}]}}),module.directive("datetimeTpl",function(){return{template:["<div ng-class=\"timeFlag ? 'datetime-w and-time-style' : 'datetime-w'\" ng-click=\"stopPropagation($event)\">",'<div style="cursor:default">','<em class="arrow-ic"></em>','<div class="show-time-box">','<div class="now-time">',"<p>当前时间</p>","<span>{{clockString}}</span>","</div>",'<div style="padding: 15px 0px;">',"<select ",'class="hour" ','ng-options="item.str for item in hourList" ','ng-model="repeatData.hour" ','ng-change="change({hour: repeatData.hour})"></select>',"</div>","<div>","<select ",'class="minute" ','ng-options="item.str for item in minuteList" ','ng-model="repeatData.minute" ','ng-change="change({minute: repeatData.minute})"></select>',"</div>","</div>",'<div class="show-date-box">','<div class="t">','<a href="javascript:;" class="p" title="上一月" ng-click="mBefore()"></a>','<a href="javascript:;" class="n" title="下一月" ng-click="mAfter()"></a>',"<select ",'class="y" ','ng-options="item.str for item in yearList" ','ng-model="repeatData.year" ','ng-change="change({year: repeatData.year})"></select>',"<select ",'class="m" ','ng-options="item.str for item in monthList" ','ng-model="repeatData.month" ','ng-change="change({month: repeatData.month})"></select>','<div class="w">',"<h4>一</h4>","<h4>二</h4>","<h4>三</h4>","<h4>四</h4>","<h4>五</h4>","<h4>六</h4>","<h4>日</h4>","</div>","</div>",'<div class="c">','<a ng-repeat="item in dayList" ng-class="item.class" ng-click="change({day: item})">{{item.val}}</a>',"</div>",'<div class="f">','<a href="javascript:;" class="clear" ng-click="clearValue()">清空</a>','<a href="javascript:;" class="today" ng-click="today()">今日</a>','<a href="javascript:;" class="cancel" ng-click="cancel()">取消</a>',"</div>","</div>","</div>","</div>"].join(""),restrict:"E",replace:!0,transclude:!0,scope:{value:"=value",config:"=config"},controller:["$scope","$element","$timeout","$interval","$document","datetimeService",function(e,t,i,n,a,r){function o(e,t){for(var i=e+"";i.length<t;)i="0"+i;return i}function c(t,i,n,a,r){for(var c=[];i>t;){var s={val:t,str:o("month"===a[0]?t+1:t,n)+(r||"")};c.push(s),s.val===a[1]&&(e.repeatData[a[0]]=s),t+=1}return c}function s(t,i,n){var a=new Date,r=a.getFullYear(),o=a.getMonth(),c=a.getDate(),s=e.newDate.getFullYear(),l=e.newDate.getMonth(),d=e.newDate.getDate(),u="d ",p=function(e){e&&(u+="d-able "),t===s&&i===l&&n===d&&(u+=e?"d-now ":"d-disabled ")};return p(e.expiredFlag?r>t||t===r&&o>i||t===r&&i===o&&c>=n:e.realFlag?t>r||t===r&&i>o||t===r&&i===o&&n>=c:!0),u}function l(e){return e%4===0&&e%100!==0||e%400===0}function d(e,t){return 1===t||3===t||5===t||7===t||8===t||10===t||12===t?31:4===t||6===t||9===t||11===t?30:2===t&&l(e)?29:28}function u(e,t){var i={"M+":e.getMonth()+1,"d+":e.getDate(),"h+":e.getHours(),"m+":e.getMinutes(),"s+":e.getSeconds(),"q+":Math.floor((e.getMonth()+3)/3),S:e.getMilliseconds()};/(y+)/.test(t)&&(t=t.replace(RegExp.$1,(e.getFullYear()+"").substr(4-RegExp.$1.length)));for(var n in i)new RegExp("("+n+")").test(t)&&(t=t.replace(RegExp.$1,1===RegExp.$1.length?i[n]:("00"+i[n]).substr((""+i[n]).length)));return t}e.oldDate=new Date,e.newDate=new Date,e.curDate=new Date,e.repeatData={},e.expiredFlag=e.config.style.match("expired"),e.realFlag=e.config.style.match("real"),e.timeFlag=e.config.style.match("time"),e.formatType=e.timeFlag?"yyyy-MM-dd hh:mm":"yyyy-MM-dd",e.setSelect=function(t,i,n,a){e.yearList=c(1901,t+100,4,["year",t],"年"),e.monthList=c(0,12,2,["month",i],"月"),e.hourList=c(0,24,2,["hour",n],"点"),e.minuteList=c(0,60,2,["minute",a],"分")},e.setDay=function(t,i,n){e.dayList=function(){for(var a=[],r=0,o=new Date(t+"-"+(i+1)+"-1"),c=o.getDay()?o.getDay():7,l=d(t,i+1);42>r;){var u=r>=c-1&&l+(c-1)>r?r-(c-2):"",p=u?s(t,i,u):"d",f={val:u,"class":p};a.push(f),f.val===n&&(e.repeatData.day=f),r+=1}return a}()},e.mBefore=function(){var t=e.curDate.getMonth()-1;0>t&&(e.curDate.setFullYear(e.curDate.getFullYear()-1),t=11),e.curDate.setMonth(t),e.reset()},e.mAfter=function(){var t=e.curDate.getMonth()+1;t>11&&(e.curDate.setFullYear(e.curDate.getFullYear()+1),t=0),e.curDate.setMonth(t),e.reset()},e.change=function(i){angular.forEach(i,function(i,a){switch(a){case"year":e.curDate.setFullYear(i.val),e.reset();break;case"month":e.curDate.setMonth(i.val),e.reset();break;case"day":i["class"].match(/d-able|d-now/)&&(e.curDate.setDate(i.val),e.setValue(e.curDate),e.timeFlag?e.reset():(t.remove(),n.cancel(r.clockTimer)));break;case"hour":e.curDate.setHours(i.val),e.initValue&&(e.setValue(e.curDate),e.reset());break;case"minute":e.curDate.setMinutes(i.val),e.initValue&&(e.setValue(e.curDate),e.reset())}})},e.clear=function(i,a,o){var c=i||new Date;e.setData(e.newDate,c),e.setData(e.curDate,c),e.value=a||"",e.reset(),o||(t.remove(),n.cancel(r.clockTimer))},e.clearValue=function(){e.clear(),"function"==typeof r.onClear&&r.onClear()},e.today=function(){var t=new Date;e.clear(t,u(t,e.formatType))},e.cancel=function(){e.initValue?(e.setValue(e.oldDate),e.reset()):e.clear(),t.remove(),n.cancel(r.clockTimer)},e.stopPropagation=function(e){e.stopPropagation()},e.setData=function(e,t){e.setFullYear(t.getFullYear()),e.setMonth(t.getMonth()),e.setDate(t.getDate()),e.setHours(t.getHours()),e.setMinutes(t.getMinutes())},e.setValue=function(t){e.setData(e.newDate,t),e.setData(e.curDate,t),e.value=u(e.newDate,e.formatType)},e.reset=function(){var t=e.curDate.getFullYear(),i=e.curDate.getMonth(),n=e.curDate.getDate(),a=e.curDate.getHours(),r=e.curDate.getMinutes();e.setSelect(t,i,a,r),e.setDay(t,i,n)},e.clock=function(){var t=new Date;e.clockString=o(t.getHours(),2)+":"+o(t.getMinutes(),2)+":"+o(t.getSeconds(),2)},e.locate=function(){var i=angular.element(window).width(),n=angular.element(window).height(),a=t.width(),r=t.height(),o=t.prev().height(),c=t.parent().offset().top-angular.element(window).scrollTop(),s=n-(c+o),l=t.parent().offset().left,d=i-(l+a),u=0,p=0,f=function(e,t,i,n){return t+i>n&&(e=n-(t+i+10),-t>e&&(e=-t)),e},g=function(n){p=f(p,l,a,i),t.addClass(n).css({left:p}),e.config.position?(t.css({bottom:30}),t.find(".arrow-ic").css({left:20})):t.find(".arrow-ic").css({left:-p+20})},h=function(e){u=f(u,c,r,n),t.addClass(e).css({top:u}),t.find(".arrow-ic").css({top:-u+o/2})},m=function(e){l+a>i&&l>a?h("dtt-w-l-sty"):a/2>l&&d>a?h("dtt-w-r-sty"):g(e)},v=function(e){h(e)};if(e.config.position)switch(p=-(28-e.config.targetElement.width()/2),e.config.position){case"top":m("dtt-w-t-sty");break;case"bottom":m("dtt-w-b-sty");break;case"left":v("dtt-w-l-sty");break;case"right":v("dtt-w-r-sty")}else s>=r?m("dtt-w-b-sty"):c>=r?m("dtt-w-t-sty"):v(l>d?"dtt-w-l-sty":"dtt-w-r-sty")},e.run=function(){e.initValue=e.value;var t=e.value?new Date(e.value.replace(/-|\./g,"/")):new Date;if(!angular.isDate(t))return void console.error("oldDate is not Date Object");e.value?(e.setData(e.oldDate,t),e.clear(t,u(t,e.formatType),"init")):e.clear(t,"","init");var a=e.oldDate.getFullYear(),o=e.oldDate.getMonth(),c=e.oldDate.getDate(),s=e.oldDate.getHours(),l=e.oldDate.getMinutes();e.setSelect(a,o,s,l),e.setDay(a,o,c),i(e.locate,80),e.timeFlag&&(e.clock(),n.cancel(r.clockTimer),r.clockTimer=n(e.clock,1e3))},e.run()}]}}),module.factory("datetimeService",function(){return{}}),!module)var module=angular.module("RCP",[]);if(module.directive("emptyTip",function(){return{template:'<div class="empty-tip" ng-style="boxStyle"><style type="text/css">.empty-tip{text-align:center;padding:30px 0}.empty-tip .msg{padding:10px 0 0;color:#999}.empty-tip .img{width:100%}</style><div ng-show="theme==1"><img src="/rcp-common/imgs/common/no-data.png" class="img" ng-style="imgStyle"></div><div ng-show="!theme"><img src="/rcp-common/imgs/common/icon-cloud.png" ng-style="imgStyle"></div><div ng-show="!theme" class="msg"><span ng-hide="showLogin">{{msg}}</span> <a href="" style="color:#00f" ng-show="showLogin">请先登录</a></div></div>',restrict:"E",replace:!0,transclude:!0,scope:{c:"="},controller:["$scope","service",function(e,t){e.msg="暂无数据",e.c&&angular.forEach(e.c,function(t,i){e[i]=t}),"请先登录"===e.msg&&(e.showLogin=!0,e.dialog=function(e){t.dialog.alert(e)})}]}}),module.factory("studyCircle",["request",function(e){var t=DYCONFIG.studyCircle.rUrl||"/";return{sendCircle:function(i,n){i.token=rcpAid.getToken();var a={method:"POST",url:t+"usr/api/createDiscuss",params:i};return e(angular.extend(a,n||{}))},getCircleList:function(i,n){i.token=rcpAid.getToken();var a={method:"POST",url:t+"pub/api/searchDiscuss",params:i};return e(angular.extend(a,n||{}))},getCircleDetail:function(i,n){i.token=rcpAid.getToken();var a={method:"GET",url:t+"pub/api/getCDetail",params:i};return e(angular.extend(a,n||{}))},setReadCount:function(i,n){i.token=rcpAid.getToken();var a={method:"GET",url:t+"pub/api/statRead",params:i};return e(angular.extend(a,n||{}))},getPersonDiscuss:function(i,n){i.token=rcpAid.getToken();var a={method:"GET",url:t+"pub/api/personDiscuss",params:i};return e(angular.extend(a,n||{}))},removeDiscuss:function(i,n){i.token=rcpAid.getToken();var a={method:"GET",url:t+"usr/api/delDiscuss",params:i};return e(angular.extend(a,n||{}))},getPersonReply:function(i,n){i.token=rcpAid.getToken();var a={method:"GET",url:t+"pub/api/personReply",params:i};return e(angular.extend(a,n||{}))}}}]),module.run(["service","studyCircle",function(e,t){e.expand("studyCircle",function(){return t})}]),!module)var module=angular.module("RCP",[]);module.filter("sanitize",["$sce",function(e){return function(t){return e.trustAsHtml(t)}}]),module.directive("studyCircleLearn",function(){return{template:'<div class="study-circle"><style type="text/css">@charset "UTF-8";.study-circle,.study-circle div{position:relative}.c{cursor:pointer}.mg-t30{margin-top:30px}.study-circle{padding-bottom:10px}.study-circle .load-0,.study-circle .load-1{width:100%;padding:20px 0 0;z-index:10;left:0}.study-circle .color-yeallow{color:#fe8811}.study-circle .load-0{position:absolute;top:115px}.study-circle .load-1{position:relative;bottom:10px}.study-circle hr{border:0;background-color:#ececec;height:1px}.study-circle button{font-size:14px;padding:6px 20px;border-radius:10px;border:none;cursor:pointer}.study-circle .study-circle-w{padding:10px 30px 0;border-bottom:1px solid #d7d7d7;width:0;background-color:#fff}.study-circle .study-circle-r{height:auto;top:0;left:0;overflow-y:auto;overflow-x:hidden}.study-circle .title{font-size:18px;color:#414141;height:30px;line-height:30px}.study-circle .content{color:#a0a0a0;margin:20px 0}.study-circle .placeholder{padding:14px}.study-circle .write{border:1px solid #ececec}.study-circle .write>div:nth-child(1){padding:6px;border:0}.study-circle .write>div:nth-child(1) .stint-chac{border-top:1px solid #ececec;border-left:1px solid #ececec;border-right:1px solid #ececec}.study-circle .write .up-img{margin-bottom:-10px;padding-bottom:18px;height:45px;width:100%;white-space:nowrap;overflow-x:auto;overflow-y:hidden;border-top:1px solid #ececec}.study-circle .write .up-img div{display:inline-block;position:relative}.study-circle .write .up-img div>i{display:none;position:absolute;top:-12px;right:-10px;color:#e86868}.study-circle .write .up-img div:hover>i{display:inline-block}.study-circle .write .up-img .img{width:50px;height:50px;margin-left:3px}.study-circle .write textarea{height:110px;border:none;width:100%;background:0 0}.study-circle .write i{margin:10px;font-size:20px;color:#a0a0a0}.study-circle .write .dyeditor-w{border:0 solid #ececec}.study-circle .write-reply{padding:5px}.study-circle .write-reply>div:nth-child(1){padding-bottom:30px}.study-circle .select-0{height:32px;margin:15px 0}.study-circle .select-0 label{line-height:32px;margin-right:15px;font-size:14px}.study-circle .select-0 button{float:right;background:#02c0b9;color:#fff;border-radius:20px}.study-circle .select-0 button:active{background:#02aca6}.study-circle .select-0 .section{line-height:32px;margin-left:-15px;width:150px}.study-circle .user-info-1{float:left;padding-right:20px;display:inline-block;width:50px;text-align:center;color:#0095CE}.study-circle .user-info-1 .img-circle{border-radius:50px}.study-circle .user-info-1 .img{width:50px;height:50px}.study-circle .other-circle{border-top:1px solid #d7d7d7;padding-top:15px;margin:-1px 30px 15px}.study-circle .other-circle .user-name{float:left}.study-circle .other-circle .user-name>div{margin:5px 0}.study-circle .other-circle .user-name>div:last-child{color:#a0a0a0}.study-circle .other-circle .content{line-height:20px}.study-circle .other-circle .content>div{margin-bottom:15px}.study-circle .other-circle .dz{cursor:pointer;float:right}.study-circle .other-circle .dz i{font-size:18px}.study-circle .other-circle .l-reply{background-color:#e5e5e5;margin-top:20px;position:relative;padding:15px;border-radius:4px}.study-circle .other-circle .l-reply .write{position:relative;background-color:#fff}.study-circle .other-circle .l-reply .write button{background-color:#fff;position:absolute;bottom:0;right:0;color:#959595}.study-circle .other-circle .l-reply textarea{height:80px;border:none;width:100%}.study-circle .other-circle .l-reply:before{position:absolute;z-index:-1;content:\'\';background:#e5e5e5;border-radius:4px;top:-6px;left:12px;height:20px;width:20px;-webkit-transform:rotate(45deg);-moz-transform:rotate(45deg);-ms-transform:rotate(45deg);-o-transform:rotate(45deg);transform:rotate(45deg)}.study-circle .other-circle .l-reply .write-reply-h{height:25px}.study-circle .other-circle .pl>div{margin-top:10px}.study-circle .other-circle .all-r{text-align:center;color:#a0a0a0}.study-circle .other-circle .line{height:1px;border-top:1px solid #d7d7d7;margin:10px 0}.study-circle .to-top{display:none;position:absolute;bottom:25px;right:25px;width:30px;height:30px;background-color:#a3a3a3}.study-circle .to-top i{position:absolute;color:#fff;top:50%;left:50%;-webkit-transform:translate(-50%,-50%);-moz-transform:translate(-50%,-50%);-ms-transform:translate(-50%,-50%);-o-transform:translate(-50%,-50%);transform:translate(-50%,-50%);font-size:18px;cursor:pointer}@media screen and (max-width:1240px){.study-circle .other-circle{margin-left:15px;margin-right:15px}.study-circle .study-circle-w{padding-right:24px;padding-left:24px}}</style><div class="study-circle-r" id="study-circle-r"><div class="study-circle-w"><loader-ui show="!load.sendCircle" class="load-0"></loader-ui><div class="title"><span>圈子</span></div><div class="write mg-t20"><dyeditor style="border-color:#d9d9d9" model="circle.content" exceed="circle.exceed" config="{id:\'dynamic-dyeditor\',len:120,style:{minHeight:80,overflow:\'auto\',padding:\'10px\'},placeholder:\'欢迎使用圈子，圈子是大家共同学习的社区，您可以在这里提问，写心得笔记，与朋友分享学习乐趣！！\'}"></dyeditor><div ng-show="uploadData.img.length" class="up-img"><div ng-repeat="img in uploadData.img track by $index"><ng-img c="{img:img}" class="img"></ng-img><i class="fa fa-times" aria-hidden="true" ng-click="delImg($index)"></i></div></div><div><a href="javascript:;" addface="circle.content" bindeditor="#dynamic-dyeditor"><i class="fa fa-smile-o"></i></a> <a href="javascript:;" ng-click="uploader()"><i class="fa fa-picture-o"></i></a><upload-img upload="uploadData" select-file="uploadImgSelect" class="swf-up-35"></upload-img></div></div><div class="select-0"><label for="c-check" class="f-l"><input type="checkbox" id="c-check" ng-model="circle.isSecret" ng-true-value="0" ng-false-value="1"> 私密</label><button ng-click="sendCircle()">发布</button><div class="clear"></div></div></div><div class="other-circle" ng-repeat="c in circleList"><div><div class="user-info-1"><ng-img c="{img:usrList[c.root.ownerId].attrs.basic.avatar,divClass:\'img\'}" class="img"></ng-img></div><div class="user-name"><div ng-bind="usrList[c.root.ownerId].attrs.basic.nickName"></div><div ng-bind="c.root.createTime| date:\'yyyy-MM-dd HH:mm:ss\'">2015-11-11 11:11:11</div></div><div class="clear"></div></div><div class="content"><div ng-bind-html="c.root.content | sanitize"></div><image-slider images="c.root.files.IMG"></image-slider></div><div><div class="f-l c" ng-click="c.root.edit=!c.root.edit;">评论（<span ng-bind="c.root.count.replyCount">0</span>）</div><div class="dz" ng-click="sendLike(c)"><i class="fa fa-thumbs-o-up" ng-class="{\'color-yeallow\':c.root.isLiked}"></i> <span ng-bind="c.root.count.likeCount">0</span></div><div class="clear"></div></div><div class="l-reply" ng-show="c.root.count.replyCount>0||c.root.edit"><div></div><div class="write write-reply" ng-show="c.root.edit"><div class="pd-b30"><textarea name="" id="" ng-model="c.root.replyContent" placeholder="请输入内容"></textarea></div><button type="button" ng-click="sendReply(c)">发布</button></div><div class="pl"><div ng-show="re.ownerId" ng-repeat="re in c.replys track by $index"><span ng-bind="usrList[re.ownerId].attrs.basic.nickName+\'：\'"></span> <span ng-bind-html="re.content | sanitize"></span></div></div><div class="line" ng-show="c.root.count.replyCount>2"></div><div class="all-r" ng-show="c.root.count.replyCount>2"><a ng-href="{{toDetail(c)}}" target="_blank">查看全部<span ng-bind="c.root.count.replyCount"></span>条回复</a></div></div></div><loader-ui show="!load.getCircleList" class="load-1"></loader-ui></div><div class="to-top" ng-click="toTop()"><i class="fa fa-arrow-up" aria-hidden="true"></i></div></div>',restrict:"E",replace:!0,transclude:!0,scope:{c:"="},controller:["$scope","$timeout","$http","service","$rootScope","cvfa",function(e,t,i,n,a,r){try{e.category="10",e.pOwnerType="10",e.courseId="",e.nowSection={},e.ownerType="10";var o=$(".study-circle .to-top"),c={pn:1,ps:4,all:5,load:!0};e.scrollFunc=function(){var t=$(this),i=t.height(),n=t.get(0).scrollHeight,a=t.scrollTop();a/(n-i)>=.95&&c.load&&(console.log("加载第"+c.pn+1,i,n,a,a/(n-i)),c.load=!1,e.getCircleList(c.pn+1)),a>10?o.show():o.hide()},$(".study-circle-r").on("scroll",e.scrollFunc),e.init=function(){e.c?angular.forEach(e.c,function(t,i){e[i]=t}):console.log("无配置文件！"),e.$on("actionAatId",function(t,i){angular.forEach(r.cat.items,function(t,n){t.id==i&&(e.nowSection=t)})}),e.circle={content:"",exceed:"",isSecret:1,nowSection:""},e.usrList={},e.circleList=[],e.load={},e.getCircleList()},e.send=function(t,i){var r=e.courseId;e.circle.nowSection&&e.nowSection.id&&(r=e.nowSection.id,e.ownerType="40");var o={acl:{ALL:+e.circle.isSecret},atUsers:[],category:e.category||"10",coin:0,content:e.circle.content,desc:"",files:{FILE:[],IMG:e.uploadData.img,VIDEO:[]},level:0,ownerType:"10",pOwnerId:"",pOwnerType:"",pid:"",scopes:[{OwnerId:r,OwnerType:e.ownerType}],tags:[],title:"",type:t};switch(t){case"10":if(e.circle.exceed>0)return void n.dialog.alert("已超出字数限制!");if(!o.content)return void n.dialog.alert("请先输入内容！");e.load.sendCircle=!0,o.needData=!0;break;case"20":if(!i.root.replyContent)return void n.dialog.alert("请先输入内容！");i.root.sendReply=!0,o.needData=!0,o.content=i.root.replyContent,o.pOwnerId=i.root.ownerId,o.pOwnerType=e.pOwnerType||"10",o.pid=i.root._id;break;case"30":i.root.sendLike=!0,o.pOwnerId=i.root.ownerId,o.pOwnerType=e.pOwnerType||"10",o.pid=i.root._id}console.log(angular.toJson(o)),n.studyCircle.sendCircle({token:rcpAid.getToken()},{data:angular.toJson(o)}).then(function(n){switch(console.log(n),e.uploadData.img=[],t){case"10":e.circle.content="",e.load.sendCircle=!1,e.getCircleList();break;case"20":i.replys.length>1?(i.replys[1]=angular.copy(i.replys[0]),i.replys[0].ownerId=a.currentUser.uid,i.replys[0].content=i.root.replyContent):i.replys[0]={ownerId:a.currentUser.uid,content:i.root.replyContent},e.usrList[a.currentUser.uid]={attrs:{basic:{nickName:a.currentUser.nickName,avatar:a.currentUser.avatar}}},i.root.edit=!1,i.root.sendReply=!1,i.root.count.replyCount++,i.root.replyContent="";break;case"30":i.root.sendLike=!1,i.root.count.likeCount=+i.root.count.likeCount+1,i.root.isLiked=!0}},function(a){switch(console.log(a),t){case"10":e.load.sendCircle=!1,n.dialog.alert("操作失败，请重试！");break;case"20":i.root.sendReply=!1,n.dialog.alert("操作失败，请重试！");break;case"30":i.root.sendLike=!1,1003===a.data.data.code&&n.dialog.alert("您已点过赞！")}})},e.sendCircle=function(){e.load.sendCircle||e.send("10")},e.sendReply=function(t){t.sendReply||e.send("20",t)},e.sendLike=function(t){t.sendLike||e.send("30",t)},e.getCircleList=function(t){if(t?c.pn=t:(e.circleList=[],e.usrList={},c.pn=1),!(c.all&&Math.ceil(c.all/c.ps)<c.pn)){var i={isZeroReply:!1,k:".",mode:1,page:c.pn,pageCount:c.ps,reviewReplyCount:2,reviewSort:-1,owners:[{OwnerId:e.courseId,OwnerType:"10"}],sort:-1};e.load.getCircleList=!0,n.studyCircle.getCircleList({},{data:angular.toJson(i)}).then(function(t){e.load.getCircleList=!1;try{angular.forEach(t.data.discuss,function(t){e.circleList.push(t)}),angular.extend(e.usrList,t.data.usr),c.all=t.data.allCount,c.load=!0}catch(i){}},function(t){console.log(t),e.load.getCircleList=!1})}},e.toDetail=function(e){return rcpAid.getUrl("圈子详情",{id:e.root._id,token:rcpAid.getToken()})},e.uploadData={max:9},e.uploader=function(){var t=e.uploadData.max||6;return e.uploadData.img.length>=t?(n.dialog.alert("最多只能添加"+t+"张图片！"),!1):void e.uploadImgSelect()},e.delImg=function(t){t<e.uploadData.img.length&&e.uploadData.img.splice(t,1)},e.toTop=function(){$(".study-circle-r").stop().animate({scrollTop:0},"normal")},e.init()}catch(s){console.log(s)}}]}});var wcms=function(){function e(){}function t(e,t){if("string"!=typeof e||e.trim().length<1)throw"the name must be string and not empty";if(this.name=e,t){if("number"!=typeof t||1>t)throw"the limit must be integer and >0";this.limit=t}else this.limit=5242880}function i(){}function n(t,i,n){if(!t||t.length<1)throw"article id is null or empty";this.aid=t,this.type=i,n&&n>0?this.count=n:this.count=10,this.args={},this.store=e.NewStore(t,4194304),this.init()}return e.langs={},e.langs.en={},e.langs.ch={},e.vals=e.langs.en,t.prototype.get=function(e){return window.localStorage[this.name+"_"+e]},t.prototype.getj=function(e){try{var t=this.get(e);return t&&t.length?JSON.parse(t):null}catch(i){return console.error("get json by key("+e+") error:"+i),null}},t.prototype.set=function(e,t){t+="";var i=this.get(e),n=0;if(n=i?this.size()+t.length-i.length:this.size()+t.length,n>this.limit)return!1;var a=this.idx();return a[e]=t.length,window.localStorage[this.name+"_"+e]=t,window.localStorage[this.name+"_size"]=n,window.localStorage[this.name+"_idx"]=JSON.stringify(a),!0},t.prototype.setj=function(e,t){return this.set(e,JSON.stringify(t))},t.prototype.del=function(e){var t=this.get(e);if(!t)return!1;var i=this.idx();return delete i[e],window.localStorage.removeItem(this.name+"_"+e),window.localStorage[this.name+"_size"]=this.size()-t.length,window.localStorage[this.name+"_idx"]=JSON.stringify(i),!0},t.prototype.idx=function(){var e=window.localStorage[this.name+"_idx"];return e&&e.length?JSON.parse(e):{}},t.prototype.size=function(){var e=window.localStorage[this.name+"_size"];return e?parseInt(e):0},t.prototype.clear=function(){var e=this.idx();for(var t in e)window.localStorage.removeItem(this.name+"_"+t);return window.localStorage.removeItem(this.name+"_size"),window.localStorage.removeItem(this.name+"_idx"),!0},e.LocStore=t,e.NewStore=function(e,i,n,a,r,o,c,s){return new t(e,i)},e.DelStroe=function(e,i,n,a,r,o,c,s){return new t(e,i).clear()},i.prototype.done=function(e){return this.done_=e,this},i.prototype.ondone=function(e,t,i){this.done_&&this.done_(e,t,i)},i.prototype.fail=function(e){return this.fail_=e,this},i.prototype.onfail=function(e,t,i){
this.fail_&&this.fail_(e,t,i)},e.Res=i,e.create="/art/api/create",e.update="/art/api/update",e.load="/art/api/load",e.ART_TABLE="T",n.prototype.init=function(){this.inited=!1,this.saving=!1;var e=this.store.getj("art");e?(console.log("the local article data found, using cache"),this.art=e,this.cached=!0):this.art={ver:-1};var t=this.store.getj("einfo");t?(console.log("the local einfo data found, using cache"),this.einfo=t):this.einfo={};var i=this.store.getj("updated");i?(console.log("the local updated data found, using cache"),this.updated=i):this.updated={gids:{},iids:{},gidx:!1,iidx:!1};var n=this.store.getj("updated_");n?(console.log("the local updated_ data found, using cache"),this.updated_=n):this.updated_={gids:{},iids:{},gidx:!1,iidx:!1};var a=this.store.get("sequence");a?this.sequence=parseInt(a):this.sequence=0},n.prototype.ls_sync=function(){this.store.setj("art",this.art),this.store.setj("sequence",this.sequence),this.store.setj("einfo",this.einfo),this.store.setj("updated",this.updated),this.store.setj("updated_",this.updated_)},n.prototype.ls_clear=function(){this.store.clear(),this.init()},n.prototype.nid=function(){var e="l"+this.sequence++;return this.ls_sync(),e},n.prototype.nfid=function(){var e="l"+(new Date).getTime()+this.sequence++;return this.ls_sync(),e},n.prototype.chk_updated=function(e){for(var t in e.gids)return!0;for(var i in e.iids)return!0;return e.gidx||e.iidx},n.prototype.isUpdated=function(){return this.chk_updated(this.updated)},n.prototype.isUpdated_=function(){return this.chk_updated(this.updated_)},n.prototype.resetUpdated=function(){this.updated.gids={},this.updated.iids={},this.updated.gidx=!1,this.updated.iidx=!1},n.prototype.resetUpdated_=function(){this.updated_.gids={},this.updated_.iids={},this.updated_.gidx=!1,this.updated_.iidx=!1},n.prototype.art_merge_u=function(e,t){e.gidx=e.gidx||t.gidx,e.iidx=e.iidx||t.iidx;for(var i in t.gids)e.gids[i]=t.gids[i];for(var n in t.iids)e.iids[n]=t.iids[n]},n.prototype.art_merge_i=function(e,t){if(t.items){if(!e.items)return void(e.items=t.items);for(var i in t.items)this.updated.iids[i]||(e.items[i]=t.items[i])}},n.prototype.art_merge_g=function(e,t){if(t.groups){if(!e.groups)return void(e.groups=t.groups);for(var i in t.groups)this.updated.gids[i]||(e.groups[i]=t.groups[i])}},n.prototype.art_merge=function(e,t){"undefined"!=typeof t.ver&&(e.ver=t.ver),t.idx&&(e.idx=t.idx),this.art_merge_i(e,t),this.art_merge_g(e,t)},n.prototype.einfo_merge=function(e,t){if(t)for(var i in t)e[i]=t[i]},n.prototype.chk_init=function(){if(!this.inited)throw"Article is not inited"},n.prototype.load_=function(t,n,a,r,o,c,s,l){var d={};d.aid=this.aid,t&&t.length&&(d.items=t),n&&n.length&&(d.groups=n),a&&a.length&&(d.type=a),r&&(d.count=r),o&&(d.itemc=o),c&&(d.idx=c),s&&(d.access=s),l&&(d.last=l);for(var u in this.args)d[u]=this.args[u];console.log("load article by "+JSON.stringify(d));var p=new i;return $.getJSON(e.load,d,function(e){p.ondone(e)}).fail(function(e){p.onfail("load fail by state:"+e.readyState+", error:"+e.statusText+", text:\n"+e.responseText,e)}),p},n.prototype.load=function(e,t,n,a,r,o,c,s){var l=new i,d=this;return this.load_(e,t,n,a,r,o,c,s).done(function(e){if(0!==e.code){var t="load article fail by code:"+e.code+", msg:"+e.msg+", dmsg:"+e.dmsg;return console.error(t),d.onLoadFail(t,e),void l.onfail(t,e)}return d.art.ver<0?(console.log("load and merge article success on first load, the base version: "+e.data.art.ver),d.art=e.data.art,d.einfo=e.data.einfo,d.onLoadDone(d,e.data),l.ondone(d,e.data),void d.ls_sync()):void(d.art.ver==e.data.art.ver?(console.log("load and merge article success on the same version: "+d.art.ver),d.art_merge(d.art,e.data.art),d.einfo_merge(d.einfo,e.data.einfo),d.onLoadDone(d,e.data),l.ondone(d,e.data),d.ls_sync()):(console.error("load article fail by having new version->",e.data.art.ver),d.onNewVer(d,e.data),l.onfail("NEW_VER",e.data)))}).fail(function(e,t){d.onLoadFail(e,t),l.onfail(e,t)}),l},n.prototype.run=function(){var t=this,n=new i,a=!1,r=function(){var i=1,o=e.ART_TABLE,c=t.count;t.art.idx&&t.art.idx.iids&&(i=0,o="",c=0),t.load(null,null,o,c,i,i,i,i).done(function(e,t){e.inited=!0,n.ondone(e,t)}).fail(function(e,i){return a||"NEW_VER"!==e?void n.onfail(e,i):(t.ls_clear(),t.init(),a=!0,void r())})};return r(),n},n.prototype.next=function(e){for(var t=[],n=0;n<e.length;n++)this.art.items[e[n]]||this.einfo[e[n]]||t.push(e[n]);var a=this;if(t.length<1){var r=new i;return r.done=function(e){return e(a),this},r}return this.load(t.join(","))},n.prototype.listGroup=function(e){for(var t=[],n=0;n<e.length;n++)this.art.groups[e[n]]||"_"!=e[n]&&"E"!=e[n]&&t.push(e[n]);var a=this;if(t.length<1){var r=new i;return r.done=function(e){return e(a),this},r}return this.load(null,t.join(","))},n.prototype.findIids=function(e){if(this.chk_init(),!this.art.idx||!this.art.idx.iids)return[];if(!e)return this.art.idx.iids;for(var t=[],i=0;i<this.art.idx.iids.length;i++){var n=this.art.idx.iids[i];e[this.art.idx.i2t[n]]&&t.push(n)}return t},n.prototype.findGids=function(){return this.chk_init(),this.art.idx&&this.art.idx.gids?this.art.idx.gids:[]},n.prototype.findItem=function(e,t,i){this.chk_init();var n=null;if(this.art.items&&this.art.items[e])n=this.art.items[e],n.visiable=!0;else{if(!this.einfo||!this.einfo[e])return null;n={g:this.einfo[e],visiable:!1}}return t&&(this.art.groups&&this.art.groups[n.g]?n.group=this.art.groups[n.g]:n.group=null),i&&(this.art.idx&&this.art.idx.gic&&this.art.idx.gic[n.g]?n.gic=this.art.idx.gic[n.g]:n.gic=null),n},n.prototype.findGroup=function(e){return this.chk_init(),this.art.groups&&this.art.groups[e]?this.art.groups[e]:null},n.prototype.moveItem=function(e,t){if(this.chk_init(),0>e||0>t||e>this.art.idx.iids.length-1||t>this.art.idx.iids.length-1)throw"index out of bound "+JSON.stringify({idxa:e,idxb:t,ilen:this.art.idx.iids.length});this.art.idx.iids.splice(t,0,this.art.idx.iids.splice(e,1)[0]),this.updated.iidx=!0,this.ls_sync()},n.prototype.moveItem2=function(e,t){t?this.moveItem(e,e-1):this.moveItem(e,e+1)},n.prototype.moveItem3=function(e,t){this.chk_init();for(var i=-1,n=0;n<this.art.idx.iids.length;n++)if(this.art.idx.iids[n]==e){i=parseInt(n);break}if(0>i)throw"the item id("+e+") is not found on article";this.moveItem2(i,t)},n.prototype.updateItem=function(e,t){if(this.chk_init(),!this.art.items[e])throw"the item id("+e+") is not found on article";if(this.art.items[e].t!=t.t)throw"the item("+e+") type can not be updated";this.art.items[e]=t,this.updated.iids[e]=1,this.ls_sync()},n.prototype.updateGroup=function(e,t){if(this.chk_init(),!this.art.groups[e])throw"the group id("+e+") is not found on article";this.art.groups[e]=t,this.updated.gids[e]=1,this.ls_sync()},n.prototype.addItem=function(e,t){this.chk_init(),"undefined"==typeof t&&(t=this.art.idx.iids.length);var i=this.nid();return this.art.items||(this.art.items={}),this.art.items[i]=e,this.art.idx.iids.splice(t,0,i),this.art.idx.i2t[i]=e.t,this.updated.iidx=!0,this.updated.iids[i]=1,this.ls_sync(),console.log("add item success by id("+i+") on index"+t+"->",JSON.stringify(e)),i},n.prototype.addGroup=function(e,t){this.chk_init(),"undefined"==typeof t&&(t=this.art.idx.gids.length);var i=this.nid();return this.art.groups||(this.art.groups={}),this.art.groups[i]=e,this.art.idx.gids.splice(t,0,i),this.updated.gidx=!0,this.updated.gids[i]=1,this.ls_sync(),console.log("add group success by id("+i+") on index"+t+"->",JSON.stringify(e)),i},n.prototype.removeItem=function(e){this.chk_init();for(var t=-1,i=0;i<this.art.idx.iids.length;i++)if(this.art.idx.iids[i]==e){t=parseInt(i);break}if(0>t)throw"the item id("+e+") is not found on article";delete this.art.items[e],this.art.idx.iids.splice(t,1),delete this.art.idx.i2t[e],this.updated.iidx=!0,this.ls_sync()},n.prototype.save_=function(){var t=new i;if(this.saving){var n="there is already having task to save article";return console.log(n),t.fail=function(e){return e(n),this},t}this.saving=!0,this.art_merge_u(this.updated_,this.updated),this.resetUpdated(),this.ls_sync(),console.log("saving article....");var a=this,r={};r.ver=a.art.ver,r.id=a.art.id,r.idx={},this.updated_.iidx&&(r.idx.iids=a.art.idx.iids),this.updated_.gidx&&(r.idx.gids=a.art.idx.gids),r.items={};for(var o in this.updated_.iids)r.items[o]=a.art.items[o];r.groups={};for(var c in this.updated_.gids)r.groups[c]=a.art.groups[c];var s=JSON.stringify(r);return console.log("saving the article by args:",r),$.ajax({url:e.update+"?"+$.param(a.args),type:"POST",data:s,dataType:"json",contentType:"application/json",success:function(e,i,n){a.saving=!1,t.ondone(a,e,i,n)},error:function(e,i,n){a.saving=!1,t.onfail("save fail by state:"+e.readyState+", error:"+e.statusText+", text:\n"+e.responseText,e,i,n)}}),t},n.prototype.save=function(){var e=new i,t=this;return this.isUpdated()?(this.save_().done(function(i,n){if(0===n.code){t.art_merge(t.art,n.data.art);var a=0,r=0;for(var o in n.data.gidm)delete t.art.groups[o],a++;for(var c in n.data.iidm)delete t.art.items[c],r++;console.log("update article success to ver("+n.data.art.ver+") with gidmc("+a+"),iidmc("+r+")"),t.resetUpdated_(),t.ls_sync(),t.onSaveDone(t,n.data,a,r),e.ondone(t,n.data,a,r)}else if(409===n.code)console.error("update article faild base ver("+t.art.ver+")->"+JSON.stringify(n.data.art.last)),t.art_merge_u(t.updated,t.updated_),t.resetUpdated_(),t.ls_sync(),t.onSaveConfict(t,n.data),e.onfail("confict",n.data);else{var s="update article fail by code:"+n.code+", msg:"+n.msg+", dmsg:"+n.dmsg;console.error(s),t.art_merge_u(t.updated,t.updated_),t.resetUpdated_(),t.ls_sync(),t.onSaveFail(s,n),e.onfail(s,n)}this.saving=!1}).fail(function(i,n){t.art_merge_u(t.updated,t.updated_),t.resetUpdated_(),t.ls_sync(),t.onSaveFail(i,n),e.onfail(i,n)}),e):(e.done=function(e){return e(t),this},e)},n.prototype.onSaveDone=function(e,t,i,n){},n.prototype.onSaveConfict=function(e,t){},n.prototype.onSaveFail=function(e,t){},n.prototype.onNewVer=function(e,t){},n.prototype.onLoadDone=function(e,t){},n.prototype.onLoadFail=function(e,t){},e.Article=n,window.wcms=e,e}();module.factory("courseContent",["request",function(e){var t=DYCONFIG.fs;return{transDownloadUrl:function(e){return t.down+"?mark="+e+"&dl=1&token="+rcpAid.getToken()},transImgUrl:function(e){return t.down+"?mark="+e+"&token="+rcpAid.getToken()},transVideoUrl:function(e){return t.down+"?mark="+e+"&type=V_pc&token="+rcpAid.getToken()},transFlashUrl:function(e){return t.down+"?mark="+e+"&token="+rcpAid.getToken()},transPreviewUrl:function(e,t,i){try{return"/course/document-preview.html?mark="+e+"&type="+this.convertExt.transExecType[t]+"&count="+i[this.convertExt.transExecType[t]].count}catch(n){console.log(n)}},convertExt:{video:["wmv","rm","rmvb","mpg","mpeg","mpe","3gp","mov","mp4","m4v","avi","mkv","flv","vob"],attach:["doc","docx","pdf","ppt","pptx"],transExecType:{doc:"D_docx",docx:"D_docx",ppt:"D_pptx",pptx:"D_pptx",pdf:"D_pdfx"}},bindHtml:function(e,t,i){return"flash"===e?'<embed src="'+this.transFlashUrl(t)+'" id="embed-flash-'+i.id+'"wmode="Opaque"allowfullscreen="true"quality="high"width="800"height="450"align="middel"allowscriptaccess="always"type="application/x-shockwave-flash"per="100%">':"video"===e?'<video id="video-main-'+i.id+'" src="'+this.transVideoUrl(t)+'"class="ckVideo" style="background-color: #000000" width="640"height="360" per="100%" preload="none"controls="controls"></video>':void 0},getFileInfo:function(i,n){var a={};return a="string"==typeof i?{method:"GET",url:t.info,params:{mark:i,mode:"mark"}}:{method:"GET",url:t.listInfo,params:{mark:i.join(","),mode:"mark"}},e(angular.extend(a,n||{}))}}}]),module.run(["service","courseContent",function(e,t){e.expand("courseContent",function(){return t})}]),module.factory("examReq",["request",function(e){var t=DYCONFIG.course.rUrl;return{getListGroup:function(i,n){i.token=rcpAid.getToken();var a={method:"GET",url:t+"pub/api/listGroup",params:i};return e(angular.extend(a,n||{}))},getListItemL:function(i,n){i.token=rcpAid.getToken();var a={method:"GET",url:t+"pub/api/listItemL",params:i};return e(angular.extend(a,n||{}))},answerPaper:function(i,n){i.token=rcpAid.getToken();var a={method:"GET",url:t+"usr/api/answer",params:i,option:{loading:!1}};return e(angular.extend(a,n||{}))},startAnswer:function(i,n){i.token=rcpAid.getToken();var a={method:"GET",url:t+"usr/api/startAnswer",params:i};return e(angular.extend(a,n||{}))},doneAnswer:function(i,n){i.token=rcpAid.getToken();var a={method:"GET",url:t+"usr/api/doneAnswer",params:i};return e(angular.extend(a,n||{}))},listExam:function(i,n){i.token=rcpAid.getToken();var a={method:"GET",url:t+"usr/api/listExam",params:i};return e(angular.extend(a,n||{}))},createPaper:function(i,n){i.token=rcpAid.getToken();var a={method:"GET",url:t+"art/api/create",params:i};return e(angular.extend(a,n||{}))}}}]),module.run(["service","examReq",function(e,t){e.expand("examReq",function(){return t})}]),module.factory("cvfa",["$rootScope","$timeout","$http","$q","service",function(e,t,i,n,a){function r(e,t){var i=/(\.\w*)$|(\.\w*?)\?|(\.\w*?)\#/.exec(e||"")||[],n=i[1]||i[2]||i[3];return"embed"===t?void s({link:e,type:0},"link"):"flash"===t||n&&(/\.swf$/.test(n)||/\.swf\?/.test(n))?void alert("您的手机不支持swf文件，请使用网页观看"):e?void s({src:e},"video"):void alert('抱歉，视频地址不能播放  src="'+e+'"')}function o(e){s({src:e},"photo")}function c(e){var t=e,i=/(\.\w*)$|(\.\w*?)\?|(\.\w*?)\#/.exec(t||"")||[],n=i[1]||i[2]||i[3];return n&&(/\.swf$/.test(n)||/\.swf\?/.test(n))?void alert("您的手机不支持swf文件，请使用网页观看"):void s({link:e},"link")}function s(e,t){var i=rcpAid.detectOS().name;switch(i){case"iPad":case"iPhone":l(e,t);break;default:d(e,t)}}function l(e,t){switch(t){case"video":window.webkit.messageHandlers.notification.postMessage({video:e.src});break;case"photo":window.webkit.messageHandlers.notification.postMessage({photo:e.src});break;case"ppt":window.webkit.messageHandlers.notification.postMessage({ppt:e.list});break;case"link":window.webkit.messageHandlers.notification.postMessage({link:e.link});break;case"paper":window.webkit.messageHandlers.notification.postMessage({paper:{pid:e.pid,title:e.title}})}}function d(e,t){var i=rcpAid.detectOS().isCrosswalk?NativeJsInterface:window.NativeJsInterface;switch(t){case"video":i.clickVideo(e.src);break;case"photo":i.clickOnePhoto(e.src);break;case"ppt":i.clickPhotoDoc(e.list);break;case"link":i.clickLink(e.link,u(e.link,"h5")?1:0);break;case"paper":i.clickPaper(e.pid,e.title)}}function u(e,t){var i=e.match(new RegExp("[?&]"+t+"=([^&]+)","i"));return null==i||i.length<0?"":decodeURIComponent(i[1])}function p(e){var t={yinyuetai:{reg:/http:\/\/www\.yinyuetai\.com/,param:"&auto=1"},56:{reg:/http:\/\/player\.56\.com/,param:"&auto=1"},ku6:{reg:/http:\/\/player\.ku6\.com/,param:"&auto=1"},sohu:{reg:/http:\/\/share\.vrs\.sohu\.com/,param:"&autoplay=true"},tudou:{reg:/http:\/\/www\.tudou\.com/,param:"&autoPlay=true"},youku:{reg:/http:\/\/player\.youku\.com/,param:"&isAutoPlay=true"},qq:{reg:/http:\/\/static\.video\.qq\.com/,param:"&auto=1"}};return angular.forEach(t,function(t){e.match(t.reg)&&(e+=t.param)}),e}function f(e,t,i){var n=$(e),a=t.t;if(n.get(0).contentData=t,i){var r=n.find(i.tag).eq(0);i.style&&r.css(i.style),"embed"!==a&&"video"!==a||n.find("iframe,embed").removeAttr("style").css({height:"100%"})}switch(a){case"flash":case"embed":case"video":n.find(".up").on({click:function(){n.find("iframe,video").attr("src",""),n.find(".w").hide().prev().show()}}),"embed"===a&&n.find(".thumbnail").html("").append(H(n));break;case"attach":n.find(".dwl").on({click:function(e){e.preventDefault(),K()?alert("请在网页端下载"):$("#file-downl-iframe").attr("src",t.c.url)}});break;case"text":K()&&(n.find("a").each(function(){$(this).on({click:function(e){e.preventDefault(),c($(this).attr("href"))}})}),n.find("img").each(function(){$(this).on({click:function(e){e.preventDefault(),o($(this).attr("src"))}})}));break;case"link":K()&&n.find(".link").on({click:function(e){e.preventDefault(),c($(this).attr("href"))}});break;case"paper":var s=Math.random().toString(36).substr(2,15),l=n.get(0);l.reloadPaper=function(){g(n,t)},l.reloadPaper(),ce[s]=l,t.paperNode=s}return n}function g(e,t){e.find(".ldg").show(),e.find(".c").hide(),e.find(".ldg").hide(),e.find(".c").show(),K()?e.find(".do-t-btn").html("开始做题").unbind("click").bind("click",function(){s({pid:t.c.aid,title:t.c.title},"paper")}):e.find(".do-t-btn").html("继续做题").unbind("click").bind("click",function(){window.open(rcpAid.getUrl("做题页",{aid:t.c.aid}))});var i={aids:t.c.aid,ret_score:1};a.examReq.listExam(i).then(function(t){console.log(t),e.find(".c").find(".status").show()},function(t){console.log(t,"获取练习信息失败"),e.find(".ldg").hide(),e.find(".c").show().html("获取练习信息失败")})}function h(e){return m(se.content.items[e])}function m(e){var t,i=e.t;switch(typeof le[i]){case"function":e.c.status&&"EDIT"===e.c.status&&(i="isedit"),t=le[i](e);break;default:i="isbuild",t=le[i](e)}return se.content.cache[e.cvp.id]=e,t}function v(e,t,i){var n=e.width(),a=e.height();if(!(t>=n)){var r=i||t,o=t*a/n;e.width(r),e.height(o)}}function y(e){var t=e.width();e.find("img").each(function(){v($(this),t)}),e.find(".cp-embed,.cp-video,.cp-flash").each(function(){$(this).find(".embed-w,.video-w,.flash-w").each(function(){v($(this),t)})})}function w(e){var t=$(se.viewNode),i="div";e.find("img").each(function(e,n){b({winTag:i,win:t,node:$(this),callback:function(){var e=$('<img src="'+$(n).attr("data-src")+'" style="'+($(n).attr("style")||"")+'" />');e.on({click:function(){K()&&o($(this).attr("src"))},load:function(){},error:function(){$(this).attr("src",oe).parent().addClass("error-img")}}),$(n).after(e).remove()}})}),e.find(".timg").each(function(e,n){b({winTag:i,win:t,node:$(this),callback:function(){var e=$(n).find(".thumbnail"),t=e.attr("data-img");t&&e.css({backgroundImage:"url("+t+")"})}})})}function b(e){function i(){var t=e.node;if(t.length&&!a&&!t.is(":hidden")){var i=o.scrollTop(),r=i+o.height(),c="window"===e.winTag?t.offset().top:t.position().top+i,s=c+t.height(),l=c>=i&&r>=c,d=i>=c&&s>=i;(l||d)&&(a=!a,"function"==typeof e.callback&&(e.callback(),o.unbind("scroll",n),o.unbind("resize",n)))}}function n(){t.cancel(r),r=t(i,200)}var a,r,o=e.win;n(),o.bind("scroll",n),o.bind("resize",n)}function x(e){window.resm=e}function k(e){var t=[];return angular.forEach(e,function(e){t.push(e)}),t}function C(){var e=k(arguments),t=e[0],i=e.slice(1,e.length);"function"==typeof t&&t.apply(t,i)}function T(e){se.idsCat=I(e.findIids({T1:1,T2:1})||[]),S(se.idsCat,se.cat.items)}function S(t,i){se.art.next(t).done(function(n,a){angular.forEach(t,function(e){var t=se.art.findItem(e,1,1);i.push({id:e,title:t.c.title,type:t.t})}),e.$broadcast("makeCatReady",n,a)}).fail(function(t,i){e.$broadcast("makeCatError",t,i),x(t,i)})}function L(e){ee=!1;var t=$(se.viewNode),i='<p class="append-loading" style="padding:30px 0;font-size:14px;color:#999;text-align:center;">正在加载...</p>',n=0;switch(e){case"top":t.children(".cp-section").first().before(i),t.scrollTop(n);break;case"bottom":t.children(".cp-section").last().after(i),n=t.get(0).scrollHeight-t.height(),t.scrollTop(n)}}function I(e){var t=[];return angular.forEach(e,function(e){t.join(",").match(new RegExp("s"+e+"s"))||t.push(e)}),t}function D(e,t){var i=I(e.findIids()||[]);re=Math.ceil(i.length/se.params.ps)-1,se.idsContent=i,se.locateContentTarget(t||i[0])}function E(e){console.log("显示页：",e);var t=$(se.viewNode);t.children('.cp-section[data-cpn="'+e+'"]').show(),N()}function _(e,t,i,n){var a=$(se.viewNode),r=a.children(".cp-section"),o=$(document.createDocumentFragment());angular.forEach(i,function(e){o.append(h(e))}),$.each(se.content.page,function(t){return parseInt(t)>n?(e="top",r=a.children('.cp-section[data-cpn="'+t+'"]'),!1):void 0}),r.length?"top"===e?r.first().before(o):r.last().after(o):a.append(o),a.children(".cp-section[data-cpn="+n+"]").each(function(){y($(this)),w($(this))}),N()}function A(){ee=!0;var t=$(se.viewNode);t.find(".append-loading").remove(),R(function(){t.css({visibility:"visible"}),ne=!1,te=null,e.$broadcast("makeContentReady")})}function N(){F(A)}function j(){var e=$(se.viewNode),t=parseInt(e.get(0).scrollHeight),i=parseInt(e.outerHeight(!0));return console.log("滚动高度",t,i),t>i}function F(e){return j()?void C(e):void M("bottom")}function R(t){var i=$(se.viewNode),n=0;if(O(),te){ie=!0,i.scrollTop(0);var a=i.children('.cp-section[data-cid="'+te+'"]'),r=a.position().top,o=parseInt(i.css("paddingTop"));n=Math.ceil(r-o+ae),console.log("高度",n,i[0].scrollHeight,i.height()),i.scrollTop(n).css({width:"100%",height:"100%"}),ie=!1,console.log("第一次不等即有问题",i.scrollTop(),n),i.scrollTop()===n||ne?C(t):(i.css({visibility:"visible"}),ne=!1,e.$broadcast("makeContentReady"))}else C(t)}function O(){var e=ne&&te;if(console.log("ContentHeight",ne,te),!j()||e){var t=$(se.viewNode),i=t.children(".cp-section"),n=t.outerHeight(!0),a=0;i.last().css({height:""}),i.each(function(e){var t=$(i).eq(i.length-(e+1));return a+=t.outerHeight(!0),t.hasClass("cp-t1")||t.hasClass("cp-t2")?!1:void 0});var r=n-a+i.last().outerHeight(!0),o=+t.children('.cp-section[data-cid="'+te+'"]').attr("data-cpn");o||(o=i.last().get(0).contentData.cvp.pn),console.log("页数",o,re,r),o>=re?console.log("已到最后一页"):(console.log("加载页",+o+1),E(+o+1))}}function M(i){var n=$(se.viewNode),a=n.children(".cp-section:visible"),r=0,o=null,c=null;if(te||(o=500),a.length){switch(i){case"top":c=a.first().get(0),r=c.contentData.cvp.pn,r-=1;break;case"bottom":r=a.last().get(0).contentData.cvp.pn,r+=1}if(r>=0&&re>=r)c&&(te=c.contentData.cvp.id),L(i),t(function(){Z(i,se.idsContent,r)},o);else{console.info("top"===i?"已到最顶部了":"已到最底部了",r),console.log(te);var s=a.last().height(),l=n.height();"top"!==i&&(l-s>s&&r>1&&(a.last().css({height:l-s}),console.log("设置高度")),r>1?A():(n.css({visibility:"visible"}),ne=!1,e.$broadcast("makeContentReady")))}}}function U(e){var t=se.idsContent,i=$.inArray(e,t);if(!t.length)return void W("info","(∩_∩)还没有内容~~~");if(!e)return void W("error","ID出错,赶紧找程序猿");if(-1===i)return void W("error","内容ID表单里找不到"+e);ee=!1;var n=Math.floor(i/se.params.ps),a=se.content.items;return a[e]?(console.log("aa",n,i,se.params.ps,a[e].cvp.pn),void E(a[e].cvp.pn)):void Z(null,t,n)}function H(e){var t=$('<a href="javascript:;" class="open"><i class="fa fa-play-circle-o"></i></a>');return t.on({click:function(){if(K()){var t=e.get(0).contentData;return void r(t.c.src,t.t)}var i=$(this).parent().parent(),n=i.next(),a=n.find("iframe,embed,video");i.hide(),n.show(),a.attr("src",a.attr("data-src"))}}),t}function P(e,t,i,n){var r,o,c,s,l,d,u=$('div[data-cid="'+i.cvp.id+'"]');switch(e){case"attach":var p=t.ext.replace(".","");switch(t.status){case"SUCCESS":K()||"done"===t.exec&&a.courseContent.convertExt.transExecType[p]&&(d=a.courseContent.transPreviewUrl(t.mark,p,t.execInfo),d&&(l='<a class="link mg-l20" href="'+d+'" target="_blank" title="">预览</a>',u.append(l)));break;case"N":K()||"done"===t.exec&&a.courseContent.convertExt.transExecType[p]&&(d=a.courseContent.transPreviewUrl(t.mark,p,t.execInfo),d&&(l='<a class="link mg-l20" href="'+d+'" target="_blank" title="">预览</a>',u.append(l)))}break;case"video":switch(t.status){case"N":"done"===t.exec?(r=[],o=r[r.length-1]||"",c=u.find(".thumbnail"),s=c.css("opacity"),l=H(u),c.html(l),s&&"0"!==s?c.css({backgroundImage:"url("+o+")"}):c.attr("data-img",o)):u.find(".timg").hide();break;case"SUCCESS":"done"===t.exec?(r=[],o=r[r.length-1]||"",c=u.find(".thumbnail"),s=c.css("opacity"),l=H(u),c.html(l),s&&"0"!==s?c.css({backgroundImage:"url("+o+")"}):c.attr("data-img",o)):u.find(".timg").hide();break;case"FAIL":u.find(".thumbnail").html("转码失败");break;case"CONVERT":u.find(".thumbnail").html("转码中...");break;case"UNKNOWN":u.find(".thumbnail").html("未知")}break;case"flash":switch(t.status){case"N":u.find(".thumbnail").html("").append(H(u));break;case"SUCCESS":u.find(".thumbnail").html("").append(H(u));break;case"UPLOAD":u.find(".thumbnail").html("上传中...");break;case"FAIL":u.find(".thumbnail").html("上传失败");break;case"UNKNOWN":u.find(".thumbnail").html("未知")}}}function z(e){var i=[],n={};angular.forEach(e,function(e){switch(e.t){case"attach":e.c.url=a.courseContent.transDownloadUrl(e.c.mark),e.c.ext&&(t(function(){P(e.t,e.c,e,e)},200),i.push(e.c.id),n[e.c.id]=e);break;case"video":e.c.url=a.courseContent.transVideoUrl(e.c.mark),t(function(){P(e.t,e.c,e,e)},200),i.push(e.c.id),n[e.c.id]=e;break;case"flash":e.c.url=a.courseContent.transFlashUrl(e.c.mark),t(function(){P(e.t,e.c,e,e)},200);break;case"image":e.c.url=a.courseContent.transImgUrl(e.c.mark)}})}function V(e,t){function i(e){var i=$('div[data-cid="'+e.cvp.id+'"]');i.find(".thumbnail").html(t)}angular.forEach(e,function(e){i(e)})}function G(e,t,i,n){if(t>re)return void console.error("页数:"+t+" 超出内容范围");var a=se.params.ps,r=t*a,o=r+a,c=e.slice(r,o);q(c,i,n,t,a)}function q(e,t,i,n,a){se.art.next(e).done(function(i){var r=se.content.items;angular.forEach(e,function(t){var i=se.art.findItem(t,1,1);i.cvp={id:t,pn:n,ps:a,tids:e},r[t]=i}),C(t,i,r,e)}).fail(function(e,t){C(i,e,t),x(e,t)})}function W(t,i){e.$broadcast("makeContentError",t,i)}function B(){var e,t=$(se.viewNode),i=t.children(".cp-section:visible");return i.each(function(){var t=$(this).position().top+$(this).height();if(t>0){try{e=$(this).get(0).contentData.cvp.id}catch(i){console.error($(this).get(0).contentData)}return!1}}),e}function J(e){var t,i=se.idsContent,n=se.art.art.idx.i2t;if(!e||!i.length)return t;var a=i.slice(0,$.inArray(e,i)+1);return $(a).each(function(e,i){var r=a[a.length-(e+1)];return"T1"===n[r]||"T2"===n[r]?(t=r,!1):void 0}),t}function Y(e){var t=window.location.search.match(new RegExp("[?&]"+e+"=([^&]+)","i"));return t?decodeURIComponent(t[1]):""}function K(){return-1!==window.location.href.indexOf("mobile-course-learning.html")}function X(e,t,i,n){var r={},o=[],c=[];return angular.forEach(t,function(t){c.push(e[t])}),angular.forEach(c,function(e){switch(e.t){case"attach":case"video":case"flash":case"image":o.push(e.c.mark),r[e.c.mark]=e}}),o.length?void a.courseContent.getFileInfo(o).then(function(e){for(var t in e.data)angular.extend(r[t].c,e.data[t].base);z(r),C(i,e)},function(e){C(i),C(n,e,o.length?r:null)}):void C(i)}function Z(e,t,i){return se.content.page[i]?(console.log("aa4",i),void E(i)):void G(t,i,function(t,n,a){console.log("/* request page content "+a+" */"),X(n,a,function(){se.content.page[i]=a,_(e,n,a,i)},function(e,t){t&&V(t,"获取文件id失败"),console.error(e," 获取文件id失败")})},function(e,t){W("error",e)})}var Q=Y("cid"),ee=!0,te=null,ie=null,ne=null,ae=10,re=0,oe="/rcp-common/imgs/icon/blank.png",ce=("http://"+g_conf.ebs_srv+"/",g_conf.rcp_srv,{}),se={self:null,art:null,idsCat:[],idsContent:[],cat:{items:[]},content:{items:{},cache:{},page:{}},params:{ps:10},config:function(e){return angular.extend(se.params,e),this},queryString:Y,locateContentTarget:function(i){e.$broadcast("locateContentTarget");var n=t(function(){t.cancel(n),te=i;var a=$(se.viewNode);a.css({visibility:"hidden"}).children(".cp-section").hide().last().css({height:""}),a.children(".cp-embed,.cp-video").each(function(){$(this).find(".w").find(".up").click()});var r=J(i);e.$broadcast("actionAatId",r),U(i)})},on:function(e,t){switch(e){case"scroll":se.scroll(t)}},scroll:function(i){function n(){var t=B(),n=J(t);n&&e.$broadcast("actionAatId",n),i(se,l,n,t)}function a(){if(ee&&!ie){var e=this.scrollHeight,i=Math.ceil($(this).scrollTop()),a=$(this).outerHeight(!0),r=se.idsContent;l="normal",0>=i&&r.length?(l="top",M(l)):i>=e-a&&r.length&&(l="bottom",M(l)),t.cancel(c),c=t(n,300)}}function r(){$(se.viewNode).children(".cp-section").each(function(){y($(this))})}function o(){t.cancel(s),s=t(r,300)}var c=null,s=null,l=null,d=$(se.viewNode);d.on({scroll:a,resize:o})},init:function(){var i=se.params;return i.contentId?(se.art=new wcms.Article(i.contentId,i.t,i.n),se.art.args.uid=i.uid,void se.art.run().done(function(t){T(se.art),D(se.art,i.target),e.$broadcast("cvfaInitReady",t)}).fail(function(t,i){e.$broadcast("cvfaInitError",t,i),"new version"===t?(console.info("本地版本与服务器版本不一致，将重新获取课程内容数据"),se.art.ls_clear(),se.init()):x(t,i)})):void t(function(){e.$broadcast("cvfaInitError","参数有误")},200)},run:function(e,t){C(t)}};K()&&$("body").addClass("mobile-content-view"),window.loadingLayerStyleText=window.loadingLayerStyleText||[".loading-layer{position:fixed;width:100%;height:100%;top:0;left:0;background:rgba(0,0,0,.3);z-index:999;transition:opacity .1s;}",".loading-circle{position:absolute;left:50%;top:50%;display:block;width:35px;height:35px;margin:-20px 0 0 -20px;}",'.loading-circle::before{content:"";position:absolute;left:-5px;top:-5px;display:block;width:100%;height:100%;border:5px solid rgba(0,0,0,.5);border-radius:50%;}','.loading-circle::after{content:"";position:absolute;left:-5px;top:-5px;display:block;width:100%;height:100%;border:5px solid transparent;border-bottom-color:white;border-radius:50%;}',".loading-amit-spin{-webkit-animation:spin .4s linear infinite;-moz-animation:spin .4s linear infinite;-o-animation:spin .4s linear infinite;animation:spin .4s linear infinite;-moz-transition:border .3s;-o-transition:border .3s;transition:border .3s;}","@-webkit-keyframes spin{0%{-webkit-transform:rotate(0);transform:rotate(0)}100%{-webkit-transform:rotate(360deg);transform:rotate(360deg)}}","@-moz-keyframes spin{0%{-moz-transform:rotate(0);transform:rotate(0)}100%{-moz-transform:rotate(360deg);transform:rotate(360deg)}}","@-o-keyframes spin{0%{-o-transform:rotate(0);transform:rotate(0)}100%{-o-transform:rotate(360deg);transform:rotate(360deg)}}","@keyframes spin{0%{-webkit-transform:rotate(0);-moz-transform:rotate(0);-o-transform:rotate(0);transform:rotate(0)}100%{-webkit-transform:rotate(360deg);-moz-transform:rotate(360deg);-o-transform:rotate(360deg);transform:rotate(360deg)}}"].join("");var le={isbuild:function(e){var t=['<div class="cp-section cp-isbuild" data-cid="'+e.cvp.id+'" data-cpn="'+e.cvp.pn+'">',"此类型（"+e.t+"）内容正在建设中...","</div>"].join("");return f(t,e)},isedit:function(e){var t=['<div class="cp-section cp-isedit" data-cid="'+e.cvp.id+'" data-cpn="'+e.cvp.pn+'"></div>'].join("");return f(t,e)},T1:function(e){var t=['<div class="cp-section cp-t1" data-cid="'+e.cvp.id+'" data-cpn="'+e.cvp.pn+'">','<h1 class="title">'+e.c.title+"</h1>","</div>"].join("");return f(t,e)},T2:function(e){var t=['<div class="cp-section cp-t2" data-cid="'+e.cvp.id+'" data-cpn="'+e.cvp.pn+'">','<h2 class="title">'+e.c.title+"</h2>","</div>"].join("");return f(t,e)},text:function(e){var t=['<div class="cp-section cp-text" data-cid="'+e.cvp.id+'" data-cpn="'+e.cvp.pn+'">'+e.c.c+"</div>"].join("");return f(t,e)},flash:function(e){e.c.src=e.c.url;var t=['<div class="cp-section cp-flash" data-cid="'+e.cvp.id+'" data-cpn="'+e.cvp.pn+'">','<div class="timg"><div class="thumbnail">加载中...</div></div>','<div class="w">','<p><a href="javascript:;" class="up">收起 <i class="fa fa-arrow-circle-up"></i></a></p>','<p class="title" style="'+(e.c.title?"":"display:none")+'">'+e.c.title+"</p>",'<div class="flash-w">','<embed src="'+e.c.url+'" data-fid="'+e.c.fid+'"  quality="high" width="100%" height="100%" align="middle" allowscriptaccess="never" allowfullscreen="true" type="application/x-shockwave-flash">',"</div>","</div>","</div>"].join("");return f(t,e,{tag:".flash-w",style:angular.extend({width:"640px",height:"360px"},e.c.style||{})})},embed:function(e){var t=e.c.url||"",i=t.match(/\ssrc=["|'](.*?)["|']/)||[];i[1]&&(t=t.replace(/(\ssrc=["|']).*?(["|'])/,"$1"+p(i[1])+"$2")),e.c.src=(t.match(/\ssrc=["|'](.*?)["|']/)||[])[1]||"";var n=t.match(/<embed/);n||(t=t.replace(/\s(src=["|']?)/," data-$1"));var a=['<div class="cp-section cp-embed" data-cid="'+e.cvp.id+'" data-cpn="'+e.cvp.pn+'">','<div class="timg"><div class="thumbnail">加载中...</div></div>','<div class="w">','<p><a href="javascript:;" class="up">收起 <i class="fa fa-arrow-circle-up"></i></a></p>','<p class="title" style="'+(e.c.title?"":"display:none")+'">'+e.c.title+"</p>",'<div class="embed-w">'+t+"</div>","</div>","</div>"].join("");return f(a,e,{tag:".embed-w",style:e.c.style});
},video:function(e){e.c.name=e.c.name?e.c.name:"";var t=['<div class="cp-section cp-video" data-cid="'+e.cvp.id+'" data-cpn="'+e.cvp.pn+'">','<div class="timg"><div class="thumbnail">加载中...</div></div>','<div class="w">','<p><a href="javascript:;" class="up">收起 <i class="fa fa-arrow-circle-up"></i></a></p>','<p class="title" style="'+(e.c.name?"":"display:none")+'">'+e.c.name.replace(/^.*\/|\..*$/g,"")+e.c.ext+"</p>",'<div class="video-w">','<video data-src="'+e.c.url+'" data-fid="'+e.c.id+'" style="width:100%;height:100%;" autoplay="autoplay" controls="controls">您的浏览器不支持 video 标签。</video>',"</div>","</div>","</div>"].join("");return e.c.src=e.c.url||"",f(t,e,{tag:".video-w",style:e.c.style})},image:function(e){var t=['<div class="cp-section cp-image" data-cid="'+e.cvp.id+'" data-cpn="'+e.cvp.pn+'">','<span class="img-blank"><img src="'+oe+'" data-src="'+e.c.url+'" data-fid="'+e.c.id+'" title="'+(e.c.filename||"")+'" /></span>',"</div>"].join("");return K()&&(e.c.style={}),f(t,e,{tag:"img",style:e.c.style})},link:function(e){var t=e.c.url;t&&t.match(/esp.aikexue.com/)&&(t.match(/cid=/)||(t+=(t.split("?")[1]?"&":"?")+"cid="+Q),t.match(/host=/)||(t+="&host="+window.location.host),e.c.url!==t&&(e.c.url=t));var i=['<div class="cp-section cp-link" data-cid="'+e.cvp.id+'" data-cpn="'+e.cvp.pn+'">','<a class="link" href="'+e.c.url+'" target="_blank" title="'+e.c.url+'">'+e.c.title+"</a>","</div>"].join("");return f(i,e)},attach:function(e){var t=['<div class="cp-section cp-attach" data-cid="'+e.cvp.id+'" data-cpn="'+e.cvp.pn+'">','<p class="title"><b>'+e.c.title+"</b></p>",'<a class="link dwl" href="'+e.c.url+'" data-fid="'+e.c.id+'" title="'+e.c.url+'">点击下载</a>',"</div>"].join("");return f(t,e)},paper:function(e){var t=['<div class="cp-section cp-practise" data-cid="'+e.cvp.id+'" data-cpn="'+e.cvp.pn+'">','<div class="w">','<i class="image-c-paper"></i>','<p class="ldg"></p>','<div class="c">','<p class="title" title="'+e.c.title+'">'+e.c.title+"</p>",'<p class="detail text-of"><span class="status" >0/9题<span></p>','<div class="action"><a href="javascript:;" class="do-t-btn"> 开始做题 </a><div>',"</div>","</div>","</div>"].join("");return f(t,e)}};return se}]),module.directive("contentList",function(){return{template:['<div class="content-list">','<div ng-if="loading" class="loading-mask">加载中...</div>','<div ng-if="errorLock" class="error-mask">加载失败...</div>','<div ng-if="infoLock" class="info-mask">{{infoText}}</div>','<ul ng-hide="errorLock">','<li ng-repeat="item in cat.items track by $index" ng-if="item.type===\'T1\' || item.type===\'T2\'" ng-class="{action: actionId == item.id, t1: item.type === \'T1\', t2: item.type === \'T2\'}" ng-click="triggerContent(item.id)" data-tid="{{item.id}}">','<a title="{{item.title}}">{{item.title}}</a>',"</li>","</ul>","</div>"].join(""),restrict:"E",replace:!0,transclude:!0,scope:{},controller:["$rootScope","$scope","$element","$attrs","cvfa",function(e,t,i,n,a){function r(){t.loading=!0}function o(){t.loading=!1}function c(){o(),t.errorLock=!0;try{t.$digest()}catch(e){}}function s(e){o(),t.infoLock=!0,t.infoText=e}function l(e){var t=$('li[data-tid="'+e+'"]').position(),n=$(i);console.log("aa3",e,t),t&&(t.top<0||t.top>n.height())&&n.stop().animate({scrollTop:n.scrollTop()+t.top},"normal")}t.triggerContent=function(e){a.locateContentTarget(e)},t.$on("actionAatId",function(e,i){t.actionId=i,l(i)}),t.$on("cvfaInitReady",function(){}),t.$on("cvfaInitError",function(e,t,i){c(),console.error(t,i,"// this is on cvfaInitError console fail msg")}),t.$on("makeCatReady",function(){t.cat=a.cat,o(),t.cat.items.length||s("(∩_∩)还没有内容~~~")}),t.$on("makeCatError",function(e,t,i){c(),console.error(t,i,"// this is on makeCatError console fail msg")}),a.run("list",function(){r()})}]}}),module.directive("contentView",function(){return{template:['<div class="content-view">','<div ng-if="loading" class="loading-mask">加载中...</div>','<div ng-if="errorLock" class="error-mask">加载失败...</div>','<div ng-if="infoLock" class="info-mask">{{infoText}}</div>','<div class="content-iframe" ng-hide="errorLock"></div>','<iframe id="file-downl-iframe" width="0" height="0" frameborder="no" marginwidth="0" marginheight="0" scrolling="no"></iframe>',"</div>"].join(""),restrict:"E",replace:!0,transclude:!0,scope:{},controller:["$rootScope","$scope","$element","$attrs","$compile","cvfa",function(e,t,i,n,a,r){function o(){t.loading=!0}function c(){t.loading=!1}function s(){c(),t.errorLock=!0;try{t.$digest()}catch(e){}}function l(e){c(),t.infoLock=!0,t.infoText=e}t.$on("cvfaInitReady",function(e,t){}),t.$on("cvfaInitError",function(e,t,i){s(),console.error(t,i,"// this is on cvfaInitError console fail msg")}),t.$on("makeContentReady",function(){c()}),t.$on("makeContentError",function(e,t,i){switch(t){case"info":l(i);break;default:s()}console[t](i,"// this is on makeContentError console fail msg")}),t.$on("locateContentTarget",function(){o()}),r.viewNode=$(i).find(".content-iframe"),r.on("scroll",function(e,t,i,n){console.log("滚动视图",t,i,n)}),r.run("content",function(){o()})}]}}),module.directive("cvDialog",function(){return{template:['<div class="win-wrap" id="c-v-dialog" ng-show="cViewDialog.show">','<div class="win-mark"></div>','<div class="win-bd"></div>','<div class="my-wrap jf-drag">','<div class="my-main">','<div class="win-hd">',"<span>提示</span>","</div>",'<div class="inner">{{cViewDialog.text}}</div>','<div class="full-w">','<a href="javascript:;" class="blue-btn" ng-click="continueLearning($event)" ng-hide="cViewDialog.type">继续学习</a>','<a href="javascript:;" class="blue-btn" ng-click="continueLearning($event)" ng-show="cViewDialog.type == \'做题\'" style="margin:0 10px;">已完成做题</a>','<a href="javascript:;" class="white-btn" ng-click="continueLearning($event)" ng-show="cViewDialog.type == \'做题\'" style="margin:0 10px;">未完成做题</a>',"</div>","</div>","</div>","</div>"].join(""),restrict:"E",replace:!0,transclude:!0,scope:{},controller:["$scope","$rootScope","cvfa",function(e,t,i){e.cViewDialog={},e.continueLearning=function(t){e.cViewDialog.show=!1,"做题"===e.cViewDialog.type&&e.cViewDialog.paperNode.reloadPaper()},e.$on("bcvPractise",function(t,n,a,r,o){if(!i.self){var c="刚刚离开学习页，已暂停学习！";switch(a){case"做题":c="您在新开的页面进行做题，请进行如下操作"}e.cViewDialog=angular.extend(e.cViewDialog,{text:c,type:a,origin:r,show:n,paperNode:o});try{e.$digest()}catch(s){}}})}]}});