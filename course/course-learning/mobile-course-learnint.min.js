function jumpPage(t){angular.element($("div[ng-controller='contentCtr']")[0]).scope().toDestination(t)}function getNowSection(){angular.element($("div[ng-controller='contentCtr']")[0]).scope().getNowSection()}var module=angular.module("RCP",["ngCookies","ngRoute","ngSanitize","LocalStorageModule"]);if(module.factory("$resource",["request",function(t){return function(e){return{get:function(i,n,a){t({method:"GET",url:e,params:i}).then(n,function(t){"function"==typeof a&&a(t.data)})}}}}]),module.controller("contentCtr",["$rootScope","$scope","$timeout","service","cvfa",function(t,e,i,n,a){function o(){t.sectionLoadingReady=!1,t.contentLoadingReady=void 0}function r(i){o(),"/"==wcms.load[0]&&(wcms.load=wcms.load.slice(1)),wcms.load=DYCONFIG.course.rUrl+wcms.load,a.config({uid:1,contentId:i,t:"T",n:3,target:a.queryString("target")}).init(),e.$on("cvfaInitReady",function(){e.endingLoading("newLock")}),e.$on("cvfaInitError",function(t,i,n){e.endingLoading("newLock")}),e.$on("actionAatId",function(t,i){angular.forEach(a.cat.items,function(t,n){t.id==i&&(e.curSectionIndex=n+1,e.curSectionName=t.title,e.nowSection=t)})}),e.$on("makeContentReady",function(){t.contentLoadingReady=!0,loadingLayer.out()}),e.$on("makeContentError",function(e,i,n){t.contentLoadingReady=!0,loadingLayer.out()}),e.$on("locateContentTarget",function(){t.contentLoadingReady=!1,loadingLayer["in"]()})}window.mobileUpgradeStyle=1;var s=function(t){"请先登录"===t?n.loginModal.show():alert(t)},c=200;e.nowSection={},e.currentUser={},e.targetId=rcpAid.queryString("target"),e.courseId=rcpAid.queryString("cid"),e.isNullContent=!1,e.learningLocationData={},t.learningDialog={},loadingLayer["in"](),e.$on("login",function(i,n){n&&(e.currentUser=t.currentUser,e.courseDetail())}),e.init=function(){n.common.checkLogin()},e.courseDetail=function(){var t={text:{idx:{type:"items"}}},i={cid:e.courseId,cmds:angular.toJson(t)};n.course.getCourseDetail(i).then(function(t){e.courseDetailHub(t)},function(){e.endingLoading()})},e.courseDetailHub=function(i){return 0!==i.code?(s(i.msg),void e.endingLoading()):(t.courseData=i.data,t.readPermissions=t.courseData.joinMode,t.readPermissions?void e.showNewContentView():void e.endingLoading())},e.toDestination=function(t){return e.contentLoadingReady||"undefined"==typeof e.contentLoadingReady?void a.locateContentTarget(t):void s("内容正在加载中，请稍后")},e.showNewContentView=function(){try{if(!t.courseData.crs.iids.text.aid)return s("课程内容id不能为空"),void console.error("courseData.linkId == undefined");r(t.courseData.crs.iids.text.aid)}catch(e){}},e.endingLoading=function(){t.sectionLoadingReady=!0,e.contentLoadingReady=!0,i(function(){loadingLayer.out()},c)},e.getNowSection=function(){try{mobilePlug(e.nowSection,"section")}catch(t){}},e.init(),e.$on("freshReady",function(t,i){e.contentLoadingReady=i,i?loadingLayer.out():loadingLayer["in"]()}),e.continueLearning=function(t){e.$broadcast("continueLearning",$(t.target).html())}}]),module.factory("course",["request",function(t){var e=DYCONFIG.course.rUrl;return{getCourseDetail:function(i,n){i.token=rcpAid.getToken();var a={method:"GET",url:e+"pub/api/loadCourse",params:i};return t(angular.extend(a,n||{}))},getTeacherCourses:function(i,n){i.token=rcpAid.getToken(),i.isSelf=1;var a={method:"GET",url:e+"pub/api/searchCourse",params:i};return t(angular.extend(a,n||{}))},joinFreeCourse:function(i,n){i.token=rcpAid.getToken();var a={method:"GET",url:e+"usr/api/joinCourse",params:i};return t(angular.extend(a,n||{}))},searchCourse:function(i,n){var a={method:"GET",url:e+"pub/api/searchCourse",params:i};return t(angular.extend(a,n||{}))},verifyCourse:function(i,n){i.token=rcpAid.getToken();var a={method:"GET",url:e+"usr/api/verifyCourse",params:i};return t(angular.extend(a,n||{}))},createCourse:function(i,n,a){i.token=rcpAid.getToken();var o={method:"POST",url:e+"usr/api/createCourse",params:i,data:a};return t(angular.extend(o,n||{}))},getStudentCourse:function(i,n){i.token=rcpAid.getToken(),i.isSelf=10;var a={method:"GET",url:e+"pub/api/searchCourse",params:i};return t(angular.extend(a,n||{}))},releaseCourse:function(i,n){i.token=rcpAid.getToken();var a={method:"GET",url:e+"usr/api/releaseCourse",params:i};return t(angular.extend(a,n||{}))},saveCourseData:function(i,n){var a={};a.token=rcpAid.getToken();var o={method:"POST",url:e+"usr/api/updateCourse",params:a,data:i};return t(angular.extend(o,n||{}))},cancelCourse:function(i,n){i.token=rcpAid.getToken();var a={method:"POST",url:e+"usr/api/cancelCourse",params:i};return t(angular.extend(a,n||{}))},getListGroup:function(i,n){i.token=rcpAid.getToken();var a={method:"GET",url:e+"pub/api/listGroup",params:i};return t(angular.extend(a,n||{}))},getAllTags:function(e,i){e.token=rcpAid.getToken();var n={method:"POST",url:DYCONFIG.pes.rUrl+'pub/api/page/GetPage?keys=[{"key":"p_classifi"}]',params:e};return t(angular.extend(n,i||{}))}}}]),module.run(["service","course",function(t,e){t.expand("course",function(){return e})}]),!module)var module=angular.module("RCP",[]);module.directive("emptyTip",function(){return{template:'<div class="empty-tip" ng-style="boxStyle"><style type="text/css">.empty-tip{text-align:center;padding:30px 0}.empty-tip .msg{padding:10px 0 0;color:#999}.empty-tip .img{width:100%}</style><div ng-show="theme==1"><img src="/rcp-common/imgs/common/no-data.png" class="img" ng-style="imgStyle"></div><div ng-show="!theme"><img src="/rcp-common/imgs/common/icon-cloud.png" ng-style="imgStyle"></div><div ng-show="!theme" class="msg"><span ng-hide="showLogin">{{msg}}</span> <a href="" style="color:#00f" ng-show="showLogin">请先登录</a></div></div>',restrict:"E",replace:!0,transclude:!0,scope:{c:"="},controller:["$scope","service",function(t,e){t.msg="暂无数据",t.c&&angular.forEach(t.c,function(e,i){t[i]=e}),"请先登录"===t.msg&&(t.showLogin=!0,t.dialog=function(t){e.dialog.alert(t)})}]}});var wcms=function(){function t(){}function e(t,e){if("string"!=typeof t||t.trim().length<1)throw"the name must be string and not empty";if(this.name=t,e){if("number"!=typeof e||1>e)throw"the limit must be integer and >0";this.limit=e}else this.limit=5242880}function i(){}function n(e,i,n){if(!e||e.length<1)throw"article id is null or empty";this.aid=e,this.type=i,n&&n>0?this.count=n:this.count=10,this.args={},this.store=t.NewStore(e,4194304),this.init()}return t.langs={},t.langs.en={},t.langs.ch={},t.vals=t.langs.en,e.prototype.get=function(t){return window.localStorage[this.name+"_"+t]},e.prototype.getj=function(t){try{var e=this.get(t);return e&&e.length?JSON.parse(e):null}catch(i){return console.error("get json by key("+t+") error:"+i),null}},e.prototype.set=function(t,e){e+="";var i=this.get(t),n=0;if(n=i?this.size()+e.length-i.length:this.size()+e.length,n>this.limit)return!1;var a=this.idx();return a[t]=e.length,window.localStorage[this.name+"_"+t]=e,window.localStorage[this.name+"_size"]=n,window.localStorage[this.name+"_idx"]=JSON.stringify(a),!0},e.prototype.setj=function(t,e){return this.set(t,JSON.stringify(e))},e.prototype.del=function(t){var e=this.get(t);if(!e)return!1;var i=this.idx();return delete i[t],window.localStorage.removeItem(this.name+"_"+t),window.localStorage[this.name+"_size"]=this.size()-e.length,window.localStorage[this.name+"_idx"]=JSON.stringify(i),!0},e.prototype.idx=function(){var t=window.localStorage[this.name+"_idx"];return t&&t.length?JSON.parse(t):{}},e.prototype.size=function(){var t=window.localStorage[this.name+"_size"];return t?parseInt(t):0},e.prototype.clear=function(){var t=this.idx();for(var e in t)window.localStorage.removeItem(this.name+"_"+e);return window.localStorage.removeItem(this.name+"_size"),window.localStorage.removeItem(this.name+"_idx"),!0},t.LocStore=e,t.NewStore=function(t,i,n,a,o,r,s,c){return new e(t,i)},t.DelStroe=function(t,i,n,a,o,r,s,c){return new e(t,i).clear()},i.prototype.done=function(t){return this.done_=t,this},i.prototype.ondone=function(t,e,i){this.done_&&this.done_(t,e,i)},i.prototype.fail=function(t){return this.fail_=t,this},i.prototype.onfail=function(t,e,i){this.fail_&&this.fail_(t,e,i)},t.Res=i,t.create="/art/api/create",t.update="/art/api/update",t.load="/art/api/load",t.ART_TABLE="T",n.prototype.init=function(){this.inited=!1,this.saving=!1;var t=this.store.getj("art");t?(console.log("the local article data found, using cache"),this.art=t,this.cached=!0):this.art={ver:-1};var e=this.store.getj("einfo");e?(console.log("the local einfo data found, using cache"),this.einfo=e):this.einfo={};var i=this.store.getj("updated");i?(console.log("the local updated data found, using cache"),this.updated=i):this.updated={gids:{},iids:{},gidx:!1,iidx:!1};var n=this.store.getj("updated_");n?(console.log("the local updated_ data found, using cache"),this.updated_=n):this.updated_={gids:{},iids:{},gidx:!1,iidx:!1};var a=this.store.get("sequence");a?this.sequence=parseInt(a):this.sequence=0},n.prototype.ls_sync=function(){this.store.setj("art",this.art),this.store.setj("sequence",this.sequence),this.store.setj("einfo",this.einfo),this.store.setj("updated",this.updated),this.store.setj("updated_",this.updated_)},n.prototype.ls_clear=function(){this.store.clear(),this.init()},n.prototype.nid=function(){var t="l"+this.sequence++;return this.ls_sync(),t},n.prototype.nfid=function(){var t="l"+(new Date).getTime()+this.sequence++;return this.ls_sync(),t},n.prototype.chk_updated=function(t){for(var e in t.gids)return!0;for(var i in t.iids)return!0;return t.gidx||t.iidx},n.prototype.isUpdated=function(){return this.chk_updated(this.updated)},n.prototype.isUpdated_=function(){return this.chk_updated(this.updated_)},n.prototype.resetUpdated=function(){this.updated.gids={},this.updated.iids={},this.updated.gidx=!1,this.updated.iidx=!1},n.prototype.resetUpdated_=function(){this.updated_.gids={},this.updated_.iids={},this.updated_.gidx=!1,this.updated_.iidx=!1},n.prototype.art_merge_u=function(t,e){t.gidx=t.gidx||e.gidx,t.iidx=t.iidx||e.iidx;for(var i in e.gids)t.gids[i]=e.gids[i];for(var n in e.iids)t.iids[n]=e.iids[n]},n.prototype.art_merge_i=function(t,e){if(e.items){if(!t.items)return void(t.items=e.items);for(var i in e.items)this.updated.iids[i]||(t.items[i]=e.items[i])}},n.prototype.art_merge_g=function(t,e){if(e.groups){if(!t.groups)return void(t.groups=e.groups);for(var i in e.groups)this.updated.gids[i]||(t.groups[i]=e.groups[i])}},n.prototype.art_merge=function(t,e){"undefined"!=typeof e.ver&&(t.ver=e.ver),e.idx&&(t.idx=e.idx),this.art_merge_i(t,e),this.art_merge_g(t,e)},n.prototype.einfo_merge=function(t,e){if(e)for(var i in e)t[i]=e[i]},n.prototype.chk_init=function(){if(!this.inited)throw"Article is not inited"},n.prototype.load_=function(e,n,a,o,r,s,c,d){var l={};l.aid=this.aid,e&&e.length&&(l.items=e),n&&n.length&&(l.groups=n),a&&a.length&&(l.type=a),o&&(l.count=o),r&&(l.itemc=r),s&&(l.idx=s),c&&(l.access=c),d&&(l.last=d);for(var u in this.args)l[u]=this.args[u];console.log("load article by "+JSON.stringify(l));var p=new i;return $.getJSON(t.load,l,function(t){p.ondone(t)}).fail(function(t){p.onfail("load fail by state:"+t.readyState+", error:"+t.statusText+", text:\n"+t.responseText,t)}),p},n.prototype.load=function(t,e,n,a,o,r,s,c){var d=new i,l=this;return this.load_(t,e,n,a,o,r,s,c).done(function(t){if(0!==t.code){var e="load article fail by code:"+t.code+", msg:"+t.msg+", dmsg:"+t.dmsg;return console.error(e),l.onLoadFail(e,t),void d.onfail(e,t)}return l.art.ver<0?(console.log("load and merge article success on first load, the base version: "+t.data.art.ver),l.art=t.data.art,l.einfo=t.data.einfo,l.onLoadDone(l,t.data),d.ondone(l,t.data),void l.ls_sync()):void(l.art.ver==t.data.art.ver?(console.log("load and merge article success on the same version: "+l.art.ver),l.art_merge(l.art,t.data.art),l.einfo_merge(l.einfo,t.data.einfo),l.onLoadDone(l,t.data),d.ondone(l,t.data),l.ls_sync()):(console.error("load article fail by having new version->",t.data.art.ver),l.onNewVer(l,t.data),d.onfail("NEW_VER",t.data)))}).fail(function(t,e){l.onLoadFail(t,e),d.onfail(t,e)}),d},n.prototype.run=function(){var e=this,n=new i,a=!1,o=function(){var i=1,r=t.ART_TABLE,s=e.count;e.art.idx&&e.art.idx.iids&&(i=0,r="",s=0),e.load(null,null,r,s,i,i,i,i).done(function(t,e){t.inited=!0,n.ondone(t,e)}).fail(function(t,i){return a||"NEW_VER"!==t?void n.onfail(t,i):(e.ls_clear(),e.init(),a=!0,void o())})};return o(),n},n.prototype.next=function(t){for(var e=[],n=0;n<t.length;n++)this.art.items[t[n]]||this.einfo[t[n]]||e.push(t[n]);var a=this;if(e.length<1){var o=new i;return o.done=function(t){return t(a),this},o}return this.load(e.join(","))},n.prototype.listGroup=function(t){for(var e=[],n=0;n<t.length;n++)this.art.groups[t[n]]||"_"!=t[n]&&"E"!=t[n]&&e.push(t[n]);var a=this;if(e.length<1){var o=new i;return o.done=function(t){return t(a),this},o}return this.load(null,e.join(","))},n.prototype.findIids=function(t){if(this.chk_init(),!this.art.idx||!this.art.idx.iids)return[];if(!t)return this.art.idx.iids;for(var e=[],i=0;i<this.art.idx.iids.length;i++){var n=this.art.idx.iids[i];t[this.art.idx.i2t[n]]&&e.push(n)}return e},n.prototype.findGids=function(){return this.chk_init(),this.art.idx&&this.art.idx.gids?this.art.idx.gids:[]},n.prototype.findItem=function(t,e,i){this.chk_init();var n=null;if(this.art.items&&this.art.items[t])n=this.art.items[t],n.visiable=!0;else{if(!this.einfo||!this.einfo[t])return null;n={g:this.einfo[t],visiable:!1}}return e&&(this.art.groups&&this.art.groups[n.g]?n.group=this.art.groups[n.g]:n.group=null),i&&(this.art.idx&&this.art.idx.gic&&this.art.idx.gic[n.g]?n.gic=this.art.idx.gic[n.g]:n.gic=null),n},n.prototype.findGroup=function(t){return this.chk_init(),this.art.groups&&this.art.groups[t]?this.art.groups[t]:null},n.prototype.moveItem=function(t,e){if(this.chk_init(),0>t||0>e||t>this.art.idx.iids.length-1||e>this.art.idx.iids.length-1)throw"index out of bound "+JSON.stringify({idxa:t,idxb:e,ilen:this.art.idx.iids.length});this.art.idx.iids.splice(e,0,this.art.idx.iids.splice(t,1)[0]),this.updated.iidx=!0,this.ls_sync()},n.prototype.moveItem2=function(t,e){e?this.moveItem(t,t-1):this.moveItem(t,t+1)},n.prototype.moveItem3=function(t,e){this.chk_init();for(var i=-1,n=0;n<this.art.idx.iids.length;n++)if(this.art.idx.iids[n]==t){i=parseInt(n);break}if(0>i)throw"the item id("+t+") is not found on article";this.moveItem2(i,e)},n.prototype.updateItem=function(t,e){if(this.chk_init(),!this.art.items[t])throw"the item id("+t+") is not found on article";if(this.art.items[t].t!=e.t)throw"the item("+t+") type can not be updated";this.art.items[t]=e,this.updated.iids[t]=1,this.ls_sync()},n.prototype.updateGroup=function(t,e){if(this.chk_init(),!this.art.groups[t])throw"the group id("+t+") is not found on article";this.art.groups[t]=e,this.updated.gids[t]=1,this.ls_sync()},n.prototype.addItem=function(t,e){this.chk_init(),"undefined"==typeof e&&(e=this.art.idx.iids.length);var i=this.nid();return this.art.items||(this.art.items={}),this.art.items[i]=t,this.art.idx.iids.splice(e,0,i),this.art.idx.i2t[i]=t.t,this.updated.iidx=!0,this.updated.iids[i]=1,this.ls_sync(),console.log("add item success by id("+i+") on index"+e+"->",JSON.stringify(t)),i},n.prototype.addGroup=function(t,e){this.chk_init(),"undefined"==typeof e&&(e=this.art.idx.gids.length);var i=this.nid();return this.art.groups||(this.art.groups={}),this.art.groups[i]=t,this.art.idx.gids.splice(e,0,i),this.updated.gidx=!0,this.updated.gids[i]=1,this.ls_sync(),console.log("add group success by id("+i+") on index"+e+"->",JSON.stringify(t)),i},n.prototype.removeItem=function(t){this.chk_init();for(var e=-1,i=0;i<this.art.idx.iids.length;i++)if(this.art.idx.iids[i]==t){e=parseInt(i);break}if(0>e)throw"the item id("+t+") is not found on article";delete this.art.items[t],this.art.idx.iids.splice(e,1),delete this.art.idx.i2t[t],this.updated.iidx=!0,this.ls_sync()},n.prototype.save_=function(){var e=new i;if(this.saving){var n="there is already having task to save article";return console.log(n),e.fail=function(t){return t(n),this},e}this.saving=!0,this.art_merge_u(this.updated_,this.updated),this.resetUpdated(),this.ls_sync(),console.log("saving article....");var a=this,o={};o.ver=a.art.ver,o.id=a.art.id,o.idx={},this.updated_.iidx&&(o.idx.iids=a.art.idx.iids),this.updated_.gidx&&(o.idx.gids=a.art.idx.gids),o.items={};for(var r in this.updated_.iids)o.items[r]=a.art.items[r];o.groups={};for(var s in this.updated_.gids)o.groups[s]=a.art.groups[s];var c=JSON.stringify(o);return console.log("saving the article by args:",o),$.ajax({url:t.update+"?"+$.param(a.args),type:"POST",data:c,dataType:"json",contentType:"application/json",success:function(t,i,n){a.saving=!1,e.ondone(a,t,i,n)},error:function(t,i,n){a.saving=!1,e.onfail("save fail by state:"+t.readyState+", error:"+t.statusText+", text:\n"+t.responseText,t,i,n)}}),e},n.prototype.save=function(){var t=new i,e=this;return this.isUpdated()?(this.save_().done(function(i,n){if(0===n.code){e.art_merge(e.art,n.data.art);var a=0,o=0;for(var r in n.data.gidm)delete e.art.groups[r],a++;for(var s in n.data.iidm)delete e.art.items[s],o++;console.log("update article success to ver("+n.data.art.ver+") with gidmc("+a+"),iidmc("+o+")"),e.resetUpdated_(),e.ls_sync(),e.onSaveDone(e,n.data,a,o),t.ondone(e,n.data,a,o)}else if(409===n.code)console.error("update article faild base ver("+e.art.ver+")->"+JSON.stringify(n.data.art.last)),e.art_merge_u(e.updated,e.updated_),e.resetUpdated_(),e.ls_sync(),e.onSaveConfict(e,n.data),t.onfail("confict",n.data);else{var c="update article fail by code:"+n.code+", msg:"+n.msg+", dmsg:"+n.dmsg;console.error(c),e.art_merge_u(e.updated,e.updated_),e.resetUpdated_(),e.ls_sync(),e.onSaveFail(c,n),t.onfail(c,n)}this.saving=!1}).fail(function(i,n){e.art_merge_u(e.updated,e.updated_),e.resetUpdated_(),e.ls_sync(),e.onSaveFail(i,n),t.onfail(i,n)}),t):(t.done=function(t){return t(e),this},t)},n.prototype.onSaveDone=function(t,e,i,n){},n.prototype.onSaveConfict=function(t,e){},n.prototype.onSaveFail=function(t,e){},n.prototype.onNewVer=function(t,e){},n.prototype.onLoadDone=function(t,e){},n.prototype.onLoadFail=function(t,e){},t.Article=n,window.wcms=t,t}();module.factory("courseContent",["request",function(t){var e=DYCONFIG.fs;return{transDownloadUrl:function(t){return e.down+"?mark="+t+"&dl=1&token="+rcpAid.getToken()},transImgUrl:function(t){return e.down+"?mark="+t+"&token="+rcpAid.getToken()},transVideoUrl:function(t){return e.down+"?mark="+t+"&type=V_pc&token="+rcpAid.getToken()},transFlashUrl:function(t){return e.down+"?mark="+t+"&token="+rcpAid.getToken()},transPreviewUrl:function(t,e,i){try{return"/course/document-preview.html?mark="+t+"&type="+this.convertExt.transExecType[e]+"&count="+i[this.convertExt.transExecType[e]].count}catch(n){console.log(n)}},convertExt:{video:["wmv","rm","rmvb","mpg","mpeg","mpe","3gp","mov","mp4","m4v","avi","mkv","flv","vob"],attach:["doc","docx","pdf","ppt","pptx"],transExecType:{doc:"D_docx",docx:"D_docx",ppt:"D_pptx",pptx:"D_pptx",pdf:"D_pdfx"}},bindHtml:function(t,e,i){return"flash"===t?'<embed src="'+this.transFlashUrl(e)+'" id="embed-flash-'+i.id+'"wmode="Opaque"allowfullscreen="true"quality="high"width="800"height="450"align="middel"allowscriptaccess="always"type="application/x-shockwave-flash"per="100%">':"video"===t?'<video id="video-main-'+i.id+'" src="'+this.transVideoUrl(e)+'"class="ckVideo" style="background-color: #000000" width="640"height="360" per="100%" preload="none"controls="controls"></video>':void 0},getFileInfo:function(i,n){var a={};return a="string"==typeof i?{method:"GET",url:e.info,params:{mark:i,mode:"mark"}}:{method:"GET",url:e.listInfo,params:{mark:i.join(","),mode:"mark"}},t(angular.extend(a,n||{}))}}}]),module.run(["service","courseContent",function(t,e){t.expand("courseContent",function(){return e})}]),module.factory("examReq",["request",function(t){var e=DYCONFIG.course.rUrl;return{getListGroup:function(i,n){i.token=rcpAid.getToken();var a={method:"GET",url:e+"pub/api/listGroup",params:i};return t(angular.extend(a,n||{}))},getListItemL:function(i,n){i.token=rcpAid.getToken();var a={method:"GET",url:e+"pub/api/listItemL",params:i};return t(angular.extend(a,n||{}))},answerPaper:function(i,n){i.token=rcpAid.getToken();var a={method:"GET",url:e+"usr/api/answer",params:i,option:{loading:!1}};return t(angular.extend(a,n||{}))},startAnswer:function(i,n){i.token=rcpAid.getToken();var a={method:"GET",url:e+"usr/api/startAnswer",params:i};return t(angular.extend(a,n||{}))},doneAnswer:function(i,n){i.token=rcpAid.getToken();var a={method:"GET",url:e+"usr/api/doneAnswer",params:i};return t(angular.extend(a,n||{}))},listExam:function(i,n){i.token=rcpAid.getToken();var a={method:"GET",url:e+"usr/api/listExam",params:i};return t(angular.extend(a,n||{}))},createPaper:function(i,n){i.token=rcpAid.getToken();var a={method:"GET",url:e+"art/api/create",params:i};return t(angular.extend(a,n||{}))}}}]),module.run(["service","examReq",function(t,e){t.expand("examReq",function(){return e})}]),module.factory("cvfa",["$rootScope","$timeout","$http","$q","service",function(t,e,i,n,a){function o(t,e){var i=/(\.\w*)$|(\.\w*?)\?|(\.\w*?)\#/.exec(t||"")||[],n=i[1]||i[2]||i[3];return"embed"===e?void c({link:t,type:0},"link"):"flash"===e||n&&(/\.swf$/.test(n)||/\.swf\?/.test(n))?void alert("您的手机不支持swf文件，请使用网页观看"):t?void c({src:t},"video"):void alert('抱歉，视频地址不能播放  src="'+t+'"')}function r(t){c({src:t},"photo")}function s(t){var e=t,i=/(\.\w*)$|(\.\w*?)\?|(\.\w*?)\#/.exec(e||"")||[],n=i[1]||i[2]||i[3];return n&&(/\.swf$/.test(n)||/\.swf\?/.test(n))?void alert("您的手机不支持swf文件，请使用网页观看"):void c({link:t},"link")}function c(t,e){var i=rcpAid.detectOS().name;switch(i){case"iPad":case"iPhone":d(t,e);break;default:l(t,e)}}function d(t,e){switch(e){case"video":window.webkit.messageHandlers.notification.postMessage({video:t.src});break;case"photo":window.webkit.messageHandlers.notification.postMessage({photo:t.src});break;case"ppt":window.webkit.messageHandlers.notification.postMessage({ppt:t.list});break;case"link":window.webkit.messageHandlers.notification.postMessage({link:t.link});break;case"paper":window.webkit.messageHandlers.notification.postMessage({paper:{pid:t.pid,title:t.title}})}}function l(t,e){var i=rcpAid.detectOS().isCrosswalk?NativeJsInterface:window.NativeJsInterface;switch(e){case"video":i.clickVideo(t.src);break;case"photo":i.clickOnePhoto(t.src);break;case"ppt":i.clickPhotoDoc(t.list);break;case"link":i.clickLink(t.link,u(t.link,"h5")?1:0);break;case"paper":i.clickPaper(t.pid,t.title)}}function u(t,e){var i=t.match(new RegExp("[?&]"+e+"=([^&]+)","i"));return null==i||i.length<0?"":decodeURIComponent(i[1])}function p(t){var e={yinyuetai:{reg:/http:\/\/www\.yinyuetai\.com/,param:"&auto=1"},56:{reg:/http:\/\/player\.56\.com/,param:"&auto=1"},ku6:{reg:/http:\/\/player\.ku6\.com/,param:"&auto=1"},sohu:{reg:/http:\/\/share\.vrs\.sohu\.com/,param:"&autoplay=true"},tudou:{reg:/http:\/\/www\.tudou\.com/,param:"&autoPlay=true"},youku:{reg:/http:\/\/player\.youku\.com/,param:"&isAutoPlay=true"},qq:{reg:/http:\/\/static\.video\.qq\.com/,param:"&auto=1"}};return angular.forEach(e,function(e){t.match(e.reg)&&(t+=e.param)}),t}function f(t,e,i){var n=$(t),a=e.t;if(n.get(0).contentData=e,i){var o=n.find(i.tag).eq(0);i.style&&o.css(i.style),"embed"!==a&&"video"!==a||n.find("iframe,embed").removeAttr("style").css({height:"100%"})}switch(a){case"flash":case"embed":case"video":n.find(".up").on({click:function(){n.find("iframe,video").attr("src",""),n.find(".w").hide().prev().show()}}),"embed"===a&&n.find(".thumbnail").html("").append(P(n));break;case"attach":n.find(".dwl").on({click:function(t){t.preventDefault(),K()?alert("请在网页端下载"):$("#file-downl-iframe").attr("src",e.c.url)}});break;case"text":K()&&(n.find("a").each(function(){$(this).on({click:function(t){t.preventDefault(),s($(this).attr("href"))}})}),n.find("img").each(function(){$(this).on({click:function(t){t.preventDefault(),r($(this).attr("src"))}})}));break;case"link":K()&&n.find(".link").on({click:function(t){t.preventDefault(),s($(this).attr("href"))}});break;case"paper":var c=Math.random().toString(36).substr(2,15),d=n.get(0);d.reloadPaper=function(){h(n,e)},d.reloadPaper(),st[c]=d,e.paperNode=c}return n}function h(t,e){t.find(".ldg").show(),t.find(".c").hide(),t.find(".ldg").hide(),t.find(".c").show(),K()?t.find(".do-t-btn").html("开始做题").unbind("click").bind("click",function(){c({pid:e.c.aid,title:e.c.title},"paper")}):t.find(".do-t-btn").html("继续做题").unbind("click").bind("click",function(){window.open(rcpAid.getUrl("做题页",{aid:e.c.aid}))});var i={aids:e.c.aid,ret_score:1};a.examReq.listExam(i).then(function(e){console.log(e),t.find(".c").find(".status").show()},function(e){console.log(e,"获取练习信息失败"),t.find(".ldg").hide(),t.find(".c").show().html("获取练习信息失败")})}function g(t){return v(ct.content.items[t])}function v(t){var e,i=t.t;switch(typeof dt[i]){case"function":t.c.status&&"EDIT"===t.c.status&&(i="isedit"),e=dt[i](t);break;default:i="isbuild",e=dt[i](t)}return ct.content.cache[t.cvp.id]=t,e}function m(t,e,i){var n=t.width(),a=t.height();if(!(e>=n)){var o=i||e,r=e*a/n;t.width(o),t.height(r)}}function w(t){var e=t.width();t.find("img").each(function(){m($(this),e)}),t.find(".cp-embed,.cp-video,.cp-flash").each(function(){$(this).find(".embed-w,.video-w,.flash-w").each(function(){m($(this),e)})})}function y(t){var e=$(ct.viewNode),i="div";t.find("img").each(function(t,n){k({winTag:i,win:e,node:$(this),callback:function(){var t=$('<img src="'+$(n).attr("data-src")+'" style="'+($(n).attr("style")||"")+'" />');t.on({click:function(){K()&&r($(this).attr("src"))},load:function(){},error:function(){$(this).attr("src",rt).parent().addClass("error-img")}}),$(n).after(t).remove()}})}),t.find(".timg").each(function(t,n){k({winTag:i,win:e,node:$(this),callback:function(){var t=$(n).find(".thumbnail"),e=t.attr("data-img");e&&t.css({backgroundImage:"url("+e+")"})}})})}function k(t){function i(){var e=t.node;if(e.length&&!a&&!e.is(":hidden")){var i=r.scrollTop(),o=i+r.height(),s="window"===t.winTag?e.offset().top:e.position().top+i,c=s+e.height(),d=s>=i&&o>=s,l=i>=s&&c>=i;(d||l)&&(a=!a,"function"==typeof t.callback&&(t.callback(),r.unbind("scroll",n),r.unbind("resize",n)))}}function n(){e.cancel(o),o=e(i,200)}var a,o,r=t.win;n(),r.bind("scroll",n),r.bind("resize",n)}function b(t){window.resm=t}function x(t){var e=[];return angular.forEach(t,function(t){e.push(t)}),e}function _(){var t=x(arguments),e=t[0],i=t.slice(1,t.length);"function"==typeof e&&e.apply(e,i)}function T(t){ct.idsCat=I(t.findIids({T1:1,T2:1})||[]),C(ct.idsCat,ct.cat.items)}function C(e,i){ct.art.next(e).done(function(n,a){angular.forEach(e,function(t){var e=ct.art.findItem(t,1,1);i.push({id:t,title:e.c.title,type:e.t})}),t.$broadcast("makeCatReady",n,a)}).fail(function(e,i){t.$broadcast("makeCatError",e,i),b(e,i)})}function S(t){tt=!1;var e=$(ct.viewNode),i='<p class="append-loading" style="padding:30px 0;font-size:14px;color:#999;text-align:center;">正在加载...</p>',n=0;switch(t){case"top":e.children(".cp-section").first().before(i),e.scrollTop(n);break;case"bottom":e.children(".cp-section").last().after(i),n=e.get(0).scrollHeight-e.height(),e.scrollTop(n)}}function I(t){var e=[];return angular.forEach(t,function(t){e.join(",").match(new RegExp("s"+t+"s"))||e.push(t)}),e}function E(t,e){var i=I(t.findIids()||[]);ot=Math.ceil(i.length/ct.params.ps)-1,ct.idsContent=i,ct.locateContentTarget(e||i[0])}function L(t){console.log("显示页：",t);var e=$(ct.viewNode);e.children('.cp-section[data-cpn="'+t+'"]').show(),A()}function D(t,e,i,n){var a=$(ct.viewNode),o=a.children(".cp-section"),r=$(document.createDocumentFragment());angular.forEach(i,function(t){r.append(g(t))}),$.each(ct.content.page,function(e){return parseInt(e)>n?(t="top",o=a.children('.cp-section[data-cpn="'+e+'"]'),!1):void 0}),o.length?"top"===t?o.first().before(r):o.last().after(r):a.append(r),a.children(".cp-section[data-cpn="+n+"]").each(function(){w($(this)),y($(this))}),A()}function N(){tt=!0;var e=$(ct.viewNode);e.find(".append-loading").remove(),U(function(){e.css({visibility:"visible"}),nt=!1,et=null,t.$broadcast("makeContentReady")})}function A(){R(N)}function j(){var t=$(ct.viewNode),e=parseInt(t.get(0).scrollHeight),i=parseInt(t.outerHeight(!0));return console.log("滚动高度",e,i),e>i}function R(t){return j()?void _(t):void O("bottom")}function U(e){var i=$(ct.viewNode),n=0;if(G(),et){it=!0,i.scrollTop(0);var a=i.children('.cp-section[data-cid="'+et+'"]'),o=a.position().top,r=parseInt(i.css("paddingTop"));n=Math.ceil(o-r+at),console.log("高度",n,i[0].scrollHeight,i.height()),i.scrollTop(n).css({width:"100%",height:"100%"}),it=!1,console.log("第一次不等即有问题",i.scrollTop(),n),i.scrollTop()===n||nt?_(e):(i.css({visibility:"visible"}),nt=!1,t.$broadcast("makeContentReady"))}else _(e)}function G(){var t=nt&&et;if(console.log("ContentHeight",nt,et),!j()||t){var e=$(ct.viewNode),i=e.children(".cp-section"),n=e.outerHeight(!0),a=0;i.last().css({height:""}),i.each(function(t){var e=$(i).eq(i.length-(t+1));return a+=e.outerHeight(!0),e.hasClass("cp-t1")||e.hasClass("cp-t2")?!1:void 0});var o=n-a+i.last().outerHeight(!0),r=+e.children('.cp-section[data-cid="'+et+'"]').attr("data-cpn");r||(r=i.last().get(0).contentData.cvp.pn),console.log("页数",r,ot,o),r>=ot?console.log("已到最后一页"):(console.log("加载页",+r+1),L(+r+1))}}function O(i){var n=$(ct.viewNode),a=n.children(".cp-section:visible"),o=0,r=null,s=null;if(et||(r=500),a.length){switch(i){case"top":s=a.first().get(0),o=s.contentData.cvp.pn,o-=1;break;case"bottom":o=a.last().get(0).contentData.cvp.pn,o+=1}if(o>=0&&ot>=o)s&&(et=s.contentData.cvp.id),S(i),e(function(){X(i,ct.idsContent,o)},r);else{console.info("top"===i?"已到最顶部了":"已到最底部了",o),console.log(et);var c=a.last().height(),d=n.height();"top"!==i&&(d-c>c&&o>1&&(a.last().css({height:d-c}),console.log("设置高度")),o>1?N():(n.css({visibility:"visible"}),nt=!1,t.$broadcast("makeContentReady")))}}}function q(t){var e=ct.idsContent,i=$.inArray(t,e);if(!e.length)return void M("info","(∩_∩)还没有内容~~~");if(!t)return void M("error","ID出错,赶紧找程序猿");if(-1===i)return void M("error","内容ID表单里找不到"+t);tt=!1;var n=Math.floor(i/ct.params.ps),a=ct.content.items;return a[t]?(console.log("aa",n,i,ct.params.ps,a[t].cvp.pn),void L(a[t].cvp.pn)):void X(null,e,n)}function P(t){var e=$('<a href="javascript:;" class="open"><i class="fa fa-play-circle-o"></i></a>');return e.on({click:function(){if(K()){var e=t.get(0).contentData;return void o(e.c.src,e.t)}var i=$(this).parent().parent(),n=i.next(),a=n.find("iframe,embed,video");i.hide(),n.show(),a.attr("src",a.attr("data-src"))}}),e}function V(t,e,i,n){var o,r,s,c,d,l,u=$('div[data-cid="'+i.cvp.id+'"]');switch(t){case"attach":var p=e.ext.replace(".","");switch(e.status){case"SUCCESS":K()||"done"===e.exec&&a.courseContent.convertExt.transExecType[p]&&(l=a.courseContent.transPreviewUrl(e.mark,p,e.execInfo),l&&(d='<a class="link mg-l20" href="'+l+'" target="_blank" title="">预览</a>',u.append(d)));break;case"N":K()||"done"===e.exec&&a.courseContent.convertExt.transExecType[p]&&(l=a.courseContent.transPreviewUrl(e.mark,p,e.execInfo),l&&(d='<a class="link mg-l20" href="'+l+'" target="_blank" title="">预览</a>',u.append(d)))}break;case"video":switch(e.status){case"N":"done"===e.exec?(o=[],r=o[o.length-1]||"",s=u.find(".thumbnail"),c=s.css("opacity"),d=P(u),s.html(d),c&&"0"!==c?s.css({backgroundImage:"url("+r+")"}):s.attr("data-img",r)):u.find(".timg").hide();break;case"SUCCESS":"done"===e.exec?(o=[],r=o[o.length-1]||"",s=u.find(".thumbnail"),c=s.css("opacity"),d=P(u),s.html(d),c&&"0"!==c?s.css({backgroundImage:"url("+r+")"}):s.attr("data-img",r)):u.find(".timg").hide();break;case"FAIL":u.find(".thumbnail").html("转码失败");break;case"CONVERT":u.find(".thumbnail").html("转码中...");break;case"UNKNOWN":u.find(".thumbnail").html("未知")}break;case"flash":switch(e.status){case"N":u.find(".thumbnail").html("").append(P(u));break;case"SUCCESS":u.find(".thumbnail").html("").append(P(u));break;case"UPLOAD":u.find(".thumbnail").html("上传中...");break;case"FAIL":u.find(".thumbnail").html("上传失败");break;case"UNKNOWN":u.find(".thumbnail").html("未知");
}}}function z(t){var i=[],n={};angular.forEach(t,function(t){switch(t.t){case"attach":t.c.url=a.courseContent.transDownloadUrl(t.c.mark),t.c.ext&&(e(function(){V(t.t,t.c,t,t)},200),i.push(t.c.id),n[t.c.id]=t);break;case"video":t.c.url=a.courseContent.transVideoUrl(t.c.mark),e(function(){V(t.t,t.c,t,t)},200),i.push(t.c.id),n[t.c.id]=t;break;case"flash":t.c.url=a.courseContent.transFlashUrl(t.c.mark),e(function(){V(t.t,t.c,t,t)},200);break;case"image":t.c.url=a.courseContent.transImgUrl(t.c.mark)}})}function F(t,e){function i(t){var i=$('div[data-cid="'+t.cvp.id+'"]');i.find(".thumbnail").html(e)}angular.forEach(t,function(t){i(t)})}function H(t,e,i,n){if(e>ot)return void console.error("页数:"+e+" 超出内容范围");var a=ct.params.ps,o=e*a,r=o+a,s=t.slice(o,r);J(s,i,n,e,a)}function J(t,e,i,n,a){ct.art.next(t).done(function(i){var o=ct.content.items;angular.forEach(t,function(e){var i=ct.art.findItem(e,1,1);i.cvp={id:e,pn:n,ps:a,tids:t},o[e]=i}),_(e,i,o,t)}).fail(function(t,e){_(i,t,e),b(t,e)})}function M(e,i){t.$broadcast("makeContentError",e,i)}function Y(){var t,e=$(ct.viewNode),i=e.children(".cp-section:visible");return i.each(function(){var e=$(this).position().top+$(this).height();if(e>0){try{t=$(this).get(0).contentData.cvp.id}catch(i){console.error($(this).get(0).contentData)}return!1}}),t}function W(t){var e,i=ct.idsContent,n=ct.art.art.idx.i2t;if(!t||!i.length)return e;var a=i.slice(0,$.inArray(t,i)+1);return $(a).each(function(t,i){var o=a[a.length-(t+1)];return"T1"===n[o]||"T2"===n[o]?(e=o,!1):void 0}),e}function B(t){var e=window.location.search.match(new RegExp("[?&]"+t+"=([^&]+)","i"));return e?decodeURIComponent(e[1]):""}function K(){return-1!==window.location.href.indexOf("mobile-course-learning.html")}function Q(t,e,i,n){var o={},r=[],s=[];return angular.forEach(e,function(e){s.push(t[e])}),angular.forEach(s,function(t){switch(t.t){case"attach":case"video":case"flash":case"image":r.push(t.c.mark),o[t.c.mark]=t}}),r.length?void a.courseContent.getFileInfo(r).then(function(t){for(var e in t.data)angular.extend(o[e].c,t.data[e].base);z(o),_(i,t)},function(t){_(i),_(n,t,r.length?o:null)}):void _(i)}function X(t,e,i){return ct.content.page[i]?(console.log("aa4",i),void L(i)):void H(e,i,function(e,n,a){console.log("/* request page content "+a+" */"),Q(n,a,function(){ct.content.page[i]=a,D(t,n,a,i)},function(t,e){e&&F(e,"获取文件id失败"),console.error(t," 获取文件id失败")})},function(t,e){M("error",t)})}var Z=B("cid"),tt=!0,et=null,it=null,nt=null,at=10,ot=0,rt="/rcp-common/imgs/icon/blank.png",st=("http://"+g_conf.ebs_srv+"/",g_conf.rcp_srv,{}),ct={self:null,art:null,idsCat:[],idsContent:[],cat:{items:[]},content:{items:{},cache:{},page:{}},params:{ps:10},config:function(t){return angular.extend(ct.params,t),this},queryString:B,locateContentTarget:function(i){t.$broadcast("locateContentTarget");var n=e(function(){e.cancel(n),et=i;var a=$(ct.viewNode);a.css({visibility:"hidden"}).children(".cp-section").hide().last().css({height:""}),a.children(".cp-embed,.cp-video").each(function(){$(this).find(".w").find(".up").click()});var o=W(i);t.$broadcast("actionAatId",o),q(i)})},on:function(t,e){switch(t){case"scroll":ct.scroll(e)}},scroll:function(i){function n(){var e=Y(),n=W(e);n&&t.$broadcast("actionAatId",n),i(ct,d,n,e)}function a(){if(tt&&!it){var t=this.scrollHeight,i=Math.ceil($(this).scrollTop()),a=$(this).outerHeight(!0),o=ct.idsContent;d="normal",0>=i&&o.length?(d="top",O(d)):i>=t-a&&o.length&&(d="bottom",O(d)),e.cancel(s),s=e(n,300)}}function o(){$(ct.viewNode).children(".cp-section").each(function(){w($(this))})}function r(){e.cancel(c),c=e(o,300)}var s=null,c=null,d=null,l=$(ct.viewNode);l.on({scroll:a,resize:r})},init:function(){var i=ct.params;return i.contentId?(ct.art=new wcms.Article(i.contentId,i.t,i.n),ct.art.args.uid=i.uid,void ct.art.run().done(function(e){T(ct.art),E(ct.art,i.target),t.$broadcast("cvfaInitReady",e)}).fail(function(e,i){t.$broadcast("cvfaInitError",e,i),"new version"===e?(console.info("本地版本与服务器版本不一致，将重新获取课程内容数据"),ct.art.ls_clear(),ct.init()):b(e,i)})):void e(function(){t.$broadcast("cvfaInitError","参数有误")},200)},run:function(t,e){_(e)}};K()&&$("body").addClass("mobile-content-view"),window.loadingLayerStyleText=window.loadingLayerStyleText||[".loading-layer{position:fixed;width:100%;height:100%;top:0;left:0;background:rgba(0,0,0,.3);z-index:999;transition:opacity .1s;}",".loading-circle{position:absolute;left:50%;top:50%;display:block;width:35px;height:35px;margin:-20px 0 0 -20px;}",'.loading-circle::before{content:"";position:absolute;left:-5px;top:-5px;display:block;width:100%;height:100%;border:5px solid rgba(0,0,0,.5);border-radius:50%;}','.loading-circle::after{content:"";position:absolute;left:-5px;top:-5px;display:block;width:100%;height:100%;border:5px solid transparent;border-bottom-color:white;border-radius:50%;}',".loading-amit-spin{-webkit-animation:spin .4s linear infinite;-moz-animation:spin .4s linear infinite;-o-animation:spin .4s linear infinite;animation:spin .4s linear infinite;-moz-transition:border .3s;-o-transition:border .3s;transition:border .3s;}","@-webkit-keyframes spin{0%{-webkit-transform:rotate(0);transform:rotate(0)}100%{-webkit-transform:rotate(360deg);transform:rotate(360deg)}}","@-moz-keyframes spin{0%{-moz-transform:rotate(0);transform:rotate(0)}100%{-moz-transform:rotate(360deg);transform:rotate(360deg)}}","@-o-keyframes spin{0%{-o-transform:rotate(0);transform:rotate(0)}100%{-o-transform:rotate(360deg);transform:rotate(360deg)}}","@keyframes spin{0%{-webkit-transform:rotate(0);-moz-transform:rotate(0);-o-transform:rotate(0);transform:rotate(0)}100%{-webkit-transform:rotate(360deg);-moz-transform:rotate(360deg);-o-transform:rotate(360deg);transform:rotate(360deg)}}"].join("");var dt={isbuild:function(t){var e=['<div class="cp-section cp-isbuild" data-cid="'+t.cvp.id+'" data-cpn="'+t.cvp.pn+'">',"此类型（"+t.t+"）内容正在建设中...","</div>"].join("");return f(e,t)},isedit:function(t){var e=['<div class="cp-section cp-isedit" data-cid="'+t.cvp.id+'" data-cpn="'+t.cvp.pn+'"></div>'].join("");return f(e,t)},T1:function(t){var e=['<div class="cp-section cp-t1" data-cid="'+t.cvp.id+'" data-cpn="'+t.cvp.pn+'">','<h1 class="title">'+t.c.title+"</h1>","</div>"].join("");return f(e,t)},T2:function(t){var e=['<div class="cp-section cp-t2" data-cid="'+t.cvp.id+'" data-cpn="'+t.cvp.pn+'">','<h2 class="title">'+t.c.title+"</h2>","</div>"].join("");return f(e,t)},text:function(t){var e=['<div class="cp-section cp-text" data-cid="'+t.cvp.id+'" data-cpn="'+t.cvp.pn+'">'+t.c.c+"</div>"].join("");return f(e,t)},flash:function(t){t.c.src=t.c.url;var e=['<div class="cp-section cp-flash" data-cid="'+t.cvp.id+'" data-cpn="'+t.cvp.pn+'">','<div class="timg"><div class="thumbnail">加载中...</div></div>','<div class="w">','<p><a href="javascript:;" class="up">收起 <i class="fa fa-arrow-circle-up"></i></a></p>','<p class="title" style="'+(t.c.title?"":"display:none")+'">'+t.c.title+"</p>",'<div class="flash-w">','<embed src="'+t.c.url+'" data-fid="'+t.c.fid+'"  quality="high" width="100%" height="100%" align="middle" allowscriptaccess="never" allowfullscreen="true" type="application/x-shockwave-flash">',"</div>","</div>","</div>"].join("");return f(e,t,{tag:".flash-w",style:angular.extend({width:"640px",height:"360px"},t.c.style||{})})},embed:function(t){var e=t.c.url||"",i=e.match(/\ssrc=["|'](.*?)["|']/)||[];i[1]&&(e=e.replace(/(\ssrc=["|']).*?(["|'])/,"$1"+p(i[1])+"$2")),t.c.src=(e.match(/\ssrc=["|'](.*?)["|']/)||[])[1]||"";var n=e.match(/<embed/);n||(e=e.replace(/\s(src=["|']?)/," data-$1"));var a=['<div class="cp-section cp-embed" data-cid="'+t.cvp.id+'" data-cpn="'+t.cvp.pn+'">','<div class="timg"><div class="thumbnail">加载中...</div></div>','<div class="w">','<p><a href="javascript:;" class="up">收起 <i class="fa fa-arrow-circle-up"></i></a></p>','<p class="title" style="'+(t.c.title?"":"display:none")+'">'+t.c.title+"</p>",'<div class="embed-w">'+e+"</div>","</div>","</div>"].join("");return f(a,t,{tag:".embed-w",style:t.c.style})},video:function(t){t.c.name=t.c.name?t.c.name:"";var e=['<div class="cp-section cp-video" data-cid="'+t.cvp.id+'" data-cpn="'+t.cvp.pn+'">','<div class="timg"><div class="thumbnail">加载中...</div></div>','<div class="w">','<p><a href="javascript:;" class="up">收起 <i class="fa fa-arrow-circle-up"></i></a></p>','<p class="title" style="'+(t.c.name?"":"display:none")+'">'+t.c.name.replace(/^.*\/|\..*$/g,"")+t.c.ext+"</p>",'<div class="video-w">','<video data-src="'+t.c.url+'" data-fid="'+t.c.id+'" style="width:100%;height:100%;" autoplay="autoplay" controls="controls">您的浏览器不支持 video 标签。</video>',"</div>","</div>","</div>"].join("");return t.c.src=t.c.url||"",f(e,t,{tag:".video-w",style:t.c.style})},image:function(t){var e=['<div class="cp-section cp-image" data-cid="'+t.cvp.id+'" data-cpn="'+t.cvp.pn+'">','<span class="img-blank"><img src="'+rt+'" data-src="'+t.c.url+'" data-fid="'+t.c.id+'" title="'+(t.c.filename||"")+'" /></span>',"</div>"].join("");return K()&&(t.c.style={}),f(e,t,{tag:"img",style:t.c.style})},link:function(t){var e=t.c.url;e&&e.match(/esp.aikexue.com/)&&(e.match(/cid=/)||(e+=(e.split("?")[1]?"&":"?")+"cid="+Z),e.match(/host=/)||(e+="&host="+window.location.host),t.c.url!==e&&(t.c.url=e));var i=['<div class="cp-section cp-link" data-cid="'+t.cvp.id+'" data-cpn="'+t.cvp.pn+'">','<a class="link" href="'+t.c.url+'" target="_blank" title="'+t.c.url+'">'+t.c.title+"</a>","</div>"].join("");return f(i,t)},attach:function(t){var e=['<div class="cp-section cp-attach" data-cid="'+t.cvp.id+'" data-cpn="'+t.cvp.pn+'">','<p class="title"><b>'+t.c.title+"</b></p>",'<a class="link dwl" href="'+t.c.url+'" data-fid="'+t.c.id+'" title="'+t.c.url+'">点击下载</a>',"</div>"].join("");return f(e,t)},paper:function(t){var e=['<div class="cp-section cp-practise" data-cid="'+t.cvp.id+'" data-cpn="'+t.cvp.pn+'">','<div class="w">','<i class="image-c-paper"></i>','<p class="ldg"></p>','<div class="c">','<p class="title" title="'+t.c.title+'">'+t.c.title+"</p>",'<p class="detail text-of"><span class="status" >0/9题<span></p>','<div class="action"><a href="javascript:;" class="do-t-btn"> 开始做题 </a><div>',"</div>","</div>","</div>"].join("");return f(e,t)}};return ct}]),module.directive("contentList",function(){return{template:['<div class="content-list">','<div ng-if="loading" class="loading-mask">加载中...</div>','<div ng-if="errorLock" class="error-mask">加载失败...</div>','<div ng-if="infoLock" class="info-mask">{{infoText}}</div>','<ul ng-hide="errorLock">','<li ng-repeat="item in cat.items track by $index" ng-if="item.type===\'T1\' || item.type===\'T2\'" ng-class="{action: actionId == item.id, t1: item.type === \'T1\', t2: item.type === \'T2\'}" ng-click="triggerContent(item.id)" data-tid="{{item.id}}">','<a title="{{item.title}}">{{item.title}}</a>',"</li>","</ul>","</div>"].join(""),restrict:"E",replace:!0,transclude:!0,scope:{},controller:["$rootScope","$scope","$element","$attrs","cvfa",function(t,e,i,n,a){function o(){e.loading=!0}function r(){e.loading=!1}function s(){r(),e.errorLock=!0;try{e.$digest()}catch(t){}}function c(t){r(),e.infoLock=!0,e.infoText=t}function d(t){var e=$('li[data-tid="'+t+'"]').position(),n=$(i);console.log("aa3",t,e),e&&(e.top<0||e.top>n.height())&&n.stop().animate({scrollTop:n.scrollTop()+e.top},"normal")}e.triggerContent=function(t){a.locateContentTarget(t)},e.$on("actionAatId",function(t,i){e.actionId=i,d(i)}),e.$on("cvfaInitReady",function(){}),e.$on("cvfaInitError",function(t,e,i){s(),console.error(e,i,"// this is on cvfaInitError console fail msg")}),e.$on("makeCatReady",function(){e.cat=a.cat,r(),e.cat.items.length||c("(∩_∩)还没有内容~~~")}),e.$on("makeCatError",function(t,e,i){s(),console.error(e,i,"// this is on makeCatError console fail msg")}),a.run("list",function(){o()})}]}}),module.directive("contentView",function(){return{template:['<div class="content-view">','<div ng-if="loading" class="loading-mask">加载中...</div>','<div ng-if="errorLock" class="error-mask">加载失败...</div>','<div ng-if="infoLock" class="info-mask">{{infoText}}</div>','<div class="content-iframe" ng-hide="errorLock"></div>','<iframe id="file-downl-iframe" width="0" height="0" frameborder="no" marginwidth="0" marginheight="0" scrolling="no"></iframe>',"</div>"].join(""),restrict:"E",replace:!0,transclude:!0,scope:{},controller:["$rootScope","$scope","$element","$attrs","$compile","cvfa",function(t,e,i,n,a,o){function r(){e.loading=!0}function s(){e.loading=!1}function c(){s(),e.errorLock=!0;try{e.$digest()}catch(t){}}function d(t){s(),e.infoLock=!0,e.infoText=t}e.$on("cvfaInitReady",function(t,e){}),e.$on("cvfaInitError",function(t,e,i){c(),console.error(e,i,"// this is on cvfaInitError console fail msg")}),e.$on("makeContentReady",function(){s()}),e.$on("makeContentError",function(t,e,i){switch(e){case"info":d(i);break;default:c()}console[e](i,"// this is on makeContentError console fail msg")}),e.$on("locateContentTarget",function(){r()}),o.viewNode=$(i).find(".content-iframe"),o.on("scroll",function(t,e,i,n){console.log("滚动视图",e,i,n)}),o.run("content",function(){r()})}]}}),module.directive("cvDialog",function(){return{template:['<div class="win-wrap" id="c-v-dialog" ng-show="cViewDialog.show">','<div class="win-mark"></div>','<div class="win-bd"></div>','<div class="my-wrap jf-drag">','<div class="my-main">','<div class="win-hd">',"<span>提示</span>","</div>",'<div class="inner">{{cViewDialog.text}}</div>','<div class="full-w">','<a href="javascript:;" class="blue-btn" ng-click="continueLearning($event)" ng-hide="cViewDialog.type">继续学习</a>','<a href="javascript:;" class="blue-btn" ng-click="continueLearning($event)" ng-show="cViewDialog.type == \'做题\'" style="margin:0 10px;">已完成做题</a>','<a href="javascript:;" class="white-btn" ng-click="continueLearning($event)" ng-show="cViewDialog.type == \'做题\'" style="margin:0 10px;">未完成做题</a>',"</div>","</div>","</div>","</div>"].join(""),restrict:"E",replace:!0,transclude:!0,scope:{},controller:["$scope","$rootScope","cvfa",function(t,e,i){t.cViewDialog={},t.continueLearning=function(e){t.cViewDialog.show=!1,"做题"===t.cViewDialog.type&&t.cViewDialog.paperNode.reloadPaper()},t.$on("bcvPractise",function(e,n,a,o,r){if(!i.self){var s="刚刚离开学习页，已暂停学习！";switch(a){case"做题":s="您在新开的页面进行做题，请进行如下操作"}t.cViewDialog=angular.extend(t.cViewDialog,{text:s,type:a,origin:o,show:n,paperNode:r});try{t.$digest()}catch(c){}}})}]}});