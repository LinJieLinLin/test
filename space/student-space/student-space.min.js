var module=angular.module("RCP",["LocalStorageModule","ngCookies","ngSanitize","ngRoute"]);if(module.config(["$routeProvider",function(e){e.when("/myCourses",{controller:"myCourseCtrl",templateUrl:"../course/module/student-course/student-courses.html"}).when("/myCircle",{controller:"myCircleCtr",templateUrl:"../study-circle/module/my-circle/my-circle.html"}).when("/myActivity/dynamic/message",{templateUrl:"../space/teacher-space/deving.html"}).when("/myActivity/dynamic/note",{templateUrl:"../space/teacher-space/deving.html"}).when("/myActivity/dynamic",{templateUrl:"../space/teacher-space/deving.html"}).when("/myActivity/dynamic/discuss",{templateUrl:"../space/teacher-space/deving.html"}).when("/myActivity/dynamic/qna",{templateUrl:"../space/teacher-space/deving.html"}).when("/myKnowledge",{templateUrl:"../space/teacher-space/deving.html"}).when("/myScore",{templateUrl:"../space/teacher-space/deving.html"}).when("/myAccont",{templateUrl:"../space/teacher-space/deving.html"}).when("/myEducation",{templateUrl:"../space/teacher-space/deving.html"}).otherwise({redirectTo:"/myCourses"})}]),module.controller("studentSpaceCtrl",["$scope","service","$timeout",function(e,t,a){function n(){$(".loading").removeClass("loading"),$(".loading-img").removeClass("loading-img"),$(".loading-text").removeClass("loading-text")}e.user={avatar:"../rcp-common/imgs/face/d-face-2.png",nickName:"user",certification:!1,desc:"天生我才必有用~千金散尽还复来"},e.certificateUrl=rcpAid.getUrl("实名认证"),e.orderUrl=rcpAid.getUrl(),e.$on("login",function(a,i){if(!i)return void t.common.toLogin();var r=e.user;r.avatar=i.avatar||r.avatar,r.nickName=i.nickName||r.nickName,r.certification=!!i.certification,r.desc=i.desc||r.desc,n()})}]),module.config(["$provide",function(e){e.decorator("$exceptionHandler",["$delegate",function(e){return function(t,a){e(t,a),console.error({origin:"AngularJS Error",msg:t.message,stack:t.stack}),document.runErrorCallUpgrade()}}])}]),module.controller("mainCtrl",["$scope","$rootScope","$http","service","$cookies","$timeout",function(e,t,a,n,i,r){function o(){var e=localStorage.getItem("anonymousLoginUsr");return e&&"error"!==e?(t.anonymousUser=JSON.parse(e),void(i.stoken=t.anonymousUser.token)):void a({method:"GET",url:"http://"+g_conf.SSO+"/sso/api/anonymousLogin"}).then(function(e){if(0!==e.data.code)return console.error(e.data.msg,"匿名登录失败"),void localStorage.setItem("anonymousLoginUsr","error");var a=e.data.data;a.usr.token=a.token,localStorage.setItem("anonymousLoginToken",a.token),delete a.usr.BAttr,delete a.usr.attrs,localStorage.setItem("anonymousLoginUsr",JSON.stringify(a.usr)),t.anonymousUser=a.usr,i.stoken=a.usr.token},function(e){localStorage.setItem("anonymousLoginUsr","error"),console.error(e,"匿名登录失败")})}function s(a){R.token=rcpAid.getToken(),e.setUserData(UINFO),l(t.currentUser.role),console.log("checkLogin by token")}function c(e){console.log("未登陆",e),rcpAid.isLogin=0,l({}),r(function(){t.$broadcast("login","")},0)}function l(t){function a(t){angular.forEach(t,function(t){var a=!1;angular.forEach(e.itemList,function(e){t.name===e.name&&(a=!0)}),a||e.itemList.push(t)})}function n(){var e=rcpAid.getUrl,t=[];return angular.forEach(arguments,function(a){switch(a){case"学习中心":t.push({ic:"L2",name:a,href:e(a)});break;case"教学中心":t.push({ic:"L2",name:a,href:e(a)});break;case"助学中心":"undefined"==typeof isIE||isIE(9,9)||t.push({ic:"L2",name:a,href:e(a)});break;case"管理中心":t.push({ic:"L1",name:a,href:e(a)});break;case"创建新课程":t.push({ic:"L4",name:a,href:e("创建课程",{type:10})})}}),t}e.itemList=[],angular.forEach(t,function(t,i){switch(i){case"default":break;case"student":e.user.schoolId&&a(n("学校空间")),e.user.classId&&a(n("班级空间"));break;case"parent":a(n("家长空间"));break;case"teacher":e.user.schoolId&&a(n("学校空间")),e.user.classId&&a(n("班级空间"));break;case"help":a(n("助学中心"));break;case"class":a(n("班级空间","学校空间"));break;case"school":a(n("学校空间"));break;case"UCS_ADMIN":a(n("管理中心"));break;case"COURSE_VERIFY_ADMIN":a(n("管理中心"));break;case"PAGE_EDIT_ADMIN":a(n("管理中心"))}}),a(n("学习中心","教学中心","创建新课程","创建新题库"))}function d(){return t.currentUser={},$("body").show(),n.common.checkLogin(s,c),rcpAid.isLogin?void 0:(console.log("未登陆"),void o())}$("body").show();try{R=new ars.ARS,R.args={},R.delay=1e3,R.pushDelay=1e4,R.url=DYCONFIG.ars.rUrl+"pub/api/record",R.token=rcpAid.getToken(),R.start()}catch(g){R={}}e.setUserData=function(e){try{if(console.log(e),!e.uid)return;t.currentUser={uid:e.usr.id,nickName:e.usr.attrs.basic.nickName,avatar:e.usr.attrs.basic.avatar,desc:e.usr.attrs.basic.desc,role:e.usr.attrs.role||""},e.usr.attrs.pass&&(t.currentUser.certification=e.usr.attrs.pass.certification),console.log("发广播",t.currentUser),r(function(){t.$broadcast("login",t.currentUser)},0)}catch(a){console.log(a)}},d()}]),module.directive("pagination",function(){return{template:'<div class="page-bar" ng-show="list.length>0"><a href="javascript:;" ng-class="current<=0?\'disabled\':\'\'" ng-click="prev()"><em class="emic">&lt;</em><em class="emf">上一页</em></a><a href="javascript:;" ng-repeat="key in keyList" ng-class="key==current ? \'cur\' : \'\'" ng-click="jump(key)">{{key+1}}</a><span ng-show="pLen>pMax && !hideEllipsis">...</span><a href="javascript:;" ng-class="current>=pLen-1?\'disabled\':\'\'" ng-click="next()"><em class="emf">下一页</em><em class="emic">&gt;</em></a><span class="jump-bar"><span>共<font class="blue-c">{{pLen}}</font>页</span><span>跳到 <input type="text" style="width:38px;height:19px;text-align:center;" ng-model="goKey"> 页</span><a href="" ng-click="go(goKey)">GO</a></span></div>',restrict:"E",replace:!0,transclude:!0,scope:{list:"=list",pagefn:"=pagefn",pageargs:"=pageargs",deepwatch:"="},controller:["$scope","$element","$attrs","service",function(e,t,a,n){e.$watch("pageargs",function(t,a){t&&(e.current=parseInt(e.pageargs.pn)-1,e.pageNode=e.current,e.pNum=parseInt(e.pageargs.ps),e.pMax=parseInt(e.pageargs.pl)||5,e.pagefn(e.pageargs,function(t){e.pLen=Math.ceil(parseInt(t.pa.total)/e.pNum),e.keyListWatch()}))},e.deepwatch),e.reKeyList=function(t,a,n){e.keyList=[];for(var i=t;a>i&&!(i>=n);i++)e.hideEllipsis=i+1==e.pLen,e.keyList.push(i)},e.keyListWatch=function(){var t=e.pLen;if(t>e.pMax){var a=Math.ceil(e.pMax/2),n=e.current;n>=a&&n<t-(e.pMax-a)?e.reKeyList(n-(e.pMax-a),n+a,t):n>=t-(e.pMax-a)?e.reKeyList(t-e.pMax,t,t):a>=n&&e.reKeyList(0,t,e.pMax)}else e.reKeyList(0,t,e.pMax)},e.jump=function(t){e.pageNode!=t&&(e.current=t,e.pageNode=t,e.pageargs.pn=t+1,e.pagefn(e.pageargs,function(t){e.pLen=Math.ceil(parseInt(t.pa.total)/e.pNum),e.keyListWatch()}))},e.next=function(){e.current++,e.current>=e.pLen&&(e.current=e.pLen-1),e.jump(e.current)},e.prev=function(){e.current--,e.current<=0&&(e.current=0),e.jump(e.current)},e.go=function(t){var a=/^-?\d+$/g;void 0==t||t.length<=0?n.dialog.alert("输入不能为空！",{}):a.test(t)?(parseInt(t)>e.pLen?(t=e.pLen,n.dialog.alert("总共只有"+e.pLen+"页，为您转到最后一页！",{})):parseInt(t)<=0&&(t=1,n.dialog.alert("不能低于第1页,为您转到最前一页！",{})),e.jump(parseInt(t)-1),e.goKey=void 0):t.match(/\s+/g)?n.dialog.alert("输入不能有空格符！",{}):n.dialog.alert("格式错误，请输入整数！",{})}}]}}),module.factory("headSearch",["request",function(e){var t=g_conf.pes.rUrl;return{SearchIntelligent:function(a,n){var i={method:"GET",url:t+"pub/api/SearchIntelligent",params:a,option:{loading:!1}};return e(angular.extend(i,n||{}))}}}]),module.run(["service","headSearch",function(e,t){e.expand("headSearch",function(){return t})}]),module.directive("headnav",function(){return{template:'<header><div ng-class="headMaximizeLock ? \'head-maximize\' : \'head-minimize\'"><div ng-class="param.style"><div class="image-head-rainbow decoration-ic"></div><section class="g-m-w header-area"><div class="minimize-logo"><a ng-href="{{param.logo.href||\'/\'}}"><img ng-src="{{param.logo.small}}" alt="{{param.logo.msg}}" title="{{param.logo.msg}}"></a></div><nav class="minimize-nav"><ul><li ng-repeat="item in navList track by $index" ng-class="item.class"><a ng-href="{{item.href || \'\'}}" target="{{item.target || \'_self\'}}">{{item.name}}</a><div ng-if="item.child.length"><ul><li ng-repeat="c in item.child"><a ng-href="{{c.href || \'\'}}" target="{{c.target || \'_self\'}}">{{c.name}}</a></li></ul></div></li></ul></nav><div class="logo"><a ng-href="{{param.logo.href||\'/\'}}"><img ng-src="{{param.logo.large}}" alt="{{param.logo.msg}}" title="{{param.logo.msg}}"></a></div><div class="top-user-menu-bar" ng-class="{clearminw: user.account}"><top-user-menu user="user" item-list="itemList"></top-user-menu></div><div class="h-sc" ng-controller="headSearchCtrl"><div class="head-search-bar"><div class="enter" ng-click="stopPropagation($event)"><input type="text" class="input" ng-model="scText" ng-keydown="onkeydown($event)" ng-change="matchChange(scSelectVal.value,scText)" placeholder="请输入关键词搜索"><div class="match-kw-v" ng-show="matchReadyLock"><div class="mc-list"><ul><li ng-if="!mcCourseList || !mcCourseList.length">暂无相关内容</li><li ng-repeat="item in mcCourseList track by $index" ng-click="intoDetail(item)" ng-if="$index < cMaxLen" ng-class="{hover: $index + lMaxLen == moveKeyIndex}" ng-mouseenter="mouseenter($index, \'资源\')"><div class="text-of pd-r10"><span class="lab" ng-if="item.t == 10">课程</span> <span class="lab" ng-if="item.t == 20">题库</span> <a class="item-name" ng-bind-html="item.name | titleMatchKw:scText"></a></div></li></ul></div></div></div><a ng-click="goToSearch(scSelectVal.value,scText)" class="submit" title="提交"><i class="fa fa-search" aria-hidden="true"></i></a></div><div class="hot-word"><a ng-href="javascript:void(0);" ng-click="goToSort(item.name)" class="mg-r20" ng-repeat="item in scHotWord">{{item.name}}</a></div></div></section><section class="nav-area"><div class="g-m-w"><div class="n-categories" ng-controller="categoriesCtrl" ng-mouseenter="service.mouseenter(hover)" ng-mouseleave="service.mouseleave(hover)"><div class="dt">全部课程</div><div class="dd" id="by-categories" ng-show="categoriesUnfoldLock || hover.mouseEnterLock"><div class="image-giraffe giraffe-icon"></div><div class="dd-inner"><div class="item" ng-repeat="item in categoriesListStyle1 track by $index" ng-mouseenter="service.mouseenter(item)" ng-mouseleave="service.mouseleave(item)" ng-show="$index<5 || hover.mouseEnterLock"><div class="layer"><h3><a ng-href="goToCategory(item.name)" target="_blank" title="{{item.name}}">{{item.name}}</a></h3><div class="hot-word"><a ng-href="goToCategory(item.name,child.name)" target="_blank" class="text-of" ng-repeat="child in item.child track by $index" ng-show="$index<3" title="{{child.name}}">{{child.name}}</a></div><i>&gt;</i></div><div class="sub" ng-show="item.mouseEnterLock"><div class="inner"><dl class="card" ng-repeat="child in item.child track by $index" ng-show="$index<3"><dt><a ng-href="goToCategory(item.name,child.name)" target="_blank" class="f-r">更多&gt;&gt;</a> <a ng-href="goToCategory(item.name,child.name)" target="_blank" title="{{child.name}}">{{child.name}}</a></dt><dd><a ng-href="goToCategory(item.name,child.name,unit.name)" target="_blank" class="text-of" ng-repeat="unit in child.child track by $index" ng-show="$index<15" title="{{unit.name}}">{{unit.name}}</a></dd></dl><div class="more-srot" ng-show="item.child.length>3"><a ng-href="goToCategory(item.name)" target="_blank" class="f-r">更多分类&gt;&gt;</a>. . .</div></div></div></div><div ng-repeat="list in categoriesListStyle2 track by $index"><div class="big-sort"><a ng-href="goToCategory(item.name)" target="_blank" title="{{list.name}}">{{list.name}}</a></div><div class="item" ng-repeat="item in list.child track by $index" ng-mouseenter="service.mouseenter(item)" ng-mouseleave="service.mouseleave(item)"><div class="layer"><h3><a ng-href="goToCategory(list.name,item.name)" target="_blank" title="{{item.name}}">{{item.name}}</a></h3><i>&gt;</i></div><div class="sub" ng-show="item.mouseEnterLock"><div class="inner"><dl class="card" ng-repeat="child in item.child track by $index" ng-show="$index<4"><dt><a ng-href="goToCategory(list.name,item.name,child.name)" target="_blank" class="f-r">更多&gt;&gt;</a> <a ng-href="goToCategory(list.name,item.name,child.name)" target="_blank" title="{{child.name}}">{{child.name}}</a></dt><dd><a ng-href="goToCategory(list.name,item.name,child.name,unit.name)" target="_blank" class="text-of" ng-repeat="unit in child.child track by $index" ng-show="$index<10" title="{{unit.name}}">{{unit.name}}</a></dd></dl><div class="more-srot" ng-show="item.child.length>4"><a ng-href="goToCategory(list.name,item.name)" target="_blank" class="f-r">更多分类&gt;&gt;</a>. . .</div></div></div></div></div></div></div></div><nav class="nav"><a ng-repeat="item in navList track by $index" ng-href="{{item.href || \'\'}}" target="{{item.target || \'_self\'}}" ng-class="item.class">{{item.name}}</a></nav><div class="extra" ng-show=""><a href="javascript:void(0);" class="icf t-icf">名师认证</a> <a href="javascript:void(0);" class="icf e-icf">真实评价</a> <a href="javascript:void(0);" class="icf r-icf">随时退</a></div></div></section></div></div></header>',restrict:"E",replace:!0,transclude:!0,scope:{itemList:"=itemList",user:"=user",nav:"="},controller:["$rootScope","$scope","$element","$attrs","service",function(e,t,a,n,i){t.service=i,t.catType=parseInt(rcpAid.getCourseCat()),e.$watch("headMaximizeLock",function(e){e&&(t.headMaximizeLock=e)}),e.$watch("categoriesUnfoldLock",function(e){e&&(t.categoriesUnfoldLock=e)}),e.$watch("catDomain",function(e){if(e)switch(e){case"aikexue.com":t.init(2)}}),t.$on("login",function(e,a){a&&t.loginInit()}),t.loginInit=function(){3===t.catType&&(t.navList=[{name:"学习中心",href:rcpAid.getUrl("学习中心"),"class":"key",target:"_blank"},{name:"教学中心",href:rcpAid.getUrl("教学中心",{uid:t.user.tid}),"class":"key",target:"_blank"},{name:"高等教育",href:rcpAid.getUrl("分类",{category:"高等教育"}),"class":"key",target:"_blank"}])},t.init=function(e){if("order"===t.nav)return t.navList=[{name:"首页",href:rcpAid.getUrl("首页"),"class":"key"},{name:"个人空间",href:rcpAid.getUrl("学习中心"),"class":"key",target:"_blank"}],void(t.param={logo:{small:"/rcp-common/imgs/order/head-icon.png",large:"/rcp-common/imgs/icon/head-icon.png",href:"/my-order.html",msg:"我的酷校"},style:""});switch(t.catType){case 3:t.isLogin?t.navList=[{name:"学习中心",href:rcpAid.getUrl("学习中心"),"class":"key",target:"_blank"},{name:"教学中心",href:rcpAid.getUrl("教学中心",{uid:t.user.tid}),"class":"key",target:"_blank"},{name:"高等教育",href:rcpAid.getUrl("分类",{category:"高等教育"}),"class":"key",target:"_blank"}]:t.navList=[{name:"高等教育",href:rcpAid.getUrl("分类",{category:"高等教育"}),"class":"key",target:"_blank"}],t.param={logo:{small:"/rcp-common/imgs/icon/gzmooc-logo.png",large:"/rcp-common/imgs/icon/gzmooc-logo.png",href:DYCONFIG.rcp.rUrl,msg:"酷校 - 首页"},style:""};break;case 2:t.navList=[{name:"首页",href:rcpAid.getUrl("首页"),"class":"key"},{name:"全部课程",href:rcpAid.getUrl("分类"),"class":"key",target:"_blank"},{name:"学习中心",href:rcpAid.getUrl("学习中心"),"class":"key",target:"_blank"}],t.param={logo:{small:"/rcp-common/imgs/icon/aikexue-logo-2.png",large:"/rcp-common/imgs/icon/aikexue-logo.png",href:DYCONFIG.rcp.rUrl,msg:"爱科学"},style:"aikexue-head"};break;default:t.navList=[{name:"首页",href:rcpAid.getUrl("首页"),"class":"key"},{name:"学习中心",href:rcpAid.getUrl("学习中心"),"class":"key",target:"_blank"},{name:"我要吐槽",href:rcpAid.getUrl("我要吐槽"),"class":"key",target:"_blank"}],t.param={logo:{small:"/rcp-common/imgs/icon/book-logo-2.png",large:"/rcp-common/imgs/icon/book-logo.png",href:DYCONFIG.rcp.rUrl,msg:"酷校LOGO·让学习更Cool"},style:""}}},t.init()}]}}),module.directive("topUserMenu",function(){return{template:'<div class="top-user-menu"><div style="font-size:14px;line-height:40px" ng-show="!currentUser.uid"><a ng-href="{{link.login}}" id="login" class="color-cyan pd-l20"><i class="image-login-user-ic"></i>马上登录 </a><span style="color:#ececec;margin:0 8px">| </span><a ng-href="{{link.register}}" class="color-cyan">注册</a></div><div class="menber-link" ng-show="currentUser.uid"><a href="" class="u-info" rel="member_link"><img ng-hide="currentUser.avatar" src="/rcp-common/imgs/face/d-face-1.png" class="face-img" width="40" height="40" rel="user_face" alt="{{currentUser.nickName}}"> <img ng-show="currentUser.avatar" ng-src="{{currentUser.avatar}}" class="face-img" width="40" height="40" rel="user_face" alt="{{currentUser.nickName}}"> <span class="name" rel="user_name" title="{{currentUser.nickName}}" ng-bind="currentUser.nickName"></span> <i class="x-arrow-dowm">&gt;</i></a><div class="u-panel"><div class="tup-box"><div class="tup-info" rel="user_info_box"><div class="user-head" rel="user_face_box"><a ng-href="{{link.setting}}"><img ng-hide="currentUser.avatar" src="/rcp-common/imgs/face/d-face-1.png" width="96" height="96" class="face-img" rel="user_face" alt="{{currentUser.nickName}}"> <img ng-show="currentUser.avatar" ng-src="{{currentUser.avatar}}" width="96" height="96" class="face-img" rel="user_face" alt="{{currentUser.nickName}}"></a></div><div class="user-identity"><p class="user-name text-of"><a href="" rel="user_name" title="{{currentUser.nickName}}" ng-bind="currentUser.nickName"></a></p><p class="attestation-un" ng-class="{\'attestation\':attestation==\'已认证\'}"><i class="image-attestation-yellow"></i> <span>{{attestation}}</span></p></div><div class="clear"></div></div><div class="tup-operate"><div class="card-sets"><a href="{{link.applySpaceUrl}}" class="key f-l"><i class="image-attestation"></i> <span class="text-4f">认证管理</span> </a><a href="{{link.setting}}" target="_blank" class="key f-l"><i class="image-settings"></i> <span class="text-4f">设置</span> </a><a href="" class="key f-r" ng-click="logout()"><i class="image-logout"></i> <span class="text-4f">退出</span></a></div><div class="card-links"><a ng-repeat="item in itemList" ng-href="{{item.href || \'\'}}" ng-class="item.name == \'...\' ? \'disabled key \'+item.icon : \'key \'+item.icon"><i></i> <span>{{item.name}}</span></a></div></div></div></div></div></div>',restrict:"E",replace:!0,transclude:!0,scope:{itemList:"=itemList",user:"=user"},controller:["$rootScope","$scope","$timeout","$location","service",function(e,t,a,n,i){t.$watch("itemList",function(e){if(e){var a=t.itemList.length,n=a%3;if(n)for(var i=3-a%3+a,r=a;i>r;r+=1)e.push({name:"..."})}},!0),t.logout=function(){var e=rcpAid.getUrl("首页");location.href=rcpAid.getUrl("退出",{url:encodeURIComponent(e)})},t.$on("login",function(e,a){a.uid&&t.loginInit()}),t.loginInit=function(){t.currentUser=e.currentUser,t.currentUser.certification&&(t.attestation="已认证")},t.init=function(){var e=rcpAid.getNoTokenUrl();t.link={login:rcpAid.getUrl("登录",{url:encodeURIComponent(e)}),register:rcpAid.getUrl("注册",{url:encodeURIComponent(e)}),applySpaceUrl:rcpAid.getUrl("实名认证"),setting:rcpAid.getUrl("个人设置",{url:window.location.href})},t.attestation="未认证"},t.init()}]}}),module.controller("categoriesCtrl",["$rootScope","$scope","service",function(e,t,a){function n(e){switch(e){case 2:t.categoriesListStyle2=i||[];break;default:t.categoriesListStyle1=i||[]}}t.service=a,t.hover={},t.catType=rcpAid.getCourseCat(),t.byCategories=function(){t.byCategoriesLoading=!0,n(t.catType)},t.listenerMember={byCategories:{node:"#by-categories",callback:t.byCategories}};var i;t.goToCategory=function(){var e=[].slice;return rcpAid.getUrl("分类",{tags:e.call(arguments,0).join(",")})}}]),module.directive("searchDir",function(){return{template:'<div class="h-sc"><div class="head-search-bar"><div class="enter" ng-click="stopPropagation($event)"><input type="text" class="input" ng-model="scText" ng-keydown="onkeydown($event)" ng-change="matchChange(scSelectVal.value,scText)" placeholder="请输入关键词搜索"><div class="match-kw-v" ng-show="matchReadyLock"><div class="mc-list"><ul><li ng-repeat="item in mcCategoryList track by $index" ng-if="$index < lMaxLen" ng-class="{hover: $index == moveKeyIndex}" ng-mouseenter="mouseenter($index,\'类\')" ng-click="matchGoToCategory(item.tag,scText)"><div class="text-of"><a href="javascript:;">{{text}}</a> 在 <a href="javascript:;" class="item-name color-cyan">{{item.tag}}</a> 分类中搜索</div></li></ul><div style="margin:0 10px;border-top:1px solid #dfdfdf" ng-if="mcCourseList.length && mcCategoryList.length"></div><ul><li ng-if="!mcCourseList || !mcCourseList.length">暂无相关内容</li><li ng-repeat="item in mcCourseList track by $index" ng-click="intoDetail(item)" ng-if="$index < cMaxLen" ng-class="{hover: $index + lMaxLen == moveKeyIndex}" ng-mouseenter="mouseenter($index,\'资源\')"><div class="text-of"><span class="lab" ng-if="item.t == 10">课程</span> <span class="lab" ng-if="item.t == 20">题库</span> <a href="javascript:;" class="item-name" ng-bind-html="item.name|titleMatchKw:scText"></a></div></li></ul></div></div></div><a ng-click="goToSearch(scSelectVal.value,scText)" class="submit" title="提交"><i class="fa fa-search" aria-hidden="true"></i></a></div><div class="hot-word"><a href="" class="mg-r20" ng-repeat="item in scHotWord" ng-click="goToSort(item.name)">{{item.name}}</a></div></div>',restrict:"E",replace:!0,transclude:!0,scope:{hot:"="},controller:"headSearchCtrl"}}),module.controller("headSearchCtrl",["$rootScope","$scope","$document","$element","service","headSearch",function(e,t,a,n,i,r){function o(){t.scText="",g()}function s(){b=!0,t.KeyDownIndex=t.moveKeyIndex,d()}function c(){"number"!=typeof t.moveKeyIndex?t.moveKeyIndex=0:t.moveKeyIndex=(t.moveKeyIndex+1)%t.aMaxLen,s()}function l(){"number"!=typeof t.moveKeyIndex?t.moveKeyIndex=t.aMaxLen-1:t.moveKeyIndex=t.moveKeyIndex<0?t.aMaxLen-1:t.moveKeyIndex-1,s(),m(t.scText.length)}function d(){var e,a=t.KeyDownIndex,n=t.lMaxLen;return t.scTag=void 0,n>a&&(t.scText=t.text),a>=n&&(e=t.mcCourseList[a-t.lMaxLen],e&&(t.scText=e.name)),e}function g(e){t.matchReadyLock=!1,e&&(a.unbind("click"),t.$digest())}function u(){a.unbind("click").bind("click",function(){g("digest")}),t.matchReadyLock=!0}function p(){t.matchReadyLock&&(clearTimeout(x),x=setTimeout(function(){g("digest")},300))}function m(e){var t=n.find('input[ng-model="scText"]').get(0);if("selectionStart"in t&&(t.selectionStart=e,t.selectionEnd=e),"createTextRange"in t){var a=t.createTextRange();a.moveStart("character",e),a.collapse(!0),a.select()}}function h(e,a){t.inSort&&!angular.isArray(e)||angular.forEach(e,function(e){return t.inSort?!1:void(a(e)||angular.isArray(e.child)&&e.child.length&&(h(e.child,a),v("push",e.name)))})}function f(e,a){switch(t.inSort=!1,v("clear"),h(e,function(e){return t.inSort=e.name===a,t.inSort&&v("push",e.name),t.inSort}),t.inSort){case!0:v("splice",a);break;default:v("clear")}return t.categorySelect}function v(e,a){var n=t.categorySelect;switch(e){case"clear":n.splice(0,n.length);break;case"push":n.push(a);break;case"splice":n.splice(0,$.inArray(a,n))}}function y(e,t){i.dialog.alert(t),console[e](t)}function k(e){var t=[];if(e.length)for(var a=0,n=e.length;n>a;a++)t.push({id:e[a].hasOwnProperty("id")?e[a].id:"",name:e[a].hasOwnProperty("title")?e[a].title:"",t:e[a].hasOwnProperty("type")?e[a].type:""});return t}t.scHotWord=[],t.scSelect=[{name:"所有分类",value:"",fixLock:!0},{name:"课程",value:10},{name:"题库",value:20}],t.scSelectVal=t.scSelect[0],t.onkeydown=function(e){switch(e.stopPropagation(),e.keyCode){case 13:t.scText||(t.scText=$(".head-search-bar input").eq(0).val());var a=t.KeyDownIndex,n=t.lMaxLen;"number"==typeof a&&a>=0&&n>a&&t.scTag?t.matchGoToCategory(t.scTag,t.scText):a>=0&&t.matchReadyLock?location.href=rcpAid.getUrl("课程详情",{cid:t.mcCourseList[a].id}):t.goToSearch(t.scSelectVal.value,t.scText);break;case 38:l();break;case 40:c();break;default:b=!1,t.moveKeyIndex=void 0,t.KeyDownIndex=void 0,t.scTag=void 0}};var b,x;n.find('input[ng-model="scText"]').unbind("focus").bind("focus",u),n.find('input[ng-model="scText"]').unbind("blur").bind("blur",p),t.mouseenter=function(e,a){switch(a){case"类":t.moveKeyIndex=e;break;case"资源":t.moveKeyIndex=e+t.lMaxLen}},t.goToSearch=function(e,t){o(),location.href=rcpAid.getUrl("搜索",{type:e,query:t?encodeURIComponent(t):t})},t.goToSort=function(e){o(),location.href=rcpAid.getUrl("分类",{tags:e})},t.stopPropagation=function(e){e.stopPropagation()},t.matchChange=function(e,a){if(!b){if(g(),!a)return t.mcCategoryList=[],void(t.mcCourseList=[]);t.text=a,r.SearchIntelligent({key:a,courseType:e||null,limit:10}).then(function(e){t.scText&&(t.matchReadyLock=!0,t.mcCourseList=k(e.data.courses||[]),t.mcCategoryList=[],t.lMaxLen=t.mcCategoryList.length>3?3:t.mcCategoryList.length,t.cMaxLen=t.mcCourseList.length-t.lMaxLen,t.aMaxLen=t.lMaxLen+t.cMaxLen,t.mcCourseList.length||t.mcCategoryList.length||g())},function(e){y("错误代码："+e.data.data.code)})}},t.$watch("scSelectVal.value",function(){t.matchChange(t.scSelectVal.value,t.scText)}),t.matchGoToCategory=function(t,a){if(!e.allTagCategroy||!e.allTagCategroy.length)return void y("error","获取分类数据失败");var n=f(e.allTagCategroy,t).reverse().join(",");n?(o(),location.href=rcpAid.getUrl("分类",{tags:n,query:a})):y("error","找不到这个分类，请检查接口数据")},t.categorySelect=[],t.intoDetail=function(e){e.hasOwnProperty("id")&&(location.href=rcpAid.getUrl("课程详情",{cid:e.id}))}}]),module.directive("tailnav",function(){return{template:'<footer><section class="footer" id="footer"><div class="g-m-w"><div class="copyright"><p>广州市大洋信息技术股份有限公司 版权所有</p><p>Copyright © 2015 ITDAYANG. All Rights Reserved.</p><p>{{caseNumber}}</p></div><div class="footer-link"><a href="http://www.itdayang.com/about.html" target="_blank">关于我们</a> <span>- </span><a href="http://www.itdayang.com/contact.html" target="_blank">联系我们</a> <span>- </span><a href="javascript:;" ng-click="atBuilding()">法律条款</a> <span>- </span><a href="javascript:;" ng-click="atBuilding()">帮助中心</a> <span>- </span><a href="javascript:;" ng-click="atBuilding()">学校申请加入</a> <span>- </span><a href="javascript:;" ng-click="atBuilding()">机构申请加入</a> <span>- </span><a href="javascript:;" ng-click="atBuilding()">意见反馈</a></div><div class="clear"></div></div></section></footer>',restrict:"E",replace:!0,transclude:!0,scope:{data:"=data"},controller:["$scope","service",function(e,t){e.catType=rcpAid.getCourseCat();var a=DYCONFIG.domain||[];angular.forEach(a,function(t){t.domain===location.host&&(e.caseNumber=t.domainNum)}),e.atBuilding=function(){t.dialog.alert("正在建设中...")}}]}}),module.filter("titleMatchKw",["$sce",function(e){return function(t,a){var n="<b>"+a+"</b>",i=/([\[\]\(\)\{\}\*\?\+\^\$\.\|\\])/gi,r=a.replace(i,"\\$1");return t=t.replace(new RegExp(r,"ig"),n),e.trustAsHtml(t)}}]),function(){function e(){var i=document.getElementById("footer");if(i){var r=document.documentElement.scrollHeight-1||document.body.scrollHeight-1,o=document.documentElement.clientHeight||document.body.clientHeight;n=o>=r?1:2,n!==a&&(o>=r?(t(i.parentNode,{height:i.offsetHeight+"px"}),t(i,{position:"absolute",width:"100%",bottom:0,left:0})):(t(i.parentNode,{height:i.offsetHeight+"px"}),t(i,{position:"",width:"100%",bottom:0,left:0}))),a=o>=r?1:2}setTimeout(e)}if(!window.fixedFooterFlag){window.fixedFooterFlag=!0;var t=function(e,t){for(k in t)e.style[k]=t[k]},a=0,n=1;e()}}(),angular.module("RCP").directive("drag",function(){var e={restrict:"A",link:function(e,t,a){function n(e){var a,l;"absolute"===p?(a=e.pageX,l=e.pageY,o={top:+t.css("top").split("px")[0],left:+t.css("left").split("px")[0]}):"fixed"===p&&(a=e.clientX,l=e.clientY,o=t.position()),angular.element("body").addClass("no-select"),s.off("mousedown",n),c.on("mousemove",i),c.on("mouseup",r),d.left=a,d.top=l,m&&(g.width=angular.element(window).width(),g.height=angular.element(window).height(),u.width=t.width(),u.height=t.height())}function i(e){var a,n;if("absolute"===p?(a=e.pageX,n=e.pageY):"fixed"===p&&(a=e.clientX,n=e.clientY),l.top=n-d.top,l.left=a-d.left,m){var i=o.top+l.top,r=o.left+l.left;i=0>=i?0:i,r=0>=r?0:r,i=i>=g.height-u.height?g.height-u.height:i,r=r>=g.width-u.width?g.width-u.width:r,t.css({top:i,left:r,bottom:"auto",right:"auto"})}else t.css({top:o.top+l.top,left:o.left+l.left,bottom:"auto",right:"auto"})}function r(){c.off("mousemove",i),c.off("mouseup",r),s.on("mousedown",n),angular.element("body").removeClass("no-select")}var o,s=a.drag?t.find(a.drag):t,c=angular.element(document),l={top:0,left:0},d={left:0,top:0},g={},u={},p=a.position||"absolute",m="true"===a.limit;angular.element("body").append("<style>.no-select{-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none;}</style>"),s.on("mousedown",n)}};return e}),!module)var module=angular.module("RCP",[]);if(module.directive("emptyTip",function(){return{template:'<div class="empty-tip" ng-style="boxStyle"><style type="text/css">.empty-tip{text-align:center;padding:30px 0}.empty-tip .msg{padding:10px 0 0;color:#999}.empty-tip .img{width:100%}</style><div ng-show="theme==1"><img src="/rcp-common/imgs/common/no-data.png" class="img" ng-style="imgStyle"></div><div ng-show="!theme"><img src="/rcp-common/imgs/common/icon-cloud.png" ng-style="imgStyle"></div><div ng-show="!theme" class="msg"><span ng-hide="showLogin">{{msg}}</span> <a href="" style="color:#00f" ng-show="showLogin">请先登录</a></div></div>',restrict:"E",replace:!0,transclude:!0,scope:{c:"="},controller:["$scope","service",function(e,t){e.msg="暂无数据",e.c&&angular.forEach(e.c,function(t,a){e[a]=t}),"请先登录"===e.msg&&(e.showLogin=!0,e.dialog=function(e){t.dialog.alert(e)})}]}}),module.directive("defaultImg",function(){return{template:'<div class="default-img"><img class="hide" ng-src="{{src}}" ng-style="{{conf.style}}" alt="{{alt}}"></div>',restrict:"E",replace:!0,transclude:!0,scope:{alt:"=",src:"=src",conf:"=conf"},controller:["$scope","$element","$attrs",function(e,t,a){var n=e.conf||{},i=t.find("img");n.width&&(t.width(n.width),i.width(n.width)),n.height&&(t.height(n.height),i.height(n.height)),i.on({load:function(){i.removeClass("hide")}}),e.$watch("src",function(e,t){e||i.addClass("hide")})}]}}),module.directive("sidebar",function(){return{restrict:"E",template:'<div class="sidebar"><ul><li ng-class="sidebar.cur" ng-repeat="sidebar in sidebarList" ng-click="barClick(sidebar)"><i ng-class="sidebar.icon"></i> <a ng-href="{{sidebar.href}}">{{sidebar.name}}</a></li></ul></div>',replace:"true",scope:{},controller:["$scope","$element","$attrs","$location","$rootScope",function(e,t,a,n,i){function r(){return n.path()}function o(){var t,a=!1,n=r();if(angular.forEach(e.sidebarList,function(e){e.cur="",e.icon=s+e.tag,t=e.href,t&&(t=t.substr(1),t==n&&(e.cur="cur",e.icon=s+e.tag+c,l=e.tag,a=!0))}),!a){var i=e.sidebarList[0];for(var o in d)if(d.hasOwnProperty(o)&&0==n.indexOf(o)){angular.forEach(e.sidebarList,function(e){d[o]==e.tag&&(i=e)});break}i.cur="cur",i.icon=s+i.tag+c}}var s="image-",c="-down",l="",d={"/paper-detail":"shijuan"};switch(a.sidebarType){case"student":s="image-cat-",e.sidebarList=[{tag:"s1",cur:"",icon:"",name:"我的课程",href:"#/myCourses"},{tag:"s3",cur:"",icon:"",name:"我的圈子",href:"#/myCircle"},{tag:"s4",cur:"",icon:"",name:"学习风格",href:"#/myKnowledge"},{tag:"s5",cur:"",icon:"",name:"我的学分",href:"#/myScore"},{tag:"s6",cur:"",icon:"",name:"账号信息",href:"#/myAccont"},{tag:"s7",cur:"",icon:"",name:"教育信息",href:"#/myEducation"}];break;case"teacher":s="image-bar-t-",e.sidebarList=[{tag:"kecheng",cur:"",icon:"",name:"课程管理",href:"#/coursesManager"},{tag:"quanxian",cur:"",icon:"",name:"权限管理",href:"#/rightManager"},{tag:"xuesheng",cur:"",icon:"",name:"学生管理",href:"#/studentManager"},{tag:"chengji",cur:"",icon:"",name:"成绩管理",href:"#/scoreManager"},{tag:"shijuan",cur:"",icon:"",name:"试卷批改",href:"#/paperManager"},{tag:"zhanghao",cur:"",icon:"",name:"账号信息",href:"#/acountInfo"}]}e.barClick=function(e){e.tag==l&&i.$broadcast("bar-repeat-click",e.tag),l=e.tag},o(),i.$on("$locationChangeSuccess",function(){o()})}]}}),module.factory("course",["request",function(e){var t=DYCONFIG.course.rUrl;return{getCourseDetail:function(a,n){a.token=rcpAid.getToken();var i={method:"GET",url:t+"pub/api/loadCourse",params:a};return e(angular.extend(i,n||{}))},getTeacherCourses:function(a,n){a.token=rcpAid.getToken(),a.isSelf=1;var i={method:"GET",url:t+"pub/api/searchCourse",params:a};return e(angular.extend(i,n||{}))},joinFreeCourse:function(a,n){a.token=rcpAid.getToken();var i={method:"GET",url:t+"usr/api/joinCourse",params:a};return e(angular.extend(i,n||{}))},searchCourse:function(a,n){
var i={method:"GET",url:t+"pub/api/searchCourse",params:a};return e(angular.extend(i,n||{}))},verifyCourse:function(a,n){a.token=rcpAid.getToken();var i={method:"GET",url:t+"usr/api/verifyCourse",params:a};return e(angular.extend(i,n||{}))},createCourse:function(a,n,i){a.token=rcpAid.getToken();var r={method:"POST",url:t+"usr/api/createCourse",params:a,data:i};return e(angular.extend(r,n||{}))},getStudentCourse:function(a,n){a.token=rcpAid.getToken(),a.isSelf=10;var i={method:"GET",url:t+"pub/api/searchCourse",params:a};return e(angular.extend(i,n||{}))},releaseCourse:function(a,n){a.token=rcpAid.getToken();var i={method:"GET",url:t+"usr/api/releaseCourse",params:a};return e(angular.extend(i,n||{}))},saveCourseData:function(a,n){var i={};i.token=rcpAid.getToken();var r={method:"POST",url:t+"usr/api/updateCourse",params:i,data:a};return e(angular.extend(r,n||{}))},cancelCourse:function(a,n){a.token=rcpAid.getToken();var i={method:"POST",url:t+"usr/api/cancelCourse",params:a};return e(angular.extend(i,n||{}))},getListGroup:function(a,n){a.token=rcpAid.getToken();var i={method:"GET",url:t+"pub/api/listGroup",params:a};return e(angular.extend(i,n||{}))},getAllTags:function(t,a){t.token=rcpAid.getToken();var n={method:"POST",url:DYCONFIG.pes.rUrl+'pub/api/page/GetPage?keys=[{"key":"p_classifi"}]',params:t};return e(angular.extend(n,a||{}))},updateArticleExt:function(a,n){a.token=rcpAid.getToken();var i={method:"GET",url:t+"usr/api/updateExt",params:a};return e(angular.extend(i,n||{}))},getArticleExt:function(a,n){a.token=rcpAid.getToken();var i={method:"GET",url:t+"pub/api/listArtExt",params:a};return e(angular.extend(i,n||{}))},loadRecord:function(a,n){a.token=rcpAid.getToken();var i={method:"GET",url:t+"pub/api/loadRecord",params:a};return e(angular.extend(i,n||{}))},listPaperCorrect:function(a,n){a.token=rcpAid.getToken();var i={method:"GET",url:t+"usr/api/listPaperCorrect",params:a};return e(angular.extend(i,n||{}))},Publish:function(a,n){a.token=rcpAid.getToken();var i={method:"GET",url:t+"usr/api/publish",params:a};return e(angular.extend(i,n||{}))}}}]),module.run(["service","course",function(e,t){e.expand("course",function(){return t})}]),module.controller("myCourseCtrl",["$scope","$rootScope","service","course","$timeout",function(e,t,a,n,i){function r(){rcpAid.isLogin&&t.currentUser&&t.currentUser.uid?i(function(){e.getResList()}):e.$on("login",function(t,n){return n?void e.getResList():void a.common.toLogin()})}function o(e){return rcpAid.getUrl("学习页",{cid:e})}function s(e){return""}function c(e){return rcpAid.getUrl("课程详情",{cid:e})}function l(t){if(!t.data.allCount)return e.isEmpty=!0,e.emptyType=!!e.filterKey,e.loading=!1,!1;e.resourceList=t.data.courses;for(var a,n=e.resourceList.length,i=e.resourceList,r=0;n>r;r++)a=i[r],a.imgs&&a.imgs[0]?a.imgUrl=a.imgs[0]:i[r].imgUrl="",a.start_time||(a.start_time="无"),a.end_time||(a.end_time="无"),a.detailUrl=c(a.id),a.studyUrl=o(a.id),a.studyDetailUrl=s(a.id);return e.isEmpty=!1,e.loading=!1,!0}var d={};d.host="*",d.sort=-9,d.mode=5,d.type=10,d.status=1,e.isEmpty=!1,e.loading=!0,e.c={theme:1},r(),e.$on("bar-repeat-click",function(t,a){"s1"==a&&e.getResList()}),e.onkeydown=function(t){13===t.keyCode&&e.getResList()},e.getResList=function(){e.loading=!0,e.pageargs={pn:1,ps:5,pl:5}},e.pagefn=function(t,i){d.page=t.pn,d.pageCount=t.ps,d.k=e.filterKey,n.getStudentCourse(d).then(function(e){l(e),e.pa={total:e.data.allCount},i(e)},function(t){e.emptyType=!!e.filterKey,e.isEmpty=!0,e.loading=!1,console.error("获取课程失败",t),t.data&&t.data.data&&301!=t.data.data.code&&a.dialog.alert("获取课程失败")})}}]),module.factory("studyCircle",["request",function(e){var t=DYCONFIG.studyCircle.rUrl||"/";return{sendCircle:function(a,n){a.token=rcpAid.getToken();var i={method:"POST",url:t+"usr/api/createDiscuss",params:a};return e(angular.extend(i,n||{}))},getCircleList:function(a,n){a.token=rcpAid.getToken();var i={method:"POST",url:t+"pub/api/searchDiscuss",params:a};return e(angular.extend(i,n||{}))},getCircleDetail:function(a,n){a.token=rcpAid.getToken();var i={method:"GET",url:t+"pub/api/getCDetail",params:a};return e(angular.extend(i,n||{}))},setReadCount:function(a,n){a.token=rcpAid.getToken();var i={method:"GET",url:t+"pub/api/statRead",params:a};return e(angular.extend(i,n||{}))},getPersonDiscuss:function(a,n){a.token=rcpAid.getToken();var i={method:"GET",url:t+"pub/api/personDiscuss",params:a};return e(angular.extend(i,n||{}))},removeDiscuss:function(a,n){a.token=rcpAid.getToken();var i={method:"GET",url:t+"usr/api/delDiscuss",params:a};return e(angular.extend(i,n||{}))},getPersonReply:function(a,n){a.token=rcpAid.getToken();var i={method:"GET",url:t+"pub/api/personReply",params:a};return e(angular.extend(i,n||{}))}}}]),module.run(["service","studyCircle",function(e,t){e.expand("studyCircle",function(){return t})}]),module.filter("sanitize",["$sce",function(e){return function(t){return e.trustAsHtml(t)}}]),module.controller("myCircleCtr",["$scope","$rootScope","$timeout","service","studyCircle",function(e,t,a,n,i){function r(e){return rcpAid.getUrl("圈子详情",{id:e})}function o(t){if(console.log("handleCircleData",t),e.circleList.length=0,!t.discuss)return void console.error("圈子数据为空",t.discuss);for(var a,n,i,o=function(e){var a=t.discuss[e].replys;if(a||console.error("帖子回复数据为空",e,a),a.length){a=a[a.length-1],a||console.error("帖子回复为空",e,a);var n=a.ownerId;return t.usr[n]||console.error("帖子回复者ownerId为空",n,t.usr),{user:t.usr[n].attrs.basic.nickName,time:a.lastModifyTime}}},s=function(e){var a=t.discuss[e].scopes;return a||console.error("圈子数据为空",e,a),a.length?(a.length>1&&console.log("圈子数据大于1",a.length),a=t.scope[a[0]],a||console.error("圈子为空",e,a),{title:a&&a.title||"",ownerId:a&&a.ownerId||-1,ownerType:a&&a.ownerType||-1}):{title:"",ownerId:-1,ownerType:-1}},c=0,l=t.discuss.length;l>c;c++)a=t.discuss[c]&&t.discuss[c].root||{},n={},i=s(c),a.ownerId!=e.user.uid&&console.error(a.ownerId,e.user.uid,"圈子uid不一致"),n.avatar=e.user.avatar,n.nickName=e.user.nickName,n.detailUrl=r(a._id),n.content=a.content,n.createTime=a.createTime,n.images=a.files&&a.files.IMG||[],n.lastReply=o(c),n.course=i.title,n.allScopeUrl=rcpAid.getUrl("全部圈子",{cid:i.ownerId,type:i.ownerType}),n.isLiked=a.isLiked,n.likeCount=a.count&&a.count.likeCount||0,n.replyCount=a.count&&a.count.replyCount||0,n.id=a._id,e.circleList.push(n)}function s(e){return"circle"==e?{pn:1,ps:6,pl:5}:{pn:1,ps:10,pl:5}}function c(t){if(console.log("handleReplyData",t),e.replyList.length=0,!t.discuss)return void console.error("回复数据为空");for(var a,n,i,o=function(e){var a=t.discuss[e].rootId;a||console.error("获取圈子 rootId数据为空",e,a);var n=t.parent[a];n||console.error("获取圈子 parent."+a+"为空",e,n);var i=n.scopes;return i&&1==i.length||console.log("圈子为空或过多",e,i,i.length),i=t.scope[i],{id:n.id,title:i&&i.title||"",content:n.content,type:n.ownerType}},s=0,c=t.discuss.length;c>s;s++)a=t.discuss[s].details,a||console.error("回复详细数据为空",a),i=o(s),n={},a.ownerId!=e.user.uid&&console.error(a.ownerId,e.user.uid,"回复uid不一致"),n.course=i.title,n.reply=a.content,n.circle=i.content,n.time=a.createTime,n.images=[],n.detailUrl=r(i.id),n.circleId=i.id,e.replyList.push(n)}e.user={avatar:t.currentUser.avatar||"../rcp-common/imgs/face/d-face-2.png",uid:t.currentUser.uid,nickName:t.currentUser.nickName},e.$on("bar-repeat-click",function(t,a){"s3"==a&&(e.circlePaginationArgs=s("circle"),e.replyPaginationArgs=s("reply"))}),e.num={circle:0,reply:0},e.loading={circle:!0,reply:!0},e.curTab=0,e.circleList=[],e.readAdd=function(e){i.setReadCount({id:e}).then(function(e){},function(e){console.log("[error]","圈子阅读数增加失败",e)})};var l={likeCount:1,reviewReplyCount:1,myOwnerType:10,ownerId:"",ownerType:10,page:1,pageCount:6};e.circlePaginationArgs=s("circle"),e.circlePaginationCb=function(t,a){e.loading.circle=!0,l.ownerId=e.user.uid,l.page=t.pn,l.pageCount=t.ps,i.getPersonDiscuss(l).then(function(t){return e.loading.circle=!1,t&&t.data?(o(t.data),e.num.circle=t.data.allCount,t.pa={total:t.data.allCount},void a(t)):(console.error("我的圈子获取圈子数据为空",err),void n.dialog.alert("圈子数据获取失败"))},function(t){console.error("我的圈子获取圈子数据错误",t),n.dialog.alert("圈子数据获取失败"),e.loading.circle=!1,e.circleList.length=0})},e.sendLike=function(t){var a=function(e){return e?(t.isLiked=!t.isLiked,void(t.likeCount+=t.isLiked?1:-1)):(console.error((t.isLiked?"取消点赞":"点赞")+"返回数据为空",e),void n.dialog.alert((t.isLiked?"取消点赞":"点赞")+"失败"))},r=function(e){return console.error((t.isLiked?"取消点赞":"点赞")+"失败",e),e.data&&e.data.data&&1003==e.data.data.code&&!t.isLiked?(t.isLiked=!t.isLiked,t.likeCount+=1,void n.dialog.alert("您已点过赞!")):void n.dialog.alert((t.isLiked?"取消点赞":"点赞")+"失败")};t.isLiked?i.removeDiscuss({parentId:t.id,ownerType:"10",type:"30"}).then(a,r):i.sendCircle({},{data:{pOwnerId:e.user.uid,pOwnerType:"10",pid:t.id,ownerType:"10",type:"30"}}).then(a,r)},e.replyList=[],a(function(){e.replyPaginationArgs=s("reply")});var d={myOwnerType:"10",ownerId:"",ownerType:"10",page:1,pageCount:1,type:"20"};e.replyPaginationCb=function(t,a){e.loading.reply=!0,d.ownerId=e.user.uid,d.page=t.pn,d.pageCount=t.ps,i.getPersonReply(d).then(function(t){return e.loading.reply=!1,t&&t.data?(c(t.data),e.num.reply=t.data.allCount,t.pa={total:t.data.allCount},void a(t)):(console.error("我的回复 获取回复数据为空",err),void n.dialog.alert("回复数据获取失败"))},function(t){console.error("我的回复 获取回复数据错误",t),n.dialog.alert("回复数据获取失败"),e.loading.reply=!1,e.replyList.length=0})}}]),!module)var module=angular.module("RCP",[]);module.filter("sanitize",["$sce",function(e){return function(t){return e.trustAsHtml(t)}}]),module.directive("studyCircle",function(){return{template:'<div class="study-circle"><div class=""><h3 class="content-section-head">圈子</h3><div class="content-section-body"><div class="no-data" ng-hide="hasData">暂无圈子</div><div ng-show="hasData"><ul class="circle-detail"><li class="inline" ng-repeat="c in circleList"><div class="user-info"><img ng-src="{{ usrList[c.root.ownerId].attrs.basic.avatar || \'../study-circle/imgs/d-face-1.png\'}}" alt=""><p class="text-hide" ng-bind="usrList[c.root.ownerId].attrs.basic.nickName"></p></div><div class="detail"><a ng-href="{{toDetailCircle}}" ng-click="toDetail(c)" target="_blank" style="color:#a6a6a6"><div ng-bind-html="c.root.content | sanitize"></div></a><div ng-bind="c.root.createTime| date:\'MM-dd HH:mm\'">00-00 00:00</div><image-slider images="c.root.files.IMG" class="self-image-slider"></image-slider><p class="desc"><span class="last-comment text-hide" ng-show="c.replys.length" ng-bind="usrList[c.replys[0].ownerId].usr[0]+\' 最后回复于 \'+(c.replys[0].createTime| date:\'MM-dd HH:mm\')">最后回复于 00-00 00:00</span> <span class="vote"><button ng-click="sendLike(c.root,$event)"><i class="fa fa-thumbs-o-up" ng-show="c.root.isLiked" style="color:#fe8811"></i> <i class="fa fa-thumbs-o-up" ng-hide="c.root.isLiked"></i> <span ng-bind="c.root.count.likeCount">0</span></button> <a ng-href="{{toDetailCircle}}" ng-click="toDetail(c)" target="_blank"><i class="fa fa-commenting-o"></i> <span ng-bind="c.root.count.replyCount">0</span></a></span></p></div></li></ul><div class="more-comment" ng-hide="c.showTotal"><a ng-href="{{toTotalCircle}}" target="_blank">查看全部圈子 &gt;</a></div><div ng-show="c.showTotal"><pagination class="study-circle-pagination" list="circleList" pageargs="pageargs" pagefn="pagefn"></pagination></div></div></div></div></div>',restrict:"E",replace:!0,transclude:!0,scope:{c:"="},controller:["$scope","$timeout","$http","service","$location",function(e,t,a,n,i){try{e.pageargs={pn:1,ps:8,pl:5},e.pagefn=function(t,a){e.getCircleList(a)},e.hasData=!1,e.curToken=rcpAid.getToken(),e.init=function(){e.circle={content:"",exceed:"",isSecret:1,nowSection:""},e.circleList=[],e.usrList={},e.c&&e.c.rUrl?"/"!==e.c.rUrl[e.c.rUrl.length-1]&&(e.c.rUrl+="/"):console.log("无配置文件！"),e.getCircleList(),e.toTotalCircle=rcpAid.getUrl("全部圈子",{cid:e.c.cid,type:e.c.type,token:e.curToken})},e.getCircleList=function(t){console.log(e.c.type+" uuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuuu");var a={k:".",mode:1,page:e.pageargs.pn,pageCount:e.pageargs.ps,reviewReplyCount:1,reviewSort:-1,owners:[{OwnerId:e.c.cid,OwnerType:e.c.type}],sort:-1};n.studyCircle.getCircleList({},{data:angular.toJson(a)}).then(function(n){console.log(n),e.circleList=n.data.discuss,e.usrList=n.data.usr,e.circleList&&e.circleList.length&&!e.usrList&&alert("返回数据有误"),n.data.allCount?e.hasData=!0:e.hasData=!1,"function"==typeof t&&(console.log(n.data.allCount),a.pa={total:n.data.allCount,pn:e.pageargs.pn,ps:e.pageargs.ps},t(a))},function(e){console.log(e)})},e.send=function(t,a){var i={acl:{ALL:+e.circle.isSecret},atUsers:[],category:e.c.category||"10",coin:0,content:e.circle.content,desc:"",files:{FILE:[],IMG:[],VIDEO:[]},level:0,ownerType:"10",pOwnerId:"",pOwnerType:"",pid:"",scopes:[{OwnerId:e.c.cid,OwnerType:e.c.type}],tags:[],title:"",type:t};switch(t){case"10":if(!i.content)return void n.dialog.alert("请先输入内容！");e.load.sendCircle=!0,i.needData=!0;break;case"20":if(!a.replyContent)return void n.dialog.alert("请先输入内容！");a.sendReply=!0,i.needData=!0,i.content=a.replyContent,i.pOwnerId=a.ownerId,i.pOwnerType=e.c.pOwnerType||"10",i.pid=a._id;break;case"30":a.sendLike=!0,i.pOwnerId=a.ownerId,i.pOwnerType=e.c.pOwnerType||"10",i.pid=a._id}n.studyCircle.sendCircle({token:rcpAid.getToken()},{data:angular.toJson(i)}).then(function(n){switch(console.log(n),t){case"10":e.circle.content="",e.load.sendCircle=!1,e.circleList.unshift(n.data.discuss[0]),angular.extend(e.usrList,n.data.usr);break;case"20":a.sendReply=!1,e.getCircleList();break;case"30":a.sendLike=!1,a.count.likeCount=+a.count.likeCount+1,a.isLiked=!0}},function(i){switch(console.log(i),t){case"10":e.load.sendCircle=!1;break;case"20":a.sendReply=!1;break;case"30":a.sendLike=!1,1003===i.data.data.code&&n.dialog.alert("您已点过赞！")}})},e.cancle=function(e){var t={ownerType:10,type:30,parentId:e._id};n.studyCircle.removeDiscuss(t).then(function(){e.isLiked=!1,e.count.likeCount=+e.count.likeCount-1,n.dialog.alert("取消点赞成功")},function(e){n.dialog.alert("取消点赞失败"),console.error(e)})},e.setReadCount=function(e,t){var a={id:e};n.studyCircle.setReadCount(a).then(function(e){console.log(e)},function(e){console.log(e)})},e.toDetail=function(t){t.root._id&&e.setReadCount(t.root._id),e.toDetailCircle=rcpAid.getUrl("圈子详情",{id:t.root._id,token:rcpAid.getToken()})},e.sendLike=function(t,a){return e.curToken?(console.log(t),a.stopPropagation(),t.isLiked?void e.cancle(t):void(t.sendLike||e.send("30",t))):void n.common.toLogin()},e.$watch("c",e.init,!0)}catch(r){console.log(r)}}]}}),angular.module("RCP").directive("imageSlider",function(){return{template:'<div class="image-slider"><style type="text/css">.image-slider-wrapper{padding:10px;background:#f2f2f2}.slider-action li{display:inline-block;margin-right:5px}.slider-action a{color:#999}.slider-action img{width:13px;height:13px;margin-right:4px}.slider-main{margin:10px 0;background:#fff;padding:5px;text-align:center;overflow:hidden;-ms-user-select:none;user-select:none;-webkit-user-select:none;-moz-user-select:none}.slider-main.right{cursor:url(/img/pic_next.cur),auto}.slider-main.left{cursor:url(/img/pic_prev.cur),auto}.slider-all ul{display:block;padding:0 25px;white-space:nowrap;vertical-align:middle;overflow:hidden;width:100%;word-wrap:normal}.slider-all li{display:inline-block;position:relative;-moz-transition:all .3s;-o-transition:all .3s;transition:all .3s}.slider-all .slider-images{width:45px;height:45px;padding:2px;cursor:pointer;border:2px solid transparent}.slider-all .slider-images.active{border:2px solid #6baef8}.slider-all{position:relative;overflow:hidden}.slider-all .nav-btn{display:block;position:absolute;top:0;bottom:0;padding:15px 5px;color:#bfbfbf;border:1px solid #e5e5e5;vertical-align:middle;text-decoration:none;background:#F7F7F7;z-index:10}.slider-all .nav-btn.left{left:0}.slider-all .nav-btn.right{right:0}.slider-all .nav-btn.active{color:#fff;background:#FFAD8F}.prev-list{margin-top:-5px}.prev-list li{border:none;display:inline-block;margin-right:5px;margin-top:5px}.prev-list .s-img{width:80px;height:80px;cursor:pointer}</style><ul class="prev-list" ng-hide="show"><li ng-repeat="img in images track by $index"><ng-img c="{img:img}" class="s-img" ng-click="showBigPic($index)"></ng-img></li></ul><div ng-show="show" class="image-slider-wrapper"><div class="slider-action"><ul><li><a ng-click="show=false" href="javascript:;"><i class="fa fa-long-arrow-up"></i> 收起</a></li><li><a ng-href="{{images[currentImage]}}" target="_blank"><i class="fa fa-search-plus"></i> 查看大图</a></li><li><a ng-click="turnLeft()" href="javascript:;"><i class="fa fa-undo"></i> 向左旋转</a></li><li><a ng-click="turnRight()" href="javascript:;"><i class="fa fa-repeat"></i> 向右旋转</a></li></ul></div><div class="slider-main {{cursor}}" ng-click="nextOrPrev()" ng-mousemove="showCursor($event)"><img ng-src="{{images[currentImage]}}" alt="" ng-style="{\'max-width\': bigImgWidth, \'max-height\': 325, transform: \'rotate(\' + rotateDeg() + \'deg)\',\'-webkit-transform\': \'rotate(\' + rotateDeg() + \'deg)\', \'-ms-transform\': \'rotate(\' + rotateDeg() + \'deg)\', \'-moz-transform\': \'rotate(\' + rotateDeg() + \'deg)\', transition:\'all 0.2s\'}"></div><div class="slider-all"><a href="javascript:;" ng-class="{active: showToggle(\'left\')}" ng-click="toggleSlide(\'left\')" class="nav-btn left">&lt</a><ul style="width:{{imageListWidth}}px"><li ng-repeat="img in images track by $index" style="left:{{left}}px"><ng-img c="{img:img,divClass:{active: currentImage==$index}}" ng-click="switchImg($index)" alt="" class="slider-images"></ng-img></li></ul><a href="javascript:;" ng-class="{active: showToggle(\'right\')}" ng-click="toggleSlide(\'right\')" class="nav-btn right">&gt</a></div></div></div>',restrict:"E",scope:{images:"=",loop:"="},controller:["$scope","$element","$timeout",function(e,t,a){var n=['<style id="image-slider-style">',".image-slider-wrapper {","padding: 10px;","background: #f2f2f2;","}",".slider-action li {","display: inline-block;","margin-right: 5px;","}",".slider-action a {","color: #999999;","}",".slider-action img {","width: 13px;","height: 13px;","margin-right: 4px;","}",".slider-main {","margin: 10px 0;","background: #fff;","padding: 5px;","text-align: center;","overflow: hidden;","user-select: none;","-webkit-user-select: none;","-moz-user-select: none;","}",".slider-main.right {",'cursor: url("/rcp-common/imgs/icon/pic_next.png"), auto;',"}",".slider-main.left {",'cursor: url("/rcp-common/imgs/icon/pic_prev.png"), auto;',"}",".slider-all ul {","display: inline-block;","white-space: nowrap;","vertical-align: middle;","overflow: hidden;","}",".slider-all li {","display: inline-block;","position: relative;","transition: all 0.3s;","}",".slider-all .slider-images {","width: 45px;","height: 45px;","padding: 2px;","cursor: pointer;","border: 2px solid rgba(0,0,0,0);","}",".slider-all .slider-images.active {","border: 2px solid #6baef8;","}",".slider-all .nav-btn {","display: inline-block;","padding: 15px 5px;","color: #bfbfbf;","border: 1px solid #e5e5e5;","vertical-align: middle;","text-decoration: none;","background: #F7F7F7;","}",".slider-all .nav-btn.active {","color: #fff;","background: #FFAD8F;","}",".prev-list li {","border: none;","display: inline-block;","margin-right: 5px;","}",".prev-list .s-img {","width: 80px;","height: 80px;","cursor: pointer;","}","</style>"].join("");angular.element("#image-slider-style").length||angular.element("body").append(n),e.turnLeftCount=e.turnRightCount=0,e.imageListWidth=0,e.bigImgWidth=0,e.bigImgOffset={top:0,left:0},e.$watch("show",function(n){n&&(e.wrapperWidth=t.find(".image-slider").width(),e.bigImgWidth=e.wrapperWidth-20,e.imageListWidth=e.wrapperWidth-76,a(function(){e.bigImgOffset=t.find(".slider-main").offset()},100))}),e.showBigPic=function(t){e.show=!0,e.switchImg(t)},e.switchImg=function(t){e.currentImage=t,e.turnLeftCount=e.turnRightCount=0},e.showCursor=function(t){if(e.images){if(e.images.length<2)return void(e.cursor="");var a=t.pageX-e.bigImgOffset.left;a>e.bigImgWidth/2?e.loop||e.currentImage<e.images.length-1?e.cursor="right":e.cursor="":e.loop||e.currentImage>0?e.cursor="left":e.cursor=""}},e.nextOrPrev=function(){e.images&&("left"===e.cursor?e.loop&&0===e.currentImage?e.switchImg(e.images.length-1):e.switchImg(e.currentImage-1):"right"===e.cursor&&(e.loop&&e.currentImage===e.images.length-1?e.switchImg(0):e.switchImg(e.currentImage+1)))},e.turnLeft=function(){e.turnLeftCount=e.turnLeftCount+1},e.turnRight=function(){e.turnRightCount=e.turnRightCount+1},e.rotateDeg=function(){return 90*(e.turnRightCount-e.turnLeftCount)},e.left=0,e.showToggle=function(t){if(e.images){var a=58;return"right"===t?a*e.images.length+e.left>e.imageListWidth:"left"===t?e.left<0:void 0}},e.toggleSlide=function(t){"right"===t&&e.showToggle(t)?e.left=e.left-e.imageListWidth:"left"===t&&e.showToggle(t)&&(e.left=e.left+e.imageListWidth)}}]}});