!function(e){"function"==typeof define&&define.amd?define(["jquery"],e):e("object"==typeof exports?require("jquery"):jQuery)}(function(e){"use strict";function t(e){return"number"==typeof e&&!isNaN(e)}function i(e){return"undefined"==typeof e}function a(e,i){var a=[];return t(i)&&a.push(i),a.slice.apply(e,a)}function n(e,t){var i=a(arguments,2);return function(){return e.apply(t,i.concat(a(arguments)))}}function o(e){var t=e.match(/^(https?:)\/\/([^\:\/\?#]+):?(\d*)/i);return t&&(t[1]!==u.protocol||t[2]!==u.hostname||t[3]!==u.port)}function s(e){var t="timestamp="+(new Date).getTime();return e+(-1===e.indexOf("?")?"?":"&")+t}function r(e){var t,i=e.naturalWidth,a=e.naturalHeight;return i||(t=new Image,t.src=e.src,i=t.width,a=t.height),{naturalWidth:i,naturalHeight:a,aspectRatio:i/a}}function c(e){var i=[],a=e.rotate,n=e.scaleX,o=e.scaleY;return t(a)&&i.push("rotate("+a+"deg)"),t(n)&&t(o)&&i.push("scale("+n+","+o+")"),i.length?i.join(" "):"none"}function l(e,t){var i,a,n=ne(e.degree)%180,o=(n>90?180-n:n)*Math.PI/180,s=oe(o),r=se(o),c=e.width,l=e.height,h=e.aspectRatio;return t?(i=c/(r+s/h),a=i/h):(i=c*r+l*s,a=c*s+l*r),{width:i,height:a}}function h(i,a){var n,o,s,r=e("<canvas>")[0],c=r.getContext("2d"),h=0,d=0,p=a.naturalWidth,g=a.naturalHeight,u=a.rotate,m=a.scaleX,f=a.scaleY,v=t(m)&&t(f)&&(1!==m||1!==f),x=t(u)&&0!==u,b=x||v,y=p,w=g;return v&&(n=p/2,o=g/2),x&&(s=l({width:p,height:g,degree:u}),y=s.width,w=s.height,n=s.width/2,o=s.height/2),r.width=y,r.height=w,b&&(h=-p/2,d=-g/2,c.save(),c.translate(n,o)),x&&c.rotate(u*Math.PI/180),v&&c.scale(m,f),c.drawImage(i,h,d,p,g),b&&c.restore(),r}function d(t,i){this.$element=e(t),this.options=e.extend({},d.DEFAULTS,e.isPlainObject(i)&&i),this.ready=!1,this.built=!1,this.complete=!1,this.rotated=!1,this.cropped=!1,this.disabled=!1,this.replaced=!1,this.isImg=!1,this.originalUrl="",this.canvas=null,this.cropBox=null,this.init()}var p=e(window),g=e(document),u=window.location,m="cropper",f="preview."+m,v="cropper-modal",x="cropper-hide",b="cropper-hidden",y="cropper-invisible",w="cropper-move",k="cropper-crop",C="cropper-disabled",$="cropper-bg",L="mousedown touchstart pointerdown MSPointerDown",T="mousemove touchmove pointermove MSPointerMove",I="mouseup touchend touchcancel pointerup pointercancel MSPointerUp MSPointerCancel",U="wheel mousewheel DOMMouseScroll",B="dblclick",S="load."+m,E="error."+m,P="resize."+m,A="build."+m,D="built."+m,M="cropstart."+m,R="cropmove."+m,N="cropend."+m,F="crop."+m,_="zoom."+m,H=/^(e|w|s|n|se|sw|ne|nw|all|crop|move|zoom)$/,O="e",W="w",Y="s",z="n",j="se",X="sw",K="ne",G="nw",q="all",V="crop",Z="move",J="zoom",Q="none",ee=e.isFunction(e("<canvas>")[0].getContext),te=Math.sqrt,ie=Math.min,ae=Math.max,ne=Math.abs,oe=Math.sin,se=Math.cos,re=parseFloat,ce={};e.extend(ce,{init:function(){var e,t=this.$element;if(t.is("img")){if(this.isImg=!0,this.originalUrl=e=t.attr("src"),!e)return;e=t.prop("src")}else t.is("canvas")&&ee&&(e=t[0].toDataURL());this.load(e)},trigger:function(t,i){var a=e.Event(t,i);return this.$element.trigger(a),a.isDefaultPrevented()},load:function(t){var i,a,n=this.options,r=this.$element,c="";t&&(this.url=t,r.one(A,n.build),this.trigger(A)||(n.checkImageOrigin&&o(t)&&(c=' crossOrigin="anonymous"',r.prop("crossOrigin")||(i=s(t))),this.$clone=a=e("<img"+c+' src="'+(i||t)+'">'),this.isImg?r[0].complete?this.start():r.one(S,e.proxy(this.start,this)):a.one(S,e.proxy(this.start,this)).one(E,e.proxy(this.stop,this)).addClass(x).insertAfter(r)))},start:function(){this.image=r(this.isImg?this.$element[0]:this.$clone[0]),this.ready=!0,this.build()},stop:function(){this.$clone.remove(),this.$clone=null}}),e.extend(ce,{build:function(){var t,i,a,n=this.options,o=this.$element,s=this.$clone;this.ready&&(this.built&&this.unbuild(),this.$container=o.parent(),this.$cropper=t=e(d.TEMPLATE),this.$canvas=t.find(".cropper-canvas").append(s),this.$dragBox=t.find(".cropper-drag-box"),this.$cropBox=i=t.find(".cropper-crop-box"),this.$viewBox=t.find(".cropper-view-box"),this.$face=a=i.find(".cropper-face"),o.addClass(b).after(t),this.isImg||s.removeClass(x),this.initPreview(),this.bind(),n.aspectRatio=re(n.aspectRatio)||NaN,n.autoCrop?(this.cropped=!0,n.modal&&this.$dragBox.addClass(v)):i.addClass(b),n.guides||i.find(".cropper-dashed").addClass(b),n.center||i.find(".cropper-center").addClass(b),n.cropBoxMovable&&a.addClass(w).data("action",q),n.highlight||a.addClass(y),n.background&&t.addClass($),n.cropBoxResizable||i.find(".cropper-line, .cropper-point").addClass(b),this.setDragMode(n.dragCrop?V:n.movable?Z:Q),this.render(),this.built=!0,this.setData(n.data),o.one(D,n.built),setTimeout(e.proxy(function(){this.trigger(D),this.complete=!0},this),0))},unbuild:function(){this.built&&(this.built=!1,this.initialImage=null,this.initialCanvas=null,this.initialCropBox=null,this.container=null,this.canvas=null,this.cropBox=null,this.unbind(),this.resetPreview(),this.$preview=null,this.$viewBox=null,this.$cropBox=null,this.$dragBox=null,this.$canvas=null,this.$container=null,this.$cropper.remove(),this.$cropper=null)}}),e.extend(ce,{render:function(){this.initContainer(),this.initCanvas(),this.initCropBox(),this.renderCanvas(),this.cropped&&this.renderCropBox()},initContainer:function(){var e=this.options,t=this.$element,i=this.$container,a=this.$cropper;a.addClass(b),t.removeClass(b),a.css(this.container={width:ae(i.width(),re(e.minContainerWidth)||200),height:ae(i.height(),re(e.minContainerHeight)||100)}),t.addClass(b),a.removeClass(b)},initCanvas:function(){var t=this.container,i=t.width,a=t.height,n=this.image,o=n.aspectRatio,s={aspectRatio:o,width:i,height:a};a*o>i?s.height=i/o:s.width=a*o,s.oldLeft=s.left=(i-s.width)/2,s.oldTop=s.top=(a-s.height)/2,this.canvas=s,this.limitCanvas(!0,!0),this.initialImage=e.extend({},n),this.initialCanvas=e.extend({},s)},limitCanvas:function(t,i){var a,n,o=this.options,s=o.strict,r=this.container,c=r.width,l=r.height,h=this.canvas,d=h.aspectRatio,p=this.cropBox,g=this.cropped&&p,u=this.initialCanvas||h,m=u.width,f=u.height;t&&(a=re(o.minCanvasWidth)||0,n=re(o.minCanvasHeight)||0,a?(s&&(a=ae(g?p.width:m,a)),n=a/d):n?(s&&(n=ae(g?p.height:f,n)),a=n*d):s&&(g?(a=p.width,n=p.height,n*d>a?a=n*d:n=a/d):(a=m,n=f)),e.extend(h,{minWidth:a,minHeight:n,maxWidth:1/0,maxHeight:1/0})),i&&(s?g?(h.minLeft=ie(p.left,p.left+p.width-h.width),h.minTop=ie(p.top,p.top+p.height-h.height),h.maxLeft=p.left,h.maxTop=p.top):(h.minLeft=ie(0,c-h.width),h.minTop=ie(0,l-h.height),h.maxLeft=ae(0,c-h.width),h.maxTop=ae(0,l-h.height)):(h.minLeft=-h.width,h.minTop=-h.height,h.maxLeft=c,h.maxTop=l))},renderCanvas:function(e){var t,i,a=this.options,n=this.canvas,o=this.image;this.rotated&&(this.rotated=!1,i=l({width:o.width,height:o.height,degree:o.rotate}),t=i.width/i.height,t!==n.aspectRatio&&(n.left-=(i.width-n.width)/2,n.top-=(i.height-n.height)/2,n.width=i.width,n.height=i.height,n.aspectRatio=t,this.limitCanvas(!0,!1))),(n.width>n.maxWidth||n.width<n.minWidth)&&(n.left=n.oldLeft),(n.height>n.maxHeight||n.height<n.minHeight)&&(n.top=n.oldTop),n.width=ie(ae(n.width,n.minWidth),n.maxWidth),n.height=ie(ae(n.height,n.minHeight),n.maxHeight),this.limitCanvas(!1,!0),n.oldLeft=n.left=ie(ae(n.left,n.minLeft),n.maxLeft),n.oldTop=n.top=ie(ae(n.top,n.minTop),n.maxTop),this.$canvas.css({width:n.width,height:n.height,left:n.left,top:n.top}),this.renderImage(),this.cropped&&a.strict&&this.limitCropBox(!0,!0),e&&this.output()},renderImage:function(t){var i,a=this.canvas,n=this.image;n.rotate&&(i=l({width:a.width,height:a.height,degree:n.rotate,aspectRatio:n.aspectRatio},!0)),e.extend(n,i?{width:i.width,height:i.height,left:(a.width-i.width)/2,top:(a.height-i.height)/2}:{width:a.width,height:a.height,left:0,top:0}),this.$clone.css({width:n.width,height:n.height,marginLeft:n.left,marginTop:n.top,transform:c(n)}),t&&this.output()},initCropBox:function(){var t=this.options,i=this.canvas,a=t.aspectRatio,n=re(t.autoCropArea)||.8,o={width:i.width,height:i.height};a&&(i.height*a>i.width?o.height=o.width/a:o.width=o.height*a),this.cropBox=o,this.limitCropBox(!0,!0),o.width=ie(ae(o.width,o.minWidth),o.maxWidth),o.height=ie(ae(o.height,o.minHeight),o.maxHeight),o.width=ae(o.minWidth,o.width*n),o.height=ae(o.minHeight,o.height*n),o.oldLeft=o.left=i.left+(i.width-o.width)/2,o.oldTop=o.top=i.top+(i.height-o.height)/2,this.initialCropBox=e.extend({},o)},limitCropBox:function(e,t){var i,a,n=this.options,o=n.strict,s=this.container,r=s.width,c=s.height,l=this.canvas,h=this.cropBox,d=n.aspectRatio;e&&(i=re(n.minCropBoxWidth)||0,a=re(n.minCropBoxHeight)||0,h.minWidth=ie(r,i),h.minHeight=ie(c,a),h.maxWidth=ie(r,o?l.width:r),h.maxHeight=ie(c,o?l.height:c),d&&(h.maxHeight*d>h.maxWidth?(h.minHeight=h.minWidth/d,h.maxHeight=h.maxWidth/d):(h.minWidth=h.minHeight*d,h.maxWidth=h.maxHeight*d)),h.minWidth=ie(h.maxWidth,h.minWidth),h.minHeight=ie(h.maxHeight,h.minHeight)),t&&(o?(h.minLeft=ae(0,l.left),h.minTop=ae(0,l.top),h.maxLeft=ie(r,l.left+l.width)-h.width,h.maxTop=ie(c,l.top+l.height)-h.height):(h.minLeft=0,h.minTop=0,h.maxLeft=r-h.width,h.maxTop=c-h.height))},renderCropBox:function(){var e=this.options,t=this.container,i=t.width,a=t.height,n=this.cropBox;(n.width>n.maxWidth||n.width<n.minWidth)&&(n.left=n.oldLeft),(n.height>n.maxHeight||n.height<n.minHeight)&&(n.top=n.oldTop),n.width=ie(ae(n.width,n.minWidth),n.maxWidth),n.height=ie(ae(n.height,n.minHeight),n.maxHeight),this.limitCropBox(!1,!0),n.oldLeft=n.left=ie(ae(n.left,n.minLeft),n.maxLeft),n.oldTop=n.top=ie(ae(n.top,n.minTop),n.maxTop),e.movable&&e.cropBoxMovable&&this.$face.data("action",n.width===i&&n.height===a?Z:q),this.$cropBox.css({width:n.width,height:n.height,left:n.left,top:n.top}),this.cropped&&e.strict&&this.limitCanvas(!0,!0),this.disabled||this.output()},output:function(){this.preview(),this.complete?this.trigger(F,this.getData()):this.built||this.$element.one(D,e.proxy(function(){this.trigger(F,this.getData())},this))}}),e.extend(ce,{initPreview:function(){var t=this.url;this.$preview=e(this.options.preview),this.$viewBox.html('<img src="'+t+'">'),this.$preview.each(function(){var i=e(this);i.data(f,{width:i.width(),height:i.height(),original:i.html()}),i.html('<img src="'+t+'" style="display:block;width:100%;min-width:0!important;min-height:0!important;max-width:none!important;max-height:none!important;image-orientation:0deg!important">')})},resetPreview:function(){this.$preview.each(function(){var t=e(this);t.html(t.data(f).original).removeData(f)})},preview:function(){var t=this.image,i=this.canvas,a=this.cropBox,n=t.width,o=t.height,s=a.left-i.left-t.left,r=a.top-i.top-t.top;this.cropped&&!this.disabled&&(this.$viewBox.find("img").css({width:n,height:o,marginLeft:-s,marginTop:-r,transform:c(t)}),this.$preview.each(function(){var i=e(this),l=i.data(f),h=l.width/a.width,d=l.width,p=a.height*h;p>l.height&&(h=l.height/a.height,d=a.width*h,p=l.height),i.width(d).height(p).find("img").css({width:n*h,height:o*h,marginLeft:-s*h,marginTop:-r*h,transform:c(t)})}))}}),e.extend(ce,{bind:function(){var t=this.options,i=this.$element,a=this.$cropper;e.isFunction(t.cropstart)&&i.on(M,t.cropstart),e.isFunction(t.cropmove)&&i.on(R,t.cropmove),e.isFunction(t.cropend)&&i.on(N,t.cropend),e.isFunction(t.crop)&&i.on(F,t.crop),e.isFunction(t.zoom)&&i.on(_,t.zoom),a.on(L,e.proxy(this.cropStart,this)),t.zoomable&&t.mouseWheelZoom&&a.on(U,e.proxy(this.wheel,this)),t.doubleClickToggle&&a.on(B,e.proxy(this.dblclick,this)),g.on(T,this._cropMove=n(this.cropMove,this)).on(I,this._cropEnd=n(this.cropEnd,this)),t.responsive&&p.on(P,this._resize=n(this.resize,this))},unbind:function(){var t=this.options,i=this.$element,a=this.$cropper;e.isFunction(t.cropstart)&&i.off(M,t.cropstart),e.isFunction(t.cropmove)&&i.off(R,t.cropmove),e.isFunction(t.cropend)&&i.off(N,t.cropend),e.isFunction(t.crop)&&i.off(F,t.crop),e.isFunction(t.zoom)&&i.off(_,t.zoom),a.off(L,this.cropStart),t.zoomable&&t.mouseWheelZoom&&a.off(U,this.wheel),t.doubleClickToggle&&a.off(B,this.dblclick),g.off(T,this._cropMove).off(I,this._cropEnd),t.responsive&&p.off(P,this._resize)}}),e.extend(ce,{resize:function(){var t,i,a,n=this.$container,o=this.container;!this.disabled&&o&&(a=n.width()/o.width,1===a&&n.height()===o.height||(t=this.getCanvasData(),i=this.getCropBoxData(),this.render(),this.setCanvasData(e.each(t,function(e,i){t[e]=i*a})),this.setCropBoxData(e.each(i,function(e,t){i[e]=t*a}))))},dblclick:function(){this.disabled||(this.$dragBox.hasClass(k)?this.setDragMode(Z):this.setDragMode(V))},wheel:function(e){var t=e.originalEvent,i=t,a=re(this.options.wheelZoomRatio)||.1,n=1;this.disabled||(e.preventDefault(),i.deltaY?n=i.deltaY>0?1:-1:i.wheelDelta?n=-i.wheelDelta/120:i.detail&&(n=i.detail>0?1:-1),this.zoom(-n*a,t))},cropStart:function(t){var i,a,n=this.options,o=t.originalEvent,s=o&&o.touches,r=t;if(!this.disabled){if(s){if(i=s.length,i>1){if(!n.zoomable||!n.touchDragZoom||2!==i)return;r=s[1],this.startX2=r.pageX,this.startY2=r.pageY,a=J}r=s[0]}if(a=a||e(r.target).data("action"),H.test(a)){if(this.trigger(M,{originalEvent:o,action:a}))return;t.preventDefault(),this.action=a,this.cropping=!1,this.startX=r.pageX||o&&o.pageX,this.startY=r.pageY||o&&o.pageY,a===V&&(this.cropping=!0,this.$dragBox.addClass(v))}}},cropMove:function(e){var t,i=this.options,a=e.originalEvent,n=a&&a.touches,o=e,s=this.action;if(!this.disabled){if(n){if(t=n.length,t>1){if(!i.zoomable||!i.touchDragZoom||2!==t)return;o=n[1],this.endX2=o.pageX,this.endY2=o.pageY}o=n[0]}if(s){if(this.trigger(R,{originalEvent:a,action:s}))return;e.preventDefault(),this.endX=o.pageX||a&&a.pageX,this.endY=o.pageY||a&&a.pageY,this.change(o.shiftKey,s===J?a:null)}}},cropEnd:function(e){var t=e.originalEvent,i=this.action;this.disabled||i&&(e.preventDefault(),this.cropping&&(this.cropping=!1,this.$dragBox.toggleClass(v,this.cropped&&this.options.modal)),this.action="",this.trigger(N,{originalEvent:t,action:i}))}}),e.extend(ce,{change:function(e,t){var i,a,n=this.options,o=n.aspectRatio,s=this.action,r=this.container,c=this.canvas,l=this.cropBox,h=l.width,d=l.height,p=l.left,g=l.top,u=p+h,m=g+d,f=0,v=0,x=r.width,y=r.height,w=!0;switch(!o&&e&&(o=h&&d?h/d:1),n.strict&&(f=l.minLeft,v=l.minTop,x=f+ie(r.width,c.width),y=v+ie(r.height,c.height)),a={x:this.endX-this.startX,y:this.endY-this.startY},o&&(a.X=a.y*o,a.Y=a.x/o),s){case q:p+=a.x,g+=a.y;break;case O:if(a.x>=0&&(u>=x||o&&(v>=g||m>=y))){w=!1;break}h+=a.x,o&&(d=h/o,g-=a.Y/2),0>h&&(s=W,h=0);break;case z:if(a.y<=0&&(v>=g||o&&(f>=p||u>=x))){w=!1;break}d-=a.y,g+=a.y,o&&(h=d*o,p+=a.X/2),0>d&&(s=Y,d=0);break;case W:if(a.x<=0&&(f>=p||o&&(v>=g||m>=y))){w=!1;break}h-=a.x,p+=a.x,o&&(d=h/o,g+=a.Y/2),0>h&&(s=O,h=0);break;case Y:if(a.y>=0&&(m>=y||o&&(f>=p||u>=x))){w=!1;break}d+=a.y,o&&(h=d*o,p-=a.X/2),0>d&&(s=z,d=0);break;case K:if(o){if(a.y<=0&&(v>=g||u>=x)){w=!1;break}d-=a.y,g+=a.y,h=d*o}else a.x>=0?x>u?h+=a.x:a.y<=0&&v>=g&&(w=!1):h+=a.x,a.y<=0?g>v&&(d-=a.y,g+=a.y):(d-=a.y,g+=a.y);0>h&&0>d?(s=X,d=0,h=0):0>h?(s=G,h=0):0>d&&(s=j,d=0);break;case G:if(o){if(a.y<=0&&(v>=g||f>=p)){w=!1;break}d-=a.y,g+=a.y,h=d*o,p+=a.X}else a.x<=0?p>f?(h-=a.x,p+=a.x):a.y<=0&&v>=g&&(w=!1):(h-=a.x,p+=a.x),a.y<=0?g>v&&(d-=a.y,g+=a.y):(d-=a.y,g+=a.y);0>h&&0>d?(s=j,d=0,h=0):0>h?(s=K,h=0):0>d&&(s=X,d=0);break;case X:if(o){if(a.x<=0&&(f>=p||m>=y)){w=!1;break}h-=a.x,p+=a.x,d=h/o}else a.x<=0?p>f?(h-=a.x,p+=a.x):a.y>=0&&m>=y&&(w=!1):(h-=a.x,p+=a.x),a.y>=0?y>m&&(d+=a.y):d+=a.y;0>h&&0>d?(s=K,d=0,h=0):0>h?(s=j,h=0):0>d&&(s=G,d=0);break;case j:if(o){if(a.x>=0&&(u>=x||m>=y)){w=!1;break}h+=a.x,d=h/o}else a.x>=0?x>u?h+=a.x:a.y>=0&&m>=y&&(w=!1):h+=a.x,a.y>=0?y>m&&(d+=a.y):d+=a.y;0>h&&0>d?(s=G,d=0,h=0):0>h?(s=X,h=0):0>d&&(s=K,d=0);break;case Z:c.left+=a.x,c.top+=a.y,this.renderCanvas(!0),w=!1;break;case J:this.zoom(function(e,t,i,a){var n=te(e*e+t*t),o=te(i*i+a*a);return(o-n)/n}(ne(this.startX-this.startX2),ne(this.startY-this.startY2),ne(this.endX-this.endX2),ne(this.endY-this.endY2)),t),this.startX2=this.endX2,this.startY2=this.endY2,w=!1;break;case V:a.x&&a.y&&(i=this.$cropper.offset(),p=this.startX-i.left,g=this.startY-i.top,h=l.minWidth,d=l.minHeight,a.x>0?a.y>0?s=j:(s=K,g-=d):a.y>0?(s=X,p-=h):(s=G,p-=h,g-=d),this.cropped||(this.cropped=!0,this.$cropBox.removeClass(b)))}w&&(l.width=h,l.height=d,l.left=p,l.top=g,this.action=s,this.renderCropBox()),this.startX=this.endX,this.startY=this.endY}}),e.extend(ce,{crop:function(){this.built&&!this.disabled&&(this.cropped||(this.cropped=!0,this.limitCropBox(!0,!0),this.options.modal&&this.$dragBox.addClass(v),this.$cropBox.removeClass(b)),this.setCropBoxData(this.initialCropBox))},reset:function(){this.built&&!this.disabled&&(this.image=e.extend({},this.initialImage),this.canvas=e.extend({},this.initialCanvas),this.cropBox=e.extend({},this.initialCropBox),this.renderCanvas(),this.cropped&&this.renderCropBox())},clear:function(){this.cropped&&!this.disabled&&(e.extend(this.cropBox,{left:0,top:0,width:0,height:0}),this.cropped=!1,this.renderCropBox(),this.limitCanvas(),this.renderCanvas(),this.$dragBox.removeClass(v),this.$cropBox.addClass(b))},replace:function(e){!this.disabled&&e&&(this.isImg&&this.$element.attr("src",e),this.options.data=null,this.load(e))},enable:function(){this.built&&(this.disabled=!1,this.$cropper.removeClass(C))},disable:function(){this.built&&(this.disabled=!0,this.$cropper.addClass(C))},destroy:function(){var e=this.$element;this.ready?(this.isImg&&e.attr("src",this.originalUrl),this.unbuild(),e.removeClass(b)):this.isImg?e.off(S,this.start):this.$clone&&this.$clone.remove(),e.removeData(m)},move:function(e,a){var n=this.canvas;i(a)&&(a=e),e=re(e),a=re(a),this.built&&!this.disabled&&this.options.movable&&(n.left+=t(e)?e:0,n.top+=t(a)?a:0,this.renderCanvas(!0))},zoom:function(e,t){var i,a,n=this.canvas;if(e=re(e),e&&this.built&&!this.disabled&&this.options.zoomable){if(this.trigger(_,{originalEvent:t,ratio:e}))return;e=0>e?1/(1-e):1+e,i=n.width*e,a=n.height*e,n.left-=(i-n.width)/2,n.top-=(a-n.height)/2,n.width=i,n.height=a,this.renderCanvas(!0),this.setDragMode(Z)}},rotate:function(e){var t=this.image,i=t.rotate||0;e=re(e)||0,this.built&&!this.disabled&&this.options.rotatable&&(t.rotate=(i+e)%360,this.rotated=!0,this.renderCanvas(!0))},scale:function(e,a){var n=this.image;i(a)&&(a=e),e=re(e),a=re(a),this.built&&!this.disabled&&this.options.scalable&&(n.scaleX=t(e)?e:1,n.scaleY=t(a)?a:1,this.renderImage(!0))},getData:function(t){var i,a,n=this.options,o=this.image,s=this.canvas,r=this.cropBox;return this.built&&this.cropped?(a={x:r.left-s.left,y:r.top-s.top,width:r.width,height:r.height},i=o.width/o.naturalWidth,e.each(a,function(e,n){n/=i,a[e]=t?Math.round(n):n})):a={x:0,y:0,width:0,height:0},n.rotatable&&(a.rotate=o.rotate||0),n.scalable&&(a.scaleX=o.scaleX||1,a.scaleY=o.scaleY||1),a},setData:function(i){var a,n=this.image,o=this.canvas,s={};e.isFunction(i)&&(i=i.call(this.$element)),this.built&&!this.disabled&&e.isPlainObject(i)&&(t(i.rotate)&&i.rotate!==n.rotate&&this.options.rotatable&&(n.rotate=i.rotate,this.rotated=!0,this.renderCanvas(!0)),a=n.width/n.naturalWidth,t(i.x)&&(s.left=i.x*a+o.left),t(i.y)&&(s.top=i.y*a+o.top),t(i.width)&&(s.width=i.width*a),t(i.height)&&(s.height=i.height*a),this.setCropBoxData(s))},getContainerData:function(){return this.built?this.container:{}},getImageData:function(){return this.ready?this.image:{}},getCanvasData:function(){var e,t=this.canvas;return this.built&&(e={left:t.left,top:t.top,width:t.width,height:t.height}),e||{}},setCanvasData:function(i){var a=this.canvas,n=a.aspectRatio;e.isFunction(i)&&(i=i.call(this.$element)),this.built&&!this.disabled&&e.isPlainObject(i)&&(t(i.left)&&(a.left=i.left),t(i.top)&&(a.top=i.top),t(i.width)?(a.width=i.width,a.height=i.width/n):t(i.height)&&(a.height=i.height,a.width=i.height*n),this.renderCanvas(!0))},getCropBoxData:function(){var e,t=this.cropBox;return this.built&&this.cropped&&(e={left:t.left,top:t.top,width:t.width,height:t.height}),e||{}},setCropBoxData:function(i){var a,n,o=this.cropBox,s=this.options.aspectRatio;e.isFunction(i)&&(i=i.call(this.$element)),this.built&&this.cropped&&!this.disabled&&e.isPlainObject(i)&&(t(i.left)&&(o.left=i.left),t(i.top)&&(o.top=i.top),t(i.width)&&i.width!==o.width&&(a=!0,o.width=i.width),t(i.height)&&i.height!==o.height&&(n=!0,o.height=i.height),s&&(a?o.height=o.width/s:n&&(o.width=o.height*s)),this.renderCropBox())},getCroppedCanvas:function(t){var i,a,n,o,s,r,c,l,d,p,g;return this.built&&this.cropped&&ee?(e.isPlainObject(t)||(t={}),g=this.getData(),i=g.width,a=g.height,l=i/a,e.isPlainObject(t)&&(s=t.width,r=t.height,s?(r=s/l,c=s/i):r&&(s=r*l,c=r/a)),n=s||i,o=r||a,d=e("<canvas>")[0],d.width=n,d.height=o,p=d.getContext("2d"),t.fillColor&&(p.fillStyle=t.fillColor,p.fillRect(0,0,n,o)),p.drawImage.apply(p,function(){var e,t,n,o,s,r,l=h(this.$clone[0],this.image),d=l.width,p=l.height,u=[l],m=g.x,f=g.y;return-i>=m||m>d?m=e=n=s=0:0>=m?(n=-m,m=0,e=s=ie(d,i+m)):d>=m&&(n=0,e=s=ie(i,d-m)),0>=e||-a>=f||f>p?f=t=o=r=0:0>=f?(o=-f,f=0,t=r=ie(p,a+f)):p>=f&&(o=0,t=r=ie(a,p-f)),u.push(m,f,e,t),c&&(n*=c,o*=c,s*=c,r*=c),s>0&&r>0&&u.push(n,o,s,r),u}.call(this)),d):void 0},setAspectRatio:function(e){var t=this.options;this.disabled||i(e)||(t.aspectRatio=re(e)||NaN,this.built&&(this.initCropBox(),this.cropped&&this.renderCropBox()))},setDragMode:function(e){var t,i,a=this.options;this.ready&&!this.disabled&&(t=a.dragCrop&&e===V,i=a.movable&&e===Z,e=t||i?e:Q,this.$dragBox.data("action",e).toggleClass(k,t).toggleClass(w,i),a.cropBoxMovable||this.$face.data("action",e).toggleClass(k,t).toggleClass(w,i))}}),e.extend(d.prototype,ce),d.DEFAULTS={aspectRatio:NaN,data:null,preview:"",strict:!0,responsive:!0,checkImageOrigin:!0,modal:!0,guides:!0,center:!0,highlight:!0,background:!0,autoCrop:!0,autoCropArea:.8,dragCrop:!0,movable:!0,rotatable:!0,scalable:!0,zoomable:!0,mouseWheelZoom:!0,wheelZoomRatio:.1,touchDragZoom:!0,cropBoxMovable:!0,cropBoxResizable:!0,doubleClickToggle:!0,minCanvasWidth:0,minCanvasHeight:0,minCropBoxWidth:0,minCropBoxHeight:0,minContainerWidth:200,minContainerHeight:100,build:null,built:null,cropstart:null,cropmove:null,cropend:null,crop:null,zoom:null},d.setDefaults=function(t){e.extend(d.DEFAULTS,t)},d.TEMPLATE='<div class="cropper-container"><div class="cropper-canvas"></div><div class="cropper-drag-box"></div><div class="cropper-crop-box"><span class="cropper-view-box"></span><span class="cropper-dashed dashed-h"></span><span class="cropper-dashed dashed-v"></span><span class="cropper-center"></span><span class="cropper-face"></span><span class="cropper-line line-e" data-action="e"></span><span class="cropper-line line-n" data-action="n"></span><span class="cropper-line line-w" data-action="w"></span><span class="cropper-line line-s" data-action="s"></span><span class="cropper-point point-e" data-action="e"></span><span class="cropper-point point-n" data-action="n"></span><span class="cropper-point point-w" data-action="w"></span><span class="cropper-point point-s" data-action="s"></span><span class="cropper-point point-ne" data-action="ne"></span><span class="cropper-point point-nw" data-action="nw"></span><span class="cropper-point point-sw" data-action="sw"></span><span class="cropper-point point-se" data-action="se"></span></div></div>',d.other=e.fn.cropper,e.fn.cropper=function(t){var n,o=a(arguments,1);return this.each(function(){var i,a=e(this),s=a.data(m);if(!s){if(/destroy/.test(t))return;a.data(m,s=new d(this,t))}"string"==typeof t&&e.isFunction(i=s[t])&&(n=i.apply(s,o))}),i(n)?this:n},e.fn.cropper.Constructor=d,e.fn.cropper.setDefaults=d.setDefaults,e.fn.cropper.noConflict=function(){return e.fn.cropper=d.other,this}});var module=angular.module("RCP",["ngCookies"]);module.controller("myCtr",["$scope","$window","$timeout","$interval","$location","service","ssoMethod",function(e,t,i,a,n,o,s){function r(e,t){for(var a=" ...",n=function(){console.log("desc",$(".desc-container .desc").height(),"container",$(".desc-container").height()-14),$(".desc-container .desc").height()>$(".desc-container").height()-14&&(console.log("rectify",e.desc,e.desc.length-a.length-1,e.desc.substr(0,e.desc.length-a.length-1)),e.desc=e.desc.substr(0,e.desc.length-a.length-1)+a,i(function(){n()}))},o={32:4,33:4,34:5,35:8,36:7,37:11,38:10,39:3,40:4,41:4,42:5,43:9,44:3,45:5,46:3,47:5,48:7,49:7,50:7,51:7,52:7,53:7,54:7,55:7,56:7,57:7,58:3,59:3,60:9,61:9,62:9,63:6,64:12,65:8,66:8,67:8,68:9,69:7,70:6,71:9,72:9,73:4,74:5,75:8,76:6,77:12,78:10,79:10,80:7,81:10,82:8,83:7,84:7,85:9,86:8,87:12,88:8,89:7,90:7,91:4,92:5,93:4,94:9,95:5,96:4,97:7,98:8,99:6,100:8,101:7,102:4,103:8,104:7,105:3,106:3,107:7,108:3,109:11,110:7,111:8,112:8,113:8,114:5,115:6,116:4,117:7,118:6,119:9,120:6,121:6,122:6,123:4,124:3,125:4,126:9},s=0,r=0,c=t.length;c>r;r++)if(s+=t.charCodeAt(r)>127?12:o[t.charCodeAt(r)]||6,s>218)return e.desc=t.substr(0,r)+a,void i(function(){n()});e.desc=t,i(function(){n()})}function c(t){if(t){var i=t.basic;i?(e.info.avatar=i.avatar,e.info.desc=i.desc,e.info.nickName=i.nickName,e.info.gender=i.gender):console.error(t,"attrs have no field 'basic'"),i=t.extra,i?(e.info.country=i.country,e.info.province=i.province,e.info.city=i.city,e.info.hobby=i.hobby||[]):console.error(t,"attrs have no field 'extra'"),i=t.privated,i?h(i.phone||""):console.error(t,"attrs have no field 'privated'"),angular.extend(d,e.info),d.hobby=[],angular.forEach(e.info.hobby,function(e,t){d.hobby[t]=e})}}function l(){var t,i,a=e.info;d.avatar!==a.avatar&&(t||(t={}))&&(t.avatar=a.avatar),d.desc!==a.desc&&(t||(t={}))&&(t.desc=a.desc),d.nickName!==a.nickName&&(t||(t={}))&&(t.nickName=a.nickName),d.gender!==a.gender&&(t||(t={}))&&(t.gender=a.gender),d.country!==a.country&&(i||(i={}))&&(i.country=a.country),d.province!==a.province&&(i||(i={}))&&(i.province=a.province),d.city!==a.city&&(i||(i={}))&&(i.city=a.city),angular.equals(d.hobby,a.hobby)&&(i||(i={}))&&(i.hobby=a.hobby),i.hobby&&!i.hobby.length&&(i.hobby=void 0);var n={attrs:{}},o=!1;return t&&(o=!0)&&(n.attrs.basic=t),i&&(o=!0)&&(n.attrs.extra=i),o?n:null}function h(t){return t?(e.phone=t.substr(0,4)+"****"+t.substr(t.length-3,t.length),void(p=t)):(e.phone="",void(p=""))}e.user={avatar:"../rcp-common/imgs/face/d-face-1.png",nickName:"username",certification:!1,desc:"这家伙很懒，什么也没留下"},e.certificateUrl=rcpAid.getUrl("实名认证"),e.showEdit=0,e.descEditText="",e.toShowEdit=function(){e.showEdit=1,i(function(){document.getElementById("desc-edit").focus()})},e.editKeyDown=function(t){13===t.keyCode&&(document.getElementById("desc-edit").blur(),e.editBlur())},e.editBlur=function(){e.descEditText!=d.desc&&s.updateUser({attrs:{basic:{desc:e.descEditText}}}).then(function(t){return t?(d.desc=e.info.desc=e.descEditText,void r(e.user,e.descEditText)):(console.error("修改签名返回数据为空",t),void o.dialog.alert("修改失败"))},function(e){console.error("修改签名请求错误",e),e.data&&e.data.data&&301!=e.data.data.code&&o.dialog.alert("修改失败")}),e.showEdit=0},e.toShowDescTips=function(t){var i=$(".info .desc-tips");i.css("left",t.clientX),i.css("top",t.clientY+7),e.showDescTips=1},e.$on("login",function(t,i){if(!i)return void o.common.toLogin(!0);var a=e.user;a.avatar=i.avatar||a.avatar,a.nickName=i.nickName||a.nickName,a.certification=!!i.certification,e.descEditText=i.desc||a.desc,r(a,i.desc||a.desc),$(".loading").removeClass("loading")}),e.loaded=!1,e.curBar="/info"==n.path()?0:"/account-setting"==n.path()?1:0,e.selectBar=function(t){e.curBar=t,0==t?n.path("info"):n.path("account-setting")},s.userInfo({selector:"basic,extra,privated"}).then(function(t){return t||t.data||t.data.usr||t.data.usr.attrs?(console.log("个人资料获",t.data.usr.attrs),c(t.data.usr.attrs),e.info.avatar=e.info.avatar||e.user.avatar,e.info.desc=e.info.desc||e.user.desc,void(e.loaded=!0)):(console.error("response data have no 'attrs' field","data:",t),void o.dialog.alert("个人资料获取失败"))},function(e){console.error("个人资料请求错误",e),o.dialog.alert("个人资料获取失败")});var d={};e.info={avatar:"",desc:"",nickName:"",gender:2,country:"",province:"",city:"",hobby:[]},e.saveInfo=function(){var e=l();console.log("req data ",e),e&&s.updateUser(e).then(function(e){return e?void t.location.reload():(console.error("修改信息请求返回数据为空",e),void o.dialog.alert("修改失败"))},function(e){console.error("修改信息请求失败",e),e.data&&e.data.data&&301!=e.data.data.code&&o.dialog.alert("修改失败")})},e.uploadConfig={showEdit:!1,uploadNum:0,upCancel:!1,id:"avatar",width:200,ratio:[1,1],containerStyle:{width:"480px",height:"310px"},mode:"fixed",scope:null,cb:function(t){t&&(e.info.avatar=t)}},e.uploadAvatar=function(){i(function(){e.uploadConfig.scope&&e.uploadConfig.scope.selectImg()})};var p="";e.phone="",e.phoneReg=/^1[34578]\d{9}$/,e.passReg=/^.{6,15}$/,e.phoneInfo={current:"",fresh:"",verification:""},e.passInfo={fresh:"",verification:""};var g=59;e.verifyPhone={isTime:!1,time:g},e.verifyPass={isTime:!1,time:g},e.verify=function(t){if(0==t&&(!e.phoneInfo.fresh||e.phoneForm.freshPhone.$error.pattern))return void(e.freshPhoneInput=-1);if(0==t||e.phone){var i=0==t?e.verifyPhone:e.verifyPass;if(!i.isTime){var n={mobile:0==t?e.phoneInfo.fresh:p,types:0==t?e.phone?"modifyBind":"bind":"resetPwd"};s.sendMessage(n).then(function(e){if(!e)return console.error("验证码发送请求返回数据为空",e),void o.dialog.alert("验证码发送失败");i.isTime=!0;var t=a(function(){i.time--,(i.time<1||!i.isTime)&&(i.isTime=!1,i.time=g,a.cancel(t))},1e3)},function(e){var t=e.data.data&&e.data.data.code;2==t?o.dialog.alert("手机号码错误，验证码发送失败"):3==t?o.dialog.alert("该手机已经绑定"):301!=t&&o.dialog.alert("验证码发送失败"),console.error("验证码发送失败",e)})}}},e.bindPhone=function(){if(e.phone&&(!e.phoneInfo.current||e.phoneForm.curPhone.$error.pattern))return void(e.curPhoneInput=-1);if(!e.phoneInfo.fresh||e.phoneForm.freshPhone.$error.pattern)return void(e.freshPhoneInput=-1);if(!e.phoneInfo.verification)return void(e.verifyPhoneInput=-1);if(e.phone&&p!=e.phoneInfo.current)return void i(function(){o.dialog.alert("原手机号码错误")},500);var t=e.phoneInfo.fresh;return e.phone&&t==e.phoneInfo.current?void i(function(){o.dialog.alert("新手机号码不能和当前手机号码相同")},500):void s.bindPhone({pcode:e.phoneInfo.verification,phone:e.phoneInfo.fresh,phoneOld:e.phone?e.phoneInfo.current:void 0,t:e.phone?"Change":"Bind"}).then(function(i){return i?(o.dialog.alert("绑定成功！"),h(t),void e.cancel(0)):(console.error("绑定手机请求返回数据为空",i),void o.dialog.alert("绑定失败"))},function(e){var t=e.data.data&&e.data.data.code;2==t?o.dialog.alert("手机号码有误,绑定失败"):5==t?o.dialog.alert("验证码错误"):301!=t&&o.dialog.alert("绑定失败"),console.error("绑定手机请求失败",e)})},e.resetPass=function(){return e.phone?e.passInfo.verification?!e.passInfo.fresh||e.passForm.freshPass.$error.pattern?void(e.freshPassInput=-1):void s.resetPassword({pcode:e.passInfo.verification,phone:p,pwd:e.passInfo.fresh}).then(function(t){return t?(o.dialog.alert("修改成功！"),void e.cancel(1)):(console.error("重置密码请求返回数据为空",t),void o.dialog.alert("修改失败"))},function(e){var t=e.data.data&&e.data.data.code;5==t||1==t?o.dialog.alert("验证码错误"):301!=t&&o.dialog.alert("修改失败"),console.error("重置密码请求失败",e)}):void(e.verifyPassInput=-1):void 0},e.showForm=function(t){0==t?(e.showPhoneForm=!e.showPhoneForm,!e.showPhoneForm&&e.cancel(0)):(e.showPassForm=!e.showPassForm,!e.showPassForm&&e.cancel(1))},e.cancel=function(t){var i=0==t?e.phoneInfo:e.passInfo;i.current="",i.fresh="",i.verification="",0==t?e.showPhoneForm=!1:e.showPassForm=!1,0==t?e.verifyPhone.isTime=!1:e.verifyPass.isTime=!1,0==t?e.curPhoneInput=e.freshPhoneInput=e.verifyPhoneInput=0:e.verifyPassInput=e.freshPassInput=0}}]),module.config(["$provide",function(e){e.decorator("$exceptionHandler",["$delegate",function(e){return function(t,i){e(t,i),console.error({origin:"AngularJS Error",msg:t.message,stack:t.stack}),document.runErrorCallUpgrade()}}])}]),module.controller("mainCtrl",["$scope","$rootScope","$http","service","$cookies","$timeout",function(e,t,i,a,n,o){function s(){var e=localStorage.getItem("anonymousLoginUsr");return e&&"error"!==e?(t.anonymousUser=JSON.parse(e),void(n.stoken=t.anonymousUser.token)):void i({method:"GET",url:"http://"+g_conf.SSO+"/sso/api/anonymousLogin"}).then(function(e){if(0!==e.data.code)return console.error(e.data.msg,"匿名登录失败"),void localStorage.setItem("anonymousLoginUsr","error");
var i=e.data.data;i.usr.token=i.token,localStorage.setItem("anonymousLoginToken",i.token),delete i.usr.BAttr,delete i.usr.attrs,localStorage.setItem("anonymousLoginUsr",JSON.stringify(i.usr)),t.anonymousUser=i.usr,n.stoken=i.usr.token},function(e){localStorage.setItem("anonymousLoginUsr","error"),console.error(e,"匿名登录失败")})}function r(i){d.token=rcpAid.getToken(),e.setUserData(UINFO),l(t.currentUser.role),console.log("checkLogin by token")}function c(e){console.log("未登陆",e),rcpAid.isLogin=0,l({}),o(function(){t.$broadcast("login","")},0)}function l(t){function i(t){angular.forEach(t,function(t){var i=!1;angular.forEach(e.itemList,function(e){t.name===e.name&&(i=!0)}),i||e.itemList.push(t)})}function a(){var e=rcpAid.getUrl,t=[];return angular.forEach(arguments,function(i){switch(i){case"学习中心":t.push({ic:"L2",name:i,href:e(i)});break;case"教学中心":t.push({ic:"L2",name:i,href:e(i)});break;case"助学中心":"undefined"==typeof isIE||isIE(9,9)||t.push({ic:"L2",name:i,href:e(i)});break;case"管理中心":t.push({ic:"L1",name:i,href:e(i)});break;case"创建新课程":t.push({ic:"L4",name:i,href:e("创建课程",{type:10})})}}),t}e.itemList=[],angular.forEach(t,function(t,n){switch(n){case"default":break;case"student":e.user.schoolId&&i(a("学校空间")),e.user.classId&&i(a("班级空间"));break;case"parent":i(a("家长空间"));break;case"teacher":e.user.schoolId&&i(a("学校空间")),e.user.classId&&i(a("班级空间"));break;case"help":i(a("助学中心"));break;case"class":i(a("班级空间","学校空间"));break;case"school":i(a("学校空间"));break;case"UCS_ADMIN":i(a("管理中心"));break;case"COURSE_VERIFY_ADMIN":i(a("管理中心"));break;case"PAGE_EDIT_ADMIN":i(a("管理中心"))}}),i(a("学习中心","教学中心","创建新课程","创建新题库"))}function h(){return t.currentUser={},$("body").show(),a.common.checkLogin(r,c),rcpAid.isLogin?void 0:(console.log("未登陆"),void s())}$("body").show();var d={};try{d=new ars.ARS,d.args={},d.delay=1e3,d.pushDelay=1e4,d.url=DYCONFIG.ars.rUrl+"pub/api/record",d.token=rcpAid.getToken(),d.start()}catch(p){d={}}e.setUserData=function(e){try{if(console.log(e),!e.uid)return;t.currentUser={uid:e.usr.id,nickName:e.usr.attrs.basic.nickName,avatar:e.usr.attrs.basic.avatar,desc:e.usr.attrs.basic.desc,role:e.usr.attrs.role||""},e.usr.attrs.pass&&(t.currentUser.certification=e.usr.attrs.pass.certification),console.log("发广播",t.currentUser),o(function(){t.$broadcast("login",t.currentUser)},0)}catch(i){console.log(i)}},h()}]),module.factory("ssoMethod",["request",function(e){var t=DYCONFIG.sso.rUrl;return{getUserAttrs:function(){return UINFO&&UINFO.usr&&UINFO.usr.attrs?UINFO.usr.attrs:void 0},userInfo:function(i,a){i=i||{},i.token=rcpAid.getToken();var n={method:"GET",url:t+"sso/api/uinfo",params:i};return e(angular.extend(n,a||{}))},updateUser:function(i,a){var n={method:"POST",url:t+"usr/api/update",params:{token:rcpAid.getToken()},data:i};return e(angular.extend(n,a||{}))},sendMessage:function(i,a){i.token=rcpAid.getToken();var n={method:"GET",url:t+"tlogin/api/sendMessage",params:i};return e(angular.extend(n,a||{}))},bindPhone:function(i,a){i.token=rcpAid.getToken();var n={method:"GET",url:t+"tlogin/api/bindPhone",params:i};return e(angular.extend(n,a||{}))},resetPassword:function(i,a){i.token=rcpAid.getToken();var n={method:"GET",url:t+"tlogin/api/resetPwd",params:i};return e(angular.extend(n,a||{}))},GCertList:function(i,a){i.token=rcpAid.getToken();var n={method:"GET",url:t+"cert/api/list",params:i};return e(angular.extend(n,a||{}))},UCertStatus:function(i,a){var n={method:"POST",url:t+"cert/api/update",params:{token:rcpAid.getToken()},data:i};return e(angular.extend(n,a||{}))}}}]),module.run(["service","ssoMethod",function(e,t){e.expand("ssoMethod",function(){return t})}]),module.factory("headSearch",["request",function(e){var t=g_conf.pes.rUrl;return{SearchIntelligent:function(i,a){var n={method:"GET",url:t+"pub/api/SearchIntelligent",params:i,option:{loading:!1}};return e(angular.extend(n,a||{}))}}}]),module.run(["service","headSearch",function(e,t){e.expand("headSearch",function(){return t})}]),module.directive("headnav",function(){return{template:'<header><div ng-class="headMaximizeLock ? \'head-maximize\' : \'head-minimize\'"><div ng-class="param.style"><div class="image-head-rainbow decoration-ic"></div><section class="g-m-w header-area"><div class="minimize-logo"><a ng-href="{{param.logo.href||\'/\'}}"><img ng-src="{{param.logo.small}}" alt="{{param.logo.msg}}" title="{{param.logo.msg}}"></a></div><nav class="minimize-nav"><ul><li ng-repeat="item in navList track by $index" ng-class="item.class"><a ng-href="{{item.href || \'\'}}" target="{{item.target || \'_self\'}}">{{item.name}}</a><div ng-if="item.child.length"><ul><li ng-repeat="c in item.child"><a ng-href="{{c.href || \'\'}}" target="{{c.target || \'_self\'}}">{{c.name}}</a></li></ul></div></li></ul></nav><div class="logo"><a ng-href="{{param.logo.href||\'/\'}}"><img ng-src="{{param.logo.large}}" alt="{{param.logo.msg}}" title="{{param.logo.msg}}"></a></div><div class="top-user-menu-bar" ng-class="{clearminw: user.account}"><top-user-menu user="user" item-list="itemList"></top-user-menu></div><div class="h-sc" ng-controller="headSearchCtrl"><div class="head-search-bar"><div class="enter" ng-click="stopPropagation($event)"><input type="text" class="input" ng-model="scText" ng-keydown="onkeydown($event)" ng-change="matchChange(scSelectVal.value,scText)" placeholder="请输入关键词搜索"><div class="match-kw-v" ng-show="matchReadyLock"><div class="mc-list"><ul><li ng-if="!mcCourseList || !mcCourseList.length">暂无相关内容</li><li ng-repeat="item in mcCourseList track by $index" ng-click="intoDetail(item)" ng-if="$index < cMaxLen" ng-class="{hover: $index + lMaxLen == moveKeyIndex}" ng-mouseenter="mouseenter($index, \'资源\')"><div class="text-of pd-r10"><span class="lab" ng-if="item.t == 10">课程</span> <span class="lab" ng-if="item.t == 20">题库</span> <a class="item-name" ng-bind-html="item.name | titleMatchKw:scText"></a></div></li></ul></div></div></div><a ng-click="goToSearch(scSelectVal.value,scText)" class="submit" title="提交"><i class="fa fa-search" aria-hidden="true"></i></a></div><div class="hot-word"><a ng-href="javascript:void(0);" ng-click="goToSort(item.name)" class="mg-r20" ng-repeat="item in scHotWord">{{item.name}}</a></div></div></section><section class="nav-area"><div class="g-m-w"><div class="n-categories" ng-controller="categoriesCtrl" ng-mouseenter="service.mouseenter(hover)" ng-mouseleave="service.mouseleave(hover)"><div class="dt">全部课程</div><div class="dd" id="by-categories" ng-show="categoriesUnfoldLock || hover.mouseEnterLock"><div class="image-giraffe giraffe-icon"></div><div class="dd-inner"><div class="item" ng-repeat="item in categoriesListStyle1 track by $index" ng-mouseenter="service.mouseenter(item)" ng-mouseleave="service.mouseleave(item)" ng-show="$index<5 || hover.mouseEnterLock"><div class="layer"><h3><a ng-href="goToCategory(item.name)" target="_blank" title="{{item.name}}">{{item.name}}</a></h3><div class="hot-word"><a ng-href="goToCategory(item.name,child.name)" target="_blank" class="text-of" ng-repeat="child in item.child track by $index" ng-show="$index<3" title="{{child.name}}">{{child.name}}</a></div><i>&gt;</i></div><div class="sub" ng-show="item.mouseEnterLock"><div class="inner"><dl class="card" ng-repeat="child in item.child track by $index" ng-show="$index<3"><dt><a ng-href="goToCategory(item.name,child.name)" target="_blank" class="f-r">更多&gt;&gt;</a> <a ng-href="goToCategory(item.name,child.name)" target="_blank" title="{{child.name}}">{{child.name}}</a></dt><dd><a ng-href="goToCategory(item.name,child.name,unit.name)" target="_blank" class="text-of" ng-repeat="unit in child.child track by $index" ng-show="$index<15" title="{{unit.name}}">{{unit.name}}</a></dd></dl><div class="more-srot" ng-show="item.child.length>3"><a ng-href="goToCategory(item.name)" target="_blank" class="f-r">更多分类&gt;&gt;</a>. . .</div></div></div></div><div ng-repeat="list in categoriesListStyle2 track by $index"><div class="big-sort"><a ng-href="goToCategory(item.name)" target="_blank" title="{{list.name}}">{{list.name}}</a></div><div class="item" ng-repeat="item in list.child track by $index" ng-mouseenter="service.mouseenter(item)" ng-mouseleave="service.mouseleave(item)"><div class="layer"><h3><a ng-href="goToCategory(list.name,item.name)" target="_blank" title="{{item.name}}">{{item.name}}</a></h3><i>&gt;</i></div><div class="sub" ng-show="item.mouseEnterLock"><div class="inner"><dl class="card" ng-repeat="child in item.child track by $index" ng-show="$index<4"><dt><a ng-href="goToCategory(list.name,item.name,child.name)" target="_blank" class="f-r">更多&gt;&gt;</a> <a ng-href="goToCategory(list.name,item.name,child.name)" target="_blank" title="{{child.name}}">{{child.name}}</a></dt><dd><a ng-href="goToCategory(list.name,item.name,child.name,unit.name)" target="_blank" class="text-of" ng-repeat="unit in child.child track by $index" ng-show="$index<10" title="{{unit.name}}">{{unit.name}}</a></dd></dl><div class="more-srot" ng-show="item.child.length>4"><a ng-href="goToCategory(list.name,item.name)" target="_blank" class="f-r">更多分类&gt;&gt;</a>. . .</div></div></div></div></div></div></div></div><nav class="nav"><a ng-repeat="item in navList track by $index" ng-href="{{item.href || \'\'}}" target="{{item.target || \'_self\'}}" ng-class="item.class">{{item.name}}</a></nav><div class="extra" ng-show=""><a href="javascript:void(0);" class="icf t-icf">名师认证</a> <a href="javascript:void(0);" class="icf e-icf">真实评价</a> <a href="javascript:void(0);" class="icf r-icf">随时退</a></div></div></section></div></div></header>',restrict:"E",replace:!0,transclude:!0,scope:{itemList:"=itemList",user:"=user",nav:"="},controller:["$rootScope","$scope","$element","$attrs","service",function(e,t,i,a,n){t.service=n,t.catType=parseInt(rcpAid.getCourseCat()),e.$watch("headMaximizeLock",function(e){e&&(t.headMaximizeLock=e)}),e.$watch("categoriesUnfoldLock",function(e){e&&(t.categoriesUnfoldLock=e)}),e.$watch("catDomain",function(e){if(e)switch(e){case"aikexue.com":t.init(2)}}),t.$on("login",function(e,i){i&&t.loginInit()}),t.loginInit=function(){3===t.catType&&(t.navList=[{name:"学习中心",href:rcpAid.getUrl("学习中心"),"class":"key",target:"_blank"},{name:"教学中心",href:rcpAid.getUrl("教学中心",{uid:t.user.tid}),"class":"key",target:"_blank"},{name:"高等教育",href:rcpAid.getUrl("分类",{category:"高等教育"}),"class":"key",target:"_blank"}])},t.init=function(e){if("order"===t.nav)return t.navList=[{name:"首页",href:rcpAid.getUrl("首页"),"class":"key"},{name:"个人空间",href:rcpAid.getUrl("学习中心"),"class":"key",target:"_blank"}],void(t.param={logo:{small:"/rcp-common/imgs/order/head-icon.png",large:"/rcp-common/imgs/icon/head-icon.png",href:"/my-order.html",msg:"我的酷校"},style:""});switch(t.catType){case 3:t.isLogin?t.navList=[{name:"学习中心",href:rcpAid.getUrl("学习中心"),"class":"key",target:"_blank"},{name:"教学中心",href:rcpAid.getUrl("教学中心",{uid:t.user.tid}),"class":"key",target:"_blank"},{name:"高等教育",href:rcpAid.getUrl("分类",{category:"高等教育"}),"class":"key",target:"_blank"}]:t.navList=[{name:"高等教育",href:rcpAid.getUrl("分类",{category:"高等教育"}),"class":"key",target:"_blank"}],t.param={logo:{small:"/rcp-common/imgs/icon/gzmooc-logo.png",large:"/rcp-common/imgs/icon/gzmooc-logo.png",href:DYCONFIG.rcp.rUrl,msg:"酷校 - 首页"},style:""};break;case 2:t.navList=[{name:"首页",href:rcpAid.getUrl("首页"),"class":"key"},{name:"全部课程",href:rcpAid.getUrl("分类"),"class":"key",target:"_blank"},{name:"学习中心",href:rcpAid.getUrl("学习中心"),"class":"key",target:"_blank"}],t.param={logo:{small:"/rcp-common/imgs/icon/aikexue-logo-2.png",large:"/rcp-common/imgs/icon/aikexue-logo.png",href:DYCONFIG.rcp.rUrl,msg:"爱科学"},style:"aikexue-head"};break;default:t.navList=[{name:"首页",href:rcpAid.getUrl("首页"),"class":"key"},{name:"学习中心",href:rcpAid.getUrl("学习中心"),"class":"key",target:"_blank"},{name:"我要吐槽",href:rcpAid.getUrl("我要吐槽"),"class":"key",target:"_blank"}],t.param={logo:{small:"/rcp-common/imgs/icon/book-logo-2.png",large:"/rcp-common/imgs/icon/book-logo.png",href:DYCONFIG.rcp.rUrl,msg:"酷校LOGO·让学习更Cool"},style:""}}},t.init()}]}}),module.directive("topUserMenu",function(){return{template:'<div class="top-user-menu"><div style="font-size:14px;line-height:40px" ng-show="!currentUser.uid"><a ng-href="{{link.login}}" id="login" class="color-cyan pd-l20"><i class="image-login-user-ic"></i>马上登录 </a><span style="color:#ececec;margin:0 8px">| </span><a ng-href="{{link.register}}" class="color-cyan">注册</a></div><div class="menber-link" ng-show="currentUser.uid"><a href="" class="u-info" rel="member_link"><img ng-hide="currentUser.avatar" src="/rcp-common/imgs/face/d-face-1.png" class="face-img" width="40" height="40" rel="user_face" alt="{{currentUser.nickName}}"> <img ng-show="currentUser.avatar" ng-src="{{currentUser.avatar}}" class="face-img" width="40" height="40" rel="user_face" alt="{{currentUser.nickName}}"> <span class="name" rel="user_name" title="{{currentUser.nickName}}" ng-bind="currentUser.nickName"></span> <i class="x-arrow-dowm">&gt;</i></a><div class="u-panel"><div class="tup-box"><div class="tup-info" rel="user_info_box"><div class="user-head" rel="user_face_box"><a ng-href="{{link.setting}}"><img ng-hide="currentUser.avatar" src="/rcp-common/imgs/face/d-face-1.png" width="96" height="96" class="face-img" rel="user_face" alt="{{currentUser.nickName}}"> <img ng-show="currentUser.avatar" ng-src="{{currentUser.avatar}}" width="96" height="96" class="face-img" rel="user_face" alt="{{currentUser.nickName}}"></a></div><div class="user-identity"><p class="user-name text-of"><a href="" rel="user_name" title="{{currentUser.nickName}}" ng-bind="currentUser.nickName"></a></p><p class="attestation-un" ng-class="{\'attestation\':attestation==\'已认证\'}"><i class="image-attestation-yellow"></i> <span>{{attestation}}</span></p></div><div class="clear"></div></div><div class="tup-operate"><div class="card-sets"><a href="{{link.applySpaceUrl}}" class="key f-l"><i class="image-attestation"></i> <span class="text-4f">认证管理</span> </a><a href="{{link.setting}}" target="_blank" class="key f-l"><i class="image-settings"></i> <span class="text-4f">设置</span> </a><a href="" class="key f-r" ng-click="logout()"><i class="image-logout"></i> <span class="text-4f">退出</span></a></div><div class="card-links"><a ng-repeat="item in itemList" ng-href="{{item.href || \'\'}}" ng-class="item.name == \'...\' ? \'disabled key \'+item.icon : \'key \'+item.icon"><i></i> <span>{{item.name}}</span></a></div></div></div></div></div></div>',restrict:"E",replace:!0,transclude:!0,scope:{itemList:"=itemList",user:"=user"},controller:["$rootScope","$scope","$timeout","$location","service",function(e,t,i,a,n){t.$watch("itemList",function(e){if(e){var i=t.itemList.length,a=i%3;if(a)for(var n=3-i%3+i,o=i;n>o;o+=1)e.push({name:"..."})}},!0),t.logout=function(){var e=rcpAid.getUrl("首页");location.href=rcpAid.getUrl("退出",{url:encodeURIComponent(e)})},t.$on("login",function(e,i){i.uid&&t.loginInit()}),t.loginInit=function(){t.currentUser=e.currentUser,t.currentUser.certification&&(t.attestation="已认证")},t.init=function(){var e=rcpAid.getNoTokenUrl();t.link={login:rcpAid.getUrl("登录",{url:encodeURIComponent(e)}),register:rcpAid.getUrl("注册",{url:encodeURIComponent(e)}),applySpaceUrl:rcpAid.getUrl("实名认证"),setting:rcpAid.getUrl("个人设置",{url:window.location.href})},t.attestation="未认证"},t.init()}]}}),module.controller("categoriesCtrl",["$rootScope","$scope","service",function(e,t,i){function a(e){switch(e){case 2:t.categoriesListStyle2=n||[];break;default:t.categoriesListStyle1=n||[]}}t.service=i,t.hover={},t.catType=rcpAid.getCourseCat(),t.byCategories=function(){t.byCategoriesLoading=!0,a(t.catType)},t.listenerMember={byCategories:{node:"#by-categories",callback:t.byCategories}};var n;t.goToCategory=function(){var e=[].slice;return rcpAid.getUrl("分类",{tags:e.call(arguments,0).join(",")})}}]),module.directive("searchDir",function(){return{template:'<div class="h-sc"><div class="head-search-bar"><div class="enter" ng-click="stopPropagation($event)"><input type="text" class="input" ng-model="scText" ng-keydown="onkeydown($event)" ng-change="matchChange(scSelectVal.value,scText)" placeholder="请输入关键词搜索"><div class="match-kw-v" ng-show="matchReadyLock"><div class="mc-list"><ul><li ng-repeat="item in mcCategoryList track by $index" ng-if="$index < lMaxLen" ng-class="{hover: $index == moveKeyIndex}" ng-mouseenter="mouseenter($index,\'类\')" ng-click="matchGoToCategory(item.tag,scText)"><div class="text-of"><a href="javascript:;">{{text}}</a> 在 <a href="javascript:;" class="item-name color-cyan">{{item.tag}}</a> 分类中搜索</div></li></ul><div style="margin:0 10px;border-top:1px solid #dfdfdf" ng-if="mcCourseList.length && mcCategoryList.length"></div><ul><li ng-if="!mcCourseList || !mcCourseList.length">暂无相关内容</li><li ng-repeat="item in mcCourseList track by $index" ng-click="intoDetail(item)" ng-if="$index < cMaxLen" ng-class="{hover: $index + lMaxLen == moveKeyIndex}" ng-mouseenter="mouseenter($index,\'资源\')"><div class="text-of"><span class="lab" ng-if="item.t == 10">课程</span> <span class="lab" ng-if="item.t == 20">题库</span> <a href="javascript:;" class="item-name" ng-bind-html="item.name|titleMatchKw:scText"></a></div></li></ul></div></div></div><a ng-click="goToSearch(scSelectVal.value,scText)" class="submit" title="提交"><i class="fa fa-search" aria-hidden="true"></i></a></div><div class="hot-word"><a href="" class="mg-r20" ng-repeat="item in scHotWord" ng-click="goToSort(item.name)">{{item.name}}</a></div></div>',restrict:"E",replace:!0,transclude:!0,scope:{hot:"="},controller:"headSearchCtrl"}}),module.controller("headSearchCtrl",["$rootScope","$scope","$document","$element","service","headSearch",function(e,t,i,a,n,o){function s(){t.scText="",d()}function r(){y=!0,t.KeyDownIndex=t.moveKeyIndex,h()}function c(){"number"!=typeof t.moveKeyIndex?t.moveKeyIndex=0:t.moveKeyIndex=(t.moveKeyIndex+1)%t.aMaxLen,r()}function l(){"number"!=typeof t.moveKeyIndex?t.moveKeyIndex=t.aMaxLen-1:t.moveKeyIndex=t.moveKeyIndex<0?t.aMaxLen-1:t.moveKeyIndex-1,r(),u(t.scText.length)}function h(){var e,i=t.KeyDownIndex,a=t.lMaxLen;return t.scTag=void 0,a>i&&(t.scText=t.text),i>=a&&(e=t.mcCourseList[i-t.lMaxLen],e&&(t.scText=e.name)),e}function d(e){t.matchReadyLock=!1,e&&(i.unbind("click"),t.$digest())}function p(){i.unbind("click").bind("click",function(){d("digest")}),t.matchReadyLock=!0}function g(){t.matchReadyLock&&(clearTimeout(w),w=setTimeout(function(){d("digest")},300))}function u(e){var t=a.find('input[ng-model="scText"]').get(0);if("selectionStart"in t&&(t.selectionStart=e,t.selectionEnd=e),"createTextRange"in t){var i=t.createTextRange();i.moveStart("character",e),i.collapse(!0),i.select()}}function m(e,i){t.inSort&&!angular.isArray(e)||angular.forEach(e,function(e){return t.inSort?!1:void(i(e)||angular.isArray(e.child)&&e.child.length&&(m(e.child,i),v("push",e.name)))})}function f(e,i){switch(t.inSort=!1,v("clear"),m(e,function(e){return t.inSort=e.name===i,t.inSort&&v("push",e.name),t.inSort}),t.inSort){case!0:v("splice",i);break;default:v("clear")}return t.categorySelect}function v(e,i){var a=t.categorySelect;switch(e){case"clear":a.splice(0,a.length);break;case"push":a.push(i);break;case"splice":a.splice(0,$.inArray(i,a))}}function x(e,t){n.dialog.alert(t),console[e](t)}function b(e){var t=[];if(e.length)for(var i=0,a=e.length;a>i;i++)t.push({id:e[i].hasOwnProperty("id")?e[i].id:"",name:e[i].hasOwnProperty("title")?e[i].title:"",t:e[i].hasOwnProperty("type")?e[i].type:""});return t}t.scHotWord=[],t.scSelect=[{name:"所有分类",value:"",fixLock:!0},{name:"课程",value:10},{name:"题库",value:20}],t.scSelectVal=t.scSelect[0],t.onkeydown=function(e){switch(e.stopPropagation(),e.keyCode){case 13:t.scText||(t.scText=$(".head-search-bar input").eq(0).val());var i=t.KeyDownIndex,a=t.lMaxLen;"number"==typeof i&&i>=0&&a>i&&t.scTag?t.matchGoToCategory(t.scTag,t.scText):i>=0&&t.matchReadyLock?location.href=rcpAid.getUrl("课程详情",{cid:t.mcCourseList[i].id}):t.goToSearch(t.scSelectVal.value,t.scText);break;case 38:l();break;case 40:c();break;default:y=!1,t.moveKeyIndex=void 0,t.KeyDownIndex=void 0,t.scTag=void 0}};var y,w;a.find('input[ng-model="scText"]').unbind("focus").bind("focus",p),a.find('input[ng-model="scText"]').unbind("blur").bind("blur",g),t.mouseenter=function(e,i){switch(i){case"类":t.moveKeyIndex=e;break;case"资源":t.moveKeyIndex=e+t.lMaxLen}},t.goToSearch=function(e,t){s(),location.href=rcpAid.getUrl("搜索",{type:e,query:t?encodeURIComponent(t):t})},t.goToSort=function(e){s(),location.href=rcpAid.getUrl("分类",{tags:e})},t.stopPropagation=function(e){e.stopPropagation()},t.matchChange=function(e,i){if(!y){if(d(),!i)return t.mcCategoryList=[],void(t.mcCourseList=[]);t.text=i,o.SearchIntelligent({key:i,courseType:e||null,limit:10}).then(function(e){t.scText&&(t.matchReadyLock=!0,t.mcCourseList=b(e.data.courses||[]),t.mcCategoryList=[],t.lMaxLen=t.mcCategoryList.length>3?3:t.mcCategoryList.length,t.cMaxLen=t.mcCourseList.length-t.lMaxLen,t.aMaxLen=t.lMaxLen+t.cMaxLen,t.mcCourseList.length||t.mcCategoryList.length||d())},function(e){x("错误代码："+e.data.data.code)})}},t.$watch("scSelectVal.value",function(){t.matchChange(t.scSelectVal.value,t.scText)}),t.matchGoToCategory=function(t,i){if(!e.allTagCategroy||!e.allTagCategroy.length)return void x("error","获取分类数据失败");var a=f(e.allTagCategroy,t).reverse().join(",");a?(s(),location.href=rcpAid.getUrl("分类",{tags:a,query:i})):x("error","找不到这个分类，请检查接口数据")},t.categorySelect=[],t.intoDetail=function(e){e.hasOwnProperty("id")&&(location.href=rcpAid.getUrl("课程详情",{cid:e.id}))}}]),module.directive("tailnav",function(){return{template:'<footer><section class="footer" id="footer"><div class="g-m-w"><div class="copyright"><p>广州市大洋信息技术股份有限公司 版权所有</p><p>Copyright © 2015 ITDAYANG. All Rights Reserved.</p><p>{{caseNumber}}</p></div><div class="footer-link"><a href="http://www.itdayang.com/about.html" target="_blank">关于我们</a> <span>- </span><a href="http://www.itdayang.com/contact.html" target="_blank">联系我们</a> <span>- </span><a href="javascript:;" ng-click="atBuilding()">法律条款</a> <span>- </span><a href="javascript:;" ng-click="atBuilding()">帮助中心</a> <span>- </span><a href="javascript:;" ng-click="atBuilding()">学校申请加入</a> <span>- </span><a href="javascript:;" ng-click="atBuilding()">机构申请加入</a> <span>- </span><a href="javascript:;" ng-click="atBuilding()">意见反馈</a></div><div class="clear"></div></div></section></footer>',restrict:"E",replace:!0,transclude:!0,scope:{data:"=data"},controller:["$scope","service",function(e,t){e.catType=rcpAid.getCourseCat();var i=DYCONFIG.domain||[];angular.forEach(i,function(t){t.domain===location.host&&(e.caseNumber=t.domainNum)}),e.atBuilding=function(){t.dialog.alert("正在建设中...")}}]}}),module.filter("titleMatchKw",["$sce",function(e){return function(t,i){var a="<b>"+i+"</b>",n=/([\[\]\(\)\{\}\*\?\+\^\$\.\|\\])/gi,o=i.replace(n,"\\$1");return t=t.replace(new RegExp(o,"ig"),a),e.trustAsHtml(t)}}]),function(){function e(){var n=document.getElementById("footer");if(n){var o=document.documentElement.scrollHeight-1||document.body.scrollHeight-1,s=document.documentElement.clientHeight||document.body.clientHeight;a=s>=o?1:2,a!==i&&(s>=o?(t(n.parentNode,{height:n.offsetHeight+"px"}),t(n,{position:"absolute",width:"100%",bottom:0,left:0})):(t(n.parentNode,{height:n.offsetHeight+"px"}),t(n,{position:"",width:"100%",bottom:0,left:0}))),i=s>=o?1:2}setTimeout(e)}if(!window.fixedFooterFlag){window.fixedFooterFlag=!0;var t=function(e,t){for(k in t)e.style[k]=t[k]},i=0,a=1;e()}}(),module.directive("uploadImgBase",function(){return{template:'<div id="upload-img-{{uploadConfig.id}}" ng-show="uploadConfig.showEdit"><div class="cropper-tool imgCropTool" ng-show="uploadConfig.mode===\'fixed\'"><div class="cropper-tool-a"><div class="cropper-tool-b"><div class="up-header jf-drag"><div class="f-l">上传图片</div><div class="f-r"><a ng-click="cancelImg()" href="" class="close-panel">×</a></div><div class="clear"></div></div><div class="up-body"><div class="show-tool f-l"><div class="cropper-img-fixed" ng-style="containerStyle"><img ng-src="{{newImg}}" alt="Picture" src=""></div><div id="img-view-{{uploadConfig.id}}" style="display:none" class="img-view"></div></div><div class="show-line"></div><div class="show-pre f-l"><div class="pd-20"><span class="name-img">预览：</span><div class="img-preview"></div></div></div><div class="clear"></div><div id="img-show-cover" class="loading" ng-show="upLoading"><div class="cover-img" style=""><img alt="loading..." src="../../rcp-common/imgs/loading1.gif" class="mg-r10"> 上传中...</div></div></div><div class="up-footer"><div class="btn-grp"><a ng-click="confirmImg()" class="confirm mg-r10">上传</a> <a ng-click="cancelImg()" class="cancel mg-l10">取消</a></div></div></div></div></div><div class="imgCropTool img-crop-tool" ng-show="uploadConfig.mode===\'course\'"><div ng-show="upLoading" class="loading-cover"><div class="cover-img"><img src="../../rcp-common/imgs/loading1.gif" class="mg-r10">上传中...</div></div><table><tr><td class="show-tool"><div class="cropper-img-course"><img ng-src="{{newImg}}" alt="Picture" src=""></div><div id="img-view-{{uploadConfig.id}}" style="display:none"></div></td><td class="show-pre"><span class="name-img">封面预览：</span><div class="img-preview"></div><div class="btn-grp"><a ng-click="confirmImg()" class="confirm">上传</a> <a ng-click="cancelImg()" class="cancel">取消</a></div></td></tr></table></div><input type="file" id="upload-input-{{uploadConfig.id}}" style="display:none"></div>',restrict:"E",replace:!0,transclude:!0,scope:{uploadConfig:"="},controller:["$scope","$timeout","$http","service",function(e,t,i,a){e.uploadConfig.scope=e,e.uploadConfig.aspectRatio=e.uploadConfig.ratio?e.uploadConfig.ratio[0]/e.uploadConfig.ratio[1]:16/9,e.containerStyle=e.uploadConfig.containerStyle||{width:"300px",height:"300px"},e.init=function(){var n=$("#upload-img-"+e.uploadConfig.id),o=$("#upload-input-"+e.uploadConfig.id),s=$("#img-view-"+e.uploadConfig.id);e.upLoading=!1,e.newImg="",e.selectImg=function(){o.trigger("click")},e.confirmImg=function(){if(e.upLoading!==!0){var i=r.cropper("getCroppedCanvas",{width:e.uploadConfig.width||550,style:"display:none",fillColor:"#FFFFFF"});i.id="canvas",i.display=!1,s.html(i),r.on({"zoom.cropper":function(e){}}),t(function(){var t=$("#canvas")[0].toDataURL("img/png"),i=t.split(",");return 2!==i.length?void a.dialog.alert("图片转换失败，请重试"):(e.upLoading=!0,void e.uploadBasePic({baseCode:i[1]}))})}},e.cancelImg=function(){e.upLoading=!1,"block"===n.get(0).style.display&&n.get(0).off(),e.uploadConfig.upCancel=!0,e.uploadConfig.showEdit=!1},e.uploadBasePic=function(t){var o={m:t.m||"C",pub:t.pub||"1",picType:t.picType||"1",fileName:t.fileName||"1.png",name:t.fileName||"1.png",base64:1,token:rcpAid.getToken()};i({method:"POST",url:DYCONFIG.fs.upload+"?"+$.param(o),data:t.baseCode||"",headers:{"Content-Type":"multipart/form-data"}}).success(function(t){e.upLoading=!1,e.uploadConfig.showEdit=!1,0===t.code?("block"===n.get(0).style.display&&n.get(0).off(),e.uploadConfig.cb(t.data)):a.dialog.alert(t.msg)}).error(function(t){e.upLoading=!1,e.uploadConfig.showEdit=!1,console.log(t)})};var r=$(".cropper-img-"+e.uploadConfig.mode+" > img");r.cropper({aspectRatio:e.uploadConfig.aspectRatio,autoCropArea:.85,preview:".img-preview",strict:!1,guides:!0,highlight:!0,dragCrop:!1,cropBoxMovable:!0,cropBoxResizable:!1});var c={URL:window.URL||window.webkitURL,blobURL:null,inputImage:o};c.inputImage.change(function(){var t,i=this.files;r.data("cropper")&&i&&i.length&&(console.log("step1"),t=i[0],/^image\/\w+$/.test(t.type)?(e.uploadConfig.showEdit=!0,c.blobURL=c.URL.createObjectURL(t),r.one("built.cropper",function(){c.URL.revokeObjectURL(c.blobURL)}).cropper("reset").cropper("replace",c.blobURL),c.inputImage.val(""),e.$apply()):(a.dialog.alert("只支持以下格式图片上传：png,jpg,bmp,gif,jpeg。"),c.blobURL=c.URL.createObjectURL(t),c.inputImage.val("")))})},t(function(){e.init()})}]}}),module.directive("locationSelect",function(){return{template:'<div class="choice-selector"><div class="con" ng-show="state"><select class="p-r" ng-model="data.province" ng-options="item as item for item in state"></select><i class="fa fa-chevron-down chevron" aria-hidden="true"></i></div><div class="con m-l" ng-show="city"><select class="p-r" ng-model="data.city" ng-options="item as item for item in city"></select><i class="fa fa-chevron-down chevron" aria-hidden="true"></i></div></div>',restrict:"E",replace:!0,transclude:!0,scope:{data:"="},controller:["$scope","$timeout",function(e,t){console.log("location-select"),isIE(9,9)&&($(".choice-selector .chevron").hide(),$(".choice-selector .p-r").removeClass("p-r")),e.$watch("data.province",function(t,i){e.city=a[t],i&&(e.data.city=e.city[0])});var i=["安徽","澳门","北京","重庆","福建","广东","甘肃","广西","贵州","河北","湖北","黑龙江","海南","河南","湖南","吉林","江苏","江西","辽宁","内蒙古","宁夏","青海","四川","山东","上海","陕西","山西","天津","台湾","西藏","香港","新疆","云南","浙江","国外"],a={"安徽":["安庆","蚌埠","亳州","滁州","巢湖","池州","阜阳","合肥","淮南","淮北","黄山","六安","马鞍山","宿州","铜陵","芜湖","宣城"],"澳门":["大堂区","风顺堂区","花地玛堂区","嘉模堂区","圣安多尼堂区","圣方济各堂区","望德堂区"],"北京":["崇文区","朝阳区","昌平区","东城区","大兴区","丰台区","房山区","海淀区","怀柔区","门头沟区","密云县","平谷区","石景山区","顺义区","通州区","西城区","宣武区","延庆县"],"重庆":["北碚区","巴南区","壁山县","长寿区","城口县","大渡口区","大足县","垫江县","涪陵区","丰都县","奉节县","合川区","江北区","九龙坡区","江津区","开县","梁平县","南岸区","南川区","彭水苗族土家族自治县","綦江县","黔江区","荣昌县","沙坪坝区","双挢区","石柱土家族自治县","潼南县","铜梁县","万州区","万盛区","武隆县","巫山县","巫溪县","秀山土家族苗族自治县","渝中区","渝北区","云阳县","酉阳土家族苗族自治县","永川区","忠县"],"福建":["福州","龙岩","南平","宁德","莆田","泉州","厦门","三明","漳州"],"广东":["潮州","东莞","佛山","广州","惠州","河源","江门","揭阳","茂名","梅州","清远","韶关","深圳","汕头","汕尾","阳江","云浮","珠海","湛江","肇庆","中山"],"甘肃":["白银","定西","甘南","嘉峪关","金昌","酒泉","兰州","陇南","临夏","平凉","庆阳","天水","武威","张掖"],"广西":["北海","百色","崇左","防城港","桂林","贵港","贺州","河池","柳州","来宾","南宁","钦州","梧州","玉林"],"贵州":["安顺","毕节","贵阳","六盘水","黔西南","黔东南","黔南","铜仁","遵义"],"河北":["保定","承德","沧州","邯郸","衡水","廊坊","秦皇岛","石家庄","唐山","邢台","张家口"],"湖北":["鄂州","恩施","黄石","黄冈","荆门","荆州","潜江","十堰","随州","神农架","天门","武汉","襄樊","孝感","咸宁","仙桃","宜昌"],"黑龙江":["大庆","大兴安岭","哈尔滨","鹤岗","黑河","鸡西","佳木斯","牡丹江","齐齐哈尔","七台河","双鸭山","绥化","伊春"],"海南":["儋州","东方","海口","琼海","三亚","五指山","文昌","万宁"],"河南":["安阳","鹤壁","焦作","济源","开封","洛阳","漯河","南阳","平顶山","濮阳","三门峡","商丘","新乡","许昌","信阳","郑州","周口","驻马店"],"湖南":["长沙","常德","郴州","衡阳","怀化","娄底","邵阳","湘潭","湘西","岳阳","益阳","永州","株洲","张家界"],"吉林":["白山","白城","长春","吉林","辽源","四平","松原","通化","延边"],"江苏":["常州","淮安","连云港","南京","南通","苏州","宿迁","泰州","无锡","徐州","盐城","扬州","镇江"],"江西":["抚州","赣州","景德镇","九江","吉安","南昌","萍乡","上饶","新余","鹰潭","宜春"],"辽宁":["鞍山","本溪","朝阳","大连","丹东","抚顺","阜新","葫芦岛","锦州","辽阳","盘锦","沈阳","铁岭","营口"],"内蒙古":["阿拉善","包头","巴彦淖尔","赤峰","鄂尔多斯","呼和浩特","呼伦贝尔","通辽","乌海","乌兰察布","兴安","锡林郭勒"],"宁夏":["固原","石嘴山","吴忠","银川","中卫"],"青海":["果洛","海东","海北","黄南","海南","梅西","西宁","玉树"],"四川":["阿坝","巴中","成都","德阳","达川","广元","广安","甘孜","泸州","乐山","凉山","绵阳","眉山","内江","南充","攀枝花","遂宁","宜宾","雅安","自贡","资阳"],"山东":["滨州","东营","德州","菏泽","济南","济宁","莱芜","临沂","聊城","青岛","日照","泰安","潍坊","威海","烟台","淄博","枣庄"],"上海":["宝山区","长宁区","崇明县","奉贤区","黄浦区","虹口区","静安区","嘉定区","金山区","卢湾区","闵行区","普陀区","浦东新区","青浦区","松江区","徐汇区","杨浦区","闸北区"],"陕西":["安康","宝鸡","汉中","商洛","铜川","渭南","西安","咸阳","延安","榆林"],"山西":["长治","大同","晋城","晋中","临汾","吕梁","朔州","太原","忻州","阳泉","运城"],"天津":["滨海新区","北辰区","宝坻区","东丽区","和平区","河东区","河西区","河北区","红挢区","津南区","静海县","蓟县","南开区","宁河区","武清区","西青区"],"台湾":["高雄市","高雄县","花莲县","基隆市","嘉义市","嘉义县","苗栗县","南投县","屏东县","澎湖县","台北市","台中市","台南市","台北县","桃园县","台中县","台南县","台东县","新竹市","新竹县","宜兰县","云林县","彰化县"],"西藏":["阿里","昌都","拉萨","林芝","那曲","日喀则","山南"],"香港":["北区","东区","大埔区","观塘区","黄大仙区","九龙城区","葵青区","离岛区","南区","荃湾区","深水区","沙田区","屯门区","湾仔区","西贡区","油尖旺区","元朗区","中西区"],"新疆":["阿克苏","阿勒泰","阿拉尔","博尔塔拉","巴音郭楞","昌吉","哈密","和田","克拉玛依","克孜勒苏","喀什","石河子","吐鲁番","塔城","图木舒克","乌鲁木齐","五家渠","伊犁"],"云南":["保山","楚雄","大理","德宏","迪庆","红河","昆明","丽江","临沧","怒江傈","普洱","曲靖","文山","西双版纳","玉溪","昭通"],"浙江":["杭州","湖州","嘉兴","金华","丽水","宁波","衢州","绍兴","台州","温州","舟山"],"国外":[]};e.state=i,e.city=a[e.data.province]}]}});